2025-01-14T13:09:18.5182930Z ##[group]Run pytest tardis --tardis-regression-data=/Users/runner/work/tardis/tardis/tardis-regression-data --cov=tardis --cov-report=xml --cov-report=html --cov-append -m "not continuum"
2025-01-14T13:09:18.5183980Z [36;1mpytest tardis --tardis-regression-data=/Users/runner/work/tardis/tardis/tardis-regression-data --cov=tardis --cov-report=xml --cov-report=html --cov-append -m "not continuum"[0m
2025-01-14T13:09:18.5283090Z shell: /bin/bash -l {0}
2025-01-14T13:09:18.5283390Z env:
2025-01-14T13:09:18.5283540Z   CACHE_NUMBER: 0
2025-01-14T13:09:18.5284050Z   PYTEST_FLAGS: --tardis-regression-data=/Users/runner/work/tardis/tardis/tardis-regression-data --cov=tardis --cov-report=xml --cov-report=html --cov-append
2025-01-14T13:09:18.5284580Z   CODECOV_TOKEN: 
2025-01-14T13:09:18.5284760Z   MAMBA_ROOT_PREFIX: /Users/runner/micromamba
2025-01-14T13:09:18.5285020Z   MAMBA_EXE: /Users/runner/micromamba-bin/micromamba
2025-01-14T13:09:18.5285340Z   CONDARC: /Users/runner/work/_temp/setup-micromamba/.condarc
2025-01-14T13:09:18.5285620Z ##[endgroup]
2025-01-14T13:09:32.9518900Z ============================= test session starts ==============================
2025-01-14T13:09:32.9520830Z platform darwin -- Python 3.12.4, pytest-8.2.2, pluggy-1.5.0
2025-01-14T13:09:32.9525850Z rootdir: /Users/runner/work/tardis/tardis
2025-01-14T13:09:32.9527110Z configfile: pyproject.toml
2025-01-14T13:09:32.9527960Z plugins: cov-5.0.0, html-4.1.1, metadata-3.1.1, doctestplus-1.2.1, anyio-4.4.0
2025-01-14T13:09:32.9531430Z collected 1796 items / 2 deselected / 1794 selected
2025-01-14T13:09:32.9533490Z 
2025-01-14T13:09:37.2880370Z tardis/energy_input/tests/test_energy_source.py ..xxx                    [  0%]
2025-01-14T13:09:39.0529720Z tardis/energy_input/tests/test_gamma_ray_channel.py ...........          [  0%]
2025-01-14T13:09:40.3507830Z tardis/energy_input/tests/test_gamma_ray_grid.py xx.                     [  1%]
2025-01-14T13:09:41.5934680Z tardis/energy_input/tests/test_gamma_ray_interactions.py xx....          [  1%]
2025-01-14T13:09:41.6035250Z tardis/energy_input/tests/test_gamma_ray_packet_source.py sssssssss      [  1%]
2025-01-14T13:09:42.7317610Z tardis/energy_input/tests/test_util.py .....xxxx.....                    [  2%]
2025-01-14T13:09:43.1158710Z tardis/grid/tests/test_grid.py .                                         [  2%]
2025-01-14T13:09:43.1169870Z tardis/gui/tests/test_gui.py s                                           [  2%]
2025-01-14T13:09:46.6914280Z tardis/io/configuration/tests/test_config_reader.py ...........          [  3%]
2025-01-14T13:09:46.7003970Z tardis/io/configuration/tests/test_configuration_namespace.py .........  [  3%]
2025-01-14T13:09:46.7229010Z tardis/io/logger/tests/test_logging.py ssssssssssssssssssssssssssss      [  5%]
2025-01-14T13:10:19.9258280Z tardis/io/model/readers/tests/test_arepo_parser.py ..                    [  5%]
2025-01-14T13:10:19.9855860Z tardis/io/model/readers/tests/test_ascii_readers.py ...                  [  5%]
2025-01-14T13:10:19.9993000Z tardis/io/model/readers/tests/test_cmfgen_reader.py ..                   [  5%]
2025-01-14T13:10:20.0234770Z tardis/io/model/readers/tests/test_csvy_reader.py ....                   [  6%]
2025-01-14T13:10:20.0397800Z tardis/io/model/readers/tests/test_stella_reader.py ..                   [  6%]
2025-01-14T13:10:20.2584120Z tardis/io/tests/test_HDFWriter.py ...............                        [  7%]
2025-01-14T13:10:20.8779600Z tardis/io/tests/test_atomic.py .....                                     [  7%]
2025-01-14T13:10:20.8956610Z tardis/io/tests/test_decay.py ..                                         [  7%]
2025-01-14T13:10:21.0796900Z tardis/io/tests/test_model_reader.py ......                              [  7%]
2025-01-14T13:10:21.0863030Z tardis/model/geometry/tests/test_radial1d.py ..                          [  7%]
2025-01-14T13:10:31.7154650Z tardis/model/tests/test_base.py EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE [ 10%]
2025-01-14T13:10:33.9142890Z EEEEEEEEEEEE                                                             [ 10%]
2025-01-14T13:10:36.4557150Z tardis/model/tests/test_csvy_model.py .........                          [ 11%]
2025-01-14T13:10:36.8203840Z tardis/model/tests/test_density.py EE                                    [ 11%]
2025-01-14T13:10:38.0973340Z tardis/opacities/tests/test_opacity_solver.py EEEEE                      [ 11%]
2025-01-14T13:10:39.6540550Z tardis/opacities/tests/test_opacity_state_numba.py EEEEE                 [ 11%]
2025-01-14T13:10:40.7609280Z tardis/opacities/tests/test_tau_sobolev.py EE                            [ 12%]
2025-01-14T13:10:43.2273810Z tardis/plasma/equilibrium/tests/test_collisional_transitions.py ...      [ 12%]
2025-01-14T13:11:27.2287400Z tardis/plasma/equilibrium/tests/test_level_populations.py ....           [ 12%]
2025-01-14T13:11:37.5658760Z tardis/plasma/equilibrium/tests/test_rate_matrix.py .                    [ 12%]
2025-01-14T13:11:39.2366000Z tardis/plasma/tests/test_complete_plasmas.py .....................s..... [ 13%]
2025-01-14T13:11:41.4870860Z s....ssssss............s............ss.....s....ssssss............s..... [ 18%]
2025-01-14T13:11:42.8377660Z .......ss.....s....ssssss............s............ss.....s....ssssss.... [ 22%]
2025-01-14T13:11:45.6556090Z ........s............ss.....s........ss............s............ss.....s [ 26%]
2025-01-14T13:11:48.4054840Z ........ss............s............ss.....s....ssssss............s...... [ 30%]
2025-01-14T13:11:49.1732760Z ......ss.....s....ssssss............s............ss.....s.ss.ssssss..... [ 34%]
2025-01-14T13:11:51.7759940Z .......s............ss.....s....ssssss............s............ss.....s. [ 38%]
2025-01-14T13:11:54.2086560Z ...ssssss............s............ss.....s....ssssss............s....... [ 42%]
2025-01-14T13:11:56.5169860Z .....ss.....s....ssssss............s............s...........ssssss...... [ 46%]
2025-01-14T13:11:58.3180850Z ......s............s...........ssssss............s............s......... [ 50%]
2025-01-14T13:12:01.2002570Z ..ssssss............s............ss.....s....ssssss............s........ [ 54%]
2025-01-14T13:12:03.9710620Z ....ss.....s....ssssss..........................s.....s....ssss......... [ 58%]
2025-01-14T13:12:04.2905850Z ...................s.....s....ssss.......                                [ 60%]
2025-01-14T13:12:14.1823360Z tardis/plasma/tests/test_hdf_plasma.py EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE [ 62%]
2025-01-14T13:12:15.9448430Z EEEEEE                                                                   [ 62%]
2025-01-14T13:12:16.4048980Z tardis/plasma/tests/test_nlte_excitation.py ...                          [ 62%]
2025-01-14T13:14:13.1916540Z tardis/plasma/tests/test_nlte_solver.py .....X                           [ 63%]
2025-01-14T13:14:13.1960160Z tardis/plasma/tests/test_plasma_continuum.py .                           [ 63%]
2025-01-14T13:14:35.2325020Z tardis/plasma/tests/test_plasma_vboundary.py .............               [ 63%]
2025-01-14T13:14:46.3372630Z tardis/plasma/tests/test_tardis_model_density_config.py ...              [ 64%]
2025-01-14T13:14:46.8608110Z tardis/simulation/tests/test_convergence.py .....                        [ 64%]
2025-01-14T13:14:51.4773960Z tardis/simulation/tests/test_simulation.py EEEEEEEEEE...                 [ 65%]
2025-01-14T13:14:51.4879610Z tardis/spectrum/tests/test_cuda_formal_integral.py sssssssssssssssssssss [ 66%]
2025-01-14T13:14:51.7214560Z ssss...ssssssssssssssssssssss                                            [ 67%]
2025-01-14T13:14:51.7254970Z tardis/spectrum/tests/test_luminosity.py ....                            [ 68%]
2025-01-14T13:14:53.3889640Z tardis/spectrum/tests/test_numba_formal_integral.py .................... [ 69%]
2025-01-14T13:14:53.3999220Z ..........                                                               [ 69%]
2025-01-14T13:14:53.5483530Z tardis/spectrum/tests/test_spectrum.py ................................. [ 71%]
2025-01-14T13:14:53.5799890Z .........                                                                [ 72%]
2025-01-14T13:14:56.2444100Z tardis/spectrum/tests/test_spectrum_solver.py EEEE                       [ 72%]
2025-01-14T13:15:00.8934130Z tardis/tests/test_tardis_full.py FEEE                                    [ 72%]
2025-01-14T13:15:10.8327440Z tardis/tests/test_tardis_full_formal_integral.py EEEEEEEEEEEEEEEE        [ 73%]
2025-01-14T13:15:10.8996410Z tardis/tests/test_util.py .............................................  [ 75%]
2025-01-14T13:15:15.1166320Z tardis/transport/montecarlo/tests/test_base.py xEEEEEEEEEEEEEEEEEEEEE    [ 77%]
2025-01-14T13:15:16.9547280Z tardis/transport/montecarlo/tests/test_interaction.py EEEEEEE            [ 77%]
2025-01-14T13:15:17.1118840Z tardis/transport/montecarlo/tests/test_macro_atom.py EEEE                [ 77%]
2025-01-14T13:15:17.1226360Z tardis/transport/montecarlo/tests/test_montecarlo.py sssssssssssssssssss [ 78%]
2025-01-14T13:15:17.1482530Z sssssssssssssssssssssssssssssssssssssssssssss                            [ 81%]
2025-01-14T13:15:20.7042450Z tardis/transport/montecarlo/tests/test_montecarlo_main_loop.py xFF       [ 81%]
2025-01-14T13:15:20.7129140Z tardis/transport/montecarlo/tests/test_nonhomologous.py ...              [ 81%]
2025-01-14T13:15:21.0146750Z tardis/transport/montecarlo/tests/test_numba_interface.py EEEEExE        [ 82%]
2025-01-14T13:15:21.3342050Z tardis/transport/montecarlo/tests/test_opacities.py ...............      [ 82%]
2025-01-14T13:15:23.6399050Z tardis/transport/montecarlo/tests/test_packet.py .................xxxxxX [ 84%]
2025-01-14T13:15:24.4137350Z XXEEEEEEEEE                                                              [ 84%]
2025-01-14T13:15:24.4428460Z tardis/transport/montecarlo/tests/test_packet_source.py ........         [ 85%]
2025-01-14T13:15:24.6888500Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py . [ 85%]
2025-01-14T13:15:49.0924940Z .FFFF                                                                    [ 85%]
2025-01-14T13:15:55.6646130Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py .FFFEE         [ 85%]
2025-01-14T13:15:55.7794620Z tardis/transport/montecarlo/tests/test_single_packet_loop.py xxx         [ 86%]
2025-01-14T13:15:57.0054870Z tardis/transport/montecarlo/tests/test_tracker_utils.py ..               [ 86%]
2025-01-14T13:15:57.4586640Z tardis/transport/montecarlo/tests/test_vpacket.py EExE                   [ 86%]
2025-01-14T13:15:57.4723930Z tardis/transport/montecarlo/tests/test_weighted_packet_source.py ....    [ 86%]
2025-01-14T13:15:59.0622960Z tardis/transport/montecarlo/tests/test_weighted_packet_source_integration.py F [ 86%]
2025-01-14T13:15:59.0623440Z                                                                          [ 86%]
2025-01-14T13:15:59.6226230Z tardis/transport/tests/test_doppler_factor.py ..................         [ 87%]
2025-01-14T13:16:01.2209970Z tardis/visualization/tools/tests/test_convergence_plot.py .............. [ 88%]
2025-01-14T13:16:02.6772480Z ......                                                                   [ 88%]
2025-01-14T13:16:04.8975930Z tardis/visualization/tools/tests/test_liv_plot.py EEEEEEEEEEEEEEEEEEEEEE [ 90%]
2025-01-14T13:16:06.3546940Z EEEEEEEEEEEEEEEEEEEEEEEEEEEEE                                            [ 91%]
2025-01-14T13:16:07.5052020Z tardis/visualization/tools/tests/test_rpacket_plot.py EEEEEEEEEEEEEEEEEE [ 92%]
2025-01-14T13:16:07.8525720Z EEEE                                                                     [ 92%]
2025-01-14T13:16:10.3624890Z tardis/visualization/tools/tests/test_sdec_plot.py EEEEEEEEEEEEEEEEEEEEE [ 94%]
2025-01-14T13:16:11.9250720Z EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE                                           [ 95%]
2025-01-14T13:16:12.2478150Z tardis/visualization/widgets/tests/test_custom_abundance.py ........ss.. [ 96%]
2025-01-14T13:16:12.2847090Z ....                                                                     [ 96%]
2025-01-14T13:16:17.1113680Z tardis/visualization/widgets/tests/test_line_info.py EEEEEEEEEEEEEEEEEEE [ 97%]
2025-01-14T13:16:23.4111230Z EEEEEEEEEEEEEEEEEE                                                       [ 98%]
2025-01-14T13:16:31.2876720Z tardis/visualization/widgets/tests/test_shell_info.py EEEEEEEEEEEEEEEEEE [ 99%]
2025-01-14T13:16:42.2931310Z EEEEEE                                                                   [100%]
2025-01-14T13:16:42.2933080Z 
2025-01-14T13:16:42.2934930Z ==================================== ERRORS ====================================
2025-01-14T13:16:42.2937300Z _________ ERROR at setup of TestModelFromPaper1Config.test_abundances __________
2025-01-14T13:16:42.2938980Z 
2025-01-14T13:16:42.2941380Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.2946350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.2955400Z 
2025-01-14T13:16:42.2955950Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.2968000Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.2968830Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.2969530Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.2971110Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.2972830Z >       sim.run_final()
2025-01-14T13:16:42.2973250Z 
2025-01-14T13:16:42.2973450Z tardis/conftest.py:233: 
2025-01-14T13:16:42.2976500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.2983010Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.2983590Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.2984620Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.2990550Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.2991650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.2992380Z 
2025-01-14T13:16:42.2993470Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.2997670Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.2998680Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.2999210Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.2999750Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3000130Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3000370Z 
2025-01-14T13:16:42.3000490Z     def initialize_transport_state(
2025-01-14T13:16:42.3000740Z         self,
2025-01-14T13:16:42.3001480Z         simulation_state,
2025-01-14T13:16:42.3001770Z         opacity_state,
2025-01-14T13:16:42.3002560Z         macro_atom_state,
2025-01-14T13:16:42.3002940Z         plasma,
2025-01-14T13:16:42.3003490Z         no_of_packets,
2025-01-14T13:16:42.3003740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3004290Z         iteration=0,
2025-01-14T13:16:42.3005140Z     ):
2025-01-14T13:16:42.3005460Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3005810Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3006140Z         else:
2025-01-14T13:16:42.3006370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3006650Z     
2025-01-14T13:16:42.3006900Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3009250Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3009570Z         )
2025-01-14T13:16:42.3009720Z     
2025-01-14T13:16:42.3009990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3010430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3010790Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3015690Z         else:
2025-01-14T13:16:42.3016360Z             continuum_state = None
2025-01-14T13:16:42.3016630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3017140Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3018020Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3019120Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3019790Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3020550Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3021370Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3022170Z         ).to_numba(
2025-01-14T13:16:42.3022790Z             macro_atom_state,
2025-01-14T13:16:42.3025460Z             self.line_interaction_type,
2025-01-14T13:16:42.3025860Z         )
2025-01-14T13:16:42.3026180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3026600Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3027050Z         ]
2025-01-14T13:16:42.3027410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3027770Z 
2025-01-14T13:16:42.3027930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3028350Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.3033070Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.3045950Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.3047710Z ---------------------------- Captured stderr setup -----------------------------
2025-01-14T13:16:42.3064270Z OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
2025-01-14T13:16:42.3064840Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.3065600Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.3067080Z _________ ERROR at setup of TestModelFromPaper1Config.test_velocities __________
2025-01-14T13:16:42.3068130Z 
2025-01-14T13:16:42.3069940Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3073630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3074820Z 
2025-01-14T13:16:42.3075110Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3077690Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3081170Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3081820Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3083630Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3156850Z >       sim.run_final()
2025-01-14T13:16:42.3157240Z 
2025-01-14T13:16:42.3162780Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3163080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3163390Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3163660Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3163950Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3164250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3164600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3165900Z 
2025-01-14T13:16:42.3166130Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3166580Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3167010Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3167570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3167990Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3168310Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3168490Z 
2025-01-14T13:16:42.3168560Z     def initialize_transport_state(
2025-01-14T13:16:42.3168750Z         self,
2025-01-14T13:16:42.3168940Z         simulation_state,
2025-01-14T13:16:42.3169180Z         opacity_state,
2025-01-14T13:16:42.3169600Z         macro_atom_state,
2025-01-14T13:16:42.3169890Z         plasma,
2025-01-14T13:16:42.3170100Z         no_of_packets,
2025-01-14T13:16:42.3170370Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3170610Z         iteration=0,
2025-01-14T13:16:42.3170880Z     ):
2025-01-14T13:16:42.3171110Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3171520Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3171780Z         else:
2025-01-14T13:16:42.3172020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3172320Z     
2025-01-14T13:16:42.3172640Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3172890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3173590Z         )
2025-01-14T13:16:42.3173970Z     
2025-01-14T13:16:42.3174260Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3174660Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3175550Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3176350Z         else:
2025-01-14T13:16:42.3177030Z             continuum_state = None
2025-01-14T13:16:42.3177900Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3178670Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3179480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3180200Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3180990Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3181680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3182420Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3183250Z         ).to_numba(
2025-01-14T13:16:42.3183850Z             macro_atom_state,
2025-01-14T13:16:42.3184490Z             self.line_interaction_type,
2025-01-14T13:16:42.3184790Z         )
2025-01-14T13:16:42.3185050Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3185530Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3185990Z         ]
2025-01-14T13:16:42.3186360Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3186730Z 
2025-01-14T13:16:42.3186910Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3187300Z __________ ERROR at setup of TestModelFromPaper1Config.test_densities __________
2025-01-14T13:16:42.3187580Z 
2025-01-14T13:16:42.3188170Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3189110Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3189510Z 
2025-01-14T13:16:42.3189650Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3190380Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3190720Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3191000Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3191320Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3191510Z >       sim.run_final()
2025-01-14T13:16:42.3191610Z 
2025-01-14T13:16:42.3191660Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3191860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3192090Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3192350Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3192600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3192860Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3193150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3193310Z 
2025-01-14T13:16:42.3193520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3193960Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3194370Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3194850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3195270Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3195570Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3195750Z 
2025-01-14T13:16:42.3195810Z     def initialize_transport_state(
2025-01-14T13:16:42.3195980Z         self,
2025-01-14T13:16:42.3196110Z         simulation_state,
2025-01-14T13:16:42.3196470Z         opacity_state,
2025-01-14T13:16:42.3196630Z         macro_atom_state,
2025-01-14T13:16:42.3196770Z         plasma,
2025-01-14T13:16:42.3196900Z         no_of_packets,
2025-01-14T13:16:42.3197050Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3197220Z         iteration=0,
2025-01-14T13:16:42.3197350Z     ):
2025-01-14T13:16:42.3197510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3197750Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3197930Z         else:
2025-01-14T13:16:42.3198060Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3198210Z     
2025-01-14T13:16:42.3198380Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3198640Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3198820Z         )
2025-01-14T13:16:42.3198930Z     
2025-01-14T13:16:42.3199090Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3199360Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3199630Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3199870Z         else:
2025-01-14T13:16:42.3199990Z             continuum_state = None
2025-01-14T13:16:42.3200190Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3200420Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3200640Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3200850Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3201070Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3201300Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3201510Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3201690Z         ).to_numba(
2025-01-14T13:16:42.3201820Z             macro_atom_state,
2025-01-14T13:16:42.3201990Z             self.line_interaction_type,
2025-01-14T13:16:42.3202160Z         )
2025-01-14T13:16:42.3202300Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3202680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3203190Z         ]
2025-01-14T13:16:42.3203500Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3203820Z 
2025-01-14T13:16:42.3203930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3205140Z _______ ERROR at setup of TestModelFromPaper1Config.test_time_explosion ________
2025-01-14T13:16:42.3205790Z 
2025-01-14T13:16:42.3207290Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3211820Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3212230Z 
2025-01-14T13:16:42.3212310Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3212570Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3212850Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3213140Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3213420Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3213610Z >       sim.run_final()
2025-01-14T13:16:42.3213700Z 
2025-01-14T13:16:42.3213770Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3213970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3214210Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3214460Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3214710Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3217450Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3217740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3217910Z 
2025-01-14T13:16:42.3218120Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3218560Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3218970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3219440Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3219850Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3220150Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3220330Z 
2025-01-14T13:16:42.3220390Z     def initialize_transport_state(
2025-01-14T13:16:42.3220570Z         self,
2025-01-14T13:16:42.3220710Z         simulation_state,
2025-01-14T13:16:42.3220870Z         opacity_state,
2025-01-14T13:16:42.3221020Z         macro_atom_state,
2025-01-14T13:16:42.3221170Z         plasma,
2025-01-14T13:16:42.3221290Z         no_of_packets,
2025-01-14T13:16:42.3221440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3221620Z         iteration=0,
2025-01-14T13:16:42.3221750Z     ):
2025-01-14T13:16:42.3224780Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3225030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3225220Z         else:
2025-01-14T13:16:42.3225350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3225510Z     
2025-01-14T13:16:42.3225680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3225920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3226110Z         )
2025-01-14T13:16:42.3226220Z     
2025-01-14T13:16:42.3226380Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3226660Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3227310Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3227550Z         else:
2025-01-14T13:16:42.3227690Z             continuum_state = None
2025-01-14T13:16:42.3227880Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3228110Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3228330Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3228560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3228790Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3229000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3229210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3229390Z         ).to_numba(
2025-01-14T13:16:42.3229530Z             macro_atom_state,
2025-01-14T13:16:42.3229700Z             self.line_interaction_type,
2025-01-14T13:16:42.3229880Z         )
2025-01-14T13:16:42.3230030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3230410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3230750Z         ]
2025-01-14T13:16:42.3231060Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3231370Z 
2025-01-14T13:16:42.3231490Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3231870Z _________ ERROR at setup of TestModelFromASCIIDensity.test_velocities __________
2025-01-14T13:16:42.3232100Z 
2025-01-14T13:16:42.3232610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3233680Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3234050Z 
2025-01-14T13:16:42.3234110Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3234370Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3234640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3234920Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3235190Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3235370Z >       sim.run_final()
2025-01-14T13:16:42.3235670Z 
2025-01-14T13:16:42.3235730Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3236070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3236630Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3237090Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3237490Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3238000Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3240120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3240790Z 
2025-01-14T13:16:42.3241360Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3243200Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3243760Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3244310Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3244860Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3245230Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3245490Z 
2025-01-14T13:16:42.3245610Z     def initialize_transport_state(
2025-01-14T13:16:42.3245860Z         self,
2025-01-14T13:16:42.3246060Z         simulation_state,
2025-01-14T13:16:42.3246530Z         opacity_state,
2025-01-14T13:16:42.3247570Z         macro_atom_state,
2025-01-14T13:16:42.3247820Z         plasma,
2025-01-14T13:16:42.3248090Z         no_of_packets,
2025-01-14T13:16:42.3248320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3248640Z         iteration=0,
2025-01-14T13:16:42.3248820Z     ):
2025-01-14T13:16:42.3249100Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3249410Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3249720Z         else:
2025-01-14T13:16:42.3250460Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3251470Z     
2025-01-14T13:16:42.3252090Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3253430Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3254260Z         )
2025-01-14T13:16:42.3255060Z     
2025-01-14T13:16:42.3256010Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3256970Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3257930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3272860Z         else:
2025-01-14T13:16:42.3273060Z             continuum_state = None
2025-01-14T13:16:42.3273370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3273650Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3273880Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3274110Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3274330Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3274560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3274770Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3274950Z         ).to_numba(
2025-01-14T13:16:42.3275100Z             macro_atom_state,
2025-01-14T13:16:42.3276540Z             self.line_interaction_type,
2025-01-14T13:16:42.3276740Z         )
2025-01-14T13:16:42.3276900Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3277300Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3277760Z         ]
2025-01-14T13:16:42.3278080Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3278400Z 
2025-01-14T13:16:42.3278520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3278870Z _________ ERROR at setup of TestModelFromASCIIDensity.test_abundances __________
2025-01-14T13:16:42.3279090Z 
2025-01-14T13:16:42.3279620Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3280520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3280880Z 
2025-01-14T13:16:42.3280960Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3281220Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3281510Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3281810Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3282200Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3282410Z >       sim.run_final()
2025-01-14T13:16:42.3282510Z 
2025-01-14T13:16:42.3282570Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3282760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3283000Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3283250Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3283520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3283780Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3284420Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3284580Z 
2025-01-14T13:16:42.3284800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3285240Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3285640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3286100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3286510Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3286830Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3287010Z 
2025-01-14T13:16:42.3287080Z     def initialize_transport_state(
2025-01-14T13:16:42.3287260Z         self,
2025-01-14T13:16:42.3287390Z         simulation_state,
2025-01-14T13:16:42.3287560Z         opacity_state,
2025-01-14T13:16:42.3287720Z         macro_atom_state,
2025-01-14T13:16:42.3287860Z         plasma,
2025-01-14T13:16:42.3287990Z         no_of_packets,
2025-01-14T13:16:42.3288150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3288320Z         iteration=0,
2025-01-14T13:16:42.3288450Z     ):
2025-01-14T13:16:42.3288610Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3288860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3289050Z         else:
2025-01-14T13:16:42.3289180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3289340Z     
2025-01-14T13:16:42.3289500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3289750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3289940Z         )
2025-01-14T13:16:42.3290170Z     
2025-01-14T13:16:42.3290360Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3290620Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3290900Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3291140Z         else:
2025-01-14T13:16:42.3291270Z             continuum_state = None
2025-01-14T13:16:42.3291470Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3291700Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3291920Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3293050Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3293790Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3294400Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3295230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3296010Z         ).to_numba(
2025-01-14T13:16:42.3296530Z             macro_atom_state,
2025-01-14T13:16:42.3297040Z             self.line_interaction_type,
2025-01-14T13:16:42.3297800Z         )
2025-01-14T13:16:42.3298280Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3299350Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3300490Z         ]
2025-01-14T13:16:42.3301310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3301670Z 
2025-01-14T13:16:42.3301800Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3302140Z _________ ERROR at setup of TestModelFromArtisDensity.test_velocities __________
2025-01-14T13:16:42.3302370Z 
2025-01-14T13:16:42.3302910Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3303880Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3304770Z 
2025-01-14T13:16:42.3304840Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3305110Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3305390Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3305680Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3306150Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3306330Z >       sim.run_final()
2025-01-14T13:16:42.3306430Z 
2025-01-14T13:16:42.3306490Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3306690Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3306950Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3307240Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3307490Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3307760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3308050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3308200Z 
2025-01-14T13:16:42.3308430Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3308920Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3310640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3311190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3311650Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3311980Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3312860Z 
2025-01-14T13:16:42.3313120Z     def initialize_transport_state(
2025-01-14T13:16:42.3313640Z         self,
2025-01-14T13:16:42.3314060Z         simulation_state,
2025-01-14T13:16:42.3314510Z         opacity_state,
2025-01-14T13:16:42.3315590Z         macro_atom_state,
2025-01-14T13:16:42.3316530Z         plasma,
2025-01-14T13:16:42.3316940Z         no_of_packets,
2025-01-14T13:16:42.3317530Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3318070Z         iteration=0,
2025-01-14T13:16:42.3318510Z     ):
2025-01-14T13:16:42.3319050Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3319810Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3320400Z         else:
2025-01-14T13:16:42.3321240Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3322490Z     
2025-01-14T13:16:42.3322700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3323280Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3323730Z         )
2025-01-14T13:16:42.3323850Z     
2025-01-14T13:16:42.3324040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3324460Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3325110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3325360Z         else:
2025-01-14T13:16:42.3325500Z             continuum_state = None
2025-01-14T13:16:42.3325730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3325990Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3326210Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3326550Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3326840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3327080Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3327940Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3328630Z         ).to_numba(
2025-01-14T13:16:42.3329130Z             macro_atom_state,
2025-01-14T13:16:42.3329940Z             self.line_interaction_type,
2025-01-14T13:16:42.3330930Z         )
2025-01-14T13:16:42.3331130Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3331550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3332130Z         ]
2025-01-14T13:16:42.3332590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3333030Z 
2025-01-14T13:16:42.3333200Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3333620Z _________ ERROR at setup of TestModelFromArtisDensity.test_abundances __________
2025-01-14T13:16:42.3333870Z 
2025-01-14T13:16:42.3334790Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3337160Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3338510Z 
2025-01-14T13:16:42.3338870Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3339890Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3341620Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3341980Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3342260Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3342480Z >       sim.run_final()
2025-01-14T13:16:42.3342670Z 
2025-01-14T13:16:42.3343130Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3344260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3344500Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3345080Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3345370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3345840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3346760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3347260Z 
2025-01-14T13:16:42.3348050Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3348560Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3349150Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3350040Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3350580Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3350980Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3351240Z 
2025-01-14T13:16:42.3351310Z     def initialize_transport_state(
2025-01-14T13:16:42.3351520Z         self,
2025-01-14T13:16:42.3351650Z         simulation_state,
2025-01-14T13:16:42.3351830Z         opacity_state,
2025-01-14T13:16:42.3351990Z         macro_atom_state,
2025-01-14T13:16:42.3352140Z         plasma,
2025-01-14T13:16:42.3352270Z         no_of_packets,
2025-01-14T13:16:42.3353630Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3353840Z         iteration=0,
2025-01-14T13:16:42.3353970Z     ):
2025-01-14T13:16:42.3354140Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3354420Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3355430Z         else:
2025-01-14T13:16:42.3355600Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3355780Z     
2025-01-14T13:16:42.3355960Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3357220Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3357420Z         )
2025-01-14T13:16:42.3357530Z     
2025-01-14T13:16:42.3358620Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3358900Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3359190Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3359430Z         else:
2025-01-14T13:16:42.3359580Z             continuum_state = None
2025-01-14T13:16:42.3359790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3360900Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3361170Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3363220Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3363470Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3363710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3363940Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3364140Z         ).to_numba(
2025-01-14T13:16:42.3364290Z             macro_atom_state,
2025-01-14T13:16:42.3364480Z             self.line_interaction_type,
2025-01-14T13:16:42.3364670Z         )
2025-01-14T13:16:42.3364820Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3365230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3365630Z         ]
2025-01-14T13:16:42.3365980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3366810Z 
2025-01-14T13:16:42.3366940Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3367330Z ____ ERROR at setup of TestModelFromArtisDensityAbundances.test_velocities _____
2025-01-14T13:16:42.3367590Z 
2025-01-14T13:16:42.3368140Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3373220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3377200Z 
2025-01-14T13:16:42.3377290Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3378920Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3379330Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3379750Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3380940Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3381280Z >       sim.run_final()
2025-01-14T13:16:42.3382250Z 
2025-01-14T13:16:42.3382450Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3384010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3384530Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3384890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3385720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3386180Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3387240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3388290Z 
2025-01-14T13:16:42.3388940Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3390460Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3392100Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3392920Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3397120Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3398800Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3403250Z 
2025-01-14T13:16:42.3406180Z     def initialize_transport_state(
2025-01-14T13:16:42.3407530Z         self,
2025-01-14T13:16:42.3408100Z         simulation_state,
2025-01-14T13:16:42.3440910Z         opacity_state,
2025-01-14T13:16:42.3441220Z         macro_atom_state,
2025-01-14T13:16:42.3441380Z         plasma,
2025-01-14T13:16:42.3441520Z         no_of_packets,
2025-01-14T13:16:42.3441670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3441840Z         iteration=0,
2025-01-14T13:16:42.3441970Z     ):
2025-01-14T13:16:42.3442140Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3443190Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3443430Z         else:
2025-01-14T13:16:42.3443590Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3443780Z     
2025-01-14T13:16:42.3443950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3444250Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3444430Z         )
2025-01-14T13:16:42.3444550Z     
2025-01-14T13:16:42.3444720Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3444980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3445270Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3445520Z         else:
2025-01-14T13:16:42.3445670Z             continuum_state = None
2025-01-14T13:16:42.3446770Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3447030Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3447320Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3447690Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3448040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3448280Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3448930Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3449340Z         ).to_numba(
2025-01-14T13:16:42.3449600Z             macro_atom_state,
2025-01-14T13:16:42.3449790Z             self.line_interaction_type,
2025-01-14T13:16:42.3450010Z         )
2025-01-14T13:16:42.3450260Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3450700Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3451250Z         ]
2025-01-14T13:16:42.3451630Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3451990Z 
2025-01-14T13:16:42.3452120Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3452500Z ____ ERROR at setup of TestModelFromArtisDensityAbundances.test_abundances _____
2025-01-14T13:16:42.3452780Z 
2025-01-14T13:16:42.3453360Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3454320Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3454690Z 
2025-01-14T13:16:42.3454770Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3455040Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3455340Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3455640Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3455920Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3456100Z >       sim.run_final()
2025-01-14T13:16:42.3456200Z 
2025-01-14T13:16:42.3456250Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3456460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3456700Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3457520Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3457780Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3458040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3458330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3458500Z 
2025-01-14T13:16:42.3458720Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3459180Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3462000Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3463590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3464710Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3465390Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3466540Z 
2025-01-14T13:16:42.3466860Z     def initialize_transport_state(
2025-01-14T13:16:42.3467080Z         self,
2025-01-14T13:16:42.3467220Z         simulation_state,
2025-01-14T13:16:42.3467390Z         opacity_state,
2025-01-14T13:16:42.3467540Z         macro_atom_state,
2025-01-14T13:16:42.3467700Z         plasma,
2025-01-14T13:16:42.3467830Z         no_of_packets,
2025-01-14T13:16:42.3467980Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3468160Z         iteration=0,
2025-01-14T13:16:42.3468290Z     ):
2025-01-14T13:16:42.3468460Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3468700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3469770Z         else:
2025-01-14T13:16:42.3469920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3470110Z     
2025-01-14T13:16:42.3470300Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3470780Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3471080Z         )
2025-01-14T13:16:42.3471200Z     
2025-01-14T13:16:42.3471370Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3471650Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3472520Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3473440Z         else:
2025-01-14T13:16:42.3473700Z             continuum_state = None
2025-01-14T13:16:42.3473920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3474170Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3474410Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3474790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3475050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3477070Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3477670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3478240Z         ).to_numba(
2025-01-14T13:16:42.3479030Z             macro_atom_state,
2025-01-14T13:16:42.3480340Z             self.line_interaction_type,
2025-01-14T13:16:42.3480570Z         )
2025-01-14T13:16:42.3481690Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3483890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3485720Z         ]
2025-01-14T13:16:42.3486050Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3486400Z 
2025-01-14T13:16:42.3486770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3487440Z _ ERROR at setup of TestModelFromArtisDensityAbundancesVSlice.test_velocities __
2025-01-14T13:16:42.3489000Z 
2025-01-14T13:16:42.3489590Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3491540Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3491890Z 
2025-01-14T13:16:42.3491960Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3492220Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3492610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3493110Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3493400Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3493580Z >       sim.run_final()
2025-01-14T13:16:42.3493680Z 
2025-01-14T13:16:42.3493740Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3493950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3494180Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3494440Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3494810Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3496850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3497520Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3497690Z 
2025-01-14T13:16:42.3497900Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3498360Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3498950Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3499440Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3500290Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3500670Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3501270Z 
2025-01-14T13:16:42.3501580Z     def initialize_transport_state(
2025-01-14T13:16:42.3502200Z         self,
2025-01-14T13:16:42.3503250Z         simulation_state,
2025-01-14T13:16:42.3503770Z         opacity_state,
2025-01-14T13:16:42.3504410Z         macro_atom_state,
2025-01-14T13:16:42.3504570Z         plasma,
2025-01-14T13:16:42.3505290Z         no_of_packets,
2025-01-14T13:16:42.3505500Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3506500Z         iteration=0,
2025-01-14T13:16:42.3506660Z     ):
2025-01-14T13:16:42.3507250Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3507520Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3508600Z         else:
2025-01-14T13:16:42.3508770Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3508950Z     
2025-01-14T13:16:42.3509120Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3509390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3509590Z         )
2025-01-14T13:16:42.3509720Z     
2025-01-14T13:16:42.3509890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3510180Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3510600Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3510860Z         else:
2025-01-14T13:16:42.3511010Z             continuum_state = None
2025-01-14T13:16:42.3511200Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3511760Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3512030Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3512260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3512510Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3512740Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3512950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3513920Z         ).to_numba(
2025-01-14T13:16:42.3514240Z             macro_atom_state,
2025-01-14T13:16:42.3514450Z             self.line_interaction_type,
2025-01-14T13:16:42.3514630Z         )
2025-01-14T13:16:42.3514780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3516340Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3517300Z         ]
2025-01-14T13:16:42.3518220Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3518770Z 
2025-01-14T13:16:42.3518900Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3519900Z _ ERROR at setup of TestModelFromArtisDensityAbundancesVSlice.test_abundances __
2025-01-14T13:16:42.3520310Z 
2025-01-14T13:16:42.3520880Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3522190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3522560Z 
2025-01-14T13:16:42.3523380Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3525280Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3525610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3525890Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3526960Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3527870Z >       sim.run_final()
2025-01-14T13:16:42.3528350Z 
2025-01-14T13:16:42.3528460Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3531790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3532180Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3532480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3532890Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3533440Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3533730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3533900Z 
2025-01-14T13:16:42.3534130Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3534580Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3535480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3536000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3536430Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3537980Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3539430Z 
2025-01-14T13:16:42.3539520Z     def initialize_transport_state(
2025-01-14T13:16:42.3539690Z         self,
2025-01-14T13:16:42.3539820Z         simulation_state,
2025-01-14T13:16:42.3539970Z         opacity_state,
2025-01-14T13:16:42.3540940Z         macro_atom_state,
2025-01-14T13:16:42.3541510Z         plasma,
2025-01-14T13:16:42.3541910Z         no_of_packets,
2025-01-14T13:16:42.3542380Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3542920Z         iteration=0,
2025-01-14T13:16:42.3543380Z     ):
2025-01-14T13:16:42.3543880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3544540Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3545070Z         else:
2025-01-14T13:16:42.3545460Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3545980Z     
2025-01-14T13:16:42.3546490Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3548110Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3549160Z         )
2025-01-14T13:16:42.3549710Z     
2025-01-14T13:16:42.3549880Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3550790Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3551080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3551330Z         else:
2025-01-14T13:16:42.3551480Z             continuum_state = None
2025-01-14T13:16:42.3551700Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3553450Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3553680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3553910Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3555160Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3555850Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3556540Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3557310Z         ).to_numba(
2025-01-14T13:16:42.3557470Z             macro_atom_state,
2025-01-14T13:16:42.3557910Z             self.line_interaction_type,
2025-01-14T13:16:42.3558090Z         )
2025-01-14T13:16:42.3558240Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3560650Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3562210Z         ]
2025-01-14T13:16:42.3563120Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3564360Z 
2025-01-14T13:16:42.3565180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3567860Z __________ ERROR at setup of TestModelFromUniformDensity.test_density __________
2025-01-14T13:16:42.3569870Z 
2025-01-14T13:16:42.3574030Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3575770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3578990Z 
2025-01-14T13:16:42.3579790Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3580300Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3580730Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3581450Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3581940Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3583280Z >       sim.run_final()
2025-01-14T13:16:42.3586220Z 
2025-01-14T13:16:42.3588980Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3632270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3632700Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3632970Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3633220Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3633490Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3633790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3634000Z 
2025-01-14T13:16:42.3634230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3634710Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3635140Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3635610Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3636070Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3636820Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3637000Z 
2025-01-14T13:16:42.3637070Z     def initialize_transport_state(
2025-01-14T13:16:42.3637240Z         self,
2025-01-14T13:16:42.3637370Z         simulation_state,
2025-01-14T13:16:42.3637530Z         opacity_state,
2025-01-14T13:16:42.3637670Z         macro_atom_state,
2025-01-14T13:16:42.3637820Z         plasma,
2025-01-14T13:16:42.3637950Z         no_of_packets,
2025-01-14T13:16:42.3638100Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3638270Z         iteration=0,
2025-01-14T13:16:42.3638400Z     ):
2025-01-14T13:16:42.3638570Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3638830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3639010Z         else:
2025-01-14T13:16:42.3639150Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3639300Z     
2025-01-14T13:16:42.3639470Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3639720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3639900Z         )
2025-01-14T13:16:42.3640010Z     
2025-01-14T13:16:42.3640170Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3640430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3640730Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3640990Z         else:
2025-01-14T13:16:42.3641120Z             continuum_state = None
2025-01-14T13:16:42.3641320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3641550Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3641770Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3641980Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3642370Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3642590Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3642810Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3642990Z         ).to_numba(
2025-01-14T13:16:42.3643130Z             macro_atom_state,
2025-01-14T13:16:42.3643310Z             self.line_interaction_type,
2025-01-14T13:16:42.3643520Z         )
2025-01-14T13:16:42.3643670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3644040Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3644410Z         ]
2025-01-14T13:16:42.3644720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3645040Z 
2025-01-14T13:16:42.3645160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3645530Z ____ ERROR at setup of TestModelFromInitialTinner.test_initial_temperature _____
2025-01-14T13:16:42.3645790Z 
2025-01-14T13:16:42.3646320Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3647240Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3647620Z 
2025-01-14T13:16:42.3647690Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3647950Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3648240Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3648530Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3648830Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3649030Z >       sim.run_final()
2025-01-14T13:16:42.3649140Z 
2025-01-14T13:16:42.3649200Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3649390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3649780Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3650040Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3650290Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3650570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3650870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3651040Z 
2025-01-14T13:16:42.3651260Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3651700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3652100Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3652590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3653030Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3653340Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3653520Z 
2025-01-14T13:16:42.3653590Z     def initialize_transport_state(
2025-01-14T13:16:42.3653760Z         self,
2025-01-14T13:16:42.3653890Z         simulation_state,
2025-01-14T13:16:42.3654050Z         opacity_state,
2025-01-14T13:16:42.3654200Z         macro_atom_state,
2025-01-14T13:16:42.3654350Z         plasma,
2025-01-14T13:16:42.3654470Z         no_of_packets,
2025-01-14T13:16:42.3654620Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3654840Z         iteration=0,
2025-01-14T13:16:42.3654980Z     ):
2025-01-14T13:16:42.3655180Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3655450Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3655760Z         else:
2025-01-14T13:16:42.3655900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3656100Z     
2025-01-14T13:16:42.3656280Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3656580Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3656800Z         )
2025-01-14T13:16:42.3656920Z     
2025-01-14T13:16:42.3657120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3657410Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3657740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3658130Z         else:
2025-01-14T13:16:42.3658300Z             continuum_state = None
2025-01-14T13:16:42.3658530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3658790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3659020Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3659300Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3659570Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3659840Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3660110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3660340Z         ).to_numba(
2025-01-14T13:16:42.3660510Z             macro_atom_state,
2025-01-14T13:16:42.3660720Z             self.line_interaction_type,
2025-01-14T13:16:42.3660940Z         )
2025-01-14T13:16:42.3661110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3661510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3661880Z         ]
2025-01-14T13:16:42.3662240Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3662580Z 
2025-01-14T13:16:42.3662740Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3663170Z _ ERROR at setup of TestModelFromArtisDensityAbundancesAllAscii.test_velocities _
2025-01-14T13:16:42.3663960Z 
2025-01-14T13:16:42.3664530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3665500Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3665870Z 
2025-01-14T13:16:42.3665940Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3666230Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3666530Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3666810Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3667100Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3667320Z >       sim.run_final()
2025-01-14T13:16:42.3667440Z 
2025-01-14T13:16:42.3667520Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3667740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3667980Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3668260Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3668560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3668840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3669150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3669310Z 
2025-01-14T13:16:42.3669540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3670070Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3670540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3671420Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3671860Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3672300Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3672520Z 
2025-01-14T13:16:42.3672590Z     def initialize_transport_state(
2025-01-14T13:16:42.3672830Z         self,
2025-01-14T13:16:42.3673010Z         simulation_state,
2025-01-14T13:16:42.3673230Z         opacity_state,
2025-01-14T13:16:42.3673450Z         macro_atom_state,
2025-01-14T13:16:42.3673620Z         plasma,
2025-01-14T13:16:42.3673750Z         no_of_packets,
2025-01-14T13:16:42.3673900Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3674080Z         iteration=0,
2025-01-14T13:16:42.3674210Z     ):
2025-01-14T13:16:42.3674380Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3674640Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3674880Z         else:
2025-01-14T13:16:42.3675010Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3675180Z     
2025-01-14T13:16:42.3675370Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3675660Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3675870Z         )
2025-01-14T13:16:42.3676010Z     
2025-01-14T13:16:42.3676180Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3676440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3676740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3677010Z         else:
2025-01-14T13:16:42.3677150Z             continuum_state = None
2025-01-14T13:16:42.3677360Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3678710Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3679560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3680260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3681200Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3682490Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3683080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3683620Z         ).to_numba(
2025-01-14T13:16:42.3684050Z             macro_atom_state,
2025-01-14T13:16:42.3684620Z             self.line_interaction_type,
2025-01-14T13:16:42.3685190Z         )
2025-01-14T13:16:42.3685630Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3687250Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3688290Z         ]
2025-01-14T13:16:42.3688930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3689290Z 
2025-01-14T13:16:42.3689410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3689800Z _ ERROR at setup of TestModelFromArtisDensityAbundancesAllAscii.test_abundances _
2025-01-14T13:16:42.3690070Z 
2025-01-14T13:16:42.3690610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3691510Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3691860Z 
2025-01-14T13:16:42.3691920Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3692190Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3692480Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3692780Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3693420Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3693640Z >       sim.run_final()
2025-01-14T13:16:42.3693750Z 
2025-01-14T13:16:42.3693800Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3694000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3694230Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3694500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3694770Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3695060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3695350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3695530Z 
2025-01-14T13:16:42.3695750Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3696200Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3696630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3697110Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3697540Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3697840Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3698030Z 
2025-01-14T13:16:42.3698100Z     def initialize_transport_state(
2025-01-14T13:16:42.3698280Z         self,
2025-01-14T13:16:42.3698420Z         simulation_state,
2025-01-14T13:16:42.3698580Z         opacity_state,
2025-01-14T13:16:42.3698730Z         macro_atom_state,
2025-01-14T13:16:42.3698880Z         plasma,
2025-01-14T13:16:42.3699000Z         no_of_packets,
2025-01-14T13:16:42.3699150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3699330Z         iteration=0,
2025-01-14T13:16:42.3699460Z     ):
2025-01-14T13:16:42.3699650Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3699890Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3700080Z         else:
2025-01-14T13:16:42.3700370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3700530Z     
2025-01-14T13:16:42.3700690Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3700940Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3701130Z         )
2025-01-14T13:16:42.3701240Z     
2025-01-14T13:16:42.3701740Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3702110Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3702560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3702880Z         else:
2025-01-14T13:16:42.3703150Z             continuum_state = None
2025-01-14T13:16:42.3703430Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3703870Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3704250Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3704540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3704950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3705270Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3705660Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3705990Z         ).to_numba(
2025-01-14T13:16:42.3706270Z             macro_atom_state,
2025-01-14T13:16:42.3706600Z             self.line_interaction_type,
2025-01-14T13:16:42.3706920Z         )
2025-01-14T13:16:42.3707120Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3707670Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3722210Z         ]
2025-01-14T13:16:42.3722710Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3723450Z 
2025-01-14T13:16:42.3723580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3723960Z _ ERROR at setup of TestModelFromArtisDensityAbundancesAllAscii.test_densities _
2025-01-14T13:16:42.3724240Z 
2025-01-14T13:16:42.3724770Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3725660Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3726020Z 
2025-01-14T13:16:42.3726090Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3726350Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3726620Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3726910Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3727200Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3727380Z >       sim.run_final()
2025-01-14T13:16:42.3727490Z 
2025-01-14T13:16:42.3727550Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3727740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3727970Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3728220Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3728460Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3728730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3729010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3729160Z 
2025-01-14T13:16:42.3729370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3729820Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3730220Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3730850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3731280Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3731590Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3731770Z 
2025-01-14T13:16:42.3731830Z     def initialize_transport_state(
2025-01-14T13:16:42.3732000Z         self,
2025-01-14T13:16:42.3732060Z         simulation_state,
2025-01-14T13:16:42.3732110Z         opacity_state,
2025-01-14T13:16:42.3732160Z         macro_atom_state,
2025-01-14T13:16:42.3732210Z         plasma,
2025-01-14T13:16:42.3732250Z         no_of_packets,
2025-01-14T13:16:42.3732310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3732360Z         iteration=0,
2025-01-14T13:16:42.3732400Z     ):
2025-01-14T13:16:42.3732500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3732590Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3732630Z         else:
2025-01-14T13:16:42.3732700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3732750Z     
2025-01-14T13:16:42.3732860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3732930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3732980Z         )
2025-01-14T13:16:42.3733020Z     
2025-01-14T13:16:42.3733130Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3733220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3733340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3733390Z         else:
2025-01-14T13:16:42.3733450Z             continuum_state = None
2025-01-14T13:16:42.3733530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3733610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3733730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3733820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3733900Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3733960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3734030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3734080Z         ).to_numba(
2025-01-14T13:16:42.3734130Z             macro_atom_state,
2025-01-14T13:16:42.3734190Z             self.line_interaction_type,
2025-01-14T13:16:42.3734240Z         )
2025-01-14T13:16:42.3734310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3734530Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3734580Z         ]
2025-01-14T13:16:42.3734830Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3734830Z 
2025-01-14T13:16:42.3734950Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3735080Z ________________ ERROR at setup of test_ascii_reader_power_law _________________
2025-01-14T13:16:42.3735080Z 
2025-01-14T13:16:42.3735610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3735900Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3735900Z 
2025-01-14T13:16:42.3735970Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3736090Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3736160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3736310Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3736370Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3736750Z >       sim.run_final()
2025-01-14T13:16:42.3736750Z 
2025-01-14T13:16:42.3736860Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3737010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3737080Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3737200Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3737270Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3737390Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3737480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3737480Z 
2025-01-14T13:16:42.3737690Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3737850Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3738030Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3738250Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3738370Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3738480Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3738480Z 
2025-01-14T13:16:42.3738550Z     def initialize_transport_state(
2025-01-14T13:16:42.3738600Z         self,
2025-01-14T13:16:42.3738650Z         simulation_state,
2025-01-14T13:16:42.3738700Z         opacity_state,
2025-01-14T13:16:42.3738760Z         macro_atom_state,
2025-01-14T13:16:42.3738810Z         plasma,
2025-01-14T13:16:42.3738860Z         no_of_packets,
2025-01-14T13:16:42.3738920Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3738970Z         iteration=0,
2025-01-14T13:16:42.3739590Z     ):
2025-01-14T13:16:42.3739700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3739780Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3739830Z         else:
2025-01-14T13:16:42.3739890Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3739940Z     
2025-01-14T13:16:42.3740050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3740120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3740160Z         )
2025-01-14T13:16:42.3740200Z     
2025-01-14T13:16:42.3740300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3740400Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3740520Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3740570Z         else:
2025-01-14T13:16:42.3740630Z             continuum_state = None
2025-01-14T13:16:42.3740710Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3740790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3740860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3740950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3741020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3741090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3741160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3741210Z         ).to_numba(
2025-01-14T13:16:42.3741260Z             macro_atom_state,
2025-01-14T13:16:42.3741320Z             self.line_interaction_type,
2025-01-14T13:16:42.3741360Z         )
2025-01-14T13:16:42.3741440Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3742380Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3742440Z         ]
2025-01-14T13:16:42.3742690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3742700Z 
2025-01-14T13:16:42.3742820Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3743130Z _____________ ERROR at setup of test_ascii_reader_exponential_law ______________
2025-01-14T13:16:42.3743130Z 
2025-01-14T13:16:42.3743880Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3744180Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3744180Z 
2025-01-14T13:16:42.3744250Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3744380Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3745080Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3748210Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3748440Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3748610Z >       sim.run_final()
2025-01-14T13:16:42.3748620Z 
2025-01-14T13:16:42.3748790Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3749040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3749270Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3749580Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3749790Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3750130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3750370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3750380Z 
2025-01-14T13:16:42.3750950Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3751970Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3752650Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3753260Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3753610Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3753920Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3753930Z 
2025-01-14T13:16:42.3754120Z     def initialize_transport_state(
2025-01-14T13:16:42.3754270Z         self,
2025-01-14T13:16:42.3754440Z         simulation_state,
2025-01-14T13:16:42.3754600Z         opacity_state,
2025-01-14T13:16:42.3754770Z         macro_atom_state,
2025-01-14T13:16:42.3754920Z         plasma,
2025-01-14T13:16:42.3755080Z         no_of_packets,
2025-01-14T13:16:42.3755250Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3755420Z         iteration=0,
2025-01-14T13:16:42.3755560Z     ):
2025-01-14T13:16:42.3755830Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3756810Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3757000Z         else:
2025-01-14T13:16:42.3757160Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3757310Z     
2025-01-14T13:16:42.3757620Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3757830Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3757980Z         )
2025-01-14T13:16:42.3758110Z     
2025-01-14T13:16:42.3758400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3758640Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3758980Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3759120Z         else:
2025-01-14T13:16:42.3759300Z             continuum_state = None
2025-01-14T13:16:42.3759520Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3759770Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3760410Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3760660Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3760880Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3761090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3761300Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3761450Z         ).to_numba(
2025-01-14T13:16:42.3761620Z             macro_atom_state,
2025-01-14T13:16:42.3761810Z             self.line_interaction_type,
2025-01-14T13:16:42.3761960Z         )
2025-01-14T13:16:42.3762180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3762800Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3763030Z         ]
2025-01-14T13:16:42.3763790Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3763830Z 
2025-01-14T13:16:42.3764160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3764540Z ______ ERROR at setup of test_radial_1D_geometry_volume[0-1.00977478e+45] ______
2025-01-14T13:16:42.3764550Z 
2025-01-14T13:16:42.3765990Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3766760Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3766770Z 
2025-01-14T13:16:42.3766980Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3767340Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3767970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3768350Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3768550Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3768710Z >       sim.run_final()
2025-01-14T13:16:42.3768720Z 
2025-01-14T13:16:42.3768890Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3769150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3769360Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3769670Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3769870Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3770230Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3770490Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3770500Z 
2025-01-14T13:16:42.3771070Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3771500Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3771990Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3772580Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3772910Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3773220Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3773230Z 
2025-01-14T13:16:42.3773420Z     def initialize_transport_state(
2025-01-14T13:16:42.3773570Z         self,
2025-01-14T13:16:42.3773760Z         simulation_state,
2025-01-14T13:16:42.3773930Z         opacity_state,
2025-01-14T13:16:42.3774110Z         macro_atom_state,
2025-01-14T13:16:42.3774280Z         plasma,
2025-01-14T13:16:42.3774430Z         no_of_packets,
2025-01-14T13:16:42.3778070Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3779400Z         iteration=0,
2025-01-14T13:16:42.3779510Z     ):
2025-01-14T13:16:42.3779920Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3780450Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3780500Z         else:
2025-01-14T13:16:42.3780560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3780610Z     
2025-01-14T13:16:42.3780730Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3780810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3780850Z         )
2025-01-14T13:16:42.3780900Z     
2025-01-14T13:16:42.3781000Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3781100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3781230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3781280Z         else:
2025-01-14T13:16:42.3781340Z             continuum_state = None
2025-01-14T13:16:42.3781430Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3781520Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3781590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3781680Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3781760Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3781830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3781900Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3781950Z         ).to_numba(
2025-01-14T13:16:42.3782010Z             macro_atom_state,
2025-01-14T13:16:42.3782070Z             self.line_interaction_type,
2025-01-14T13:16:42.3782120Z         )
2025-01-14T13:16:42.3782200Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3782430Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3782480Z         ]
2025-01-14T13:16:42.3782880Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3782890Z 
2025-01-14T13:16:42.3783020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3783160Z _____ ERROR at setup of test_radial_1D_geometry_volume[10-1.98154804e+45] ______
2025-01-14T13:16:42.3783170Z 
2025-01-14T13:16:42.3783680Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3783980Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3783980Z 
2025-01-14T13:16:42.3784050Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3784170Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3784250Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3784400Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3784470Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3784520Z >       sim.run_final()
2025-01-14T13:16:42.3784520Z 
2025-01-14T13:16:42.3784580Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3784690Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3784770Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3784880Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3784960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3785080Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3785170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3785170Z 
2025-01-14T13:16:42.3785540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3785710Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3786310Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3786530Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3786660Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3786760Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3786770Z 
2025-01-14T13:16:42.3786830Z     def initialize_transport_state(
2025-01-14T13:16:42.3786880Z         self,
2025-01-14T13:16:42.3786940Z         simulation_state,
2025-01-14T13:16:42.3786990Z         opacity_state,
2025-01-14T13:16:42.3787040Z         macro_atom_state,
2025-01-14T13:16:42.3787100Z         plasma,
2025-01-14T13:16:42.3787140Z         no_of_packets,
2025-01-14T13:16:42.3787210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3787260Z         iteration=0,
2025-01-14T13:16:42.3787310Z     ):
2025-01-14T13:16:42.3787410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3787490Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3787530Z         else:
2025-01-14T13:16:42.3787590Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3787630Z     
2025-01-14T13:16:42.3787740Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3787810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3787860Z         )
2025-01-14T13:16:42.3787900Z     
2025-01-14T13:16:42.3788000Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3788100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3788230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3788280Z         else:
2025-01-14T13:16:42.3788620Z             continuum_state = None
2025-01-14T13:16:42.3788700Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3788790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3788860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3788940Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3789020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3789090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3789160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3789210Z         ).to_numba(
2025-01-14T13:16:42.3789270Z             macro_atom_state,
2025-01-14T13:16:42.3789330Z             self.line_interaction_type,
2025-01-14T13:16:42.3789380Z         )
2025-01-14T13:16:42.3789450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3789680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3789730Z         ]
2025-01-14T13:16:42.3789980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3789990Z 
2025-01-14T13:16:42.3790110Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3790250Z _____ ERROR at setup of test_radial_1D_geometry_volume[19-3.13361319e+45] ______
2025-01-14T13:16:42.3790250Z 
2025-01-14T13:16:42.3790790Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3791100Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3791100Z 
2025-01-14T13:16:42.3791170Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3791300Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3791370Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3791610Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3791680Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3791730Z >       sim.run_final()
2025-01-14T13:16:42.3791730Z 
2025-01-14T13:16:42.3791790Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3791880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3791960Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3792070Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3792150Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3792270Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3792360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3792360Z 
2025-01-14T13:16:42.3792670Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3792850Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3793020Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3793250Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3793370Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3793480Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3793480Z 
2025-01-14T13:16:42.3793550Z     def initialize_transport_state(
2025-01-14T13:16:42.3793590Z         self,
2025-01-14T13:16:42.3793660Z         simulation_state,
2025-01-14T13:16:42.3793710Z         opacity_state,
2025-01-14T13:16:42.3793770Z         macro_atom_state,
2025-01-14T13:16:42.3793810Z         plasma,
2025-01-14T13:16:42.3793960Z         no_of_packets,
2025-01-14T13:16:42.3794020Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3794070Z         iteration=0,
2025-01-14T13:16:42.3794120Z     ):
2025-01-14T13:16:42.3794220Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3794300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3794350Z         else:
2025-01-14T13:16:42.3794400Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3794440Z     
2025-01-14T13:16:42.3794550Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3794620Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3794680Z         )
2025-01-14T13:16:42.3794720Z     
2025-01-14T13:16:42.3794830Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3794920Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3795040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3795090Z         else:
2025-01-14T13:16:42.3795160Z             continuum_state = None
2025-01-14T13:16:42.3795230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3795320Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3795390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3795480Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3795560Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3795630Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3795690Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3795750Z         ).to_numba(
2025-01-14T13:16:42.3795810Z             macro_atom_state,
2025-01-14T13:16:42.3795870Z             self.line_interaction_type,
2025-01-14T13:16:42.3795930Z         )
2025-01-14T13:16:42.3796000Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3796250Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3796300Z         ]
2025-01-14T13:16:42.3796560Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3796620Z 
2025-01-14T13:16:42.3796740Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3796910Z _ ERROR at setup of test_composition_elemental_number_density[index0-539428198] _
2025-01-14T13:16:42.3796910Z 
2025-01-14T13:16:42.3797450Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3797750Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3797750Z 
2025-01-14T13:16:42.3797820Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3797950Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3798030Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3798170Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3798240Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3798290Z >       sim.run_final()
2025-01-14T13:16:42.3798300Z 
2025-01-14T13:16:42.3798350Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3798440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3798510Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3798630Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3798690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3798820Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3798910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3799000Z 
2025-01-14T13:16:42.3799210Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3799380Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3799550Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3799800Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3799930Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3800040Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3800040Z 
2025-01-14T13:16:42.3800100Z     def initialize_transport_state(
2025-01-14T13:16:42.3800150Z         self,
2025-01-14T13:16:42.3800200Z         simulation_state,
2025-01-14T13:16:42.3800260Z         opacity_state,
2025-01-14T13:16:42.3800310Z         macro_atom_state,
2025-01-14T13:16:42.3800360Z         plasma,
2025-01-14T13:16:42.3800410Z         no_of_packets,
2025-01-14T13:16:42.3800480Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3800530Z         iteration=0,
2025-01-14T13:16:42.3800580Z     ):
2025-01-14T13:16:42.3800670Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3800750Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3800790Z         else:
2025-01-14T13:16:42.3800850Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3800890Z     
2025-01-14T13:16:42.3800990Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3801070Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3801110Z         )
2025-01-14T13:16:42.3801160Z     
2025-01-14T13:16:42.3801260Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3801360Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3801700Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3801760Z         else:
2025-01-14T13:16:42.3801920Z             continuum_state = None
2025-01-14T13:16:42.3802240Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3802430Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3802580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3802670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3802840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3803000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3803160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3803210Z         ).to_numba(
2025-01-14T13:16:42.3804070Z             macro_atom_state,
2025-01-14T13:16:42.3804260Z             self.line_interaction_type,
2025-01-14T13:16:42.3804380Z         )
2025-01-14T13:16:42.3804550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3805090Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3805420Z         ]
2025-01-14T13:16:42.3805810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3805820Z 
2025-01-14T13:16:42.3806090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3806330Z _ ERROR at setup of test_composition_elemental_number_density[index1-409675383] _
2025-01-14T13:16:42.3806330Z 
2025-01-14T13:16:42.3806930Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3807220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3807360Z 
2025-01-14T13:16:42.3807490Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3807680Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3807820Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3807960Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3818350Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3818470Z >       sim.run_final()
2025-01-14T13:16:42.3818480Z 
2025-01-14T13:16:42.3818540Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3818640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3818740Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3818860Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3818930Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3819060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3819160Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3819170Z 
2025-01-14T13:16:42.3819390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3819560Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3819740Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3819960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3820080Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3820190Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3820200Z 
2025-01-14T13:16:42.3820270Z     def initialize_transport_state(
2025-01-14T13:16:42.3820320Z         self,
2025-01-14T13:16:42.3820380Z         simulation_state,
2025-01-14T13:16:42.3820430Z         opacity_state,
2025-01-14T13:16:42.3820510Z         macro_atom_state,
2025-01-14T13:16:42.3820550Z         plasma,
2025-01-14T13:16:42.3820610Z         no_of_packets,
2025-01-14T13:16:42.3821310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3821360Z         iteration=0,
2025-01-14T13:16:42.3821410Z     ):
2025-01-14T13:16:42.3821510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3821580Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3821630Z         else:
2025-01-14T13:16:42.3821680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3821730Z     
2025-01-14T13:16:42.3821840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3821920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3821960Z         )
2025-01-14T13:16:42.3822000Z     
2025-01-14T13:16:42.3822110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3822200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3822330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3822380Z         else:
2025-01-14T13:16:42.3822450Z             continuum_state = None
2025-01-14T13:16:42.3822530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3822610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3822670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3822760Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3822830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3822910Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3822970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3823020Z         ).to_numba(
2025-01-14T13:16:42.3823080Z             macro_atom_state,
2025-01-14T13:16:42.3823140Z             self.line_interaction_type,
2025-01-14T13:16:42.3823180Z         )
2025-01-14T13:16:42.3823260Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3823790Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3823850Z         ]
2025-01-14T13:16:42.3824100Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3824100Z 
2025-01-14T13:16:42.3824220Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3824380Z _ ERROR at setup of test_composition_elemental_number_density[index2-314387928] _
2025-01-14T13:16:42.3824390Z 
2025-01-14T13:16:42.3824900Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3825180Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3825190Z 
2025-01-14T13:16:42.3825250Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3825380Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3825460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3825610Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3825670Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3825720Z >       sim.run_final()
2025-01-14T13:16:42.3825720Z 
2025-01-14T13:16:42.3825780Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3825880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3825950Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3826070Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3826130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3826260Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3826350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3826400Z 
2025-01-14T13:16:42.3826620Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3826780Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3826960Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3827190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3827330Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3827440Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3827440Z 
2025-01-14T13:16:42.3827510Z     def initialize_transport_state(
2025-01-14T13:16:42.3827560Z         self,
2025-01-14T13:16:42.3827610Z         simulation_state,
2025-01-14T13:16:42.3827690Z         opacity_state,
2025-01-14T13:16:42.3827760Z         macro_atom_state,
2025-01-14T13:16:42.3827810Z         plasma,
2025-01-14T13:16:42.3827860Z         no_of_packets,
2025-01-14T13:16:42.3827930Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3827980Z         iteration=0,
2025-01-14T13:16:42.3828020Z     ):
2025-01-14T13:16:42.3828120Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3828190Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3828240Z         else:
2025-01-14T13:16:42.3828300Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3828350Z     
2025-01-14T13:16:42.3828460Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3828540Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3828590Z         )
2025-01-14T13:16:42.3828640Z     
2025-01-14T13:16:42.3828740Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3828840Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3829080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3829140Z         else:
2025-01-14T13:16:42.3829200Z             continuum_state = None
2025-01-14T13:16:42.3829280Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3829370Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3829440Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3829530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3829600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3829680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3829740Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3829800Z         ).to_numba(
2025-01-14T13:16:42.3829850Z             macro_atom_state,
2025-01-14T13:16:42.3829910Z             self.line_interaction_type,
2025-01-14T13:16:42.3829950Z         )
2025-01-14T13:16:42.3830030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3830260Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3830320Z         ]
2025-01-14T13:16:42.3830580Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3830590Z 
2025-01-14T13:16:42.3830710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3830870Z _ ERROR at setup of test_composition_elemental_number_density[index3-56066111] _
2025-01-14T13:16:42.3830870Z 
2025-01-14T13:16:42.3831390Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3831690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3831700Z 
2025-01-14T13:16:42.3831760Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3831980Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3832050Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3832190Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3832270Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3832320Z >       sim.run_final()
2025-01-14T13:16:42.3832320Z 
2025-01-14T13:16:42.3832380Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3832460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3832540Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3832650Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3832720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3832840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3832930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3832940Z 
2025-01-14T13:16:42.3833150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3833310Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3833490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3833710Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3833830Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3833940Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3833940Z 
2025-01-14T13:16:42.3834010Z     def initialize_transport_state(
2025-01-14T13:16:42.3834050Z         self,
2025-01-14T13:16:42.3834100Z         simulation_state,
2025-01-14T13:16:42.3834220Z         opacity_state,
2025-01-14T13:16:42.3834270Z         macro_atom_state,
2025-01-14T13:16:42.3834320Z         plasma,
2025-01-14T13:16:42.3834370Z         no_of_packets,
2025-01-14T13:16:42.3834430Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3834480Z         iteration=0,
2025-01-14T13:16:42.3834530Z     ):
2025-01-14T13:16:42.3834630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3834700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3834740Z         else:
2025-01-14T13:16:42.3834800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3834840Z     
2025-01-14T13:16:42.3834940Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3835020Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3835060Z         )
2025-01-14T13:16:42.3835100Z     
2025-01-14T13:16:42.3835200Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3835290Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3835410Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3835470Z         else:
2025-01-14T13:16:42.3835520Z             continuum_state = None
2025-01-14T13:16:42.3835610Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3835690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3835760Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3835840Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3835920Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3835990Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3836050Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3836100Z         ).to_numba(
2025-01-14T13:16:42.3836160Z             macro_atom_state,
2025-01-14T13:16:42.3836220Z             self.line_interaction_type,
2025-01-14T13:16:42.3836270Z         )
2025-01-14T13:16:42.3836350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3836570Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3836690Z         ]
2025-01-14T13:16:42.3836940Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3836950Z 
2025-01-14T13:16:42.3837070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3837230Z _ ERROR at setup of test_composition_elemental_number_density[index4-42580098] _
2025-01-14T13:16:42.3837230Z 
2025-01-14T13:16:42.3837750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3838030Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3838040Z 
2025-01-14T13:16:42.3838110Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3838240Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3838310Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3838450Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3838510Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3838560Z >       sim.run_final()
2025-01-14T13:16:42.3838570Z 
2025-01-14T13:16:42.3838620Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3838710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3838780Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3838890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3838960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3839140Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3839230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3839230Z 
2025-01-14T13:16:42.3839440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3839600Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3839780Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3840010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3840130Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3840240Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3840240Z 
2025-01-14T13:16:42.3840310Z     def initialize_transport_state(
2025-01-14T13:16:42.3840360Z         self,
2025-01-14T13:16:42.3840420Z         simulation_state,
2025-01-14T13:16:42.3840460Z         opacity_state,
2025-01-14T13:16:42.3840520Z         macro_atom_state,
2025-01-14T13:16:42.3840570Z         plasma,
2025-01-14T13:16:42.3840620Z         no_of_packets,
2025-01-14T13:16:42.3840680Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3840730Z         iteration=0,
2025-01-14T13:16:42.3840770Z     ):
2025-01-14T13:16:42.3840870Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3840930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3840980Z         else:
2025-01-14T13:16:42.3841040Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3841090Z     
2025-01-14T13:16:42.3841190Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3841270Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3841320Z         )
2025-01-14T13:16:42.3841360Z     
2025-01-14T13:16:42.3841470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3841570Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3841690Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3842080Z         else:
2025-01-14T13:16:42.3842150Z             continuum_state = None
2025-01-14T13:16:42.3842220Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3842310Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3842370Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3842460Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3842530Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3842600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3842670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3842730Z         ).to_numba(
2025-01-14T13:16:42.3842780Z             macro_atom_state,
2025-01-14T13:16:42.3842840Z             self.line_interaction_type,
2025-01-14T13:16:42.3842890Z         )
2025-01-14T13:16:42.3842970Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3843200Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3843240Z         ]
2025-01-14T13:16:42.3843490Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3843490Z 
2025-01-14T13:16:42.3843600Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3843760Z _ ERROR at setup of test_composition_elemental_number_density[index5-32676283] _
2025-01-14T13:16:42.3843770Z 
2025-01-14T13:16:42.3844270Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3844840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3844880Z 
2025-01-14T13:16:42.3844990Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3845130Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3845210Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3845350Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3845420Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3845470Z >       sim.run_final()
2025-01-14T13:16:42.3845470Z 
2025-01-14T13:16:42.3845530Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3845610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3845680Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3845800Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3845870Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3846000Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3846090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3846090Z 
2025-01-14T13:16:42.3846300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3846460Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3846640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3846860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3846980Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3847100Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3847100Z 
2025-01-14T13:16:42.3847180Z     def initialize_transport_state(
2025-01-14T13:16:42.3847230Z         self,
2025-01-14T13:16:42.3847290Z         simulation_state,
2025-01-14T13:16:42.3847350Z         opacity_state,
2025-01-14T13:16:42.3847550Z         macro_atom_state,
2025-01-14T13:16:42.3847600Z         plasma,
2025-01-14T13:16:42.3847650Z         no_of_packets,
2025-01-14T13:16:42.3847720Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3847770Z         iteration=0,
2025-01-14T13:16:42.3847840Z     ):
2025-01-14T13:16:42.3847960Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3848030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3848080Z         else:
2025-01-14T13:16:42.3848130Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3848180Z     
2025-01-14T13:16:42.3848280Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3848360Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3848400Z         )
2025-01-14T13:16:42.3848440Z     
2025-01-14T13:16:42.3850030Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3850390Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3850770Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3850990Z         else:
2025-01-14T13:16:42.3851170Z             continuum_state = None
2025-01-14T13:16:42.3851400Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3851640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3853010Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3853290Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3853500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3853710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3853910Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3854070Z         ).to_numba(
2025-01-14T13:16:42.3854240Z             macro_atom_state,
2025-01-14T13:16:42.3855220Z             self.line_interaction_type,
2025-01-14T13:16:42.3855360Z         )
2025-01-14T13:16:42.3855600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3856220Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3856370Z         ]
2025-01-14T13:16:42.3857060Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3857070Z 
2025-01-14T13:16:42.3857400Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3857840Z _ ERROR at setup of test_composition_elemental_number_density[index6-841032262] _
2025-01-14T13:16:42.3857850Z 
2025-01-14T13:16:42.3859330Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3860150Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3860160Z 
2025-01-14T13:16:42.3860350Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3860700Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3860910Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3861300Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3861490Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3861650Z >       sim.run_final()
2025-01-14T13:16:42.3861650Z 
2025-01-14T13:16:42.3861830Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3862070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3862300Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3862600Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3862820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3863160Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3863840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3863850Z 
2025-01-14T13:16:42.3864430Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3864860Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3865330Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3865930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3866310Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3866640Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3866650Z 
2025-01-14T13:16:42.3867560Z     def initialize_transport_state(
2025-01-14T13:16:42.3867760Z         self,
2025-01-14T13:16:42.3867930Z         simulation_state,
2025-01-14T13:16:42.3868110Z         opacity_state,
2025-01-14T13:16:42.3868280Z         macro_atom_state,
2025-01-14T13:16:42.3868440Z         plasma,
2025-01-14T13:16:42.3868590Z         no_of_packets,
2025-01-14T13:16:42.3868780Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3868930Z         iteration=0,
2025-01-14T13:16:42.3869080Z     ):
2025-01-14T13:16:42.3869360Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3869570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3869710Z         else:
2025-01-14T13:16:42.3869890Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3870030Z     
2025-01-14T13:16:42.3870330Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3870540Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3870690Z         )
2025-01-14T13:16:42.3871500Z     
2025-01-14T13:16:42.3871810Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3872060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3872400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3872560Z         else:
2025-01-14T13:16:42.3872730Z             continuum_state = None
2025-01-14T13:16:42.3872960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3873200Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3873400Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3873650Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3873890Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3874100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3874310Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3874460Z         ).to_numba(
2025-01-14T13:16:42.3874650Z             macro_atom_state,
2025-01-14T13:16:42.3874840Z             self.line_interaction_type,
2025-01-14T13:16:42.3874990Z         )
2025-01-14T13:16:42.3875220Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3875860Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3876020Z         ]
2025-01-14T13:16:42.3876990Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3877260Z 
2025-01-14T13:16:42.3877530Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3877700Z _ ERROR at setup of test_composition_elemental_number_density[index7-638732300] _
2025-01-14T13:16:42.3877700Z 
2025-01-14T13:16:42.3878230Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3878550Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3878870Z 
2025-01-14T13:16:42.3878940Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3879070Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3879140Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3879300Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3879360Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3879420Z >       sim.run_final()
2025-01-14T13:16:42.3879420Z 
2025-01-14T13:16:42.3879480Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3879580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3879660Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3879770Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3879850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3879980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3880070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3880070Z 
2025-01-14T13:16:42.3880290Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3880450Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3880620Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3880850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3880970Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3881090Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3881180Z 
2025-01-14T13:16:42.3881250Z     def initialize_transport_state(
2025-01-14T13:16:42.3881300Z         self,
2025-01-14T13:16:42.3881360Z         simulation_state,
2025-01-14T13:16:42.3881410Z         opacity_state,
2025-01-14T13:16:42.3881470Z         macro_atom_state,
2025-01-14T13:16:42.3881520Z         plasma,
2025-01-14T13:16:42.3881570Z         no_of_packets,
2025-01-14T13:16:42.3882280Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3882530Z         iteration=0,
2025-01-14T13:16:42.3882670Z     ):
2025-01-14T13:16:42.3882980Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3883200Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3883350Z         else:
2025-01-14T13:16:42.3883540Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3883700Z     
2025-01-14T13:16:42.3884020Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3884230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3884410Z         )
2025-01-14T13:16:42.3884550Z     
2025-01-14T13:16:42.3884840Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3885100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3885440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3885590Z         else:
2025-01-14T13:16:42.3885780Z             continuum_state = None
2025-01-14T13:16:42.3885990Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3886270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3886480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3886710Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3886930Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3887170Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3887390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3887550Z         ).to_numba(
2025-01-14T13:16:42.3887720Z             macro_atom_state,
2025-01-14T13:16:42.3888070Z             self.line_interaction_type,
2025-01-14T13:16:42.3889310Z         )
2025-01-14T13:16:42.3889550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3890190Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3890340Z         ]
2025-01-14T13:16:42.3891020Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3891030Z 
2025-01-14T13:16:42.3891890Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3892330Z _ ERROR at setup of test_composition_elemental_number_density[index8-490167906] _
2025-01-14T13:16:42.3892340Z 
2025-01-14T13:16:42.3893850Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3894890Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3895570Z 
2025-01-14T13:16:42.3896510Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3897570Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3898280Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3899220Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3900210Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3900560Z >       sim.run_final()
2025-01-14T13:16:42.3900560Z 
2025-01-14T13:16:42.3900630Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3901130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3901720Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3903690Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3904100Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3904710Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3904890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3905040Z 
2025-01-14T13:16:42.3906460Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3907690Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3907930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3908970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3940660Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3941330Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3941400Z 
2025-01-14T13:16:42.3941720Z     def initialize_transport_state(
2025-01-14T13:16:42.3941900Z         self,
2025-01-14T13:16:42.3942080Z         simulation_state,
2025-01-14T13:16:42.3942240Z         opacity_state,
2025-01-14T13:16:42.3942420Z         macro_atom_state,
2025-01-14T13:16:42.3942570Z         plasma,
2025-01-14T13:16:42.3942970Z         no_of_packets,
2025-01-14T13:16:42.3943400Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3943570Z         iteration=0,
2025-01-14T13:16:42.3943930Z     ):
2025-01-14T13:16:42.3944450Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3944900Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3946450Z         else:
2025-01-14T13:16:42.3946880Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3947050Z     
2025-01-14T13:16:42.3947390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3947710Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3947890Z         )
2025-01-14T13:16:42.3948030Z     
2025-01-14T13:16:42.3948330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3949980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3950410Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3950530Z         else:
2025-01-14T13:16:42.3950600Z             continuum_state = None
2025-01-14T13:16:42.3950690Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3950790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3950870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3951220Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3951950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3952290Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3953230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3953670Z         ).to_numba(
2025-01-14T13:16:42.3953770Z             macro_atom_state,
2025-01-14T13:16:42.3953850Z             self.line_interaction_type,
2025-01-14T13:16:42.3953900Z         )
2025-01-14T13:16:42.3953980Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3954540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3955500Z         ]
2025-01-14T13:16:42.3955820Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3955830Z 
2025-01-14T13:16:42.3956390Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3956980Z _ ERROR at setup of test_composition_elemental_number_density[index9-269136275] _
2025-01-14T13:16:42.3956990Z 
2025-01-14T13:16:42.3957530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3959530Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3959570Z 
2025-01-14T13:16:42.3959790Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3960150Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3960420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3960580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3960640Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3960690Z >       sim.run_final()
2025-01-14T13:16:42.3960700Z 
2025-01-14T13:16:42.3960760Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3960870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3960970Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3961100Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3961200Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3961590Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3961910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3961920Z 
2025-01-14T13:16:42.3962700Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3962910Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3963090Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3963310Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3963450Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3963580Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3963580Z 
2025-01-14T13:16:42.3963920Z     def initialize_transport_state(
2025-01-14T13:16:42.3963970Z         self,
2025-01-14T13:16:42.3964230Z         simulation_state,
2025-01-14T13:16:42.3964480Z         opacity_state,
2025-01-14T13:16:42.3965250Z         macro_atom_state,
2025-01-14T13:16:42.3965490Z         plasma,
2025-01-14T13:16:42.3965660Z         no_of_packets,
2025-01-14T13:16:42.3965850Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3966830Z         iteration=0,
2025-01-14T13:16:42.3967170Z     ):
2025-01-14T13:16:42.3967320Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3967400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3967450Z         else:
2025-01-14T13:16:42.3967940Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3968170Z     
2025-01-14T13:16:42.3971050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3971330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3971490Z         )
2025-01-14T13:16:42.3971660Z     
2025-01-14T13:16:42.3972800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3973130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3973590Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3973760Z         else:
2025-01-14T13:16:42.3973930Z             continuum_state = None
2025-01-14T13:16:42.3974190Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3974460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3974670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3975030Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3975170Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3975250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3975550Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3975600Z         ).to_numba(
2025-01-14T13:16:42.3975670Z             macro_atom_state,
2025-01-14T13:16:42.3975740Z             self.line_interaction_type,
2025-01-14T13:16:42.3975810Z         )
2025-01-14T13:16:42.3975900Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3976140Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3976190Z         ]
2025-01-14T13:16:42.3976460Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3976470Z 
2025-01-14T13:16:42.3976600Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3976790Z _ ERROR at setup of test_composition_elemental_number_density[index10-204398856] _
2025-01-14T13:16:42.3976800Z 
2025-01-14T13:16:42.3977370Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3977690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3977700Z 
2025-01-14T13:16:42.3977770Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3977910Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3978000Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3978190Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3978260Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3978510Z >       sim.run_final()
2025-01-14T13:16:42.3978540Z 
2025-01-14T13:16:42.3978820Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3979150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3979250Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3979930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3980460Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3981180Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3981340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3981340Z 
2025-01-14T13:16:42.3981560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3981750Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3981940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3982160Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.3982280Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.3982400Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.3982410Z 
2025-01-14T13:16:42.3982710Z     def initialize_transport_state(
2025-01-14T13:16:42.3982930Z         self,
2025-01-14T13:16:42.3983270Z         simulation_state,
2025-01-14T13:16:42.3983440Z         opacity_state,
2025-01-14T13:16:42.3983620Z         macro_atom_state,
2025-01-14T13:16:42.3983770Z         plasma,
2025-01-14T13:16:42.3984130Z         no_of_packets,
2025-01-14T13:16:42.3985460Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.3985560Z         iteration=0,
2025-01-14T13:16:42.3985610Z     ):
2025-01-14T13:16:42.3985720Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.3985930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.3986190Z         else:
2025-01-14T13:16:42.3986360Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.3986510Z     
2025-01-14T13:16:42.3986850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.3987520Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.3987700Z         )
2025-01-14T13:16:42.3987840Z     
2025-01-14T13:16:42.3988150Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.3988410Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.3988850Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.3989290Z         else:
2025-01-14T13:16:42.3989570Z             continuum_state = None
2025-01-14T13:16:42.3989960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.3990100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.3990190Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.3990310Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.3990390Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.3990470Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.3990560Z             continuum_state=continuum_state,
2025-01-14T13:16:42.3990610Z         ).to_numba(
2025-01-14T13:16:42.3990680Z             macro_atom_state,
2025-01-14T13:16:42.3990760Z             self.line_interaction_type,
2025-01-14T13:16:42.3990830Z         )
2025-01-14T13:16:42.3990930Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.3991180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.3991230Z         ]
2025-01-14T13:16:42.3991520Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.3991530Z 
2025-01-14T13:16:42.3991790Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.3993510Z _ ERROR at setup of test_composition_elemental_number_density[index11-156857199] _
2025-01-14T13:16:42.3993540Z 
2025-01-14T13:16:42.3995010Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.3996190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.3996200Z 
2025-01-14T13:16:42.3996280Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.3996430Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.3996520Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.3996890Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.3997190Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.3997380Z >       sim.run_final()
2025-01-14T13:16:42.3997400Z 
2025-01-14T13:16:42.3997610Z tardis/conftest.py:233: 
2025-01-14T13:16:42.3998060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3998180Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.3998300Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.3998370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.3998500Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.3998590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.3998590Z 
2025-01-14T13:16:42.3998850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.3999060Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.3999280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.3999560Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4001870Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4002000Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4002010Z 
2025-01-14T13:16:42.4002070Z     def initialize_transport_state(
2025-01-14T13:16:42.4002120Z         self,
2025-01-14T13:16:42.4002180Z         simulation_state,
2025-01-14T13:16:42.4002250Z         opacity_state,
2025-01-14T13:16:42.4002710Z         macro_atom_state,
2025-01-14T13:16:42.4002800Z         plasma,
2025-01-14T13:16:42.4002860Z         no_of_packets,
2025-01-14T13:16:42.4002940Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4003010Z         iteration=0,
2025-01-14T13:16:42.4003080Z     ):
2025-01-14T13:16:42.4003200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4003290Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4003350Z         else:
2025-01-14T13:16:42.4003420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4003490Z     
2025-01-14T13:16:42.4003600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4003690Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4004170Z         )
2025-01-14T13:16:42.4004510Z     
2025-01-14T13:16:42.4008770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4009160Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4009560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4009780Z         else:
2025-01-14T13:16:42.4010000Z             continuum_state = None
2025-01-14T13:16:42.4010290Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4010970Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4011100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4011190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4011980Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4012360Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4012590Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4013640Z         ).to_numba(
2025-01-14T13:16:42.4013710Z             macro_atom_state,
2025-01-14T13:16:42.4013780Z             self.line_interaction_type,
2025-01-14T13:16:42.4013820Z         )
2025-01-14T13:16:42.4014420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4015430Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4016000Z         ]
2025-01-14T13:16:42.4016330Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4016350Z 
2025-01-14T13:16:42.4016490Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4016670Z _ ERROR at setup of test_composition_elemental_number_density[index12-45482957] _
2025-01-14T13:16:42.4016680Z 
2025-01-14T13:16:42.4017980Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4018330Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4018330Z 
2025-01-14T13:16:42.4018400Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4018530Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4018610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4018750Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4018820Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4018870Z >       sim.run_final()
2025-01-14T13:16:42.4018880Z 
2025-01-14T13:16:42.4018930Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4019240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4019330Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4019440Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4021070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4021250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4021370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4021380Z 
2025-01-14T13:16:42.4021600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4022330Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4022580Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4022840Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4023010Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4023140Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4023150Z 
2025-01-14T13:16:42.4023220Z     def initialize_transport_state(
2025-01-14T13:16:42.4023700Z         self,
2025-01-14T13:16:42.4024090Z         simulation_state,
2025-01-14T13:16:42.4024310Z         opacity_state,
2025-01-14T13:16:42.4024500Z         macro_atom_state,
2025-01-14T13:16:42.4024720Z         plasma,
2025-01-14T13:16:42.4024880Z         no_of_packets,
2025-01-14T13:16:42.4025100Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4025270Z         iteration=0,
2025-01-14T13:16:42.4025480Z     ):
2025-01-14T13:16:42.4026330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4027010Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4027120Z         else:
2025-01-14T13:16:42.4027200Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4027260Z     
2025-01-14T13:16:42.4027390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4027760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4027820Z         )
2025-01-14T13:16:42.4028400Z     
2025-01-14T13:16:42.4029110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4029310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4029480Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4029530Z         else:
2025-01-14T13:16:42.4029590Z             continuum_state = None
2025-01-14T13:16:42.4029670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4029770Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4029850Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4029930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4030030Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4030110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4030180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4030230Z         ).to_numba(
2025-01-14T13:16:42.4030290Z             macro_atom_state,
2025-01-14T13:16:42.4030350Z             self.line_interaction_type,
2025-01-14T13:16:42.4030790Z         )
2025-01-14T13:16:42.4031570Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4032800Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4033230Z         ]
2025-01-14T13:16:42.4034210Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4034230Z 
2025-01-14T13:16:42.4034410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4034610Z _ ERROR at setup of test_composition_elemental_number_density[index13-34542591] _
2025-01-14T13:16:42.4034780Z 
2025-01-14T13:16:42.4036250Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4037140Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4037180Z 
2025-01-14T13:16:42.4037400Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4038930Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4039240Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4040020Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4040130Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4040190Z >       sim.run_final()
2025-01-14T13:16:42.4040200Z 
2025-01-14T13:16:42.4040260Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4040820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4041450Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4041640Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4041740Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4041870Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4041970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4041970Z 
2025-01-14T13:16:42.4042210Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4042880Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4043720Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4044030Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4044630Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4045060Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4045060Z 
2025-01-14T13:16:42.4045140Z     def initialize_transport_state(
2025-01-14T13:16:42.4045200Z         self,
2025-01-14T13:16:42.4045260Z         simulation_state,
2025-01-14T13:16:42.4045330Z         opacity_state,
2025-01-14T13:16:42.4045400Z         macro_atom_state,
2025-01-14T13:16:42.4045470Z         plasma,
2025-01-14T13:16:42.4045530Z         no_of_packets,
2025-01-14T13:16:42.4045590Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4045650Z         iteration=0,
2025-01-14T13:16:42.4045700Z     ):
2025-01-14T13:16:42.4045810Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4045910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4045980Z         else:
2025-01-14T13:16:42.4046080Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4046140Z     
2025-01-14T13:16:42.4046270Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4046360Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4047120Z         )
2025-01-14T13:16:42.4047410Z     
2025-01-14T13:16:42.4048660Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4048800Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4048930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4049200Z         else:
2025-01-14T13:16:42.4049330Z             continuum_state = None
2025-01-14T13:16:42.4049420Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4049510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4049590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4049710Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4050230Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4050330Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4050430Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4050520Z         ).to_numba(
2025-01-14T13:16:42.4050580Z             macro_atom_state,
2025-01-14T13:16:42.4051180Z             self.line_interaction_type,
2025-01-14T13:16:42.4051270Z         )
2025-01-14T13:16:42.4051370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4051730Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4051810Z         ]
2025-01-14T13:16:42.4052980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4053030Z 
2025-01-14T13:16:42.4053620Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4054180Z _ ERROR at setup of test_composition_elemental_number_density[index14-26508241] _
2025-01-14T13:16:42.4054210Z 
2025-01-14T13:16:42.4058220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4059370Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4059390Z 
2025-01-14T13:16:42.4059480Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4060240Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4060740Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4060960Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4061040Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4061100Z >       sim.run_final()
2025-01-14T13:16:42.4061120Z 
2025-01-14T13:16:42.4061190Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4061300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4062560Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4062720Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4062810Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4062940Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4063070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4063080Z 
2025-01-14T13:16:42.4063300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4063460Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4063660Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4063900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4064040Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4064150Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4064150Z 
2025-01-14T13:16:42.4064220Z     def initialize_transport_state(
2025-01-14T13:16:42.4064550Z         self,
2025-01-14T13:16:42.4064640Z         simulation_state,
2025-01-14T13:16:42.4064700Z         opacity_state,
2025-01-14T13:16:42.4064750Z         macro_atom_state,
2025-01-14T13:16:42.4064800Z         plasma,
2025-01-14T13:16:42.4064850Z         no_of_packets,
2025-01-14T13:16:42.4064920Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4064970Z         iteration=0,
2025-01-14T13:16:42.4065020Z     ):
2025-01-14T13:16:42.4065120Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4065220Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4065940Z         else:
2025-01-14T13:16:42.4066030Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4066080Z     
2025-01-14T13:16:42.4066200Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4066280Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4066330Z         )
2025-01-14T13:16:42.4066390Z     
2025-01-14T13:16:42.4066510Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4066630Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4066780Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4066840Z         else:
2025-01-14T13:16:42.4066900Z             continuum_state = None
2025-01-14T13:16:42.4066990Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4067080Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4067170Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4067270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4067350Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4067430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4067490Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4067540Z         ).to_numba(
2025-01-14T13:16:42.4067600Z             macro_atom_state,
2025-01-14T13:16:42.4067680Z             self.line_interaction_type,
2025-01-14T13:16:42.4067730Z         )
2025-01-14T13:16:42.4067830Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4069110Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4070980Z         ]
2025-01-14T13:16:42.4072160Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4072180Z 
2025-01-14T13:16:42.4072720Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4072950Z _ ERROR at setup of test_composition_elemental_number_density[index15-34001569] _
2025-01-14T13:16:42.4073170Z 
2025-01-14T13:16:42.4079290Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4084630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4084660Z 
2025-01-14T13:16:42.4085050Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4085580Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4085690Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4086100Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4086460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4086840Z >       sim.run_final()
2025-01-14T13:16:42.4086850Z 
2025-01-14T13:16:42.4086940Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4087360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4087600Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4087980Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4088390Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4093220Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4096750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4096760Z 
2025-01-14T13:16:42.4098400Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4098640Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4098890Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4099620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4100900Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4101080Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4101090Z 
2025-01-14T13:16:42.4101200Z     def initialize_transport_state(
2025-01-14T13:16:42.4101250Z         self,
2025-01-14T13:16:42.4101350Z         simulation_state,
2025-01-14T13:16:42.4101470Z         opacity_state,
2025-01-14T13:16:42.4101590Z         macro_atom_state,
2025-01-14T13:16:42.4101640Z         plasma,
2025-01-14T13:16:42.4101730Z         no_of_packets,
2025-01-14T13:16:42.4102720Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4102880Z         iteration=0,
2025-01-14T13:16:42.4102940Z     ):
2025-01-14T13:16:42.4103090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4103770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4103880Z         else:
2025-01-14T13:16:42.4103990Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4104050Z     
2025-01-14T13:16:42.4104220Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4104350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4104460Z         )
2025-01-14T13:16:42.4135800Z     
2025-01-14T13:16:42.4136070Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4136170Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4136300Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4136350Z         else:
2025-01-14T13:16:42.4136420Z             continuum_state = None
2025-01-14T13:16:42.4136500Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4136590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4136660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4136780Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4136860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4137330Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4137410Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4137460Z         ).to_numba(
2025-01-14T13:16:42.4137520Z             macro_atom_state,
2025-01-14T13:16:42.4137580Z             self.line_interaction_type,
2025-01-14T13:16:42.4137630Z         )
2025-01-14T13:16:42.4137710Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4137940Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4137990Z         ]
2025-01-14T13:16:42.4138230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4138240Z 
2025-01-14T13:16:42.4138360Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4138520Z _ ERROR at setup of test_composition_elemental_number_density[index16-25822910] _
2025-01-14T13:16:42.4138520Z 
2025-01-14T13:16:42.4139050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4139340Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4139340Z 
2025-01-14T13:16:42.4139410Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4139540Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4139610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4139750Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4139960Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4140010Z >       sim.run_final()
2025-01-14T13:16:42.4140020Z 
2025-01-14T13:16:42.4140070Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4140170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4140240Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4140350Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4140430Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4140550Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4140640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4140640Z 
2025-01-14T13:16:42.4140860Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4141020Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4141200Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4141440Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4141570Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4141690Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4141690Z 
2025-01-14T13:16:42.4141760Z     def initialize_transport_state(
2025-01-14T13:16:42.4141800Z         self,
2025-01-14T13:16:42.4141860Z         simulation_state,
2025-01-14T13:16:42.4141910Z         opacity_state,
2025-01-14T13:16:42.4141960Z         macro_atom_state,
2025-01-14T13:16:42.4142000Z         plasma,
2025-01-14T13:16:42.4142050Z         no_of_packets,
2025-01-14T13:16:42.4142110Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4142160Z         iteration=0,
2025-01-14T13:16:42.4142200Z     ):
2025-01-14T13:16:42.4142310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4142380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4142440Z         else:
2025-01-14T13:16:42.4142580Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4142630Z     
2025-01-14T13:16:42.4142740Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4142810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4142860Z         )
2025-01-14T13:16:42.4142900Z     
2025-01-14T13:16:42.4143000Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4143090Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4143210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4143270Z         else:
2025-01-14T13:16:42.4143330Z             continuum_state = None
2025-01-14T13:16:42.4143410Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4143500Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4143570Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4143660Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4143740Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4143810Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4143880Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4143920Z         ).to_numba(
2025-01-14T13:16:42.4143980Z             macro_atom_state,
2025-01-14T13:16:42.4144050Z             self.line_interaction_type,
2025-01-14T13:16:42.4144110Z         )
2025-01-14T13:16:42.4144190Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4144410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4144450Z         ]
2025-01-14T13:16:42.4144710Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4144760Z 
2025-01-14T13:16:42.4144900Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4145070Z _ ERROR at setup of test_composition_elemental_number_density[index17-19816693] _
2025-01-14T13:16:42.4145080Z 
2025-01-14T13:16:42.4145610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4145900Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4145910Z 
2025-01-14T13:16:42.4145970Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4146100Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4146170Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4146310Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4146370Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4146420Z >       sim.run_final()
2025-01-14T13:16:42.4146430Z 
2025-01-14T13:16:42.4146490Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4146580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4146650Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4146760Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4146830Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4146970Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4147060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4147060Z 
2025-01-14T13:16:42.4147300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4147460Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4147640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4148210Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4148330Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4148450Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4148450Z 
2025-01-14T13:16:42.4148520Z     def initialize_transport_state(
2025-01-14T13:16:42.4148580Z         self,
2025-01-14T13:16:42.4148650Z         simulation_state,
2025-01-14T13:16:42.4148710Z         opacity_state,
2025-01-14T13:16:42.4148760Z         macro_atom_state,
2025-01-14T13:16:42.4148810Z         plasma,
2025-01-14T13:16:42.4148860Z         no_of_packets,
2025-01-14T13:16:42.4148920Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4148970Z         iteration=0,
2025-01-14T13:16:42.4149010Z     ):
2025-01-14T13:16:42.4149110Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4149180Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4149230Z         else:
2025-01-14T13:16:42.4149290Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4151610Z     
2025-01-14T13:16:42.4151740Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4151810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4151850Z         )
2025-01-14T13:16:42.4151890Z     
2025-01-14T13:16:42.4151990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4152090Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4152210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4152250Z         else:
2025-01-14T13:16:42.4152310Z             continuum_state = None
2025-01-14T13:16:42.4152390Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4152480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4152860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4152950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4153020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4153090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4153160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4153210Z         ).to_numba(
2025-01-14T13:16:42.4153260Z             macro_atom_state,
2025-01-14T13:16:42.4153330Z             self.line_interaction_type,
2025-01-14T13:16:42.4153380Z         )
2025-01-14T13:16:42.4153460Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4153690Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4156560Z         ]
2025-01-14T13:16:42.4156810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4156820Z 
2025-01-14T13:16:42.4156930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4157080Z ______ ERROR at setup of test_simulation_state_mass[index0-1.4471412e+31] ______
2025-01-14T13:16:42.4157080Z 
2025-01-14T13:16:42.4157610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4157900Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4157900Z 
2025-01-14T13:16:42.4157970Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4158090Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4158170Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4158320Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4158390Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4158560Z >       sim.run_final()
2025-01-14T13:16:42.4158570Z 
2025-01-14T13:16:42.4158620Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4158710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4158790Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4158900Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4158970Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4159090Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4159180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4159180Z 
2025-01-14T13:16:42.4159390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4159550Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4159740Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4159970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4160090Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4160200Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4160200Z 
2025-01-14T13:16:42.4160270Z     def initialize_transport_state(
2025-01-14T13:16:42.4160320Z         self,
2025-01-14T13:16:42.4160370Z         simulation_state,
2025-01-14T13:16:42.4160430Z         opacity_state,
2025-01-14T13:16:42.4160480Z         macro_atom_state,
2025-01-14T13:16:42.4160530Z         plasma,
2025-01-14T13:16:42.4160580Z         no_of_packets,
2025-01-14T13:16:42.4160640Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4160680Z         iteration=0,
2025-01-14T13:16:42.4161120Z     ):
2025-01-14T13:16:42.4161220Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4161300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4161360Z         else:
2025-01-14T13:16:42.4161420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4161460Z     
2025-01-14T13:16:42.4161570Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4161660Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4161710Z         )
2025-01-14T13:16:42.4161760Z     
2025-01-14T13:16:42.4161860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4161960Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4162080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4162140Z         else:
2025-01-14T13:16:42.4162200Z             continuum_state = None
2025-01-14T13:16:42.4162280Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4162370Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4162440Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4162520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4162600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4162670Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4162750Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4162800Z         ).to_numba(
2025-01-14T13:16:42.4162850Z             macro_atom_state,
2025-01-14T13:16:42.4162920Z             self.line_interaction_type,
2025-01-14T13:16:42.4162960Z         )
2025-01-14T13:16:42.4163040Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4163270Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4163320Z         ]
2025-01-14T13:16:42.4163580Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4163580Z 
2025-01-14T13:16:42.4163710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4163940Z ______ ERROR at setup of test_simulation_state_mass[index1-2.6820129e+30] ______
2025-01-14T13:16:42.4163940Z 
2025-01-14T13:16:42.4164460Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4164750Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4164760Z 
2025-01-14T13:16:42.4164820Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4164950Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4165020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4165170Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4165230Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4165290Z >       sim.run_final()
2025-01-14T13:16:42.4165290Z 
2025-01-14T13:16:42.4165340Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4165440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4165510Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4165610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4165690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4165810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4165900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4165900Z 
2025-01-14T13:16:42.4166110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4166350Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4166540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4166760Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4166880Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4166990Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4166990Z 
2025-01-14T13:16:42.4167060Z     def initialize_transport_state(
2025-01-14T13:16:42.4167100Z         self,
2025-01-14T13:16:42.4167160Z         simulation_state,
2025-01-14T13:16:42.4167210Z         opacity_state,
2025-01-14T13:16:42.4167270Z         macro_atom_state,
2025-01-14T13:16:42.4167320Z         plasma,
2025-01-14T13:16:42.4167370Z         no_of_packets,
2025-01-14T13:16:42.4167430Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4167480Z         iteration=0,
2025-01-14T13:16:42.4167520Z     ):
2025-01-14T13:16:42.4167620Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4167700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4167750Z         else:
2025-01-14T13:16:42.4167800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4167850Z     
2025-01-14T13:16:42.4167950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4168030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4168080Z         )
2025-01-14T13:16:42.4168120Z     
2025-01-14T13:16:42.4168220Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4168310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4168440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4168490Z         else:
2025-01-14T13:16:42.4168550Z             continuum_state = None
2025-01-14T13:16:42.4168630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4168720Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4168910Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4168990Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4169060Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4169140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4169210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4169250Z         ).to_numba(
2025-01-14T13:16:42.4169310Z             macro_atom_state,
2025-01-14T13:16:42.4169370Z             self.line_interaction_type,
2025-01-14T13:16:42.4169420Z         )
2025-01-14T13:16:42.4169490Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4169710Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4169760Z         ]
2025-01-14T13:16:42.4170010Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4170020Z 
2025-01-14T13:16:42.4170130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4170280Z ______ ERROR at setup of test_simulation_state_mass[index2-1.3464444e+29] ______
2025-01-14T13:16:42.4170290Z 
2025-01-14T13:16:42.4170800Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4171100Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4171110Z 
2025-01-14T13:16:42.4171170Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4171300Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4171460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4171600Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4171670Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4171730Z >       sim.run_final()
2025-01-14T13:16:42.4171740Z 
2025-01-14T13:16:42.4171810Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4171910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4171980Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4172100Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4172160Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4172290Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4172380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4172380Z 
2025-01-14T13:16:42.4172600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4172760Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4172940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4173170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4173290Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4173400Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4173400Z 
2025-01-14T13:16:42.4173470Z     def initialize_transport_state(
2025-01-14T13:16:42.4173520Z         self,
2025-01-14T13:16:42.4173570Z         simulation_state,
2025-01-14T13:16:42.4173630Z         opacity_state,
2025-01-14T13:16:42.4173680Z         macro_atom_state,
2025-01-14T13:16:42.4173720Z         plasma,
2025-01-14T13:16:42.4173780Z         no_of_packets,
2025-01-14T13:16:42.4173840Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4173890Z         iteration=0,
2025-01-14T13:16:42.4173940Z     ):
2025-01-14T13:16:42.4174050Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4174510Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4174560Z         else:
2025-01-14T13:16:42.4174620Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4174660Z     
2025-01-14T13:16:42.4174780Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4174870Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4174920Z         )
2025-01-14T13:16:42.4174970Z     
2025-01-14T13:16:42.4175070Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4175160Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4175290Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4175340Z         else:
2025-01-14T13:16:42.4175420Z             continuum_state = None
2025-01-14T13:16:42.4175510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4175610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4175680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4175770Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4175850Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4175920Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4176000Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4176050Z         ).to_numba(
2025-01-14T13:16:42.4176100Z             macro_atom_state,
2025-01-14T13:16:42.4176170Z             self.line_interaction_type,
2025-01-14T13:16:42.4176210Z         )
2025-01-14T13:16:42.4176290Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4176530Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4177160Z         ]
2025-01-14T13:16:42.4177420Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4177430Z 
2025-01-14T13:16:42.4177540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4177690Z __ ERROR at setup of test_radial_1d_model_atomic_mass[index0-1.67378172e-24] ___
2025-01-14T13:16:42.4177690Z 
2025-01-14T13:16:42.4178220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4178530Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4178540Z 
2025-01-14T13:16:42.4178610Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4178730Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4178830Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4178980Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4179060Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4179120Z >       sim.run_final()
2025-01-14T13:16:42.4179120Z 
2025-01-14T13:16:42.4179200Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4179290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4179370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4179480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4179550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4179680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4179780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4179790Z 
2025-01-14T13:16:42.4180040Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4180210Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4180500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4180730Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4180880Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4180990Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4180990Z 
2025-01-14T13:16:42.4181070Z     def initialize_transport_state(
2025-01-14T13:16:42.4181110Z         self,
2025-01-14T13:16:42.4181170Z         simulation_state,
2025-01-14T13:16:42.4181230Z         opacity_state,
2025-01-14T13:16:42.4181280Z         macro_atom_state,
2025-01-14T13:16:42.4181320Z         plasma,
2025-01-14T13:16:42.4181370Z         no_of_packets,
2025-01-14T13:16:42.4181430Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4181480Z         iteration=0,
2025-01-14T13:16:42.4181530Z     ):
2025-01-14T13:16:42.4181620Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4181700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4181740Z         else:
2025-01-14T13:16:42.4181800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4181840Z     
2025-01-14T13:16:42.4181950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4182020Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4182070Z         )
2025-01-14T13:16:42.4182110Z     
2025-01-14T13:16:42.4182210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4182300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4182420Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4182470Z         else:
2025-01-14T13:16:42.4182610Z             continuum_state = None
2025-01-14T13:16:42.4182710Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4182810Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4182890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4182970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4183040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4183110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4183180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4183230Z         ).to_numba(
2025-01-14T13:16:42.4183280Z             macro_atom_state,
2025-01-14T13:16:42.4183340Z             self.line_interaction_type,
2025-01-14T13:16:42.4183390Z         )
2025-01-14T13:16:42.4183470Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4183690Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4183740Z         ]
2025-01-14T13:16:42.4183990Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4183990Z 
2025-01-14T13:16:42.4184110Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4184260Z __ ERROR at setup of test_radial_1d_model_atomic_mass[index1-9.51707707e-23] ___
2025-01-14T13:16:42.4184260Z 
2025-01-14T13:16:42.4184770Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4185060Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4185060Z 
2025-01-14T13:16:42.4185130Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4185250Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4185320Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4185550Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4185610Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4185670Z >       sim.run_final()
2025-01-14T13:16:42.4185670Z 
2025-01-14T13:16:42.4185720Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4185820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4185890Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4186010Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4186070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4186400Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4186550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4186560Z 
2025-01-14T13:16:42.4186840Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4187010Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4187330Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4187710Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4187920Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4188210Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4188210Z 
2025-01-14T13:16:42.4188420Z     def initialize_transport_state(
2025-01-14T13:16:42.4188730Z         self,
2025-01-14T13:16:42.4188860Z         simulation_state,
2025-01-14T13:16:42.4188980Z         opacity_state,
2025-01-14T13:16:42.4189100Z         macro_atom_state,
2025-01-14T13:16:42.4189150Z         plasma,
2025-01-14T13:16:42.4189440Z         no_of_packets,
2025-01-14T13:16:42.4189560Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4189680Z         iteration=0,
2025-01-14T13:16:42.4189730Z     ):
2025-01-14T13:16:42.4189880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4190030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4190150Z         else:
2025-01-14T13:16:42.4190290Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4190340Z     
2025-01-14T13:16:42.4190570Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4190710Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4190840Z         )
2025-01-14T13:16:42.4190880Z     
2025-01-14T13:16:42.4191040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4191130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4191450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4191510Z         else:
2025-01-14T13:16:42.4191640Z             continuum_state = None
2025-01-14T13:16:42.4191790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4191960Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4192050Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4210030Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4210230Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4210310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4210380Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4210440Z         ).to_numba(
2025-01-14T13:16:42.4210490Z             macro_atom_state,
2025-01-14T13:16:42.4210560Z             self.line_interaction_type,
2025-01-14T13:16:42.4210600Z         )
2025-01-14T13:16:42.4210690Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4210920Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4211000Z         ]
2025-01-14T13:16:42.4211250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4211570Z 
2025-01-14T13:16:42.4211690Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4211850Z __ ERROR at setup of test_radial_1d_model_atomic_mass[index2-9.54725917e-23] ___
2025-01-14T13:16:42.4211860Z 
2025-01-14T13:16:42.4212390Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4212670Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4212670Z 
2025-01-14T13:16:42.4212740Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4212880Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4212960Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4213100Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4213160Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4213220Z >       sim.run_final()
2025-01-14T13:16:42.4213220Z 
2025-01-14T13:16:42.4213290Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4213390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4213480Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4213590Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4213660Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4213780Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4213870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4214010Z 
2025-01-14T13:16:42.4214230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4214390Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4214560Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4214810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4214940Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4215050Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4215050Z 
2025-01-14T13:16:42.4215120Z     def initialize_transport_state(
2025-01-14T13:16:42.4215160Z         self,
2025-01-14T13:16:42.4215220Z         simulation_state,
2025-01-14T13:16:42.4215270Z         opacity_state,
2025-01-14T13:16:42.4215330Z         macro_atom_state,
2025-01-14T13:16:42.4215380Z         plasma,
2025-01-14T13:16:42.4215430Z         no_of_packets,
2025-01-14T13:16:42.4215490Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4215540Z         iteration=0,
2025-01-14T13:16:42.4215590Z     ):
2025-01-14T13:16:42.4215680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4215760Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4215800Z         else:
2025-01-14T13:16:42.4215860Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4215900Z     
2025-01-14T13:16:42.4216010Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4216080Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4216130Z         )
2025-01-14T13:16:42.4216170Z     
2025-01-14T13:16:42.4216280Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4216360Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4216500Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4216540Z         else:
2025-01-14T13:16:42.4216600Z             continuum_state = None
2025-01-14T13:16:42.4216960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4217050Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4217120Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4217200Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4217280Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4217350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4217420Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4217470Z         ).to_numba(
2025-01-14T13:16:42.4217520Z             macro_atom_state,
2025-01-14T13:16:42.4217580Z             self.line_interaction_type,
2025-01-14T13:16:42.4217630Z         )
2025-01-14T13:16:42.4217710Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4217930Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4217980Z         ]
2025-01-14T13:16:42.4218230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4218240Z 
2025-01-14T13:16:42.4218350Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4218530Z __ ERROR at setup of TestModelStateFromNonUniformAbundances.test_atomic_mass ___
2025-01-14T13:16:42.4218530Z 
2025-01-14T13:16:42.4219050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4219360Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4219570Z 
2025-01-14T13:16:42.4219660Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4219780Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4219860Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4220010Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4220070Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4220130Z >       sim.run_final()
2025-01-14T13:16:42.4220130Z 
2025-01-14T13:16:42.4220200Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4220320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4220410Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4220530Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4220600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4220740Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4376400Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4376530Z 
2025-01-14T13:16:42.4376850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4377050Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4377240Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4377470Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4377590Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4377710Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4377710Z 
2025-01-14T13:16:42.4377780Z     def initialize_transport_state(
2025-01-14T13:16:42.4377830Z         self,
2025-01-14T13:16:42.4377880Z         simulation_state,
2025-01-14T13:16:42.4377930Z         opacity_state,
2025-01-14T13:16:42.4377990Z         macro_atom_state,
2025-01-14T13:16:42.4378040Z         plasma,
2025-01-14T13:16:42.4378090Z         no_of_packets,
2025-01-14T13:16:42.4378650Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4378700Z         iteration=0,
2025-01-14T13:16:42.4381840Z     ):
2025-01-14T13:16:42.4381960Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4382040Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4382110Z         else:
2025-01-14T13:16:42.4382170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4382220Z     
2025-01-14T13:16:42.4382330Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4382400Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4382450Z         )
2025-01-14T13:16:42.4382500Z     
2025-01-14T13:16:42.4382610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4382700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4382830Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4382890Z         else:
2025-01-14T13:16:42.4382980Z             continuum_state = None
2025-01-14T13:16:42.4383070Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4383150Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4383220Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4558710Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4559050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4559160Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4559240Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4559320Z         ).to_numba(
2025-01-14T13:16:42.4559390Z             macro_atom_state,
2025-01-14T13:16:42.4562130Z             self.line_interaction_type,
2025-01-14T13:16:42.4562640Z         )
2025-01-14T13:16:42.4562960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4567400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4567640Z         ]
2025-01-14T13:16:42.4568460Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4568480Z 
2025-01-14T13:16:42.4568890Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4569520Z _ ERROR at setup of TestModelStateFromNonUniformAbundances.test_elemental_number_density _
2025-01-14T13:16:42.4569540Z 
2025-01-14T13:16:42.4571070Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4571940Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4571970Z 
2025-01-14T13:16:42.4572220Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4572640Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4572950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4573440Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4573690Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4573890Z >       sim.run_final()
2025-01-14T13:16:42.4573910Z 
2025-01-14T13:16:42.4574100Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4574340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4574550Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4574870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4575160Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4575570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4575840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4576470Z 
2025-01-14T13:16:42.4577420Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4580420Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4581580Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4581860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4582000Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4582140Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4582170Z 
2025-01-14T13:16:42.4582250Z     def initialize_transport_state(
2025-01-14T13:16:42.4582320Z         self,
2025-01-14T13:16:42.4582370Z         simulation_state,
2025-01-14T13:16:42.4582460Z         opacity_state,
2025-01-14T13:16:42.4582510Z         macro_atom_state,
2025-01-14T13:16:42.4582570Z         plasma,
2025-01-14T13:16:42.4582650Z         no_of_packets,
2025-01-14T13:16:42.4582760Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4582840Z         iteration=0,
2025-01-14T13:16:42.4582930Z     ):
2025-01-14T13:16:42.4583060Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4583170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4583230Z         else:
2025-01-14T13:16:42.4583330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4583380Z     
2025-01-14T13:16:42.4583520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4584450Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4586480Z         )
2025-01-14T13:16:42.4586560Z     
2025-01-14T13:16:42.4586680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4586810Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4587420Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4587500Z         else:
2025-01-14T13:16:42.4587570Z             continuum_state = None
2025-01-14T13:16:42.4587670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4587770Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4590220Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4590670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4590800Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4590880Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4590950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4590990Z         ).to_numba(
2025-01-14T13:16:42.4591050Z             macro_atom_state,
2025-01-14T13:16:42.4591110Z             self.line_interaction_type,
2025-01-14T13:16:42.4591160Z         )
2025-01-14T13:16:42.4591270Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4591510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4592740Z         ]
2025-01-14T13:16:42.4593410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4593430Z 
2025-01-14T13:16:42.4593570Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4593750Z _________ ERROR at setup of test_hdf_simulation_state_scalars[t_inner] _________
2025-01-14T13:16:42.4593760Z 
2025-01-14T13:16:42.4595370Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4595710Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4595730Z 
2025-01-14T13:16:42.4596670Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4597100Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4597220Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4597390Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4597460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4597520Z >       sim.run_final()
2025-01-14T13:16:42.4597520Z 
2025-01-14T13:16:42.4597600Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4597730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4597830Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4597990Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4598070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4598230Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4598540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4598560Z 
2025-01-14T13:16:42.4598850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4599060Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4599280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4599570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4599720Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4599860Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4599860Z 
2025-01-14T13:16:42.4599930Z     def initialize_transport_state(
2025-01-14T13:16:42.4599980Z         self,
2025-01-14T13:16:42.4600870Z         simulation_state,
2025-01-14T13:16:42.4600930Z         opacity_state,
2025-01-14T13:16:42.4600990Z         macro_atom_state,
2025-01-14T13:16:42.4601050Z         plasma,
2025-01-14T13:16:42.4601110Z         no_of_packets,
2025-01-14T13:16:42.4601170Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4601230Z         iteration=0,
2025-01-14T13:16:42.4601290Z     ):
2025-01-14T13:16:42.4601430Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4601510Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4601560Z         else:
2025-01-14T13:16:42.4601640Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4601690Z     
2025-01-14T13:16:42.4601810Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4601880Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4601950Z         )
2025-01-14T13:16:42.4602000Z     
2025-01-14T13:16:42.4602120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4602240Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4602400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4602460Z         else:
2025-01-14T13:16:42.4602530Z             continuum_state = None
2025-01-14T13:16:42.4602620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4602720Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4602800Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4602880Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4602980Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4603060Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4603130Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4603190Z         ).to_numba(
2025-01-14T13:16:42.4603290Z             macro_atom_state,
2025-01-14T13:16:42.4603390Z             self.line_interaction_type,
2025-01-14T13:16:42.4603460Z         )
2025-01-14T13:16:42.4603560Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4603840Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4605560Z         ]
2025-01-14T13:16:42.4605860Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4605870Z 
2025-01-14T13:16:42.4606000Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4606170Z _____ ERROR at setup of test_hdf_simulation_state_nparray[dilution_factor] _____
2025-01-14T13:16:42.4606170Z 
2025-01-14T13:16:42.4606750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4607090Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4607100Z 
2025-01-14T13:16:42.4607200Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4607370Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4607460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4607600Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4609070Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4609170Z >       sim.run_final()
2025-01-14T13:16:42.4609180Z 
2025-01-14T13:16:42.4609250Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4611120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4612100Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4612270Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4615190Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4619990Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4620090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4620100Z 
2025-01-14T13:16:42.4620310Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4620470Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4620640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4620860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4620980Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4621090Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4621100Z 
2025-01-14T13:16:42.4621160Z     def initialize_transport_state(
2025-01-14T13:16:42.4621210Z         self,
2025-01-14T13:16:42.4621260Z         simulation_state,
2025-01-14T13:16:42.4621320Z         opacity_state,
2025-01-14T13:16:42.4621370Z         macro_atom_state,
2025-01-14T13:16:42.4623980Z         plasma,
2025-01-14T13:16:42.4624060Z         no_of_packets,
2025-01-14T13:16:42.4624130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4624720Z         iteration=0,
2025-01-14T13:16:42.4624770Z     ):
2025-01-14T13:16:42.4624900Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4624980Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4625030Z         else:
2025-01-14T13:16:42.4625080Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4625140Z     
2025-01-14T13:16:42.4625500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4625610Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4625660Z         )
2025-01-14T13:16:42.4625730Z     
2025-01-14T13:16:42.4625870Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4625980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4626700Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4626780Z         else:
2025-01-14T13:16:42.4626850Z             continuum_state = None
2025-01-14T13:16:42.4626930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4627030Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4627100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4627190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4627280Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4627380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4627470Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4628640Z         ).to_numba(
2025-01-14T13:16:42.4628740Z             macro_atom_state,
2025-01-14T13:16:42.4628850Z             self.line_interaction_type,
2025-01-14T13:16:42.4628920Z         )
2025-01-14T13:16:42.4629030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4629350Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4629440Z         ]
2025-01-14T13:16:42.4629800Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4629810Z 
2025-01-14T13:16:42.4629990Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4630190Z _________ ERROR at setup of test_hdf_simulation_state_nparray[v_inner] _________
2025-01-14T13:16:42.4630200Z 
2025-01-14T13:16:42.4630820Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4634320Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4634330Z 
2025-01-14T13:16:42.4634450Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4634830Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4635130Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4635330Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4635430Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4635520Z >       sim.run_final()
2025-01-14T13:16:42.4635530Z 
2025-01-14T13:16:42.4635600Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4635690Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4635790Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4635940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4637120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4639250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4639430Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4639440Z 
2025-01-14T13:16:42.4639700Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4639920Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4640160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4644220Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4644400Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4644550Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4644570Z 
2025-01-14T13:16:42.4644670Z     def initialize_transport_state(
2025-01-14T13:16:42.4644750Z         self,
2025-01-14T13:16:42.4644810Z         simulation_state,
2025-01-14T13:16:42.4645090Z         opacity_state,
2025-01-14T13:16:42.4645150Z         macro_atom_state,
2025-01-14T13:16:42.4645220Z         plasma,
2025-01-14T13:16:42.4645300Z         no_of_packets,
2025-01-14T13:16:42.4645370Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4645450Z         iteration=0,
2025-01-14T13:16:42.4645510Z     ):
2025-01-14T13:16:42.4645620Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4645730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4645810Z         else:
2025-01-14T13:16:42.4645880Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4645930Z     
2025-01-14T13:16:42.4646390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4646490Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4646550Z         )
2025-01-14T13:16:42.4646610Z     
2025-01-14T13:16:42.4646760Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4646880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4647050Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4647110Z         else:
2025-01-14T13:16:42.4712820Z             continuum_state = None
2025-01-14T13:16:42.4713170Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4713260Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4713330Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4713410Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4713490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4713560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4713630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4713670Z         ).to_numba(
2025-01-14T13:16:42.4713730Z             macro_atom_state,
2025-01-14T13:16:42.4714280Z             self.line_interaction_type,
2025-01-14T13:16:42.4714340Z         )
2025-01-14T13:16:42.4714420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4714660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4714700Z         ]
2025-01-14T13:16:42.4714950Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4714950Z 
2025-01-14T13:16:42.4715070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4715210Z _________ ERROR at setup of test_hdf_simulation_state_nparray[v_outer] _________
2025-01-14T13:16:42.4715220Z 
2025-01-14T13:16:42.4715740Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4716030Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4716040Z 
2025-01-14T13:16:42.4716100Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4716230Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4716300Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4716450Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4716520Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4716580Z >       sim.run_final()
2025-01-14T13:16:42.4716590Z 
2025-01-14T13:16:42.4716640Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4716740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4716810Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4716930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4717000Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4717120Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4717380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4717380Z 
2025-01-14T13:16:42.4717610Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4717790Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4717970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4718190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4718320Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4718660Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4718670Z 
2025-01-14T13:16:42.4718840Z     def initialize_transport_state(
2025-01-14T13:16:42.4718980Z         self,
2025-01-14T13:16:42.4719110Z         simulation_state,
2025-01-14T13:16:42.4719170Z         opacity_state,
2025-01-14T13:16:42.4719290Z         macro_atom_state,
2025-01-14T13:16:42.4721780Z         plasma,
2025-01-14T13:16:42.4721900Z         no_of_packets,
2025-01-14T13:16:42.4722010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4722130Z         iteration=0,
2025-01-14T13:16:42.4722170Z     ):
2025-01-14T13:16:42.4722390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4722530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4722640Z         else:
2025-01-14T13:16:42.4722690Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4722820Z     
2025-01-14T13:16:42.4723010Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4723100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4723280Z         )
2025-01-14T13:16:42.4723450Z     
2025-01-14T13:16:42.4723610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4723780Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4723960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4724010Z         else:
2025-01-14T13:16:42.4724120Z             continuum_state = None
2025-01-14T13:16:42.4724270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4724420Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4724490Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4724670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4724800Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4724950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4725060Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4725120Z         ).to_numba(
2025-01-14T13:16:42.4725290Z             macro_atom_state,
2025-01-14T13:16:42.4725410Z             self.line_interaction_type,
2025-01-14T13:16:42.4725530Z         )
2025-01-14T13:16:42.4725620Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4725940Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4725990Z         ]
2025-01-14T13:16:42.4726410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4726410Z 
2025-01-14T13:16:42.4726590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4726720Z _____________________ ERROR at setup of test_hdf_density_0 _____________________
2025-01-14T13:16:42.4726720Z 
2025-01-14T13:16:42.4727410Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4727770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4728030Z 
2025-01-14T13:16:42.4728170Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4728350Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4728440Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4728670Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4728790Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4728910Z >       sim.run_final()
2025-01-14T13:16:42.4728920Z 
2025-01-14T13:16:42.4728970Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4729120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4729260Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4729430Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4729500Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4729700Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4729840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4729840Z 
2025-01-14T13:16:42.4730130Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4730290Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4730540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4730850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4731050Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4731230Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4731450Z 
2025-01-14T13:16:42.4731580Z     def initialize_transport_state(
2025-01-14T13:16:42.4731620Z         self,
2025-01-14T13:16:42.4731730Z         simulation_state,
2025-01-14T13:16:42.4731840Z         opacity_state,
2025-01-14T13:16:42.4731950Z         macro_atom_state,
2025-01-14T13:16:42.4732000Z         plasma,
2025-01-14T13:16:42.4732100Z         no_of_packets,
2025-01-14T13:16:42.4732210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4732340Z         iteration=0,
2025-01-14T13:16:42.4732390Z     ):
2025-01-14T13:16:42.4732580Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4732710Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4732820Z         else:
2025-01-14T13:16:42.4732870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4732980Z     
2025-01-14T13:16:42.4733150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4733230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4733420Z         )
2025-01-14T13:16:42.4733460Z     
2025-01-14T13:16:42.4733610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4733760Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4733930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4733980Z         else:
2025-01-14T13:16:42.4734100Z             continuum_state = None
2025-01-14T13:16:42.4734230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4734390Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4734460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4734610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4734760Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4734890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4735020Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4735070Z         ).to_numba(
2025-01-14T13:16:42.4735190Z             macro_atom_state,
2025-01-14T13:16:42.4735300Z             self.line_interaction_type,
2025-01-14T13:16:42.4735520Z         )
2025-01-14T13:16:42.4735600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4735910Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4736050Z         ]
2025-01-14T13:16:42.4736350Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4736350Z 
2025-01-14T13:16:42.4736520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4736650Z ______________________ ERROR at setup of test_hdf_time_0 _______________________
2025-01-14T13:16:42.4736650Z 
2025-01-14T13:16:42.4737220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4737560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4737570Z 
2025-01-14T13:16:42.4737690Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4737880Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4737950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4738140Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4738260Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4738370Z >       sim.run_final()
2025-01-14T13:16:42.4738370Z 
2025-01-14T13:16:42.4738720Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4738880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4739010Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4739300Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4739370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4739900Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4740060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4740060Z 
2025-01-14T13:16:42.4740370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4740540Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4740820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4741140Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4741310Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4741470Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4741480Z 
2025-01-14T13:16:42.4741590Z     def initialize_transport_state(
2025-01-14T13:16:42.4741640Z         self,
2025-01-14T13:16:42.4741740Z         simulation_state,
2025-01-14T13:16:42.4741840Z         opacity_state,
2025-01-14T13:16:42.4741940Z         macro_atom_state,
2025-01-14T13:16:42.4742000Z         plasma,
2025-01-14T13:16:42.4742100Z         no_of_packets,
2025-01-14T13:16:42.4742220Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4742310Z         iteration=0,
2025-01-14T13:16:42.4742360Z     ):
2025-01-14T13:16:42.4742510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4742630Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4742720Z         else:
2025-01-14T13:16:42.4742780Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4742890Z     
2025-01-14T13:16:42.4743050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4743130Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4743300Z         )
2025-01-14T13:16:42.4743340Z     
2025-01-14T13:16:42.4743610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4743750Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4743920Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4743970Z         else:
2025-01-14T13:16:42.4744080Z             continuum_state = None
2025-01-14T13:16:42.4744220Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4744380Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4744510Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4744590Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4744700Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4744830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4744960Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4745010Z         ).to_numba(
2025-01-14T13:16:42.4745110Z             macro_atom_state,
2025-01-14T13:16:42.4745230Z             self.line_interaction_type,
2025-01-14T13:16:42.4745340Z         )
2025-01-14T13:16:42.4745420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4745730Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4745910Z         ]
2025-01-14T13:16:42.4746230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4746230Z 
2025-01-14T13:16:42.4746410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4746550Z _____________ ERROR at setup of test_opacity_solver[scatter-False] _____________
2025-01-14T13:16:42.4746550Z 
2025-01-14T13:16:42.4747100Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4747540Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4747550Z 
2025-01-14T13:16:42.4747660Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4747850Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4748020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4748220Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4748330Z >       sim.iterate(10)
2025-01-14T13:16:42.4748330Z 
2025-01-14T13:16:42.4748490Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4748600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4748740Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4748960Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4749110Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4749110Z 
2025-01-14T13:16:42.4749420Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11b3720f0>
2025-01-14T13:16:42.4749630Z simulation_state = <tardis.model.base.SimulationState object at 0x11b464890>
2025-01-14T13:16:42.4749900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x14662ed50>
2025-01-14T13:16:42.4750120Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3097f23f0>
2025-01-14T13:16:42.4750320Z plasma = <tardis.plasma.base.BasePlasma object at 0x1465682f0>
2025-01-14T13:16:42.4750480Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4750490Z 
2025-01-14T13:16:42.4750600Z     def initialize_transport_state(
2025-01-14T13:16:42.4750650Z         self,
2025-01-14T13:16:42.4750780Z         simulation_state,
2025-01-14T13:16:42.4750910Z         opacity_state,
2025-01-14T13:16:42.4751080Z         macro_atom_state,
2025-01-14T13:16:42.4751180Z         plasma,
2025-01-14T13:16:42.4751230Z         no_of_packets,
2025-01-14T13:16:42.4751350Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4751450Z         iteration=0,
2025-01-14T13:16:42.4751570Z     ):
2025-01-14T13:16:42.4751680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4751830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4751950Z         else:
2025-01-14T13:16:42.4752070Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4752110Z     
2025-01-14T13:16:42.4752260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4752390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4752490Z         )
2025-01-14T13:16:42.4752590Z     
2025-01-14T13:16:42.4752690Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4752830Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4753000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4753050Z         else:
2025-01-14T13:16:42.4753180Z             continuum_state = None
2025-01-14T13:16:42.4753320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4753460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4753590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4753670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4753840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4753960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4754080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4754180Z         ).to_numba(
2025-01-14T13:16:42.4754230Z             macro_atom_state,
2025-01-14T13:16:42.4754340Z             self.line_interaction_type,
2025-01-14T13:16:42.4754520Z         )
2025-01-14T13:16:42.4754650Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4754870Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4754960Z         ]
2025-01-14T13:16:42.4755250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4755250Z 
2025-01-14T13:16:42.4755430Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4755630Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.4756010Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.4756440Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.4756580Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.4757160Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.4757310Z ____________ ERROR at setup of test_opacity_solver[macroatom-False] ____________
2025-01-14T13:16:42.4757390Z 
2025-01-14T13:16:42.4757910Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4758270Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4758280Z 
2025-01-14T13:16:42.4758390Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4758570Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4758650Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4758850Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4759200Z >       sim.iterate(10)
2025-01-14T13:16:42.4759210Z 
2025-01-14T13:16:42.4759340Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4759480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4759550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4759740Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4759890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4759890Z 
2025-01-14T13:16:42.4760170Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11b3720f0>
2025-01-14T13:16:42.4760320Z simulation_state = <tardis.model.base.SimulationState object at 0x11b464890>
2025-01-14T13:16:42.4760570Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x14662ed50>
2025-01-14T13:16:42.4760870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3097f23f0>
2025-01-14T13:16:42.4761070Z plasma = <tardis.plasma.base.BasePlasma object at 0x1465682f0>
2025-01-14T13:16:42.4761170Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4761180Z 
2025-01-14T13:16:42.4761320Z     def initialize_transport_state(
2025-01-14T13:16:42.4761430Z         self,
2025-01-14T13:16:42.4761530Z         simulation_state,
2025-01-14T13:16:42.4761660Z         opacity_state,
2025-01-14T13:16:42.4761710Z         macro_atom_state,
2025-01-14T13:16:42.4761820Z         plasma,
2025-01-14T13:16:42.4762800Z         no_of_packets,
2025-01-14T13:16:42.4762960Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4763080Z         iteration=0,
2025-01-14T13:16:42.4763180Z     ):
2025-01-14T13:16:42.4763340Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4763910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4764050Z         else:
2025-01-14T13:16:42.4764170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4764280Z     
2025-01-14T13:16:42.4764390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4764530Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4764630Z         )
2025-01-14T13:16:42.4764740Z     
2025-01-14T13:16:42.4764840Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4764990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4765170Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4765270Z         else:
2025-01-14T13:16:42.4765400Z             continuum_state = None
2025-01-14T13:16:42.4765480Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4765620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4765740Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4765880Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4765960Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4766080Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4766210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4766320Z         ).to_numba(
2025-01-14T13:16:42.4766370Z             macro_atom_state,
2025-01-14T13:16:42.4766560Z             self.line_interaction_type,
2025-01-14T13:16:42.4766680Z         )
2025-01-14T13:16:42.4766810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4767090Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4767130Z         ]
2025-01-14T13:16:42.4767430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4767440Z 
2025-01-14T13:16:42.4767630Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4767830Z ____________ ERROR at setup of test_opacity_solver[macroatom-True] _____________
2025-01-14T13:16:42.4767940Z 
2025-01-14T13:16:42.4768460Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4768820Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4768820Z 
2025-01-14T13:16:42.4768940Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4769140Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4769280Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4769420Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4769550Z >       sim.iterate(10)
2025-01-14T13:16:42.4769550Z 
2025-01-14T13:16:42.4769690Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4769840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4769970Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4770090Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4770240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4770240Z 
2025-01-14T13:16:42.4770440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11b3720f0>
2025-01-14T13:16:42.4770730Z simulation_state = <tardis.model.base.SimulationState object at 0x11b464890>
2025-01-14T13:16:42.4770910Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x14662ed50>
2025-01-14T13:16:42.4771190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3097f23f0>
2025-01-14T13:16:42.4771440Z plasma = <tardis.plasma.base.BasePlasma object at 0x1465682f0>
2025-01-14T13:16:42.4771610Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4771610Z 
2025-01-14T13:16:42.4771750Z     def initialize_transport_state(
2025-01-14T13:16:42.4771790Z         self,
2025-01-14T13:16:42.4771920Z         simulation_state,
2025-01-14T13:16:42.4772010Z         opacity_state,
2025-01-14T13:16:42.4772120Z         macro_atom_state,
2025-01-14T13:16:42.4772170Z         plasma,
2025-01-14T13:16:42.4772280Z         no_of_packets,
2025-01-14T13:16:42.4772680Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4772820Z         iteration=0,
2025-01-14T13:16:42.4772860Z     ):
2025-01-14T13:16:42.4773030Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4773170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4773280Z         else:
2025-01-14T13:16:42.4773420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4773470Z     
2025-01-14T13:16:42.4773710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4773860Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4773980Z         )
2025-01-14T13:16:42.4774020Z     
2025-01-14T13:16:42.4774190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4774350Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4774540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4774590Z         else:
2025-01-14T13:16:42.4774770Z             continuum_state = None
2025-01-14T13:16:42.4774930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4775060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4775200Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4775280Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4775420Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4775580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4775890Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4775950Z         ).to_numba(
2025-01-14T13:16:42.4776090Z             macro_atom_state,
2025-01-14T13:16:42.4776260Z             self.line_interaction_type,
2025-01-14T13:16:42.4776390Z         )
2025-01-14T13:16:42.4776480Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4776830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4776970Z         ]
2025-01-14T13:16:42.4777280Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4777290Z 
2025-01-14T13:16:42.4777490Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4777640Z ___________ ERROR at setup of test_opacity_solver[downbranch-False] ____________
2025-01-14T13:16:42.4777640Z 
2025-01-14T13:16:42.4778230Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4778620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4778630Z 
2025-01-14T13:16:42.4778770Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4778950Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4779020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4779230Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4779350Z >       sim.iterate(10)
2025-01-14T13:16:42.4779360Z 
2025-01-14T13:16:42.4779490Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4779710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4779850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4780040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4780190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4780200Z 
2025-01-14T13:16:42.4780490Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11b3720f0>
2025-01-14T13:16:42.4780660Z simulation_state = <tardis.model.base.SimulationState object at 0x11b464890>
2025-01-14T13:16:42.4780890Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x14662ed50>
2025-01-14T13:16:42.4781100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3097f23f0>
2025-01-14T13:16:42.4781370Z plasma = <tardis.plasma.base.BasePlasma object at 0x1465682f0>
2025-01-14T13:16:42.4781530Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4781530Z 
2025-01-14T13:16:42.4781590Z     def initialize_transport_state(
2025-01-14T13:16:42.4781710Z         self,
2025-01-14T13:16:42.4781830Z         simulation_state,
2025-01-14T13:16:42.4781960Z         opacity_state,
2025-01-14T13:16:42.4782010Z         macro_atom_state,
2025-01-14T13:16:42.4782120Z         plasma,
2025-01-14T13:16:42.4782240Z         no_of_packets,
2025-01-14T13:16:42.4782370Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4782420Z         iteration=0,
2025-01-14T13:16:42.4782520Z     ):
2025-01-14T13:16:42.4782670Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4782800Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4782850Z         else:
2025-01-14T13:16:42.4782970Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4783070Z     
2025-01-14T13:16:42.4783240Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4783370Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4783410Z         )
2025-01-14T13:16:42.4783550Z     
2025-01-14T13:16:42.4783880Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4784030Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4784160Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4784270Z         else:
2025-01-14T13:16:42.4784380Z             continuum_state = None
2025-01-14T13:16:42.4784530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4784630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4784800Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4785000Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4785180Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4785330Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4785400Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4785520Z         ).to_numba(
2025-01-14T13:16:42.4785630Z             macro_atom_state,
2025-01-14T13:16:42.4785790Z             self.line_interaction_type,
2025-01-14T13:16:42.4785840Z         )
2025-01-14T13:16:42.4786020Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4786320Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4786450Z         ]
2025-01-14T13:16:42.4786690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4786700Z 
2025-01-14T13:16:42.4786910Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4787140Z ____________ ERROR at setup of test_opacity_solver[downbranch-True] ____________
2025-01-14T13:16:42.4787150Z 
2025-01-14T13:16:42.4787750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4788210Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4788220Z 
2025-01-14T13:16:42.4788360Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4788490Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4788630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4788840Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4788960Z >       sim.iterate(10)
2025-01-14T13:16:42.4788970Z 
2025-01-14T13:16:42.4789030Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4805590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4805800Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4805960Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4806050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4806060Z 
2025-01-14T13:16:42.4806270Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11b3720f0>
2025-01-14T13:16:42.4806430Z simulation_state = <tardis.model.base.SimulationState object at 0x11b464890>
2025-01-14T13:16:42.4806610Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x14662ed50>
2025-01-14T13:16:42.4806830Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3097f23f0>
2025-01-14T13:16:42.4806950Z plasma = <tardis.plasma.base.BasePlasma object at 0x1465682f0>
2025-01-14T13:16:42.4807060Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4807060Z 
2025-01-14T13:16:42.4807120Z     def initialize_transport_state(
2025-01-14T13:16:42.4807180Z         self,
2025-01-14T13:16:42.4807230Z         simulation_state,
2025-01-14T13:16:42.4807280Z         opacity_state,
2025-01-14T13:16:42.4807850Z         macro_atom_state,
2025-01-14T13:16:42.4807900Z         plasma,
2025-01-14T13:16:42.4807950Z         no_of_packets,
2025-01-14T13:16:42.4808010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4808060Z         iteration=0,
2025-01-14T13:16:42.4808100Z     ):
2025-01-14T13:16:42.4808200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4808270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4808330Z         else:
2025-01-14T13:16:42.4808380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4808420Z     
2025-01-14T13:16:42.4808530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4808600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4808640Z         )
2025-01-14T13:16:42.4808680Z     
2025-01-14T13:16:42.4808790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4808890Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4809010Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4809060Z         else:
2025-01-14T13:16:42.4809120Z             continuum_state = None
2025-01-14T13:16:42.4809190Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4809270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4809350Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4809430Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4809500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4809570Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4809630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4809680Z         ).to_numba(
2025-01-14T13:16:42.4809740Z             macro_atom_state,
2025-01-14T13:16:42.4809810Z             self.line_interaction_type,
2025-01-14T13:16:42.4810230Z         )
2025-01-14T13:16:42.4810310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4810560Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4810620Z         ]
2025-01-14T13:16:42.4810860Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4810870Z 
2025-01-14T13:16:42.4810980Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4811130Z _________ ERROR at setup of test_opacity_state_to_numba[scatter-False] _________
2025-01-14T13:16:42.4811130Z 
2025-01-14T13:16:42.4811700Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4811990Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4812000Z 
2025-01-14T13:16:42.4812060Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4812180Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4812250Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4812410Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4812470Z >       sim.iterate(10)
2025-01-14T13:16:42.4812470Z 
2025-01-14T13:16:42.4812530Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4812620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4812680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4812810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4812890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4812900Z 
2025-01-14T13:16:42.4813110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c95fd10>
2025-01-14T13:16:42.4813360Z simulation_state = <tardis.model.base.SimulationState object at 0x30979d400>
2025-01-14T13:16:42.4813530Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x11b34f6e0>
2025-01-14T13:16:42.4813750Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1467ccd10>
2025-01-14T13:16:42.4813870Z plasma = <tardis.plasma.base.BasePlasma object at 0x11b2c0e90>
2025-01-14T13:16:42.4813970Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4813980Z 
2025-01-14T13:16:42.4814040Z     def initialize_transport_state(
2025-01-14T13:16:42.4814080Z         self,
2025-01-14T13:16:42.4814130Z         simulation_state,
2025-01-14T13:16:42.4814180Z         opacity_state,
2025-01-14T13:16:42.4814230Z         macro_atom_state,
2025-01-14T13:16:42.4814280Z         plasma,
2025-01-14T13:16:42.4814320Z         no_of_packets,
2025-01-14T13:16:42.4814380Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4814440Z         iteration=0,
2025-01-14T13:16:42.4814480Z     ):
2025-01-14T13:16:42.4814570Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4814640Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4814690Z         else:
2025-01-14T13:16:42.4814740Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4814780Z     
2025-01-14T13:16:42.4814880Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4814960Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4815000Z         )
2025-01-14T13:16:42.4815040Z     
2025-01-14T13:16:42.4815140Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4815220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4815340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4815450Z         else:
2025-01-14T13:16:42.4815510Z             continuum_state = None
2025-01-14T13:16:42.4815580Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4815670Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4815730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4815820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4815890Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4815960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4816020Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4816060Z         ).to_numba(
2025-01-14T13:16:42.4816120Z             macro_atom_state,
2025-01-14T13:16:42.4816180Z             self.line_interaction_type,
2025-01-14T13:16:42.4816220Z         )
2025-01-14T13:16:42.4816290Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4816540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4816610Z         ]
2025-01-14T13:16:42.4816890Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4816910Z 
2025-01-14T13:16:42.4817050Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4817230Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.4817610Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.4818010Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.4818160Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.4818630Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.4818810Z ________ ERROR at setup of test_opacity_state_to_numba[macroatom-False] ________
2025-01-14T13:16:42.4818940Z 
2025-01-14T13:16:42.4819510Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4819820Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4819830Z 
2025-01-14T13:16:42.4819910Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4820070Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4820140Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4820310Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4820380Z >       sim.iterate(10)
2025-01-14T13:16:42.4820380Z 
2025-01-14T13:16:42.4820460Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4820560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4820640Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4820780Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4820870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4820870Z 
2025-01-14T13:16:42.4821100Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c95fd10>
2025-01-14T13:16:42.4821260Z simulation_state = <tardis.model.base.SimulationState object at 0x30979d400>
2025-01-14T13:16:42.4821450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x11b34f6e0>
2025-01-14T13:16:42.4821690Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1467ccd10>
2025-01-14T13:16:42.4821900Z plasma = <tardis.plasma.base.BasePlasma object at 0x11b2c0e90>
2025-01-14T13:16:42.4822020Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4822030Z 
2025-01-14T13:16:42.4822090Z     def initialize_transport_state(
2025-01-14T13:16:42.4822140Z         self,
2025-01-14T13:16:42.4822190Z         simulation_state,
2025-01-14T13:16:42.4822240Z         opacity_state,
2025-01-14T13:16:42.4822290Z         macro_atom_state,
2025-01-14T13:16:42.4822340Z         plasma,
2025-01-14T13:16:42.4822390Z         no_of_packets,
2025-01-14T13:16:42.4822450Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4822490Z         iteration=0,
2025-01-14T13:16:42.4822530Z     ):
2025-01-14T13:16:42.4822630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4822700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4822740Z         else:
2025-01-14T13:16:42.4822800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4822840Z     
2025-01-14T13:16:42.4828240Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4828720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4828920Z         )
2025-01-14T13:16:42.4829080Z     
2025-01-14T13:16:42.4829380Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4829670Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4830010Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4830160Z         else:
2025-01-14T13:16:42.4830340Z             continuum_state = None
2025-01-14T13:16:42.4830560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4830790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4830990Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4831210Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4831490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4831720Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4832630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4832780Z         ).to_numba(
2025-01-14T13:16:42.4832940Z             macro_atom_state,
2025-01-14T13:16:42.4833130Z             self.line_interaction_type,
2025-01-14T13:16:42.4833270Z         )
2025-01-14T13:16:42.4833520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4834140Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4834290Z         ]
2025-01-14T13:16:42.4834960Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4834970Z 
2025-01-14T13:16:42.4837130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4837380Z ________ ERROR at setup of test_opacity_state_to_numba[macroatom-True] _________
2025-01-14T13:16:42.4837400Z 
2025-01-14T13:16:42.4837960Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4838280Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4838280Z 
2025-01-14T13:16:42.4838360Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4838500Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4838580Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4838740Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4838800Z >       sim.iterate(10)
2025-01-14T13:16:42.4838800Z 
2025-01-14T13:16:42.4838880Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4839290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4839370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4839500Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4839590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4839590Z 
2025-01-14T13:16:42.4839820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c95fd10>
2025-01-14T13:16:42.4839980Z simulation_state = <tardis.model.base.SimulationState object at 0x30979d400>
2025-01-14T13:16:42.4840170Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x11b34f6e0>
2025-01-14T13:16:42.4843220Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1467ccd10>
2025-01-14T13:16:42.4843390Z plasma = <tardis.plasma.base.BasePlasma object at 0x11b2c0e90>
2025-01-14T13:16:42.4843510Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4843510Z 
2025-01-14T13:16:42.4843580Z     def initialize_transport_state(
2025-01-14T13:16:42.4843630Z         self,
2025-01-14T13:16:42.4843690Z         simulation_state,
2025-01-14T13:16:42.4843740Z         opacity_state,
2025-01-14T13:16:42.4843790Z         macro_atom_state,
2025-01-14T13:16:42.4843840Z         plasma,
2025-01-14T13:16:42.4843890Z         no_of_packets,
2025-01-14T13:16:42.4843950Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4843990Z         iteration=0,
2025-01-14T13:16:42.4849190Z     ):
2025-01-14T13:16:42.4849310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4849400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4849470Z         else:
2025-01-14T13:16:42.4849530Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4849580Z     
2025-01-14T13:16:42.4849680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4849770Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4849810Z         )
2025-01-14T13:16:42.4849860Z     
2025-01-14T13:16:42.4857510Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4857640Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4857770Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4857820Z         else:
2025-01-14T13:16:42.4857880Z             continuum_state = None
2025-01-14T13:16:42.4857960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4858040Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4858110Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4858200Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4858270Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4858340Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4858410Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4858470Z         ).to_numba(
2025-01-14T13:16:42.4858520Z             macro_atom_state,
2025-01-14T13:16:42.4858590Z             self.line_interaction_type,
2025-01-14T13:16:42.4858640Z         )
2025-01-14T13:16:42.4858740Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4858960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4859010Z         ]
2025-01-14T13:16:42.4859280Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4859290Z 
2025-01-14T13:16:42.4859410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4859560Z _______ ERROR at setup of test_opacity_state_to_numba[downbranch-False] ________
2025-01-14T13:16:42.4859570Z 
2025-01-14T13:16:42.4860080Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4860710Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4860720Z 
2025-01-14T13:16:42.4860780Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4860910Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4860980Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4861120Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4861170Z >       sim.iterate(10)
2025-01-14T13:16:42.4861180Z 
2025-01-14T13:16:42.4861240Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4861330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4861400Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4861530Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4861620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4861620Z 
2025-01-14T13:16:42.4861830Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c95fd10>
2025-01-14T13:16:42.4861980Z simulation_state = <tardis.model.base.SimulationState object at 0x30979d400>
2025-01-14T13:16:42.4862160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x11b34f6e0>
2025-01-14T13:16:42.4862380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1467ccd10>
2025-01-14T13:16:42.4862510Z plasma = <tardis.plasma.base.BasePlasma object at 0x11b2c0e90>
2025-01-14T13:16:42.4862610Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4862620Z 
2025-01-14T13:16:42.4862680Z     def initialize_transport_state(
2025-01-14T13:16:42.4862730Z         self,
2025-01-14T13:16:42.4862780Z         simulation_state,
2025-01-14T13:16:42.4862830Z         opacity_state,
2025-01-14T13:16:42.4862970Z         macro_atom_state,
2025-01-14T13:16:42.4863020Z         plasma,
2025-01-14T13:16:42.4863060Z         no_of_packets,
2025-01-14T13:16:42.4863120Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4863170Z         iteration=0,
2025-01-14T13:16:42.4863210Z     ):
2025-01-14T13:16:42.4863310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4863380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4863440Z         else:
2025-01-14T13:16:42.4863490Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4863540Z     
2025-01-14T13:16:42.4863640Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4863720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4863760Z         )
2025-01-14T13:16:42.4863800Z     
2025-01-14T13:16:42.4863900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4863990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4864120Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4864190Z         else:
2025-01-14T13:16:42.4864250Z             continuum_state = None
2025-01-14T13:16:42.4864320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4864400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4864470Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4864550Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4864630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4864690Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4864760Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4864810Z         ).to_numba(
2025-01-14T13:16:42.4864860Z             macro_atom_state,
2025-01-14T13:16:42.4865010Z             self.line_interaction_type,
2025-01-14T13:16:42.4865060Z         )
2025-01-14T13:16:42.4865150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4865390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4865430Z         ]
2025-01-14T13:16:42.4865680Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4865680Z 
2025-01-14T13:16:42.4865800Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4865940Z ________ ERROR at setup of test_opacity_state_to_numba[downbranch-True] ________
2025-01-14T13:16:42.4865950Z 
2025-01-14T13:16:42.4866450Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4866740Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4866750Z 
2025-01-14T13:16:42.4866810Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4866940Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4867020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4867150Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4867210Z >       sim.iterate(10)
2025-01-14T13:16:42.4867210Z 
2025-01-14T13:16:42.4867280Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4867360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4867430Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4867550Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4867640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4867640Z 
2025-01-14T13:16:42.4867850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c95fd10>
2025-01-14T13:16:42.4868110Z simulation_state = <tardis.model.base.SimulationState object at 0x30979d400>
2025-01-14T13:16:42.4868280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x11b34f6e0>
2025-01-14T13:16:42.4868500Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1467ccd10>
2025-01-14T13:16:42.4868620Z plasma = <tardis.plasma.base.BasePlasma object at 0x11b2c0e90>
2025-01-14T13:16:42.4868730Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4868730Z 
2025-01-14T13:16:42.4868790Z     def initialize_transport_state(
2025-01-14T13:16:42.4868840Z         self,
2025-01-14T13:16:42.4868890Z         simulation_state,
2025-01-14T13:16:42.4868940Z         opacity_state,
2025-01-14T13:16:42.4868990Z         macro_atom_state,
2025-01-14T13:16:42.4869040Z         plasma,
2025-01-14T13:16:42.4869080Z         no_of_packets,
2025-01-14T13:16:42.4869150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4869190Z         iteration=0,
2025-01-14T13:16:42.4869240Z     ):
2025-01-14T13:16:42.4869340Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4869400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4869450Z         else:
2025-01-14T13:16:42.4869500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4869550Z     
2025-01-14T13:16:42.4869650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4869720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4869760Z         )
2025-01-14T13:16:42.4869800Z     
2025-01-14T13:16:42.4869900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4869990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4870110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4870220Z         else:
2025-01-14T13:16:42.4870280Z             continuum_state = None
2025-01-14T13:16:42.4870380Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4870470Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4870540Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4870620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4870710Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4870780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4870850Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4870890Z         ).to_numba(
2025-01-14T13:16:42.4870940Z             macro_atom_state,
2025-01-14T13:16:42.4871000Z             self.line_interaction_type,
2025-01-14T13:16:42.4871040Z         )
2025-01-14T13:16:42.4871120Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4871340Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4871390Z         ]
2025-01-14T13:16:42.4871640Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4871640Z 
2025-01-14T13:16:42.4871770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4871910Z ____________ ERROR at setup of test_calculate_sobolev_line_opacity _____________
2025-01-14T13:16:42.4871920Z 
2025-01-14T13:16:42.4872420Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4872710Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4872720Z 
2025-01-14T13:16:42.4872780Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4872920Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4873120Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4873250Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4873310Z >       sim.iterate(10)
2025-01-14T13:16:42.4873310Z 
2025-01-14T13:16:42.4873370Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4873460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4873530Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4873650Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4873730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4873740Z 
2025-01-14T13:16:42.4873950Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31baceff0>
2025-01-14T13:16:42.4874110Z simulation_state = <tardis.model.base.SimulationState object at 0x11b3fac30>
2025-01-14T13:16:42.4874280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31dc592b0>
2025-01-14T13:16:42.4874500Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310e547d0>
2025-01-14T13:16:42.4874620Z plasma = <tardis.plasma.base.BasePlasma object at 0x3097c5580>
2025-01-14T13:16:42.4874730Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4874730Z 
2025-01-14T13:16:42.4874790Z     def initialize_transport_state(
2025-01-14T13:16:42.4874830Z         self,
2025-01-14T13:16:42.4874890Z         simulation_state,
2025-01-14T13:16:42.4874950Z         opacity_state,
2025-01-14T13:16:42.4875000Z         macro_atom_state,
2025-01-14T13:16:42.4875050Z         plasma,
2025-01-14T13:16:42.4875100Z         no_of_packets,
2025-01-14T13:16:42.4875160Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4875260Z         iteration=0,
2025-01-14T13:16:42.4875310Z     ):
2025-01-14T13:16:42.4875400Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4875470Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4875520Z         else:
2025-01-14T13:16:42.4875570Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4875610Z     
2025-01-14T13:16:42.4875720Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4875800Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4875840Z         )
2025-01-14T13:16:42.4875880Z     
2025-01-14T13:16:42.4875980Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4876070Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4876190Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4876230Z         else:
2025-01-14T13:16:42.4876290Z             continuum_state = None
2025-01-14T13:16:42.4876370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4876460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4876520Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4876600Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4876670Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4876740Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4876810Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4876850Z         ).to_numba(
2025-01-14T13:16:42.4876900Z             macro_atom_state,
2025-01-14T13:16:42.4876970Z             self.line_interaction_type,
2025-01-14T13:16:42.4877010Z         )
2025-01-14T13:16:42.4877080Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4877300Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4877340Z         ]
2025-01-14T13:16:42.4877590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4877840Z 
2025-01-14T13:16:42.4877960Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4878100Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.4878470Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.4878820Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.4878940Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.4879340Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.4879480Z ________________ ERROR at setup of test_calculate_beta_sobolevs ________________
2025-01-14T13:16:42.4879490Z 
2025-01-14T13:16:42.4879990Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4880280Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4880290Z 
2025-01-14T13:16:42.4880360Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.4880490Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4880560Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4880700Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4880750Z >       sim.iterate(10)
2025-01-14T13:16:42.4880750Z 
2025-01-14T13:16:42.4880820Z tardis/opacities/tests/conftest.py:10: 
2025-01-14T13:16:42.4881210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4881280Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4881410Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4881490Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4881490Z 
2025-01-14T13:16:42.4881710Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31baceff0>
2025-01-14T13:16:42.4881860Z simulation_state = <tardis.model.base.SimulationState object at 0x11b3fac30>
2025-01-14T13:16:42.4882040Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31dc592b0>
2025-01-14T13:16:42.4882260Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310e547d0>
2025-01-14T13:16:42.4882380Z plasma = <tardis.plasma.base.BasePlasma object at 0x3097c5580>
2025-01-14T13:16:42.4882490Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.4882490Z 
2025-01-14T13:16:42.4882560Z     def initialize_transport_state(
2025-01-14T13:16:42.4882610Z         self,
2025-01-14T13:16:42.4882660Z         simulation_state,
2025-01-14T13:16:42.4882710Z         opacity_state,
2025-01-14T13:16:42.4882760Z         macro_atom_state,
2025-01-14T13:16:42.4882800Z         plasma,
2025-01-14T13:16:42.4882850Z         no_of_packets,
2025-01-14T13:16:42.4882900Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4882950Z         iteration=0,
2025-01-14T13:16:42.4882990Z     ):
2025-01-14T13:16:42.4883200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4883270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4883310Z         else:
2025-01-14T13:16:42.4883360Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4883410Z     
2025-01-14T13:16:42.4883510Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4883580Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4883630Z         )
2025-01-14T13:16:42.4883670Z     
2025-01-14T13:16:42.4883870Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4883950Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4884070Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4884120Z         else:
2025-01-14T13:16:42.4884180Z             continuum_state = None
2025-01-14T13:16:42.4884250Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4884330Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4884400Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4884480Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4884550Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4884620Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4884680Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4884730Z         ).to_numba(
2025-01-14T13:16:42.4884780Z             macro_atom_state,
2025-01-14T13:16:42.4884840Z             self.line_interaction_type,
2025-01-14T13:16:42.4884880Z         )
2025-01-14T13:16:42.4884950Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4885170Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4885220Z         ]
2025-01-14T13:16:42.4885460Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4885460Z 
2025-01-14T13:16:42.4885590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4885720Z ______________ ERROR at setup of test_hdf_plasma[number_density] _______________
2025-01-14T13:16:42.4885730Z 
2025-01-14T13:16:42.4886220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4886570Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4886580Z 
2025-01-14T13:16:42.4886640Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4886770Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4886830Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4886970Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4887040Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4887090Z >       sim.run_final()
2025-01-14T13:16:42.4887090Z 
2025-01-14T13:16:42.4887150Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4887240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4887310Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4887430Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4907330Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4907560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4907660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4907660Z 
2025-01-14T13:16:42.4907890Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4908060Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4908250Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4908480Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4908620Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4908760Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4908760Z 
2025-01-14T13:16:42.4909190Z     def initialize_transport_state(
2025-01-14T13:16:42.4909240Z         self,
2025-01-14T13:16:42.4909300Z         simulation_state,
2025-01-14T13:16:42.4909350Z         opacity_state,
2025-01-14T13:16:42.4909400Z         macro_atom_state,
2025-01-14T13:16:42.4909450Z         plasma,
2025-01-14T13:16:42.4909500Z         no_of_packets,
2025-01-14T13:16:42.4909560Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.4909610Z         iteration=0,
2025-01-14T13:16:42.4909660Z     ):
2025-01-14T13:16:42.4909760Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.4909850Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.4909890Z         else:
2025-01-14T13:16:42.4909950Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.4910000Z     
2025-01-14T13:16:42.4910110Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.4910200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.4910250Z         )
2025-01-14T13:16:42.4910300Z     
2025-01-14T13:16:42.4910420Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.4910500Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.4910640Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.4910680Z         else:
2025-01-14T13:16:42.4910740Z             continuum_state = None
2025-01-14T13:16:42.4910820Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.4910910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.4910990Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.4911080Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.4911160Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.4911230Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.4911450Z             continuum_state=continuum_state,
2025-01-14T13:16:42.4911500Z         ).to_numba(
2025-01-14T13:16:42.4911560Z             macro_atom_state,
2025-01-14T13:16:42.4911620Z             self.line_interaction_type,
2025-01-14T13:16:42.4911670Z         )
2025-01-14T13:16:42.4911750Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.4911970Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.4912020Z         ]
2025-01-14T13:16:42.4912260Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.4912270Z 
2025-01-14T13:16:42.4912380Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.4912510Z _________________ ERROR at setup of test_hdf_plasma[beta_rad] __________________
2025-01-14T13:16:42.4912520Z 
2025-01-14T13:16:42.4913040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.4913340Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.4913340Z 
2025-01-14T13:16:42.4913410Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.4913540Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.4913610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.4913760Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.4913820Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.4913880Z >       sim.run_final()
2025-01-14T13:16:42.4913880Z 
2025-01-14T13:16:42.4913940Z tardis/conftest.py:233: 
2025-01-14T13:16:42.4914030Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4914100Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.4914320Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.4914390Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.4914510Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.4914610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.4914610Z 
2025-01-14T13:16:42.4914820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.4914990Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.4915160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.4915380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.4915500Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.4915610Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.4915620Z 
2025-01-14T13:16:42.4915690Z     def initialize_transport_state(
2025-01-14T13:16:42.4915730Z         self,
2025-01-14T13:16:42.5062370Z         simulation_state,
2025-01-14T13:16:42.5062770Z         opacity_state,
2025-01-14T13:16:42.5062830Z         macro_atom_state,
2025-01-14T13:16:42.5062880Z         plasma,
2025-01-14T13:16:42.5062930Z         no_of_packets,
2025-01-14T13:16:42.5062990Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5063050Z         iteration=0,
2025-01-14T13:16:42.5063090Z     ):
2025-01-14T13:16:42.5063210Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5063290Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5063340Z         else:
2025-01-14T13:16:42.5063390Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5063440Z     
2025-01-14T13:16:42.5063950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5064030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5064080Z         )
2025-01-14T13:16:42.5064120Z     
2025-01-14T13:16:42.5064230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5064320Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5064450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5064490Z         else:
2025-01-14T13:16:42.5064560Z             continuum_state = None
2025-01-14T13:16:42.5064640Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5064730Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5064790Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5064880Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5064950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5065030Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5065100Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5065160Z         ).to_numba(
2025-01-14T13:16:42.5065230Z             macro_atom_state,
2025-01-14T13:16:42.5065290Z             self.line_interaction_type,
2025-01-14T13:16:42.5065350Z         )
2025-01-14T13:16:42.5065430Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5065670Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5065720Z         ]
2025-01-14T13:16:42.5065980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5065980Z 
2025-01-14T13:16:42.5066090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5066240Z ______ ERROR at setup of test_hdf_plasma[general_level_boltzmann_factor] _______
2025-01-14T13:16:42.5066250Z 
2025-01-14T13:16:42.5066770Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5067450Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5067450Z 
2025-01-14T13:16:42.5067520Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5067640Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5067710Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5067860Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5067930Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5067980Z >       sim.run_final()
2025-01-14T13:16:42.5067990Z 
2025-01-14T13:16:42.5068040Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5068140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5068220Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5068340Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5068410Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5068540Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5068620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5068630Z 
2025-01-14T13:16:42.5068840Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5069000Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5069180Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5069400Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5069950Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5070060Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5070070Z 
2025-01-14T13:16:42.5070130Z     def initialize_transport_state(
2025-01-14T13:16:42.5070180Z         self,
2025-01-14T13:16:42.5070230Z         simulation_state,
2025-01-14T13:16:42.5070290Z         opacity_state,
2025-01-14T13:16:42.5070340Z         macro_atom_state,
2025-01-14T13:16:42.5070380Z         plasma,
2025-01-14T13:16:42.5070430Z         no_of_packets,
2025-01-14T13:16:42.5070500Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5070540Z         iteration=0,
2025-01-14T13:16:42.5070600Z     ):
2025-01-14T13:16:42.5070700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5070770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5070810Z         else:
2025-01-14T13:16:42.5070870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5070910Z     
2025-01-14T13:16:42.5071030Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5071100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5071150Z         )
2025-01-14T13:16:42.5071200Z     
2025-01-14T13:16:42.5071300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5071380Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5071500Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5071550Z         else:
2025-01-14T13:16:42.5071610Z             continuum_state = None
2025-01-14T13:16:42.5071690Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5071820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5071890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5071970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5072050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5072120Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5072200Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5072400Z         ).to_numba(
2025-01-14T13:16:42.5072450Z             macro_atom_state,
2025-01-14T13:16:42.5072540Z             self.line_interaction_type,
2025-01-14T13:16:42.5072620Z         )
2025-01-14T13:16:42.5072710Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5072960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5073040Z         ]
2025-01-14T13:16:42.5073330Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5073350Z 
2025-01-14T13:16:42.5073510Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5073670Z __________ ERROR at setup of test_hdf_plasma[level_boltzmann_factor] ___________
2025-01-14T13:16:42.5073680Z 
2025-01-14T13:16:42.5090130Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5090690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5090710Z 
2025-01-14T13:16:42.5090810Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5090970Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5091060Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5091230Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5091340Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5091410Z >       sim.run_final()
2025-01-14T13:16:42.5091420Z 
2025-01-14T13:16:42.5092110Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5092230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5092340Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5092470Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5092550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5092720Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5092820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5092830Z 
2025-01-14T13:16:42.5093050Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5093260Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5093450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5093700Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5093880Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5094000Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5094000Z 
2025-01-14T13:16:42.5094070Z     def initialize_transport_state(
2025-01-14T13:16:42.5094130Z         self,
2025-01-14T13:16:42.5094190Z         simulation_state,
2025-01-14T13:16:42.5094240Z         opacity_state,
2025-01-14T13:16:42.5094300Z         macro_atom_state,
2025-01-14T13:16:42.5094350Z         plasma,
2025-01-14T13:16:42.5094390Z         no_of_packets,
2025-01-14T13:16:42.5094460Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5094520Z         iteration=0,
2025-01-14T13:16:42.5094560Z     ):
2025-01-14T13:16:42.5094680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5094760Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5094820Z         else:
2025-01-14T13:16:42.5094910Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5094980Z     
2025-01-14T13:16:42.5095120Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5095430Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5095520Z         )
2025-01-14T13:16:42.5095570Z     
2025-01-14T13:16:42.5095710Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5095800Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5095960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5096010Z         else:
2025-01-14T13:16:42.5096090Z             continuum_state = None
2025-01-14T13:16:42.5096180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5096280Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5096370Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5096470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5096580Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5096680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5096780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5096860Z         ).to_numba(
2025-01-14T13:16:42.5096930Z             macro_atom_state,
2025-01-14T13:16:42.5097000Z             self.line_interaction_type,
2025-01-14T13:16:42.5097050Z         )
2025-01-14T13:16:42.5097140Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5097390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5097440Z         ]
2025-01-14T13:16:42.5097720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5097730Z 
2025-01-14T13:16:42.5097860Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5098010Z ________ ERROR at setup of test_hdf_plasma[stimulated_emission_factor] _________
2025-01-14T13:16:42.5098110Z 
2025-01-14T13:16:42.5098690Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5099210Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5099220Z 
2025-01-14T13:16:42.5099300Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5099430Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5099500Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5099640Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5099700Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5099750Z >       sim.run_final()
2025-01-14T13:16:42.5099760Z 
2025-01-14T13:16:42.5099810Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5099910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5099980Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5100090Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5100160Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5100290Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5100370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5100380Z 
2025-01-14T13:16:42.5100590Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5100750Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5100930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5101150Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5101280Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5101510Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5101520Z 
2025-01-14T13:16:42.5101580Z     def initialize_transport_state(
2025-01-14T13:16:42.5101640Z         self,
2025-01-14T13:16:42.5101690Z         simulation_state,
2025-01-14T13:16:42.5101760Z         opacity_state,
2025-01-14T13:16:42.5101830Z         macro_atom_state,
2025-01-14T13:16:42.5101900Z         plasma,
2025-01-14T13:16:42.5101950Z         no_of_packets,
2025-01-14T13:16:42.5102010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5102060Z         iteration=0,
2025-01-14T13:16:42.5102100Z     ):
2025-01-14T13:16:42.5102480Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5102560Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5102610Z         else:
2025-01-14T13:16:42.5102670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5102730Z     
2025-01-14T13:16:42.5102860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5102950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5102990Z         )
2025-01-14T13:16:42.5103040Z     
2025-01-14T13:16:42.5103140Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5103230Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5103350Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5103400Z         else:
2025-01-14T13:16:42.5103460Z             continuum_state = None
2025-01-14T13:16:42.5103530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5103620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5103680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5103770Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5103940Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5104020Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5104110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5104160Z         ).to_numba(
2025-01-14T13:16:42.5104230Z             macro_atom_state,
2025-01-14T13:16:42.5104300Z             self.line_interaction_type,
2025-01-14T13:16:42.5104350Z         )
2025-01-14T13:16:42.5104430Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5104660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5104720Z         ]
2025-01-14T13:16:42.5105000Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5105010Z 
2025-01-14T13:16:42.5105140Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5105300Z ________________ ERROR at setup of test_hdf_plasma[t_electrons] ________________
2025-01-14T13:16:42.5105310Z 
2025-01-14T13:16:42.5105840Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5106160Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5106160Z 
2025-01-14T13:16:42.5106230Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5106360Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5106460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5106600Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5106660Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5106720Z >       sim.run_final()
2025-01-14T13:16:42.5106720Z 
2025-01-14T13:16:42.5106780Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5107270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5107360Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5107460Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5107540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5107680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5107780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5107780Z 
2025-01-14T13:16:42.5108020Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5108210Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5108390Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5108650Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5108790Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5108900Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5108900Z 
2025-01-14T13:16:42.5108980Z     def initialize_transport_state(
2025-01-14T13:16:42.5109040Z         self,
2025-01-14T13:16:42.5109100Z         simulation_state,
2025-01-14T13:16:42.5109190Z         opacity_state,
2025-01-14T13:16:42.5109240Z         macro_atom_state,
2025-01-14T13:16:42.5109300Z         plasma,
2025-01-14T13:16:42.5109370Z         no_of_packets,
2025-01-14T13:16:42.5109440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5109500Z         iteration=0,
2025-01-14T13:16:42.5109570Z     ):
2025-01-14T13:16:42.5109680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5109770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5110110Z         else:
2025-01-14T13:16:42.5110170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5110230Z     
2025-01-14T13:16:42.5110350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5110440Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5110510Z         )
2025-01-14T13:16:42.5110560Z     
2025-01-14T13:16:42.5110680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5110790Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5110930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5110990Z         else:
2025-01-14T13:16:42.5111050Z             continuum_state = None
2025-01-14T13:16:42.5111130Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5111210Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5111290Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5111390Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5111480Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5111550Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5111630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5111690Z         ).to_numba(
2025-01-14T13:16:42.5111750Z             macro_atom_state,
2025-01-14T13:16:42.5111820Z             self.line_interaction_type,
2025-01-14T13:16:42.5111860Z         )
2025-01-14T13:16:42.5111950Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5112210Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5112270Z         ]
2025-01-14T13:16:42.5112550Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5112560Z 
2025-01-14T13:16:42.5112690Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5112850Z _______________ ERROR at setup of test_hdf_plasma[wavelength_cm] _______________
2025-01-14T13:16:42.5112970Z 
2025-01-14T13:16:42.5113530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5113860Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5113870Z 
2025-01-14T13:16:42.5113940Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5114090Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5114180Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5114340Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5114420Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5114490Z >       sim.run_final()
2025-01-14T13:16:42.5114490Z 
2025-01-14T13:16:42.5114550Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5114650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5114720Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5114840Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5114930Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5115050Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5115140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5115140Z 
2025-01-14T13:16:42.5115360Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5115540Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5115750Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5116110Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5116270Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5116380Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5116390Z 
2025-01-14T13:16:42.5160810Z     def initialize_transport_state(
2025-01-14T13:16:42.5161040Z         self,
2025-01-14T13:16:42.5161100Z         simulation_state,
2025-01-14T13:16:42.5161150Z         opacity_state,
2025-01-14T13:16:42.5161200Z         macro_atom_state,
2025-01-14T13:16:42.5161250Z         plasma,
2025-01-14T13:16:42.5161300Z         no_of_packets,
2025-01-14T13:16:42.5161360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5161410Z         iteration=0,
2025-01-14T13:16:42.5161450Z     ):
2025-01-14T13:16:42.5161560Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5161660Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5161710Z         else:
2025-01-14T13:16:42.5161760Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5161810Z     
2025-01-14T13:16:42.5161920Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5161990Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5162040Z         )
2025-01-14T13:16:42.5162080Z     
2025-01-14T13:16:42.5162180Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5162260Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5162390Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5162440Z         else:
2025-01-14T13:16:42.5162510Z             continuum_state = None
2025-01-14T13:16:42.5162580Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5162660Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5162730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5162810Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5163360Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5163430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5163500Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5163540Z         ).to_numba(
2025-01-14T13:16:42.5163600Z             macro_atom_state,
2025-01-14T13:16:42.5163660Z             self.line_interaction_type,
2025-01-14T13:16:42.5163700Z         )
2025-01-14T13:16:42.5163780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5164010Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5164050Z         ]
2025-01-14T13:16:42.5164300Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5164300Z 
2025-01-14T13:16:42.5164430Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5164570Z __________ ERROR at setup of test_hdf_plasma[lines_lower_level_index] __________
2025-01-14T13:16:42.5164580Z 
2025-01-14T13:16:42.5165090Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5165380Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5165380Z 
2025-01-14T13:16:42.5165440Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5165560Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5165640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5165780Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5165980Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5166040Z >       sim.run_final()
2025-01-14T13:16:42.5166050Z 
2025-01-14T13:16:42.5166100Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5166200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5166270Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5166380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5166450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5166570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5166650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5166660Z 
2025-01-14T13:16:42.5166870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5167020Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5167200Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5167420Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5167540Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5167650Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5167660Z 
2025-01-14T13:16:42.5167720Z     def initialize_transport_state(
2025-01-14T13:16:42.5167760Z         self,
2025-01-14T13:16:42.5167820Z         simulation_state,
2025-01-14T13:16:42.5167870Z         opacity_state,
2025-01-14T13:16:42.5167910Z         macro_atom_state,
2025-01-14T13:16:42.5167960Z         plasma,
2025-01-14T13:16:42.5168010Z         no_of_packets,
2025-01-14T13:16:42.5168070Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5168120Z         iteration=0,
2025-01-14T13:16:42.5168160Z     ):
2025-01-14T13:16:42.5168260Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5168330Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5168380Z         else:
2025-01-14T13:16:42.5168510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5168550Z     
2025-01-14T13:16:42.5168650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5168730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5168770Z         )
2025-01-14T13:16:42.5168810Z     
2025-01-14T13:16:42.5168910Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5168990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5169110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5169160Z         else:
2025-01-14T13:16:42.5169220Z             continuum_state = None
2025-01-14T13:16:42.5169290Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5169370Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5169440Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5169530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5196650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5197020Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5197100Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5197160Z         ).to_numba(
2025-01-14T13:16:42.5197210Z             macro_atom_state,
2025-01-14T13:16:42.5197280Z             self.line_interaction_type,
2025-01-14T13:16:42.5197320Z         )
2025-01-14T13:16:42.5197400Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5197660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5197730Z         ]
2025-01-14T13:16:42.5197980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5198550Z 
2025-01-14T13:16:42.5198680Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5198840Z ______________ ERROR at setup of test_hdf_plasma[ionization_data] ______________
2025-01-14T13:16:42.5198860Z 
2025-01-14T13:16:42.5199420Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5199720Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5199730Z 
2025-01-14T13:16:42.5199820Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5199970Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5200060Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5200220Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5200330Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5200390Z >       sim.run_final()
2025-01-14T13:16:42.5200400Z 
2025-01-14T13:16:42.5200460Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5200550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5200820Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5200940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5201010Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5201150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5201240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5201240Z 
2025-01-14T13:16:42.5201460Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5201620Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5201800Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5202630Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5202750Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5202860Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5202870Z 
2025-01-14T13:16:42.5202930Z     def initialize_transport_state(
2025-01-14T13:16:42.5202970Z         self,
2025-01-14T13:16:42.5203020Z         simulation_state,
2025-01-14T13:16:42.5203080Z         opacity_state,
2025-01-14T13:16:42.5203120Z         macro_atom_state,
2025-01-14T13:16:42.5203180Z         plasma,
2025-01-14T13:16:42.5203220Z         no_of_packets,
2025-01-14T13:16:42.5203290Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5203330Z         iteration=0,
2025-01-14T13:16:42.5203380Z     ):
2025-01-14T13:16:42.5203480Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5203550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5203600Z         else:
2025-01-14T13:16:42.5203660Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5203710Z     
2025-01-14T13:16:42.5203840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5203930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5204000Z         )
2025-01-14T13:16:42.5204060Z     
2025-01-14T13:16:42.5204160Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5204250Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5204370Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5204420Z         else:
2025-01-14T13:16:42.5204470Z             continuum_state = None
2025-01-14T13:16:42.5204550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5204630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5204950Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5205030Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5205110Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5205180Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5205250Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5205290Z         ).to_numba(
2025-01-14T13:16:42.5205350Z             macro_atom_state,
2025-01-14T13:16:42.5205410Z             self.line_interaction_type,
2025-01-14T13:16:42.5205450Z         )
2025-01-14T13:16:42.5205530Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5205750Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5205800Z         ]
2025-01-14T13:16:42.5206050Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5206060Z 
2025-01-14T13:16:42.5206180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5206310Z __________________ ERROR at setup of test_hdf_plasma[density] __________________
2025-01-14T13:16:42.5206310Z 
2025-01-14T13:16:42.5206830Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5207110Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5207120Z 
2025-01-14T13:16:42.5207180Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5207310Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5207380Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5207540Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5207600Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5207770Z >       sim.run_final()
2025-01-14T13:16:42.5207770Z 
2025-01-14T13:16:42.5207830Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5207930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5208000Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5208110Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5208180Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5208310Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5208410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5208410Z 
2025-01-14T13:16:42.5208650Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5208840Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5209040Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5209280Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5209420Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5209540Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5209540Z 
2025-01-14T13:16:42.5209620Z     def initialize_transport_state(
2025-01-14T13:16:42.5209670Z         self,
2025-01-14T13:16:42.5209730Z         simulation_state,
2025-01-14T13:16:42.5209790Z         opacity_state,
2025-01-14T13:16:42.5209840Z         macro_atom_state,
2025-01-14T13:16:42.5209880Z         plasma,
2025-01-14T13:16:42.5209950Z         no_of_packets,
2025-01-14T13:16:42.5210010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5210070Z         iteration=0,
2025-01-14T13:16:42.5210210Z     ):
2025-01-14T13:16:42.5210310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5210380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5210420Z         else:
2025-01-14T13:16:42.5210480Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5210520Z     
2025-01-14T13:16:42.5210630Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5210700Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5210740Z         )
2025-01-14T13:16:42.5210790Z     
2025-01-14T13:16:42.5210900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5210990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5211120Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5211170Z         else:
2025-01-14T13:16:42.5211230Z             continuum_state = None
2025-01-14T13:16:42.5211310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5211430Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5211500Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5211600Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5211700Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5211770Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5211840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5211890Z         ).to_numba(
2025-01-14T13:16:42.5211970Z             macro_atom_state,
2025-01-14T13:16:42.5212040Z             self.line_interaction_type,
2025-01-14T13:16:42.5212110Z         )
2025-01-14T13:16:42.5212190Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5212410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5212450Z         ]
2025-01-14T13:16:42.5212730Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5212740Z 
2025-01-14T13:16:42.5212870Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5213130Z ________________ ERROR at setup of test_hdf_plasma[atomic_mass] ________________
2025-01-14T13:16:42.5213140Z 
2025-01-14T13:16:42.5213650Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5215020Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5215050Z 
2025-01-14T13:16:42.5215130Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5215260Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5215340Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5215510Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5215580Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5215640Z >       sim.run_final()
2025-01-14T13:16:42.5215640Z 
2025-01-14T13:16:42.5215710Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5215810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5215900Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5216020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5216100Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5216240Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5216330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5216330Z 
2025-01-14T13:16:42.5216560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5216950Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5217150Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5217380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5217490Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5217620Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5217630Z 
2025-01-14T13:16:42.5217710Z     def initialize_transport_state(
2025-01-14T13:16:42.5217770Z         self,
2025-01-14T13:16:42.5217830Z         simulation_state,
2025-01-14T13:16:42.5217900Z         opacity_state,
2025-01-14T13:16:42.5217960Z         macro_atom_state,
2025-01-14T13:16:42.5218000Z         plasma,
2025-01-14T13:16:42.5218050Z         no_of_packets,
2025-01-14T13:16:42.5218110Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5218160Z         iteration=0,
2025-01-14T13:16:42.5218200Z     ):
2025-01-14T13:16:42.5218310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5218390Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5218440Z         else:
2025-01-14T13:16:42.5218500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5218550Z     
2025-01-14T13:16:42.5218660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5218730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5218770Z         )
2025-01-14T13:16:42.5218820Z     
2025-01-14T13:16:42.5218930Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5219020Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5219160Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5219210Z         else:
2025-01-14T13:16:42.5219260Z             continuum_state = None
2025-01-14T13:16:42.5219340Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5219430Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5219580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5219670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5219750Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5219830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5219910Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5219970Z         ).to_numba(
2025-01-14T13:16:42.5220020Z             macro_atom_state,
2025-01-14T13:16:42.5220100Z             self.line_interaction_type,
2025-01-14T13:16:42.5220140Z         )
2025-01-14T13:16:42.5220220Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5220440Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5220490Z         ]
2025-01-14T13:16:42.5220760Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5220770Z 
2025-01-14T13:16:42.5220880Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5221040Z ___________ ERROR at setup of test_hdf_plasma[level_number_density] ____________
2025-01-14T13:16:42.5221040Z 
2025-01-14T13:16:42.5221570Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5221910Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5221910Z 
2025-01-14T13:16:42.5221980Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5222120Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5222280Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5222430Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5222500Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5222560Z >       sim.run_final()
2025-01-14T13:16:42.5222570Z 
2025-01-14T13:16:42.5222630Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5222720Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5222790Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5222890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5222980Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5223100Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5223190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5223190Z 
2025-01-14T13:16:42.5223430Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5223600Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5223780Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5224010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5224140Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5224240Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5224240Z 
2025-01-14T13:16:42.5224310Z     def initialize_transport_state(
2025-01-14T13:16:42.5224370Z         self,
2025-01-14T13:16:42.5224440Z         simulation_state,
2025-01-14T13:16:42.5224500Z         opacity_state,
2025-01-14T13:16:42.5224550Z         macro_atom_state,
2025-01-14T13:16:42.5224600Z         plasma,
2025-01-14T13:16:42.5224650Z         no_of_packets,
2025-01-14T13:16:42.5224710Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5224750Z         iteration=0,
2025-01-14T13:16:42.5224800Z     ):
2025-01-14T13:16:42.5225190Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5225260Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5225300Z         else:
2025-01-14T13:16:42.5225370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5225410Z     
2025-01-14T13:16:42.5225530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5225600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5225650Z         )
2025-01-14T13:16:42.5225690Z     
2025-01-14T13:16:42.5225790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5225880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5226000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5226050Z         else:
2025-01-14T13:16:42.5226100Z             continuum_state = None
2025-01-14T13:16:42.5226180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5226260Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5226330Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5226410Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5226490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5226550Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5226620Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5226660Z         ).to_numba(
2025-01-14T13:16:42.5226710Z             macro_atom_state,
2025-01-14T13:16:42.5226770Z             self.line_interaction_type,
2025-01-14T13:16:42.5226820Z         )
2025-01-14T13:16:42.5226890Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5227110Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5227410Z         ]
2025-01-14T13:16:42.5227660Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5227670Z 
2025-01-14T13:16:42.5227780Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5227920Z __________ ERROR at setup of test_hdf_plasma[lines_upper_level_index] __________
2025-01-14T13:16:42.5227920Z 
2025-01-14T13:16:42.5228430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5228710Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5228720Z 
2025-01-14T13:16:42.5228780Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5228910Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5228990Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5229130Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5229190Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5229240Z >       sim.run_final()
2025-01-14T13:16:42.5229250Z 
2025-01-14T13:16:42.5229300Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5229390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5229460Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5229570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5229640Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5229760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5229850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5229850Z 
2025-01-14T13:16:42.5230060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5230220Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5230460Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5230680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5230800Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5230900Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5230900Z 
2025-01-14T13:16:42.5230970Z     def initialize_transport_state(
2025-01-14T13:16:42.5231020Z         self,
2025-01-14T13:16:42.5231070Z         simulation_state,
2025-01-14T13:16:42.5232110Z         opacity_state,
2025-01-14T13:16:42.5232250Z         macro_atom_state,
2025-01-14T13:16:42.5232320Z         plasma,
2025-01-14T13:16:42.5232390Z         no_of_packets,
2025-01-14T13:16:42.5232460Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5232520Z         iteration=0,
2025-01-14T13:16:42.5232570Z     ):
2025-01-14T13:16:42.5232680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5232750Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5232810Z         else:
2025-01-14T13:16:42.5232860Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5232910Z     
2025-01-14T13:16:42.5233040Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5233130Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5233190Z         )
2025-01-14T13:16:42.5233240Z     
2025-01-14T13:16:42.5233360Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5233470Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5233620Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5233690Z         else:
2025-01-14T13:16:42.5234080Z             continuum_state = None
2025-01-14T13:16:42.5234180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5234290Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5234380Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5234490Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5234580Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5234670Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5234760Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5234820Z         ).to_numba(
2025-01-14T13:16:42.5234910Z             macro_atom_state,
2025-01-14T13:16:42.5234970Z             self.line_interaction_type,
2025-01-14T13:16:42.5235040Z         )
2025-01-14T13:16:42.5235120Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5235370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5235430Z         ]
2025-01-14T13:16:42.5235720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5235730Z 
2025-01-14T13:16:42.5235860Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5236010Z ____________________ ERROR at setup of test_hdf_plasma[nu] _____________________
2025-01-14T13:16:42.5236010Z 
2025-01-14T13:16:42.5236580Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5236890Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5236900Z 
2025-01-14T13:16:42.5236980Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5237130Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5237230Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5237480Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5237570Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5237630Z >       sim.run_final()
2025-01-14T13:16:42.5237640Z 
2025-01-14T13:16:42.5237690Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5237780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5237860Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5237970Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5238040Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5238180Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5238270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5238280Z 
2025-01-14T13:16:42.5238530Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5238720Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5238930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5239190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5239310Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5239440Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5239450Z 
2025-01-14T13:16:42.5239530Z     def initialize_transport_state(
2025-01-14T13:16:42.5239600Z         self,
2025-01-14T13:16:42.5239680Z         simulation_state,
2025-01-14T13:16:42.5239740Z         opacity_state,
2025-01-14T13:16:42.5239790Z         macro_atom_state,
2025-01-14T13:16:42.5239860Z         plasma,
2025-01-14T13:16:42.5240070Z         no_of_packets,
2025-01-14T13:16:42.5240130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5240190Z         iteration=0,
2025-01-14T13:16:42.5240260Z     ):
2025-01-14T13:16:42.5240380Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5240460Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5240510Z         else:
2025-01-14T13:16:42.5240570Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5240630Z     
2025-01-14T13:16:42.5240750Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5240850Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5240900Z         )
2025-01-14T13:16:42.5240960Z     
2025-01-14T13:16:42.5241080Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5241190Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5241360Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5241440Z         else:
2025-01-14T13:16:42.5241500Z             continuum_state = None
2025-01-14T13:16:42.5241580Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5241660Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5241730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5241810Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5241880Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5241950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5242010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5242060Z         ).to_numba(
2025-01-14T13:16:42.5242110Z             macro_atom_state,
2025-01-14T13:16:42.5242180Z             self.line_interaction_type,
2025-01-14T13:16:42.5242220Z         )
2025-01-14T13:16:42.5242310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5242520Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5242580Z         ]
2025-01-14T13:16:42.5242820Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5242920Z 
2025-01-14T13:16:42.5243040Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5243170Z _______________ ERROR at setup of test_hdf_plasma[beta_sobolev] ________________
2025-01-14T13:16:42.5243170Z 
2025-01-14T13:16:42.5243680Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5243970Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5243970Z 
2025-01-14T13:16:42.5244030Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5244160Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5244240Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5244370Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5244460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5244510Z >       sim.run_final()
2025-01-14T13:16:42.5244510Z 
2025-01-14T13:16:42.5244590Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5244680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5244760Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5244890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5244970Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5245100Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5245200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5245270Z 
2025-01-14T13:16:42.5245510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5245700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5245890Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5246130Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5246260Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5246370Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5246370Z 
2025-01-14T13:16:42.5246440Z     def initialize_transport_state(
2025-01-14T13:16:42.5246480Z         self,
2025-01-14T13:16:42.5246540Z         simulation_state,
2025-01-14T13:16:42.5246590Z         opacity_state,
2025-01-14T13:16:42.5246640Z         macro_atom_state,
2025-01-14T13:16:42.5246690Z         plasma,
2025-01-14T13:16:42.5246750Z         no_of_packets,
2025-01-14T13:16:42.5246820Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5246880Z         iteration=0,
2025-01-14T13:16:42.5246940Z     ):
2025-01-14T13:16:42.5247030Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5247120Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5247170Z         else:
2025-01-14T13:16:42.5247220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5247270Z     
2025-01-14T13:16:42.5247380Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5247450Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5247490Z         )
2025-01-14T13:16:42.5247540Z     
2025-01-14T13:16:42.5247640Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5247740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5247880Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5247970Z         else:
2025-01-14T13:16:42.5248050Z             continuum_state = None
2025-01-14T13:16:42.5248510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5248590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5248660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5248740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5248820Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5248880Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5248970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5249030Z         ).to_numba(
2025-01-14T13:16:42.5249080Z             macro_atom_state,
2025-01-14T13:16:42.5249150Z             self.line_interaction_type,
2025-01-14T13:16:42.5249210Z         )
2025-01-14T13:16:42.5249280Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5249540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5249600Z         ]
2025-01-14T13:16:42.5249840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5249850Z 
2025-01-14T13:16:42.5249970Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5250130Z _________ ERROR at setup of test_hdf_plasma[transition_probabilities] __________
2025-01-14T13:16:42.5250130Z 
2025-01-14T13:16:42.5250690Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5250980Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5251520Z 
2025-01-14T13:16:42.5251600Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5251740Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5251820Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5251960Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5252030Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5252100Z >       sim.run_final()
2025-01-14T13:16:42.5252100Z 
2025-01-14T13:16:42.5252180Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5252280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5252340Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5252480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5252560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5252690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5252810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5252820Z 
2025-01-14T13:16:42.5253030Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5253230Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5253420Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5253680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5253810Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5253960Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5253960Z 
2025-01-14T13:16:42.5254030Z     def initialize_transport_state(
2025-01-14T13:16:42.5254070Z         self,
2025-01-14T13:16:42.5254150Z         simulation_state,
2025-01-14T13:16:42.5254210Z         opacity_state,
2025-01-14T13:16:42.5254260Z         macro_atom_state,
2025-01-14T13:16:42.5254310Z         plasma,
2025-01-14T13:16:42.5254360Z         no_of_packets,
2025-01-14T13:16:42.5254590Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5254650Z         iteration=0,
2025-01-14T13:16:42.5254700Z     ):
2025-01-14T13:16:42.5254800Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5254970Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5255030Z         else:
2025-01-14T13:16:42.5255100Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5255140Z     
2025-01-14T13:16:42.5255260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5255350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5255400Z         )
2025-01-14T13:16:42.5255440Z     
2025-01-14T13:16:42.5255560Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5255670Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5255810Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5255850Z         else:
2025-01-14T13:16:42.5255930Z             continuum_state = None
2025-01-14T13:16:42.5256010Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5256090Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5256160Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5256250Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5262230Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5262380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5262450Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5262500Z         ).to_numba(
2025-01-14T13:16:42.5262550Z             macro_atom_state,
2025-01-14T13:16:42.5262620Z             self.line_interaction_type,
2025-01-14T13:16:42.5262670Z         )
2025-01-14T13:16:42.5262740Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5263250Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5263300Z         ]
2025-01-14T13:16:42.5263550Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5263560Z 
2025-01-14T13:16:42.5263670Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5263800Z ____________________ ERROR at setup of test_hdf_plasma[phi] ____________________
2025-01-14T13:16:42.5263810Z 
2025-01-14T13:16:42.5264320Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5264610Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5264620Z 
2025-01-14T13:16:42.5264690Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5264810Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5264890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5265030Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5265100Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5265150Z >       sim.run_final()
2025-01-14T13:16:42.5265160Z 
2025-01-14T13:16:42.5265220Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5265310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5265380Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5265500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5265560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5265690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5265780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5265870Z 
2025-01-14T13:16:42.5266090Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5266250Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5266440Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5266650Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5266780Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5266890Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5266890Z 
2025-01-14T13:16:42.5266950Z     def initialize_transport_state(
2025-01-14T13:16:42.5267000Z         self,
2025-01-14T13:16:42.5267050Z         simulation_state,
2025-01-14T13:16:42.5267110Z         opacity_state,
2025-01-14T13:16:42.5267160Z         macro_atom_state,
2025-01-14T13:16:42.5267210Z         plasma,
2025-01-14T13:16:42.5267260Z         no_of_packets,
2025-01-14T13:16:42.5267330Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5267370Z         iteration=0,
2025-01-14T13:16:42.5267420Z     ):
2025-01-14T13:16:42.5267510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5267580Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5267620Z         else:
2025-01-14T13:16:42.5267680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5267740Z     
2025-01-14T13:16:42.5267840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5267920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5267960Z         )
2025-01-14T13:16:42.5268000Z     
2025-01-14T13:16:42.5268100Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5268190Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5268380Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5268440Z         else:
2025-01-14T13:16:42.5268490Z             continuum_state = None
2025-01-14T13:16:42.5268570Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5268650Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5268720Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5268800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5268880Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5268950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5269020Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5269070Z         ).to_numba(
2025-01-14T13:16:42.5269120Z             macro_atom_state,
2025-01-14T13:16:42.5269190Z             self.line_interaction_type,
2025-01-14T13:16:42.5269230Z         )
2025-01-14T13:16:42.5269310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5269540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5269590Z         ]
2025-01-14T13:16:42.5269840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5269840Z 
2025-01-14T13:16:42.5269970Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5270110Z ____________ ERROR at setup of test_hdf_plasma[electron_densities] _____________
2025-01-14T13:16:42.5270110Z 
2025-01-14T13:16:42.5270630Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5270920Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5270930Z 
2025-01-14T13:16:42.5270990Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5271190Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5271260Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5271410Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5271470Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5271520Z >       sim.run_final()
2025-01-14T13:16:42.5271520Z 
2025-01-14T13:16:42.5271580Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5271680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5271750Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5271850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5271920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5272040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5272130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5272140Z 
2025-01-14T13:16:42.5272350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5272510Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5272690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5272900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5273030Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5273140Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5273140Z 
2025-01-14T13:16:42.5273210Z     def initialize_transport_state(
2025-01-14T13:16:42.5273250Z         self,
2025-01-14T13:16:42.5273360Z         simulation_state,
2025-01-14T13:16:42.5273420Z         opacity_state,
2025-01-14T13:16:42.5273470Z         macro_atom_state,
2025-01-14T13:16:42.5273520Z         plasma,
2025-01-14T13:16:42.5273580Z         no_of_packets,
2025-01-14T13:16:42.5273640Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5273680Z         iteration=0,
2025-01-14T13:16:42.5273740Z     ):
2025-01-14T13:16:42.5273840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5273910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5273950Z         else:
2025-01-14T13:16:42.5274000Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5274050Z     
2025-01-14T13:16:42.5274150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5274220Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5274260Z         )
2025-01-14T13:16:42.5274300Z     
2025-01-14T13:16:42.5274400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5274490Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5274620Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5274680Z         else:
2025-01-14T13:16:42.5274750Z             continuum_state = None
2025-01-14T13:16:42.5274820Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5274910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5274990Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5275070Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5275150Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5275220Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5275290Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5275330Z         ).to_numba(
2025-01-14T13:16:42.5275390Z             macro_atom_state,
2025-01-14T13:16:42.5275450Z             self.line_interaction_type,
2025-01-14T13:16:42.5275510Z         )
2025-01-14T13:16:42.5275590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5275810Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5276140Z         ]
2025-01-14T13:16:42.5276400Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5276400Z 
2025-01-14T13:16:42.5276520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5276650Z ___________________ ERROR at setup of test_hdf_plasma[t_rad] ___________________
2025-01-14T13:16:42.5276650Z 
2025-01-14T13:16:42.5277170Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5277460Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5277470Z 
2025-01-14T13:16:42.5277540Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5277680Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5277750Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5277900Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5277970Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5278020Z >       sim.run_final()
2025-01-14T13:16:42.5278020Z 
2025-01-14T13:16:42.5278080Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5278170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5278240Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5278370Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5278440Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5278810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5278910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5278920Z 
2025-01-14T13:16:42.5279200Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5279400Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5279580Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5279810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5279930Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5280040Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5280040Z 
2025-01-14T13:16:42.5280110Z     def initialize_transport_state(
2025-01-14T13:16:42.5280160Z         self,
2025-01-14T13:16:42.5280210Z         simulation_state,
2025-01-14T13:16:42.5280260Z         opacity_state,
2025-01-14T13:16:42.5280320Z         macro_atom_state,
2025-01-14T13:16:42.5280360Z         plasma,
2025-01-14T13:16:42.5280410Z         no_of_packets,
2025-01-14T13:16:42.5280470Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5280510Z         iteration=0,
2025-01-14T13:16:42.5280560Z     ):
2025-01-14T13:16:42.5280650Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5280730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5280780Z         else:
2025-01-14T13:16:42.5280830Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5280880Z     
2025-01-14T13:16:42.5280980Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5281050Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5281090Z         )
2025-01-14T13:16:42.5281140Z     
2025-01-14T13:16:42.5281240Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5281330Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5281620Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5281670Z         else:
2025-01-14T13:16:42.5281750Z             continuum_state = None
2025-01-14T13:16:42.5281830Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5281910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5281980Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5282060Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5282130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5282200Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5282280Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5282330Z         ).to_numba(
2025-01-14T13:16:42.5282390Z             macro_atom_state,
2025-01-14T13:16:42.5282600Z             self.line_interaction_type,
2025-01-14T13:16:42.5282660Z         )
2025-01-14T13:16:42.5282730Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5282960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5283000Z         ]
2025-01-14T13:16:42.5283240Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5283250Z 
2025-01-14T13:16:42.5283360Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5283490Z ______________ ERROR at setup of test_hdf_plasma[selected_atoms] _______________
2025-01-14T13:16:42.5283500Z 
2025-01-14T13:16:42.5284000Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5284430Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5284440Z 
2025-01-14T13:16:42.5284520Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5284700Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5284830Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5285030Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5285140Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5285220Z >       sim.run_final()
2025-01-14T13:16:42.5285230Z 
2025-01-14T13:16:42.5285330Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5285460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5285600Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5285750Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5285870Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5286050Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5286190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5286200Z 
2025-01-14T13:16:42.5286480Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5286680Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5286900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5287170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5287330Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5287480Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5287490Z 
2025-01-14T13:16:42.5287590Z     def initialize_transport_state(
2025-01-14T13:16:42.5287680Z         self,
2025-01-14T13:16:42.5287760Z         simulation_state,
2025-01-14T13:16:42.5288010Z         opacity_state,
2025-01-14T13:16:42.5288100Z         macro_atom_state,
2025-01-14T13:16:42.5288200Z         plasma,
2025-01-14T13:16:42.5288270Z         no_of_packets,
2025-01-14T13:16:42.5288370Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5288460Z         iteration=0,
2025-01-14T13:16:42.5288540Z     ):
2025-01-14T13:16:42.5288670Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5288760Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5288830Z         else:
2025-01-14T13:16:42.5288910Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5288970Z     
2025-01-14T13:16:42.5289110Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5289180Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5289230Z         )
2025-01-14T13:16:42.5289270Z     
2025-01-14T13:16:42.5289390Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5289540Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5289700Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5290660Z         else:
2025-01-14T13:16:42.5290810Z             continuum_state = None
2025-01-14T13:16:42.5290920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5291030Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5294360Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5294530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5294660Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5294760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5294870Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5295060Z         ).to_numba(
2025-01-14T13:16:42.5295150Z             macro_atom_state,
2025-01-14T13:16:42.5296040Z             self.line_interaction_type,
2025-01-14T13:16:42.5296110Z         )
2025-01-14T13:16:42.5296230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5296550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5296640Z         ]
2025-01-14T13:16:42.5296970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5296990Z 
2025-01-14T13:16:42.5297180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5297400Z ____________ ERROR at setup of test_hdf_plasma[ion_number_density] _____________
2025-01-14T13:16:42.5297410Z 
2025-01-14T13:16:42.5298040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5298420Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5298440Z 
2025-01-14T13:16:42.5298520Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5299140Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5299250Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5299450Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5299540Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5299600Z >       sim.run_final()
2025-01-14T13:16:42.5299620Z 
2025-01-14T13:16:42.5299690Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5299810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5299910Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5300780Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5300910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5301060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5301360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5301380Z 
2025-01-14T13:16:42.5301630Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5301850Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5302070Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5302380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5305680Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5305840Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5305850Z 
2025-01-14T13:16:42.5305950Z     def initialize_transport_state(
2025-01-14T13:16:42.5306020Z         self,
2025-01-14T13:16:42.5306110Z         simulation_state,
2025-01-14T13:16:42.5306200Z         opacity_state,
2025-01-14T13:16:42.5306270Z         macro_atom_state,
2025-01-14T13:16:42.5306320Z         plasma,
2025-01-14T13:16:42.5306390Z         no_of_packets,
2025-01-14T13:16:42.5306480Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5306570Z         iteration=0,
2025-01-14T13:16:42.5306640Z     ):
2025-01-14T13:16:42.5306770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5306870Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5306940Z         else:
2025-01-14T13:16:42.5307020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5307090Z     
2025-01-14T13:16:42.5307250Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5307360Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5307440Z         )
2025-01-14T13:16:42.5307650Z     
2025-01-14T13:16:42.5307810Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5307930Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5308100Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5308160Z         else:
2025-01-14T13:16:42.5308250Z             continuum_state = None
2025-01-14T13:16:42.5308350Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5308480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5308570Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5308700Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5308800Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5308890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5308970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5309010Z         ).to_numba(
2025-01-14T13:16:42.5309080Z             macro_atom_state,
2025-01-14T13:16:42.5309170Z             self.line_interaction_type,
2025-01-14T13:16:42.5309250Z         )
2025-01-14T13:16:42.5309370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5309640Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5309700Z         ]
2025-01-14T13:16:42.5310030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5310040Z 
2025-01-14T13:16:42.5310190Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5310400Z ____________ ERROR at setup of test_hdf_plasma[partition_function] _____________
2025-01-14T13:16:42.5310410Z 
2025-01-14T13:16:42.5311040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5311400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5314920Z 
2025-01-14T13:16:42.5315080Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5315260Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5315380Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5315580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5315660Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5315730Z >       sim.run_final()
2025-01-14T13:16:42.5315740Z 
2025-01-14T13:16:42.5315820Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5315950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5316060Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5316230Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5316320Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5316520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5316650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5316650Z 
2025-01-14T13:16:42.5316920Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5317140Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5317360Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5317670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5317830Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5317980Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5329920Z 
2025-01-14T13:16:42.5330520Z     def initialize_transport_state(
2025-01-14T13:16:42.5330700Z         self,
2025-01-14T13:16:42.5330930Z         simulation_state,
2025-01-14T13:16:42.5331160Z         opacity_state,
2025-01-14T13:16:42.5331750Z         macro_atom_state,
2025-01-14T13:16:42.5331910Z         plasma,
2025-01-14T13:16:42.5331970Z         no_of_packets,
2025-01-14T13:16:42.5332050Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5332140Z         iteration=0,
2025-01-14T13:16:42.5332210Z     ):
2025-01-14T13:16:42.5332330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5332430Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5332500Z         else:
2025-01-14T13:16:42.5332580Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5332660Z     
2025-01-14T13:16:42.5332790Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5334010Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5334110Z         )
2025-01-14T13:16:42.5334180Z     
2025-01-14T13:16:42.5334310Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5334440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5338340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5338660Z         else:
2025-01-14T13:16:42.5338940Z             continuum_state = None
2025-01-14T13:16:42.5339250Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5339560Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5339870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5340020Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5340130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5340240Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5340350Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5340450Z         ).to_numba(
2025-01-14T13:16:42.5340550Z             macro_atom_state,
2025-01-14T13:16:42.5340660Z             self.line_interaction_type,
2025-01-14T13:16:42.5341070Z         )
2025-01-14T13:16:42.5341170Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5341450Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5341540Z         ]
2025-01-14T13:16:42.5341870Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5341880Z 
2025-01-14T13:16:42.5342040Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5342610Z _________________ ERROR at setup of test_hdf_plasma[abundance] _________________
2025-01-14T13:16:42.5342620Z 
2025-01-14T13:16:42.5343240Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5343620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5343630Z 
2025-01-14T13:16:42.5343730Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5343900Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5344010Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5345400Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5345750Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5345990Z >       sim.run_final()
2025-01-14T13:16:42.5346020Z 
2025-01-14T13:16:42.5346280Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5346610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5346930Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5347630Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5347750Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5347910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5348040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5348050Z 
2025-01-14T13:16:42.5348310Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5348500Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5348710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5348990Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5349160Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5349310Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5349330Z 
2025-01-14T13:16:42.5349420Z     def initialize_transport_state(
2025-01-14T13:16:42.5349510Z         self,
2025-01-14T13:16:42.5349590Z         simulation_state,
2025-01-14T13:16:42.5349670Z         opacity_state,
2025-01-14T13:16:42.5349750Z         macro_atom_state,
2025-01-14T13:16:42.5349830Z         plasma,
2025-01-14T13:16:42.5349910Z         no_of_packets,
2025-01-14T13:16:42.5350000Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5350070Z         iteration=0,
2025-01-14T13:16:42.5350140Z     ):
2025-01-14T13:16:42.5350270Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5350390Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5350480Z         else:
2025-01-14T13:16:42.5350580Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5350650Z     
2025-01-14T13:16:42.5350830Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5350950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5351050Z         )
2025-01-14T13:16:42.5351120Z     
2025-01-14T13:16:42.5351470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5351610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5351790Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5351890Z         else:
2025-01-14T13:16:42.5351990Z             continuum_state = None
2025-01-14T13:16:42.5352080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5352160Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5352250Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5352380Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5352500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5352600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5352690Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5352740Z         ).to_numba(
2025-01-14T13:16:42.5352800Z             macro_atom_state,
2025-01-14T13:16:42.5352870Z             self.line_interaction_type,
2025-01-14T13:16:42.5352950Z         )
2025-01-14T13:16:42.5353060Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5353370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5353450Z         ]
2025-01-14T13:16:42.5353780Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5353790Z 
2025-01-14T13:16:42.5353960Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5354150Z ________________ ERROR at setup of test_hdf_plasma[g_electron] _________________
2025-01-14T13:16:42.5354160Z 
2025-01-14T13:16:42.5354760Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5355350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5355370Z 
2025-01-14T13:16:42.5355470Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5355670Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5355770Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5355970Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5356040Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5356090Z >       sim.run_final()
2025-01-14T13:16:42.5356100Z 
2025-01-14T13:16:42.5356150Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5356300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5356400Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5356560Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5356680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5356850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5357000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5357020Z 
2025-01-14T13:16:42.5357300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5357510Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5358480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5358790Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5358960Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5359120Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5359130Z 
2025-01-14T13:16:42.5359420Z     def initialize_transport_state(
2025-01-14T13:16:42.5359490Z         self,
2025-01-14T13:16:42.5359580Z         simulation_state,
2025-01-14T13:16:42.5359630Z         opacity_state,
2025-01-14T13:16:42.5362530Z         macro_atom_state,
2025-01-14T13:16:42.5362610Z         plasma,
2025-01-14T13:16:42.5362680Z         no_of_packets,
2025-01-14T13:16:42.5362740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5362830Z         iteration=0,
2025-01-14T13:16:42.5362890Z     ):
2025-01-14T13:16:42.5363180Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5363290Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5363370Z         else:
2025-01-14T13:16:42.5363450Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5363520Z     
2025-01-14T13:16:42.5363660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5363760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5363840Z         )
2025-01-14T13:16:42.5363910Z     
2025-01-14T13:16:42.5364040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5364140Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5364290Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5364370Z         else:
2025-01-14T13:16:42.5364460Z             continuum_state = None
2025-01-14T13:16:42.5364570Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5364690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5364790Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5364940Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5381520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5381670Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5382070Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5382130Z         ).to_numba(
2025-01-14T13:16:42.5382190Z             macro_atom_state,
2025-01-14T13:16:42.5382250Z             self.line_interaction_type,
2025-01-14T13:16:42.5382300Z         )
2025-01-14T13:16:42.5382380Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5382630Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5382690Z         ]
2025-01-14T13:16:42.5382980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5382990Z 
2025-01-14T13:16:42.5383100Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5383240Z _____________________ ERROR at setup of test_hdf_plasma[g] _____________________
2025-01-14T13:16:42.5383250Z 
2025-01-14T13:16:42.5383790Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5384110Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5384120Z 
2025-01-14T13:16:42.5384210Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5384350Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5384450Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5384610Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5384700Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5384770Z >       sim.run_final()
2025-01-14T13:16:42.5384780Z 
2025-01-14T13:16:42.5384850Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5384960Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5385050Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5393510Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5393600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5393770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5393900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5393910Z 
2025-01-14T13:16:42.5394210Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5394410Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5394650Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5394960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5395150Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5396460Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5396480Z 
2025-01-14T13:16:42.5396570Z     def initialize_transport_state(
2025-01-14T13:16:42.5396650Z         self,
2025-01-14T13:16:42.5396730Z         simulation_state,
2025-01-14T13:16:42.5396810Z         opacity_state,
2025-01-14T13:16:42.5396890Z         macro_atom_state,
2025-01-14T13:16:42.5396970Z         plasma,
2025-01-14T13:16:42.5397050Z         no_of_packets,
2025-01-14T13:16:42.5397140Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5397220Z         iteration=0,
2025-01-14T13:16:42.5397280Z     ):
2025-01-14T13:16:42.5397420Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5397530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5397610Z         else:
2025-01-14T13:16:42.5397700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5397790Z     
2025-01-14T13:16:42.5397930Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5400270Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5400350Z         )
2025-01-14T13:16:42.5400430Z     
2025-01-14T13:16:42.5400570Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5400700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5400870Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5400960Z         else:
2025-01-14T13:16:42.5401050Z             continuum_state = None
2025-01-14T13:16:42.5401190Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5401330Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5401430Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5401520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5403810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5404260Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5404610Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5404850Z         ).to_numba(
2025-01-14T13:16:42.5406460Z             macro_atom_state,
2025-01-14T13:16:42.5406630Z             self.line_interaction_type,
2025-01-14T13:16:42.5406700Z         )
2025-01-14T13:16:42.5406840Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5407080Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5407180Z         ]
2025-01-14T13:16:42.5407510Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5407530Z 
2025-01-14T13:16:42.5407640Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5408970Z ___________________ ERROR at setup of test_hdf_plasma[lines] ___________________
2025-01-14T13:16:42.5408990Z 
2025-01-14T13:16:42.5409620Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5410220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5410240Z 
2025-01-14T13:16:42.5410330Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5410530Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5410640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5410850Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5410950Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5411020Z >       sim.run_final()
2025-01-14T13:16:42.5411030Z 
2025-01-14T13:16:42.5411110Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5411240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5411350Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5411520Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5411640Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5411810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5411950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5411950Z 
2025-01-14T13:16:42.5412230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5412410Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5412840Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5413150Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5413410Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5413580Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5413600Z 
2025-01-14T13:16:42.5413710Z     def initialize_transport_state(
2025-01-14T13:16:42.5413780Z         self,
2025-01-14T13:16:42.5413870Z         simulation_state,
2025-01-14T13:16:42.5413950Z         opacity_state,
2025-01-14T13:16:42.5414050Z         macro_atom_state,
2025-01-14T13:16:42.5414130Z         plasma,
2025-01-14T13:16:42.5414220Z         no_of_packets,
2025-01-14T13:16:42.5414290Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5414340Z         iteration=0,
2025-01-14T13:16:42.5414380Z     ):
2025-01-14T13:16:42.5414500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5414620Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5414700Z         else:
2025-01-14T13:16:42.5414790Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5414870Z     
2025-01-14T13:16:42.5415030Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5415120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5415210Z         )
2025-01-14T13:16:42.5415280Z     
2025-01-14T13:16:42.5415450Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5415570Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5472540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5472650Z         else:
2025-01-14T13:16:42.5472700Z             continuum_state = None
2025-01-14T13:16:42.5472780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5472880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5472970Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5473100Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5473200Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5473360Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5473470Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5474060Z         ).to_numba(
2025-01-14T13:16:42.5474130Z             macro_atom_state,
2025-01-14T13:16:42.5474190Z             self.line_interaction_type,
2025-01-14T13:16:42.5474270Z         )
2025-01-14T13:16:42.5474370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5474680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5474740Z         ]
2025-01-14T13:16:42.5475020Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5475030Z 
2025-01-14T13:16:42.5475160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5475320Z ___________________ ERROR at setup of test_hdf_plasma[f_lu] ____________________
2025-01-14T13:16:42.5475330Z 
2025-01-14T13:16:42.5475850Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5476140Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5476150Z 
2025-01-14T13:16:42.5476210Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5476350Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5476430Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5476590Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5476650Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5476700Z >       sim.run_final()
2025-01-14T13:16:42.5476700Z 
2025-01-14T13:16:42.5476760Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5477080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5477150Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5477270Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5477330Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5477450Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5477540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5477540Z 
2025-01-14T13:16:42.5477770Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5477950Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5478160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5478490Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5478680Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5478810Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5478830Z 
2025-01-14T13:16:42.5478920Z     def initialize_transport_state(
2025-01-14T13:16:42.5478980Z         self,
2025-01-14T13:16:42.5479040Z         simulation_state,
2025-01-14T13:16:42.5479120Z         opacity_state,
2025-01-14T13:16:42.5479200Z         macro_atom_state,
2025-01-14T13:16:42.5479260Z         plasma,
2025-01-14T13:16:42.5479310Z         no_of_packets,
2025-01-14T13:16:42.5479360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5479410Z         iteration=0,
2025-01-14T13:16:42.5479450Z     ):
2025-01-14T13:16:42.5479550Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5479610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5479660Z         else:
2025-01-14T13:16:42.5479720Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5479760Z     
2025-01-14T13:16:42.5479870Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5480030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5480070Z         )
2025-01-14T13:16:42.5480110Z     
2025-01-14T13:16:42.5480210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5480310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5480470Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5480520Z         else:
2025-01-14T13:16:42.5480590Z             continuum_state = None
2025-01-14T13:16:42.5480680Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5480790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5480860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5480940Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5481010Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5481080Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5481150Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5481200Z         ).to_numba(
2025-01-14T13:16:42.5481250Z             macro_atom_state,
2025-01-14T13:16:42.5481310Z             self.line_interaction_type,
2025-01-14T13:16:42.5481360Z         )
2025-01-14T13:16:42.5481430Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5481670Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5481740Z         ]
2025-01-14T13:16:42.5488240Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5489490Z 
2025-01-14T13:16:42.5489690Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5489890Z _______________ ERROR at setup of test_hdf_plasma[tau_sobolevs] ________________
2025-01-14T13:16:42.5490110Z 
2025-01-14T13:16:42.5493070Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5493390Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5493400Z 
2025-01-14T13:16:42.5493470Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5493600Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5493680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5493830Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5493890Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5493940Z >       sim.run_final()
2025-01-14T13:16:42.5493950Z 
2025-01-14T13:16:42.5494010Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5494100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5494180Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5494320Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5494400Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5494550Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5494640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5494640Z 
2025-01-14T13:16:42.5494850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5495010Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5495190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5495410Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5495530Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5497220Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5497220Z 
2025-01-14T13:16:42.5497290Z     def initialize_transport_state(
2025-01-14T13:16:42.5497350Z         self,
2025-01-14T13:16:42.5497410Z         simulation_state,
2025-01-14T13:16:42.5497490Z         opacity_state,
2025-01-14T13:16:42.5497540Z         macro_atom_state,
2025-01-14T13:16:42.5497590Z         plasma,
2025-01-14T13:16:42.5497640Z         no_of_packets,
2025-01-14T13:16:42.5497700Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5497750Z         iteration=0,
2025-01-14T13:16:42.5497820Z     ):
2025-01-14T13:16:42.5497930Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5498040Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5498110Z         else:
2025-01-14T13:16:42.5498180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5498240Z     
2025-01-14T13:16:42.5498350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5498420Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5498460Z         )
2025-01-14T13:16:42.5498510Z     
2025-01-14T13:16:42.5498620Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5498740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5498910Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5498970Z         else:
2025-01-14T13:16:42.5499050Z             continuum_state = None
2025-01-14T13:16:42.5499140Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5499250Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5499320Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5499400Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5500130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5500210Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5500280Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5500330Z         ).to_numba(
2025-01-14T13:16:42.5500380Z             macro_atom_state,
2025-01-14T13:16:42.5500440Z             self.line_interaction_type,
2025-01-14T13:16:42.5500490Z         )
2025-01-14T13:16:42.5500560Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5500780Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5500830Z         ]
2025-01-14T13:16:42.5501070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5501070Z 
2025-01-14T13:16:42.5501180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5501310Z __________________ ERROR at setup of test_hdf_plasma[j_blues] __________________
2025-01-14T13:16:42.5501320Z 
2025-01-14T13:16:42.5501830Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5502130Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5502140Z 
2025-01-14T13:16:42.5502200Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5502320Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5502390Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5502530Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5502590Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5502640Z >       sim.run_final()
2025-01-14T13:16:42.5502650Z 
2025-01-14T13:16:42.5502700Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5502790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5502940Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5503060Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5503130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5503250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5503330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5503340Z 
2025-01-14T13:16:42.5503540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5503700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5503870Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5504090Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5504220Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5504320Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5504330Z 
2025-01-14T13:16:42.5504390Z     def initialize_transport_state(
2025-01-14T13:16:42.5504440Z         self,
2025-01-14T13:16:42.5504490Z         simulation_state,
2025-01-14T13:16:42.5504540Z         opacity_state,
2025-01-14T13:16:42.5504600Z         macro_atom_state,
2025-01-14T13:16:42.5504640Z         plasma,
2025-01-14T13:16:42.5504690Z         no_of_packets,
2025-01-14T13:16:42.5504750Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5504790Z         iteration=0,
2025-01-14T13:16:42.5504830Z     ):
2025-01-14T13:16:42.5504930Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5505080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5505190Z         else:
2025-01-14T13:16:42.5505250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5505290Z     
2025-01-14T13:16:42.5505400Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5505470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5505510Z         )
2025-01-14T13:16:42.5505550Z     
2025-01-14T13:16:42.5505650Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5505740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5505860Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5505900Z         else:
2025-01-14T13:16:42.5505970Z             continuum_state = None
2025-01-14T13:16:42.5506040Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5506120Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5506200Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5506290Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5506370Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5506450Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5506520Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5506570Z         ).to_numba(
2025-01-14T13:16:42.5506630Z             macro_atom_state,
2025-01-14T13:16:42.5506690Z             self.line_interaction_type,
2025-01-14T13:16:42.5506740Z         )
2025-01-14T13:16:42.5506820Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5507050Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5507100Z         ]
2025-01-14T13:16:42.5507360Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5507360Z 
2025-01-14T13:16:42.5507480Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5507630Z _______________ ERROR at setup of test_hdf_plasma[metastability] _______________
2025-01-14T13:16:42.5507680Z 
2025-01-14T13:16:42.5508220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5508520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5508530Z 
2025-01-14T13:16:42.5508600Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5508720Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5508790Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5508940Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5508990Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5509060Z >       sim.run_final()
2025-01-14T13:16:42.5509060Z 
2025-01-14T13:16:42.5509110Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5509200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5513360Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5513680Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5513790Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5514000Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5514140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5514150Z 
2025-01-14T13:16:42.5515250Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5515470Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5515680Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5518260Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5518460Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5518600Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5518620Z 
2025-01-14T13:16:42.5518700Z     def initialize_transport_state(
2025-01-14T13:16:42.5518750Z         self,
2025-01-14T13:16:42.5518820Z         simulation_state,
2025-01-14T13:16:42.5518860Z         opacity_state,
2025-01-14T13:16:42.5518970Z         macro_atom_state,
2025-01-14T13:16:42.5519480Z         plasma,
2025-01-14T13:16:42.5519550Z         no_of_packets,
2025-01-14T13:16:42.5519620Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5519670Z         iteration=0,
2025-01-14T13:16:42.5519720Z     ):
2025-01-14T13:16:42.5519820Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5519890Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5519940Z         else:
2025-01-14T13:16:42.5519990Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5520050Z     
2025-01-14T13:16:42.5520150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5520230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5520270Z         )
2025-01-14T13:16:42.5520310Z     
2025-01-14T13:16:42.5520410Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5520500Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5520630Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5520670Z         else:
2025-01-14T13:16:42.5520730Z             continuum_state = None
2025-01-14T13:16:42.5520810Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5520900Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5520960Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5521050Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5521120Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5521320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5521390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5521440Z         ).to_numba(
2025-01-14T13:16:42.5521490Z             macro_atom_state,
2025-01-14T13:16:42.5521550Z             self.line_interaction_type,
2025-01-14T13:16:42.5521600Z         )
2025-01-14T13:16:42.5521670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5521890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5521940Z         ]
2025-01-14T13:16:42.5522190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5522200Z 
2025-01-14T13:16:42.5522320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5522450Z _____________________ ERROR at setup of test_hdf_plasma[w] _____________________
2025-01-14T13:16:42.5522450Z 
2025-01-14T13:16:42.5522970Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5523260Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5523260Z 
2025-01-14T13:16:42.5523330Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5523450Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5523530Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5523670Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5523800Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5523850Z >       sim.run_final()
2025-01-14T13:16:42.5523860Z 
2025-01-14T13:16:42.5523910Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5524000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5524080Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5524190Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5524260Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5524390Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5524470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5524480Z 
2025-01-14T13:16:42.5524690Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5524850Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5525030Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5526920Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5527060Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5527170Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5527170Z 
2025-01-14T13:16:42.5527230Z     def initialize_transport_state(
2025-01-14T13:16:42.5527290Z         self,
2025-01-14T13:16:42.5527340Z         simulation_state,
2025-01-14T13:16:42.5527390Z         opacity_state,
2025-01-14T13:16:42.5527440Z         macro_atom_state,
2025-01-14T13:16:42.5527480Z         plasma,
2025-01-14T13:16:42.5527530Z         no_of_packets,
2025-01-14T13:16:42.5527590Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5527630Z         iteration=0,
2025-01-14T13:16:42.5527680Z     ):
2025-01-14T13:16:42.5527770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5527850Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5527900Z         else:
2025-01-14T13:16:42.5528260Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5528310Z     
2025-01-14T13:16:42.5528410Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5528490Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5528530Z         )
2025-01-14T13:16:42.5528580Z     
2025-01-14T13:16:42.5528680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5528770Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5528890Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5528940Z         else:
2025-01-14T13:16:42.5528990Z             continuum_state = None
2025-01-14T13:16:42.5529070Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5529150Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5529220Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5529300Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5529380Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5529450Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5529520Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5529570Z         ).to_numba(
2025-01-14T13:16:42.5529620Z             macro_atom_state,
2025-01-14T13:16:42.5529680Z             self.line_interaction_type,
2025-01-14T13:16:42.5529720Z         )
2025-01-14T13:16:42.5529790Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5530010Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5530060Z         ]
2025-01-14T13:16:42.5530300Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5530530Z 
2025-01-14T13:16:42.5530650Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5530790Z _____________ ERROR at setup of test_hdf_plasma[excitation_energy] _____________
2025-01-14T13:16:42.5530790Z 
2025-01-14T13:16:42.5531300Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5531590Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5531600Z 
2025-01-14T13:16:42.5531660Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5531780Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5531860Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5532000Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5532060Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5532110Z >       sim.run_final()
2025-01-14T13:16:42.5532120Z 
2025-01-14T13:16:42.5532180Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5532270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5532350Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5532450Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5532520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5532640Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5532730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5532730Z 
2025-01-14T13:16:42.5532940Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5533110Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5533290Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5533570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5533710Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5533820Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5533820Z 
2025-01-14T13:16:42.5533890Z     def initialize_transport_state(
2025-01-14T13:16:42.5533930Z         self,
2025-01-14T13:16:42.5533990Z         simulation_state,
2025-01-14T13:16:42.5534030Z         opacity_state,
2025-01-14T13:16:42.5534090Z         macro_atom_state,
2025-01-14T13:16:42.5534130Z         plasma,
2025-01-14T13:16:42.5534180Z         no_of_packets,
2025-01-14T13:16:42.5534240Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5534290Z         iteration=0,
2025-01-14T13:16:42.5534330Z     ):
2025-01-14T13:16:42.5534430Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5534510Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5534550Z         else:
2025-01-14T13:16:42.5534620Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5534660Z     
2025-01-14T13:16:42.5534770Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5534840Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5540330Z         )
2025-01-14T13:16:42.5540410Z     
2025-01-14T13:16:42.5540530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5540640Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5540800Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5540870Z         else:
2025-01-14T13:16:42.5540970Z             continuum_state = None
2025-01-14T13:16:42.5541050Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5541140Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5541340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5541450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5541530Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5541600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5541690Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5541750Z         ).to_numba(
2025-01-14T13:16:42.5541820Z             macro_atom_state,
2025-01-14T13:16:42.5541890Z             self.line_interaction_type,
2025-01-14T13:16:42.5541950Z         )
2025-01-14T13:16:42.5542030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5542280Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5542330Z         ]
2025-01-14T13:16:42.5542590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5542610Z 
2025-01-14T13:16:42.5542730Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5542880Z ______________________ ERROR at setup of test_hdf_levels _______________________
2025-01-14T13:16:42.5542880Z 
2025-01-14T13:16:42.5543440Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5543750Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5543760Z 
2025-01-14T13:16:42.5543820Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5543960Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5544050Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5544210Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5544290Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5544480Z >       sim.run_final()
2025-01-14T13:16:42.5544480Z 
2025-01-14T13:16:42.5544550Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5544660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5544740Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5544860Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5544920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5545170Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5545260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5545260Z 
2025-01-14T13:16:42.5545470Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5545630Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5545810Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5546050Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5546180Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5546290Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5546290Z 
2025-01-14T13:16:42.5546350Z     def initialize_transport_state(
2025-01-14T13:16:42.5546400Z         self,
2025-01-14T13:16:42.5546450Z         simulation_state,
2025-01-14T13:16:42.5546510Z         opacity_state,
2025-01-14T13:16:42.5546560Z         macro_atom_state,
2025-01-14T13:16:42.5546610Z         plasma,
2025-01-14T13:16:42.5546660Z         no_of_packets,
2025-01-14T13:16:42.5546710Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5546760Z         iteration=0,
2025-01-14T13:16:42.5546900Z     ):
2025-01-14T13:16:42.5547010Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5547070Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5547130Z         else:
2025-01-14T13:16:42.5547180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5547230Z     
2025-01-14T13:16:42.5547350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5547430Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5547470Z         )
2025-01-14T13:16:42.5547510Z     
2025-01-14T13:16:42.5547610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5547700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5547830Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5547870Z         else:
2025-01-14T13:16:42.5547940Z             continuum_state = None
2025-01-14T13:16:42.5548010Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5548100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5548170Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5548260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5548330Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5548400Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5548460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5548510Z         ).to_numba(
2025-01-14T13:16:42.5548560Z             macro_atom_state,
2025-01-14T13:16:42.5548620Z             self.line_interaction_type,
2025-01-14T13:16:42.5548660Z         )
2025-01-14T13:16:42.5548740Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5548950Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5549000Z         ]
2025-01-14T13:16:42.5549240Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5549250Z 
2025-01-14T13:16:42.5549360Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5549580Z ______________ ERROR at setup of test_hdf_scalars[time_explosion] ______________
2025-01-14T13:16:42.5549580Z 
2025-01-14T13:16:42.5550090Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5550370Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5550370Z 
2025-01-14T13:16:42.5550440Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5550560Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5550640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5550790Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5550870Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5550920Z >       sim.run_final()
2025-01-14T13:16:42.5550920Z 
2025-01-14T13:16:42.5550980Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5551070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5551150Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5551260Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5551330Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5551460Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5551540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5551540Z 
2025-01-14T13:16:42.5551750Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5551980Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5552160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5552380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5552510Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5552610Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5552610Z 
2025-01-14T13:16:42.5552680Z     def initialize_transport_state(
2025-01-14T13:16:42.5552730Z         self,
2025-01-14T13:16:42.5552780Z         simulation_state,
2025-01-14T13:16:42.5552830Z         opacity_state,
2025-01-14T13:16:42.5552880Z         macro_atom_state,
2025-01-14T13:16:42.5552930Z         plasma,
2025-01-14T13:16:42.5552980Z         no_of_packets,
2025-01-14T13:16:42.5553030Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5553090Z         iteration=0,
2025-01-14T13:16:42.5553130Z     ):
2025-01-14T13:16:42.5553230Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5553300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5553340Z         else:
2025-01-14T13:16:42.5553410Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5553450Z     
2025-01-14T13:16:42.5553550Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5553620Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5553670Z         )
2025-01-14T13:16:42.5553710Z     
2025-01-14T13:16:42.5553810Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5553910Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5554020Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5554070Z         else:
2025-01-14T13:16:42.5554130Z             continuum_state = None
2025-01-14T13:16:42.5554210Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5554300Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5554840Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5554930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5555020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5555100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5555180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5555230Z         ).to_numba(
2025-01-14T13:16:42.5555290Z             macro_atom_state,
2025-01-14T13:16:42.5555350Z             self.line_interaction_type,
2025-01-14T13:16:42.5555390Z         )
2025-01-14T13:16:42.5555470Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5555680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5555730Z         ]
2025-01-14T13:16:42.5555970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5555980Z 
2025-01-14T13:16:42.5556090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5556230Z __________ ERROR at setup of test_hdf_scalars[link_t_rad_t_electron] ___________
2025-01-14T13:16:42.5556240Z 
2025-01-14T13:16:42.5556750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5557060Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5557060Z 
2025-01-14T13:16:42.5557130Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5557260Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5557570Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5557720Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5557790Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5557840Z >       sim.run_final()
2025-01-14T13:16:42.5557850Z 
2025-01-14T13:16:42.5557900Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5557990Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5558070Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5558180Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5558240Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5558370Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5558450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5558460Z 
2025-01-14T13:16:42.5558670Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5558830Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5559010Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5559230Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5559360Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5559470Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5559470Z 
2025-01-14T13:16:42.5559540Z     def initialize_transport_state(
2025-01-14T13:16:42.5559580Z         self,
2025-01-14T13:16:42.5559640Z         simulation_state,
2025-01-14T13:16:42.5559680Z         opacity_state,
2025-01-14T13:16:42.5559740Z         macro_atom_state,
2025-01-14T13:16:42.5559780Z         plasma,
2025-01-14T13:16:42.5559830Z         no_of_packets,
2025-01-14T13:16:42.5559880Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5559930Z         iteration=0,
2025-01-14T13:16:42.5559970Z     ):
2025-01-14T13:16:42.5560070Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5560210Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5562880Z         else:
2025-01-14T13:16:42.5563690Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5563850Z     
2025-01-14T13:16:42.5564190Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5564390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5564530Z         )
2025-01-14T13:16:42.5564670Z     
2025-01-14T13:16:42.5564980Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5565260Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5565590Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5565730Z         else:
2025-01-14T13:16:42.5565910Z             continuum_state = None
2025-01-14T13:16:42.5566170Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5566460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5566710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5566950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5567150Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5567350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5567540Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5567680Z         ).to_numba(
2025-01-14T13:16:42.5567870Z             macro_atom_state,
2025-01-14T13:16:42.5568090Z             self.line_interaction_type,
2025-01-14T13:16:42.5568270Z         )
2025-01-14T13:16:42.5568500Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5569180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5569360Z         ]
2025-01-14T13:16:42.5570930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5570970Z 
2025-01-14T13:16:42.5571340Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5572760Z _________________ ERROR at setup of test_hdf_helium_treatment __________________
2025-01-14T13:16:42.5572800Z 
2025-01-14T13:16:42.5576860Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5577800Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5577820Z 
2025-01-14T13:16:42.5578040Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5578430Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5578900Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5579360Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5579570Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5579730Z >       sim.run_final()
2025-01-14T13:16:42.5579740Z 
2025-01-14T13:16:42.5579930Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5580200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5580460Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5580780Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5581020Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5581440Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5581680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5581690Z 
2025-01-14T13:16:42.5582320Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5582790Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5585060Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5590470Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5590700Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5590810Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5590820Z 
2025-01-14T13:16:42.5590880Z     def initialize_transport_state(
2025-01-14T13:16:42.5590930Z         self,
2025-01-14T13:16:42.5590990Z         simulation_state,
2025-01-14T13:16:42.5591040Z         opacity_state,
2025-01-14T13:16:42.5591090Z         macro_atom_state,
2025-01-14T13:16:42.5591140Z         plasma,
2025-01-14T13:16:42.5591190Z         no_of_packets,
2025-01-14T13:16:42.5591260Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5591310Z         iteration=0,
2025-01-14T13:16:42.5591360Z     ):
2025-01-14T13:16:42.5591480Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5591550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5591600Z         else:
2025-01-14T13:16:42.5591650Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5591700Z     
2025-01-14T13:16:42.5591810Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5591880Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5591920Z         )
2025-01-14T13:16:42.5591960Z     
2025-01-14T13:16:42.5592070Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5592160Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5592300Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5592350Z         else:
2025-01-14T13:16:42.5592700Z             continuum_state = None
2025-01-14T13:16:42.5592790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5592880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5592950Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5593040Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5593120Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5593190Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5593260Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5593310Z         ).to_numba(
2025-01-14T13:16:42.5593370Z             macro_atom_state,
2025-01-14T13:16:42.5593440Z             self.line_interaction_type,
2025-01-14T13:16:42.5593490Z         )
2025-01-14T13:16:42.5593570Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5593790Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5593840Z         ]
2025-01-14T13:16:42.5594100Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5594110Z 
2025-01-14T13:16:42.5594230Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5594360Z ___________________ ERROR at setup of test_atomic_data_uuid ____________________
2025-01-14T13:16:42.5594360Z 
2025-01-14T13:16:42.5594880Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5595170Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5595170Z 
2025-01-14T13:16:42.5595230Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5595360Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5595440Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5595690Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5595760Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5595810Z >       sim.run_final()
2025-01-14T13:16:42.5595810Z 
2025-01-14T13:16:42.5595880Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5595970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5596050Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5596160Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5596230Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5596350Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5596440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5596450Z 
2025-01-14T13:16:42.5596690Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5596880Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5597060Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5597280Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5597420Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5597530Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5597540Z 
2025-01-14T13:16:42.5597600Z     def initialize_transport_state(
2025-01-14T13:16:42.5597660Z         self,
2025-01-14T13:16:42.5597730Z         simulation_state,
2025-01-14T13:16:42.5597790Z         opacity_state,
2025-01-14T13:16:42.5597860Z         macro_atom_state,
2025-01-14T13:16:42.5597900Z         plasma,
2025-01-14T13:16:42.5598030Z         no_of_packets,
2025-01-14T13:16:42.5598100Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5598150Z         iteration=0,
2025-01-14T13:16:42.5598190Z     ):
2025-01-14T13:16:42.5598300Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5598380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5598420Z         else:
2025-01-14T13:16:42.5598480Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5598530Z     
2025-01-14T13:16:42.5598650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5598720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5598760Z         )
2025-01-14T13:16:42.5598800Z     
2025-01-14T13:16:42.5598910Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5599000Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5599150Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5599220Z         else:
2025-01-14T13:16:42.5599300Z             continuum_state = None
2025-01-14T13:16:42.5599390Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5599490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5599570Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5599650Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5599720Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5599790Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5599860Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5599920Z         ).to_numba(
2025-01-14T13:16:42.5599980Z             macro_atom_state,
2025-01-14T13:16:42.5600050Z             self.line_interaction_type,
2025-01-14T13:16:42.5600120Z         )
2025-01-14T13:16:42.5600210Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5600460Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5600540Z         ]
2025-01-14T13:16:42.5600810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5601230Z 
2025-01-14T13:16:42.5601380Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5601530Z ___________________ ERROR at setup of test_collection[t_rad] ___________________
2025-01-14T13:16:42.5601540Z 
2025-01-14T13:16:42.5602290Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5602590Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5602600Z 
2025-01-14T13:16:42.5602660Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5602800Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5602870Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5603040Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5603110Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5603160Z >       sim.run_final()
2025-01-14T13:16:42.5603160Z 
2025-01-14T13:16:42.5603220Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5603320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5603390Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5603500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5603570Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5603690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5603780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5604150Z 
2025-01-14T13:16:42.5604370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5604550Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5604730Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5604970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5605430Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5605600Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5605600Z 
2025-01-14T13:16:42.5605670Z     def initialize_transport_state(
2025-01-14T13:16:42.5605730Z         self,
2025-01-14T13:16:42.5605790Z         simulation_state,
2025-01-14T13:16:42.5605840Z         opacity_state,
2025-01-14T13:16:42.5605900Z         macro_atom_state,
2025-01-14T13:16:42.5605970Z         plasma,
2025-01-14T13:16:42.5606040Z         no_of_packets,
2025-01-14T13:16:42.5606110Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5606160Z         iteration=0,
2025-01-14T13:16:42.5606210Z     ):
2025-01-14T13:16:42.5606310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5606390Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5606430Z         else:
2025-01-14T13:16:42.5606490Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5606550Z     
2025-01-14T13:16:42.5606660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5606730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5606780Z         )
2025-01-14T13:16:42.5606820Z     
2025-01-14T13:16:42.5606930Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5607010Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5607140Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5607190Z         else:
2025-01-14T13:16:42.5607250Z             continuum_state = None
2025-01-14T13:16:42.5607530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5607630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5607710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5607800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5607870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5607940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5608010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5608060Z         ).to_numba(
2025-01-14T13:16:42.5608110Z             macro_atom_state,
2025-01-14T13:16:42.5608170Z             self.line_interaction_type,
2025-01-14T13:16:42.5608220Z         )
2025-01-14T13:16:42.5608290Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5608510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5608560Z         ]
2025-01-14T13:16:42.5608820Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5608820Z 
2025-01-14T13:16:42.5608940Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5609070Z _____________________ ERROR at setup of test_collection[w] _____________________
2025-01-14T13:16:42.5609070Z 
2025-01-14T13:16:42.5609610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5609950Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.5609960Z 
2025-01-14T13:16:42.5610120Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.5610240Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.5610320Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.5610460Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.5610530Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.5610570Z >       sim.run_final()
2025-01-14T13:16:42.5610580Z 
2025-01-14T13:16:42.5610640Z tardis/conftest.py:233: 
2025-01-14T13:16:42.5610730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5610800Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5610920Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5610990Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5611110Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5611200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5611210Z 
2025-01-14T13:16:42.5611450Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.5611620Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.5611810Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.5612040Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.5612160Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.5612270Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5612280Z 
2025-01-14T13:16:42.5612340Z     def initialize_transport_state(
2025-01-14T13:16:42.5612380Z         self,
2025-01-14T13:16:42.5612440Z         simulation_state,
2025-01-14T13:16:42.5612490Z         opacity_state,
2025-01-14T13:16:42.5612540Z         macro_atom_state,
2025-01-14T13:16:42.5612600Z         plasma,
2025-01-14T13:16:42.5612660Z         no_of_packets,
2025-01-14T13:16:42.5612810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5612860Z         iteration=0,
2025-01-14T13:16:42.5612900Z     ):
2025-01-14T13:16:42.5613000Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5613090Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5613140Z         else:
2025-01-14T13:16:42.5613210Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5613260Z     
2025-01-14T13:16:42.5613380Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5613460Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5613520Z         )
2025-01-14T13:16:42.5613580Z     
2025-01-14T13:16:42.5613700Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5613810Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5613960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5614020Z         else:
2025-01-14T13:16:42.5614090Z             continuum_state = None
2025-01-14T13:16:42.5614180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5614280Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5614350Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5614430Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5614500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5614570Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5614640Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5614690Z         ).to_numba(
2025-01-14T13:16:42.5614740Z             macro_atom_state,
2025-01-14T13:16:42.5614810Z             self.line_interaction_type,
2025-01-14T13:16:42.5614850Z         )
2025-01-14T13:16:42.5614930Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5615230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5615290Z         ]
2025-01-14T13:16:42.5615550Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5615560Z 
2025-01-14T13:16:42.5615680Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5615820Z _________ ERROR at setup of test_plasma_state_iterations[iterations_w] _________
2025-01-14T13:16:42.5615830Z 
2025-01-14T13:16:42.5616300Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5616640Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5616660Z 
2025-01-14T13:16:42.5616720Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5616820Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5616890Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5616970Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5617050Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5617150Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5617200Z     
2025-01-14T13:16:42.5617280Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5617350Z >       sim.run_convergence()
2025-01-14T13:16:42.5617350Z 
2025-01-14T13:16:42.5617430Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5617540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5617630Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5617750Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5617820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5617960Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5618140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5618150Z 
2025-01-14T13:16:42.5618390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5618570Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5618740Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5618960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5619080Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5619210Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5619220Z 
2025-01-14T13:16:42.5619300Z     def initialize_transport_state(
2025-01-14T13:16:42.5619350Z         self,
2025-01-14T13:16:42.5619400Z         simulation_state,
2025-01-14T13:16:42.5619460Z         opacity_state,
2025-01-14T13:16:42.5619510Z         macro_atom_state,
2025-01-14T13:16:42.5619560Z         plasma,
2025-01-14T13:16:42.5619600Z         no_of_packets,
2025-01-14T13:16:42.5619660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5619710Z         iteration=0,
2025-01-14T13:16:42.5619750Z     ):
2025-01-14T13:16:42.5619840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5619910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5619960Z         else:
2025-01-14T13:16:42.5620020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5625100Z     
2025-01-14T13:16:42.5625250Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5625320Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5625370Z         )
2025-01-14T13:16:42.5625600Z     
2025-01-14T13:16:42.5625700Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5625950Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5626090Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5626140Z         else:
2025-01-14T13:16:42.5626210Z             continuum_state = None
2025-01-14T13:16:42.5626300Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5626400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5626470Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5626560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5626640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5626710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5626780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5626830Z         ).to_numba(
2025-01-14T13:16:42.5626880Z             macro_atom_state,
2025-01-14T13:16:42.5626950Z             self.line_interaction_type,
2025-01-14T13:16:42.5626990Z         )
2025-01-14T13:16:42.5627070Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5627320Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5627370Z         ]
2025-01-14T13:16:42.5627640Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5627650Z 
2025-01-14T13:16:42.5627780Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5627920Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5628290Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5628660Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5628810Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5629610Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5629780Z _______ ERROR at setup of test_plasma_state_iterations[iterations_t_rad] _______
2025-01-14T13:16:42.5629790Z 
2025-01-14T13:16:42.5630330Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5630660Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5630670Z 
2025-01-14T13:16:42.5630730Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5630830Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5630920Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5631000Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5631080Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5631180Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5631250Z     
2025-01-14T13:16:42.5631330Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5631410Z >       sim.run_convergence()
2025-01-14T13:16:42.5631420Z 
2025-01-14T13:16:42.5631510Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5631610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5631710Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5631830Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5631900Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5632520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5632630Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5632640Z 
2025-01-14T13:16:42.5632860Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5633020Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5633210Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5633450Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5633580Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5633700Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5633700Z 
2025-01-14T13:16:42.5633760Z     def initialize_transport_state(
2025-01-14T13:16:42.5633810Z         self,
2025-01-14T13:16:42.5633870Z         simulation_state,
2025-01-14T13:16:42.5633910Z         opacity_state,
2025-01-14T13:16:42.5633970Z         macro_atom_state,
2025-01-14T13:16:42.5634010Z         plasma,
2025-01-14T13:16:42.5634070Z         no_of_packets,
2025-01-14T13:16:42.5634130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5634170Z         iteration=0,
2025-01-14T13:16:42.5634210Z     ):
2025-01-14T13:16:42.5634310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5634380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5634440Z         else:
2025-01-14T13:16:42.5634520Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5634570Z     
2025-01-14T13:16:42.5634680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5634750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5634790Z         )
2025-01-14T13:16:42.5634840Z     
2025-01-14T13:16:42.5634950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5635070Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5635200Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5635340Z         else:
2025-01-14T13:16:42.5635400Z             continuum_state = None
2025-01-14T13:16:42.5635480Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5635590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5635670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5635750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5635820Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5635890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5635970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5636030Z         ).to_numba(
2025-01-14T13:16:42.5636080Z             macro_atom_state,
2025-01-14T13:16:42.5636150Z             self.line_interaction_type,
2025-01-14T13:16:42.5636190Z         )
2025-01-14T13:16:42.5636270Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5636500Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5636550Z         ]
2025-01-14T13:16:42.5636810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5636810Z 
2025-01-14T13:16:42.5636930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5637080Z _ ERROR at setup of test_plasma_state_iterations[iterations_electron_densities] _
2025-01-14T13:16:42.5637090Z 
2025-01-14T13:16:42.5637570Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5637880Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5637990Z 
2025-01-14T13:16:42.5638070Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5638160Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5638240Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5638300Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5638380Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5638470Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5638520Z     
2025-01-14T13:16:42.5638590Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5638640Z >       sim.run_convergence()
2025-01-14T13:16:42.5638640Z 
2025-01-14T13:16:42.5638730Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5638810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5638900Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5639020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5639100Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5639230Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5639330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5639330Z 
2025-01-14T13:16:42.5639560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5639740Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5639940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5640190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5640320Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5640440Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5640450Z 
2025-01-14T13:16:42.5640530Z     def initialize_transport_state(
2025-01-14T13:16:42.5640680Z         self,
2025-01-14T13:16:42.5640750Z         simulation_state,
2025-01-14T13:16:42.5640800Z         opacity_state,
2025-01-14T13:16:42.5640870Z         macro_atom_state,
2025-01-14T13:16:42.5640930Z         plasma,
2025-01-14T13:16:42.5640970Z         no_of_packets,
2025-01-14T13:16:42.5641040Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5641110Z         iteration=0,
2025-01-14T13:16:42.5641170Z     ):
2025-01-14T13:16:42.5641290Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5641380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5641430Z         else:
2025-01-14T13:16:42.5641510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5641560Z     
2025-01-14T13:16:42.5641680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5641770Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5641820Z         )
2025-01-14T13:16:42.5641860Z     
2025-01-14T13:16:42.5641960Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5642060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5642210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5642260Z         else:
2025-01-14T13:16:42.5642320Z             continuum_state = None
2025-01-14T13:16:42.5642400Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5642480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5642560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5642650Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5642750Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5642820Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5642900Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5643060Z         ).to_numba(
2025-01-14T13:16:42.5643130Z             macro_atom_state,
2025-01-14T13:16:42.5643200Z             self.line_interaction_type,
2025-01-14T13:16:42.5643250Z         )
2025-01-14T13:16:42.5643320Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5643570Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5643620Z         ]
2025-01-14T13:16:42.5643860Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5643860Z 
2025-01-14T13:16:42.5643970Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5644110Z ______ ERROR at setup of test_plasma_state_iterations[iterations_t_inner] ______
2025-01-14T13:16:42.5644120Z 
2025-01-14T13:16:42.5644610Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5644920Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5644920Z 
2025-01-14T13:16:42.5644990Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5645080Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5645150Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5645220Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5645310Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5645410Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5645450Z     
2025-01-14T13:16:42.5645520Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5645570Z >       sim.run_convergence()
2025-01-14T13:16:42.5645580Z 
2025-01-14T13:16:42.5645660Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5645750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5645920Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5646030Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5646100Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5646220Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5646320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5646330Z 
2025-01-14T13:16:42.5646550Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5646710Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5646920Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5647160Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5647300Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5647410Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5647410Z 
2025-01-14T13:16:42.5647480Z     def initialize_transport_state(
2025-01-14T13:16:42.5647530Z         self,
2025-01-14T13:16:42.5647580Z         simulation_state,
2025-01-14T13:16:42.5647630Z         opacity_state,
2025-01-14T13:16:42.5647680Z         macro_atom_state,
2025-01-14T13:16:42.5647740Z         plasma,
2025-01-14T13:16:42.5647790Z         no_of_packets,
2025-01-14T13:16:42.5647850Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5647900Z         iteration=0,
2025-01-14T13:16:42.5647940Z     ):
2025-01-14T13:16:42.5648040Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5648110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5648170Z         else:
2025-01-14T13:16:42.5648330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5648380Z     
2025-01-14T13:16:42.5648520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5648610Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5648670Z         )
2025-01-14T13:16:42.5648720Z     
2025-01-14T13:16:42.5648830Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5648940Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5649060Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5649110Z         else:
2025-01-14T13:16:42.5649170Z             continuum_state = None
2025-01-14T13:16:42.5649260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5649350Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5649440Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5649540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5649650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5649730Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5649840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5649890Z         ).to_numba(
2025-01-14T13:16:42.5649960Z             macro_atom_state,
2025-01-14T13:16:42.5650030Z             self.line_interaction_type,
2025-01-14T13:16:42.5650080Z         )
2025-01-14T13:16:42.5650150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5650390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5650470Z         ]
2025-01-14T13:16:42.5650750Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5650760Z 
2025-01-14T13:16:42.5650890Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5651060Z __________ ERROR at setup of test_plasma_estimates[nu_bar_estimator] ___________
2025-01-14T13:16:42.5651070Z 
2025-01-14T13:16:42.5651600Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5652300Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5652320Z 
2025-01-14T13:16:42.5652390Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5652510Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5652580Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5652670Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5652760Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5652880Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5652940Z     
2025-01-14T13:16:42.5653030Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5653090Z >       sim.run_convergence()
2025-01-14T13:16:42.5653090Z 
2025-01-14T13:16:42.5653190Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5653300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5653390Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5653520Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5653600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5653730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5653840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5653840Z 
2025-01-14T13:16:42.5654070Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5654230Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5654710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5654970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5655120Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5655240Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5655250Z 
2025-01-14T13:16:42.5655310Z     def initialize_transport_state(
2025-01-14T13:16:42.5655360Z         self,
2025-01-14T13:16:42.5655410Z         simulation_state,
2025-01-14T13:16:42.5655480Z         opacity_state,
2025-01-14T13:16:42.5655540Z         macro_atom_state,
2025-01-14T13:16:42.5655590Z         plasma,
2025-01-14T13:16:42.5655640Z         no_of_packets,
2025-01-14T13:16:42.5655700Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5655750Z         iteration=0,
2025-01-14T13:16:42.5655800Z     ):
2025-01-14T13:16:42.5655910Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5655990Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5656030Z         else:
2025-01-14T13:16:42.5656090Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5656140Z     
2025-01-14T13:16:42.5656260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5656330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5656370Z         )
2025-01-14T13:16:42.5656410Z     
2025-01-14T13:16:42.5656510Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5656600Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5656720Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5656770Z         else:
2025-01-14T13:16:42.5656820Z             continuum_state = None
2025-01-14T13:16:42.5656900Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5656990Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5657070Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5657270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5657340Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5657410Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5657470Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5657520Z         ).to_numba(
2025-01-14T13:16:42.5657570Z             macro_atom_state,
2025-01-14T13:16:42.5657630Z             self.line_interaction_type,
2025-01-14T13:16:42.5657680Z         )
2025-01-14T13:16:42.5657770Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5658010Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5658060Z         ]
2025-01-14T13:16:42.5658310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5658310Z 
2025-01-14T13:16:42.5658420Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5658560Z _____________ ERROR at setup of test_plasma_estimates[j_estimator] _____________
2025-01-14T13:16:42.5658570Z 
2025-01-14T13:16:42.5659070Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5659400Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5659400Z 
2025-01-14T13:16:42.5659480Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5659580Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5659660Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5659850Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5659930Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5660020Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5660070Z     
2025-01-14T13:16:42.5660140Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5660200Z >       sim.run_convergence()
2025-01-14T13:16:42.5660200Z 
2025-01-14T13:16:42.5660280Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5660370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5660460Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5660590Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5660660Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5660780Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5660870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5660880Z 
2025-01-14T13:16:42.5661080Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5661280Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5661480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5661710Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5661820Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5661940Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5661940Z 
2025-01-14T13:16:42.5662000Z     def initialize_transport_state(
2025-01-14T13:16:42.5662040Z         self,
2025-01-14T13:16:42.5662090Z         simulation_state,
2025-01-14T13:16:42.5662140Z         opacity_state,
2025-01-14T13:16:42.5662190Z         macro_atom_state,
2025-01-14T13:16:42.5662240Z         plasma,
2025-01-14T13:16:42.5662300Z         no_of_packets,
2025-01-14T13:16:42.5662350Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5662490Z         iteration=0,
2025-01-14T13:16:42.5662540Z     ):
2025-01-14T13:16:42.5662630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5662700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5662750Z         else:
2025-01-14T13:16:42.5662810Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5662850Z     
2025-01-14T13:16:42.5662950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5663030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5663070Z         )
2025-01-14T13:16:42.5663110Z     
2025-01-14T13:16:42.5663210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5663290Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5663410Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5663460Z         else:
2025-01-14T13:16:42.5663520Z             continuum_state = None
2025-01-14T13:16:42.5663590Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5663680Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5663740Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5663820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5663890Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5663960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5664030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5664070Z         ).to_numba(
2025-01-14T13:16:42.5664120Z             macro_atom_state,
2025-01-14T13:16:42.5664180Z             self.line_interaction_type,
2025-01-14T13:16:42.5664220Z         )
2025-01-14T13:16:42.5664300Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5664520Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5664680Z         ]
2025-01-14T13:16:42.5664940Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5664950Z 
2025-01-14T13:16:42.5665070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5665220Z _____________ ERROR at setup of test_plasma_estimates[t_radiative] _____________
2025-01-14T13:16:42.5665220Z 
2025-01-14T13:16:42.5665710Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5666170Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5666180Z 
2025-01-14T13:16:42.5666270Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5666370Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5666450Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5666520Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5666600Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5666710Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5666760Z     
2025-01-14T13:16:42.5666840Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5666900Z >       sim.run_convergence()
2025-01-14T13:16:42.5666910Z 
2025-01-14T13:16:42.5666990Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5667260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5667370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5667490Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5667560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5667680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5668000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5668000Z 
2025-01-14T13:16:42.5668230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5668390Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5668560Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5668780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5668900Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5669030Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5669040Z 
2025-01-14T13:16:42.5669110Z     def initialize_transport_state(
2025-01-14T13:16:42.5669160Z         self,
2025-01-14T13:16:42.5669230Z         simulation_state,
2025-01-14T13:16:42.5669300Z         opacity_state,
2025-01-14T13:16:42.5669360Z         macro_atom_state,
2025-01-14T13:16:42.5669410Z         plasma,
2025-01-14T13:16:42.5669470Z         no_of_packets,
2025-01-14T13:16:42.5669520Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5669570Z         iteration=0,
2025-01-14T13:16:42.5669610Z     ):
2025-01-14T13:16:42.5669710Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5669770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5669820Z         else:
2025-01-14T13:16:42.5669870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5669910Z     
2025-01-14T13:16:42.5670010Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5670080Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5670130Z         )
2025-01-14T13:16:42.5670170Z     
2025-01-14T13:16:42.5670340Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5670430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5670560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5670600Z         else:
2025-01-14T13:16:42.5670660Z             continuum_state = None
2025-01-14T13:16:42.5670730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5670820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5670880Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5670960Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5671030Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5671110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5671170Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5671210Z         ).to_numba(
2025-01-14T13:16:42.5671270Z             macro_atom_state,
2025-01-14T13:16:42.5671330Z             self.line_interaction_type,
2025-01-14T13:16:42.5671370Z         )
2025-01-14T13:16:42.5671450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5671670Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5671710Z         ]
2025-01-14T13:16:42.5671950Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5671960Z 
2025-01-14T13:16:42.5672070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5672220Z ___________ ERROR at setup of test_plasma_estimates[dilution_factor] ___________
2025-01-14T13:16:42.5672230Z 
2025-01-14T13:16:42.5672690Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5673000Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5673440Z 
2025-01-14T13:16:42.5673530Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5673620Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5673690Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5673760Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5673840Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5673930Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5673970Z     
2025-01-14T13:16:42.5674040Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5674090Z >       sim.run_convergence()
2025-01-14T13:16:42.5674100Z 
2025-01-14T13:16:42.5674200Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5674280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5674370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5674500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5674590Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5674720Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5674820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5674830Z 
2025-01-14T13:16:42.5675030Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5675180Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5675360Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5675570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5675690Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5676010Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5676030Z 
2025-01-14T13:16:42.5676090Z     def initialize_transport_state(
2025-01-14T13:16:42.5676130Z         self,
2025-01-14T13:16:42.5676190Z         simulation_state,
2025-01-14T13:16:42.5676250Z         opacity_state,
2025-01-14T13:16:42.5676330Z         macro_atom_state,
2025-01-14T13:16:42.5676390Z         plasma,
2025-01-14T13:16:42.5676450Z         no_of_packets,
2025-01-14T13:16:42.5676530Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5676580Z         iteration=0,
2025-01-14T13:16:42.5676620Z     ):
2025-01-14T13:16:42.5676720Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5676800Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5676840Z         else:
2025-01-14T13:16:42.5676900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5676940Z     
2025-01-14T13:16:42.5677040Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5677120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5677170Z         )
2025-01-14T13:16:42.5677210Z     
2025-01-14T13:16:42.5677300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5677390Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5677540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5677600Z         else:
2025-01-14T13:16:42.5677670Z             continuum_state = None
2025-01-14T13:16:42.5677740Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5677820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5677890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5677970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5678040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5678100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5678170Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5678220Z         ).to_numba(
2025-01-14T13:16:42.5678350Z             macro_atom_state,
2025-01-14T13:16:42.5678430Z             self.line_interaction_type,
2025-01-14T13:16:42.5678480Z         )
2025-01-14T13:16:42.5678550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5678770Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5678810Z         ]
2025-01-14T13:16:42.5679070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5679080Z 
2025-01-14T13:16:42.5679190Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5679320Z _____________ ERROR at setup of test_plasma_estimates[output_nus] ______________
2025-01-14T13:16:42.5679330Z 
2025-01-14T13:16:42.5679800Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5680110Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5680120Z 
2025-01-14T13:16:42.5680190Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5680290Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5680360Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5680440Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5680510Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5680600Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5680640Z     
2025-01-14T13:16:42.5685120Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5685210Z >       sim.run_convergence()
2025-01-14T13:16:42.5685350Z 
2025-01-14T13:16:42.5685440Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5685530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5685620Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5685730Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5685790Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5685910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5686000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5686000Z 
2025-01-14T13:16:42.5686210Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5686370Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5686540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5686770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5686910Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5687030Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5687040Z 
2025-01-14T13:16:42.5687100Z     def initialize_transport_state(
2025-01-14T13:16:42.5687150Z         self,
2025-01-14T13:16:42.5687210Z         simulation_state,
2025-01-14T13:16:42.5687270Z         opacity_state,
2025-01-14T13:16:42.5687320Z         macro_atom_state,
2025-01-14T13:16:42.5687370Z         plasma,
2025-01-14T13:16:42.5687420Z         no_of_packets,
2025-01-14T13:16:42.5687470Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5687520Z         iteration=0,
2025-01-14T13:16:42.5687560Z     ):
2025-01-14T13:16:42.5687650Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5687730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5687780Z         else:
2025-01-14T13:16:42.5687840Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5687960Z     
2025-01-14T13:16:42.5688070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5688140Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5688190Z         )
2025-01-14T13:16:42.5688230Z     
2025-01-14T13:16:42.5688330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5688420Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5688550Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5688600Z         else:
2025-01-14T13:16:42.5688660Z             continuum_state = None
2025-01-14T13:16:42.5688740Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5688820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5688890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5688970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5689060Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5689140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5689220Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5689270Z         ).to_numba(
2025-01-14T13:16:42.5689320Z             macro_atom_state,
2025-01-14T13:16:42.5689380Z             self.line_interaction_type,
2025-01-14T13:16:42.5689430Z         )
2025-01-14T13:16:42.5689500Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5689720Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5689760Z         ]
2025-01-14T13:16:42.5690020Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5690030Z 
2025-01-14T13:16:42.5690140Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5690350Z ___________ ERROR at setup of test_plasma_estimates[output_energies] ___________
2025-01-14T13:16:42.5690360Z 
2025-01-14T13:16:42.5690840Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5691140Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5691140Z 
2025-01-14T13:16:42.5691220Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.5691340Z     def simulation_one_loop(config, atomic_data_fname):
2025-01-14T13:16:42.5691420Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5691490Z         config.montecarlo.iterations = 2
2025-01-14T13:16:42.5691570Z         config.montecarlo.no_of_packets = int(4e4)
2025-01-14T13:16:42.5691660Z         config.montecarlo.last_no_of_packets = int(4e4)
2025-01-14T13:16:42.5691700Z     
2025-01-14T13:16:42.5691770Z         sim = Simulation.from_config(config)
2025-01-14T13:16:42.5691830Z >       sim.run_convergence()
2025-01-14T13:16:42.5691840Z 
2025-01-14T13:16:42.5691920Z tardis/simulation/tests/test_simulation.py:26: 
2025-01-14T13:16:42.5692010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5692090Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5692210Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5692280Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5692400Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5692490Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5692490Z 
2025-01-14T13:16:42.5692700Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x1591c8560>
2025-01-14T13:16:42.5692860Z simulation_state = <tardis.model.base.SimulationState object at 0x154983f80>
2025-01-14T13:16:42.5693130Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17491d3a0>
2025-01-14T13:16:42.5693350Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17491eb40>
2025-01-14T13:16:42.5693470Z plasma = <tardis.plasma.base.BasePlasma object at 0x154a14950>
2025-01-14T13:16:42.5693580Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5693580Z 
2025-01-14T13:16:42.5693640Z     def initialize_transport_state(
2025-01-14T13:16:42.5693690Z         self,
2025-01-14T13:16:42.5693750Z         simulation_state,
2025-01-14T13:16:42.5693800Z         opacity_state,
2025-01-14T13:16:42.5693850Z         macro_atom_state,
2025-01-14T13:16:42.5693900Z         plasma,
2025-01-14T13:16:42.5693940Z         no_of_packets,
2025-01-14T13:16:42.5694000Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5694050Z         iteration=0,
2025-01-14T13:16:42.5694100Z     ):
2025-01-14T13:16:42.5694200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5694270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5694320Z         else:
2025-01-14T13:16:42.5694380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5694420Z     
2025-01-14T13:16:42.5694530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5694600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5694640Z         )
2025-01-14T13:16:42.5694690Z     
2025-01-14T13:16:42.5694790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5694870Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5694990Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5695040Z         else:
2025-01-14T13:16:42.5695090Z             continuum_state = None
2025-01-14T13:16:42.5695230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5695310Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5695380Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5695470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5695540Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5695610Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5695680Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5695720Z         ).to_numba(
2025-01-14T13:16:42.5695780Z             macro_atom_state,
2025-01-14T13:16:42.5695840Z             self.line_interaction_type,
2025-01-14T13:16:42.5695890Z         )
2025-01-14T13:16:42.5695960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5696180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5696220Z         ]
2025-01-14T13:16:42.5696470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5696480Z 
2025-01-14T13:16:42.5696600Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5696750Z ___________ ERROR at setup of TestSpectrumSolver.test_initialization ___________
2025-01-14T13:16:42.5696750Z 
2025-01-14T13:16:42.5696980Z self = <tardis.spectrum.tests.test_spectrum_solver.TestSpectrumSolver object at 0x11a2fe390>
2025-01-14T13:16:42.5697120Z request = <SubRequest 'simulation' for <Function test_initialization>>
2025-01-14T13:16:42.5697420Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5697480Z generate_reference = False
2025-01-14T13:16:42.5697650Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5697660Z 
2025-01-14T13:16:42.5697730Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5697780Z     def simulation(
2025-01-14T13:16:42.5697830Z         self,
2025-01-14T13:16:42.5697880Z         request,
2025-01-14T13:16:42.5698190Z         atomic_data_fname,
2025-01-14T13:16:42.5698250Z         generate_reference,
2025-01-14T13:16:42.5698320Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5698360Z     ):
2025-01-14T13:16:42.5698430Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5698560Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5698600Z         )
2025-01-14T13:16:42.5698680Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5698740Z     
2025-01-14T13:16:42.5698820Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5698880Z >       simulation.run_final()
2025-01-14T13:16:42.5698880Z 
2025-01-14T13:16:42.5698970Z tardis/spectrum/tests/test_spectrum_solver.py:32: 
2025-01-14T13:16:42.5699050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5699130Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5699240Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5699310Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5699430Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5699510Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5699520Z 
2025-01-14T13:16:42.5699720Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x305580980>
2025-01-14T13:16:42.5699880Z simulation_state = <tardis.model.base.SimulationState object at 0x305594e90>
2025-01-14T13:16:42.5700050Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31639d1c0>
2025-01-14T13:16:42.5700260Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x31639fb60>
2025-01-14T13:16:42.5700390Z plasma = <tardis.plasma.base.BasePlasma object at 0x3054a1790>
2025-01-14T13:16:42.5700770Z no_of_packets = 500000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5700770Z 
2025-01-14T13:16:42.5700850Z     def initialize_transport_state(
2025-01-14T13:16:42.5700910Z         self,
2025-01-14T13:16:42.5700980Z         simulation_state,
2025-01-14T13:16:42.5701030Z         opacity_state,
2025-01-14T13:16:42.5701080Z         macro_atom_state,
2025-01-14T13:16:42.5701120Z         plasma,
2025-01-14T13:16:42.5701170Z         no_of_packets,
2025-01-14T13:16:42.5701240Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5701290Z         iteration=0,
2025-01-14T13:16:42.5701340Z     ):
2025-01-14T13:16:42.5701430Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5701500Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5701540Z         else:
2025-01-14T13:16:42.5701600Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5701640Z     
2025-01-14T13:16:42.5701750Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5701820Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5701870Z         )
2025-01-14T13:16:42.5701910Z     
2025-01-14T13:16:42.5702010Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5702100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5702210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5702260Z         else:
2025-01-14T13:16:42.5702330Z             continuum_state = None
2025-01-14T13:16:42.5702410Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5702490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5702560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5702640Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5702720Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5702780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5702850Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5702900Z         ).to_numba(
2025-01-14T13:16:42.5703040Z             macro_atom_state,
2025-01-14T13:16:42.5703110Z             self.line_interaction_type,
2025-01-14T13:16:42.5703150Z         )
2025-01-14T13:16:42.5703230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5703440Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5703490Z         ]
2025-01-14T13:16:42.5703740Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5703740Z 
2025-01-14T13:16:42.5703850Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5703980Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5704310Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5704680Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5704820Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5705230Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5705380Z _______ ERROR at setup of TestSpectrumSolver.test_spectrum_real_packets ________
2025-01-14T13:16:42.5705380Z 
2025-01-14T13:16:42.5705580Z self = <tardis.spectrum.tests.test_spectrum_solver.TestSpectrumSolver object at 0x11a2fe390>
2025-01-14T13:16:42.5705720Z request = <SubRequest 'simulation' for <Function test_initialization>>
2025-01-14T13:16:42.5706240Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5706450Z generate_reference = False
2025-01-14T13:16:42.5706610Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5706610Z 
2025-01-14T13:16:42.5706680Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5706720Z     def simulation(
2025-01-14T13:16:42.5706770Z         self,
2025-01-14T13:16:42.5706810Z         request,
2025-01-14T13:16:42.5706870Z         atomic_data_fname,
2025-01-14T13:16:42.5706920Z         generate_reference,
2025-01-14T13:16:42.5706990Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5707030Z     ):
2025-01-14T13:16:42.5707100Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5707240Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5707290Z         )
2025-01-14T13:16:42.5707350Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5707400Z     
2025-01-14T13:16:42.5707480Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5707540Z >       simulation.run_final()
2025-01-14T13:16:42.5707540Z 
2025-01-14T13:16:42.5707640Z tardis/spectrum/tests/test_spectrum_solver.py:32: 
2025-01-14T13:16:42.5707720Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5707800Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5707910Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5707980Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5708100Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5708180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5708190Z 
2025-01-14T13:16:42.5708390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x305580980>
2025-01-14T13:16:42.5708560Z simulation_state = <tardis.model.base.SimulationState object at 0x305594e90>
2025-01-14T13:16:42.5708730Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31639d1c0>
2025-01-14T13:16:42.5708950Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x31639fb60>
2025-01-14T13:16:42.5709140Z plasma = <tardis.plasma.base.BasePlasma object at 0x3054a1790>
2025-01-14T13:16:42.5709250Z no_of_packets = 500000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5709250Z 
2025-01-14T13:16:42.5709320Z     def initialize_transport_state(
2025-01-14T13:16:42.5709370Z         self,
2025-01-14T13:16:42.5709420Z         simulation_state,
2025-01-14T13:16:42.5709470Z         opacity_state,
2025-01-14T13:16:42.5709520Z         macro_atom_state,
2025-01-14T13:16:42.5709560Z         plasma,
2025-01-14T13:16:42.5709610Z         no_of_packets,
2025-01-14T13:16:42.5709670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5709710Z         iteration=0,
2025-01-14T13:16:42.5709760Z     ):
2025-01-14T13:16:42.5709850Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5709920Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5709970Z         else:
2025-01-14T13:16:42.5710020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5710060Z     
2025-01-14T13:16:42.5710170Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5710240Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5710290Z         )
2025-01-14T13:16:42.5710330Z     
2025-01-14T13:16:42.5710430Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5710510Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5710630Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5710680Z         else:
2025-01-14T13:16:42.5710740Z             continuum_state = None
2025-01-14T13:16:42.5710830Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5710910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5710990Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5711170Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5711250Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5711320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5711390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5711430Z         ).to_numba(
2025-01-14T13:16:42.5711490Z             macro_atom_state,
2025-01-14T13:16:42.5711550Z             self.line_interaction_type,
2025-01-14T13:16:42.5711600Z         )
2025-01-14T13:16:42.5711670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5711890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5711930Z         ]
2025-01-14T13:16:42.5712190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5712200Z 
2025-01-14T13:16:42.5712320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5712480Z __ ERROR at setup of TestSpectrumSolver.test_spectrum_real_packets_reabsorbed __
2025-01-14T13:16:42.5712480Z 
2025-01-14T13:16:42.5712680Z self = <tardis.spectrum.tests.test_spectrum_solver.TestSpectrumSolver object at 0x11a2fe390>
2025-01-14T13:16:42.5712820Z request = <SubRequest 'simulation' for <Function test_initialization>>
2025-01-14T13:16:42.5713130Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5713190Z generate_reference = False
2025-01-14T13:16:42.5713350Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5713360Z 
2025-01-14T13:16:42.5713430Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5713490Z     def simulation(
2025-01-14T13:16:42.5713540Z         self,
2025-01-14T13:16:42.5713580Z         request,
2025-01-14T13:16:42.5713630Z         atomic_data_fname,
2025-01-14T13:16:42.5713690Z         generate_reference,
2025-01-14T13:16:42.5713760Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5713890Z     ):
2025-01-14T13:16:42.5713970Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5714120Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5714170Z         )
2025-01-14T13:16:42.5714240Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5714290Z     
2025-01-14T13:16:42.5714380Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5714460Z >       simulation.run_final()
2025-01-14T13:16:42.5714460Z 
2025-01-14T13:16:42.5714560Z tardis/spectrum/tests/test_spectrum_solver.py:32: 
2025-01-14T13:16:42.5714640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5714730Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5714870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5714950Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5715060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5715180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5715190Z 
2025-01-14T13:16:42.5715430Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x305580980>
2025-01-14T13:16:42.5715620Z simulation_state = <tardis.model.base.SimulationState object at 0x305594e90>
2025-01-14T13:16:42.5715820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31639d1c0>
2025-01-14T13:16:42.5716050Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x31639fb60>
2025-01-14T13:16:42.5716190Z plasma = <tardis.plasma.base.BasePlasma object at 0x3054a1790>
2025-01-14T13:16:42.5716320Z no_of_packets = 500000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5716320Z 
2025-01-14T13:16:42.5716500Z     def initialize_transport_state(
2025-01-14T13:16:42.5716560Z         self,
2025-01-14T13:16:42.5716640Z         simulation_state,
2025-01-14T13:16:42.5716710Z         opacity_state,
2025-01-14T13:16:42.5716790Z         macro_atom_state,
2025-01-14T13:16:42.5716850Z         plasma,
2025-01-14T13:16:42.5716920Z         no_of_packets,
2025-01-14T13:16:42.5716970Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5717020Z         iteration=0,
2025-01-14T13:16:42.5717080Z     ):
2025-01-14T13:16:42.5717210Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5717310Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5717370Z         else:
2025-01-14T13:16:42.5717450Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5717510Z     
2025-01-14T13:16:42.5717650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5717750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5717810Z         )
2025-01-14T13:16:42.5717860Z     
2025-01-14T13:16:42.5717990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5718100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5718260Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5718320Z         else:
2025-01-14T13:16:42.5718400Z             continuum_state = None
2025-01-14T13:16:42.5718480Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5718570Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5718650Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5718750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5718850Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5718930Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5719020Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5719080Z         ).to_numba(
2025-01-14T13:16:42.5719160Z             macro_atom_state,
2025-01-14T13:16:42.5719240Z             self.line_interaction_type,
2025-01-14T13:16:42.5719300Z         )
2025-01-14T13:16:42.5719690Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5719950Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5720000Z         ]
2025-01-14T13:16:42.5720290Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5720300Z 
2025-01-14T13:16:42.5720440Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5720600Z _______________ ERROR at setup of TestSpectrumSolver.test_solve ________________
2025-01-14T13:16:42.5720600Z 
2025-01-14T13:16:42.5720810Z self = <tardis.spectrum.tests.test_spectrum_solver.TestSpectrumSolver object at 0x11a2fe390>
2025-01-14T13:16:42.5720980Z request = <SubRequest 'simulation' for <Function test_initialization>>
2025-01-14T13:16:42.5721330Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5721410Z generate_reference = False
2025-01-14T13:16:42.5721580Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5721580Z 
2025-01-14T13:16:42.5721640Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5721710Z     def simulation(
2025-01-14T13:16:42.5721780Z         self,
2025-01-14T13:16:42.5721840Z         request,
2025-01-14T13:16:42.5721910Z         atomic_data_fname,
2025-01-14T13:16:42.5721990Z         generate_reference,
2025-01-14T13:16:42.5722080Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5722130Z     ):
2025-01-14T13:16:42.5722210Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5722370Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5722440Z         )
2025-01-14T13:16:42.5722510Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5723100Z     
2025-01-14T13:16:42.5723210Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5723290Z >       simulation.run_final()
2025-01-14T13:16:42.5723290Z 
2025-01-14T13:16:42.5723390Z tardis/spectrum/tests/test_spectrum_solver.py:32: 
2025-01-14T13:16:42.5723510Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5723610Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.5723740Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5723840Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5723990Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5724100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5724110Z 
2025-01-14T13:16:42.5724340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x305580980>
2025-01-14T13:16:42.5724540Z simulation_state = <tardis.model.base.SimulationState object at 0x305594e90>
2025-01-14T13:16:42.5724750Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x31639d1c0>
2025-01-14T13:16:42.5725010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x31639fb60>
2025-01-14T13:16:42.5725160Z plasma = <tardis.plasma.base.BasePlasma object at 0x3054a1790>
2025-01-14T13:16:42.5725300Z no_of_packets = 500000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.5725310Z 
2025-01-14T13:16:42.5725390Z     def initialize_transport_state(
2025-01-14T13:16:42.5725440Z         self,
2025-01-14T13:16:42.5725510Z         simulation_state,
2025-01-14T13:16:42.5725580Z         opacity_state,
2025-01-14T13:16:42.5725630Z         macro_atom_state,
2025-01-14T13:16:42.5725680Z         plasma,
2025-01-14T13:16:42.5725740Z         no_of_packets,
2025-01-14T13:16:42.5725810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5725880Z         iteration=0,
2025-01-14T13:16:42.5725940Z     ):
2025-01-14T13:16:42.5726070Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5726300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5726360Z         else:
2025-01-14T13:16:42.5726430Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5726490Z     
2025-01-14T13:16:42.5726630Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5726720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5726780Z         )
2025-01-14T13:16:42.5726840Z     
2025-01-14T13:16:42.5726960Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5727080Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5727230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5727300Z         else:
2025-01-14T13:16:42.5727370Z             continuum_state = None
2025-01-14T13:16:42.5727450Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5727570Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5727660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5727770Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5727860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5727940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5728030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5728090Z         ).to_numba(
2025-01-14T13:16:42.5728160Z             macro_atom_state,
2025-01-14T13:16:42.5728240Z             self.line_interaction_type,
2025-01-14T13:16:42.5728300Z         )
2025-01-14T13:16:42.5728400Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5728660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5728710Z         ]
2025-01-14T13:16:42.5728970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5729090Z 
2025-01-14T13:16:42.5729230Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5730510Z _________ ERROR at setup of TestTransportSimple.test_j_blue_estimators _________
2025-01-14T13:16:42.5730640Z 
2025-01-14T13:16:42.5731280Z self = <tardis.tests.test_tardis_full.TestTransportSimple object at 0x118c14560>
2025-01-14T13:16:42.5731760Z request = <SubRequest 'simulation' for <Function test_j_blue_estimators>>
2025-01-14T13:16:42.5732710Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5732940Z generate_reference = False
2025-01-14T13:16:42.5733430Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5733450Z 
2025-01-14T13:16:42.5733670Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5733870Z     def simulation(
2025-01-14T13:16:42.5734090Z         self,
2025-01-14T13:16:42.5734280Z         request,
2025-01-14T13:16:42.5734490Z         atomic_data_fname,
2025-01-14T13:16:42.5734720Z         generate_reference,
2025-01-14T13:16:42.5734980Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5735150Z     ):
2025-01-14T13:16:42.5735370Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5735820Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5736020Z         )
2025-01-14T13:16:42.5736230Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5736370Z     
2025-01-14T13:16:42.5736590Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5736780Z >       simulation.run_convergence()
2025-01-14T13:16:42.5736780Z 
2025-01-14T13:16:42.5736970Z tardis/tests/test_tardis_full.py:54: 
2025-01-14T13:16:42.5737250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5737550Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5737870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5739120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5739270Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5739360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5739370Z 
2025-01-14T13:16:42.5739580Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ec42930>
2025-01-14T13:16:42.5739750Z simulation_state = <tardis.model.base.SimulationState object at 0x31bd20d70>
2025-01-14T13:16:42.5739940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310c2e300>
2025-01-14T13:16:42.5740170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e353e60>
2025-01-14T13:16:42.5740290Z plasma = <tardis.plasma.base.BasePlasma object at 0x312a20650>
2025-01-14T13:16:42.5740430Z no_of_packets = 200000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5740430Z 
2025-01-14T13:16:42.5740500Z     def initialize_transport_state(
2025-01-14T13:16:42.5740550Z         self,
2025-01-14T13:16:42.5740610Z         simulation_state,
2025-01-14T13:16:42.5740660Z         opacity_state,
2025-01-14T13:16:42.5740710Z         macro_atom_state,
2025-01-14T13:16:42.5740760Z         plasma,
2025-01-14T13:16:42.5740810Z         no_of_packets,
2025-01-14T13:16:42.5740870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5740920Z         iteration=0,
2025-01-14T13:16:42.5740960Z     ):
2025-01-14T13:16:42.5741070Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5741140Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5741190Z         else:
2025-01-14T13:16:42.5741250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5741290Z     
2025-01-14T13:16:42.5741400Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5741600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5741650Z         )
2025-01-14T13:16:42.5741690Z     
2025-01-14T13:16:42.5741800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5741890Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5742020Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5742070Z         else:
2025-01-14T13:16:42.5742130Z             continuum_state = None
2025-01-14T13:16:42.5742200Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5742290Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5742360Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5742450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5742530Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5742600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5742670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5742720Z         ).to_numba(
2025-01-14T13:16:42.5742770Z             macro_atom_state,
2025-01-14T13:16:42.5742840Z             self.line_interaction_type,
2025-01-14T13:16:42.5742890Z         )
2025-01-14T13:16:42.5742970Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5743220Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5743270Z         ]
2025-01-14T13:16:42.5743540Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5743550Z 
2025-01-14T13:16:42.5743670Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5743800Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5744210Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5749800Z 	
2025-01-14T13:16:42.5750360Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.5750750Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5751140Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.5751310Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5751760Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.5752000Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5752410Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5752590Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5752800Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.5752970Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5753040Z 	
2025-01-14T13:16:42.5753190Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.5753340Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5753480Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.5753800Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.5754150Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.5754550Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.5755130Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5755350Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.5755450Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.5755530Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.5755700Z _____________ ERROR at setup of TestTransportSimple.test_spectrum ______________
2025-01-14T13:16:42.5755710Z 
2025-01-14T13:16:42.5755890Z self = <tardis.tests.test_tardis_full.TestTransportSimple object at 0x118c14560>
2025-01-14T13:16:42.5756050Z request = <SubRequest 'simulation' for <Function test_j_blue_estimators>>
2025-01-14T13:16:42.5756390Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5756470Z generate_reference = False
2025-01-14T13:16:42.5756650Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5756660Z 
2025-01-14T13:16:42.5756740Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5756800Z     def simulation(
2025-01-14T13:16:42.5756860Z         self,
2025-01-14T13:16:42.5756910Z         request,
2025-01-14T13:16:42.5756960Z         atomic_data_fname,
2025-01-14T13:16:42.5757020Z         generate_reference,
2025-01-14T13:16:42.5757100Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5757140Z     ):
2025-01-14T13:16:42.5757210Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5757370Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5757420Z         )
2025-01-14T13:16:42.5757480Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5757530Z     
2025-01-14T13:16:42.5757610Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5757670Z >       simulation.run_convergence()
2025-01-14T13:16:42.5757680Z 
2025-01-14T13:16:42.5757740Z tardis/tests/test_tardis_full.py:54: 
2025-01-14T13:16:42.5757830Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5758200Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5758320Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5758380Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5758510Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5758610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5758620Z 
2025-01-14T13:16:42.5758840Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ec42930>
2025-01-14T13:16:42.5759010Z simulation_state = <tardis.model.base.SimulationState object at 0x31bd20d70>
2025-01-14T13:16:42.5759180Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310c2e300>
2025-01-14T13:16:42.5759410Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e353e60>
2025-01-14T13:16:42.5759540Z plasma = <tardis.plasma.base.BasePlasma object at 0x312a20650>
2025-01-14T13:16:42.5759660Z no_of_packets = 200000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5759660Z 
2025-01-14T13:16:42.5759730Z     def initialize_transport_state(
2025-01-14T13:16:42.5759780Z         self,
2025-01-14T13:16:42.5759830Z         simulation_state,
2025-01-14T13:16:42.5759900Z         opacity_state,
2025-01-14T13:16:42.5759970Z         macro_atom_state,
2025-01-14T13:16:42.5760030Z         plasma,
2025-01-14T13:16:42.5760080Z         no_of_packets,
2025-01-14T13:16:42.5760160Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5760220Z         iteration=0,
2025-01-14T13:16:42.5760280Z     ):
2025-01-14T13:16:42.5760380Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5760450Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5760720Z         else:
2025-01-14T13:16:42.5760790Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5760830Z     
2025-01-14T13:16:42.5760940Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5761010Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5761060Z         )
2025-01-14T13:16:42.5761100Z     
2025-01-14T13:16:42.5761200Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5761290Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5761410Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5761460Z         else:
2025-01-14T13:16:42.5761520Z             continuum_state = None
2025-01-14T13:16:42.5761590Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5761680Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5761740Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5761830Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5761910Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5761980Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5762040Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5762090Z         ).to_numba(
2025-01-14T13:16:42.5762140Z             macro_atom_state,
2025-01-14T13:16:42.5762200Z             self.line_interaction_type,
2025-01-14T13:16:42.5762250Z         )
2025-01-14T13:16:42.5762320Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5762550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5762590Z         ]
2025-01-14T13:16:42.5762840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5762840Z 
2025-01-14T13:16:42.5762970Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5763150Z _________ ERROR at setup of TestTransportSimple.test_virtual_spectrum __________
2025-01-14T13:16:42.5763290Z 
2025-01-14T13:16:42.5763460Z self = <tardis.tests.test_tardis_full.TestTransportSimple object at 0x118c14560>
2025-01-14T13:16:42.5763610Z request = <SubRequest 'simulation' for <Function test_j_blue_estimators>>
2025-01-14T13:16:42.5763910Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5763980Z generate_reference = False
2025-01-14T13:16:42.5764150Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.5764150Z 
2025-01-14T13:16:42.5764210Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5764270Z     def simulation(
2025-01-14T13:16:42.5764310Z         self,
2025-01-14T13:16:42.5764360Z         request,
2025-01-14T13:16:42.5764410Z         atomic_data_fname,
2025-01-14T13:16:42.5764470Z         generate_reference,
2025-01-14T13:16:42.5764540Z         example_configuration_dir: Path,
2025-01-14T13:16:42.5764580Z     ):
2025-01-14T13:16:42.5764650Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.5764790Z             str(example_configuration_dir / "tardis_configv1_verysimple.yml")
2025-01-14T13:16:42.5764830Z         )
2025-01-14T13:16:42.5764900Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.5764950Z     
2025-01-14T13:16:42.5765030Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5765090Z >       simulation.run_convergence()
2025-01-14T13:16:42.5765090Z 
2025-01-14T13:16:42.5765160Z tardis/tests/test_tardis_full.py:54: 
2025-01-14T13:16:42.5765250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5765330Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5765450Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5765520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5765730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5766670Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5766690Z 
2025-01-14T13:16:42.5766930Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ec42930>
2025-01-14T13:16:42.5767090Z simulation_state = <tardis.model.base.SimulationState object at 0x31bd20d70>
2025-01-14T13:16:42.5767270Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310c2e300>
2025-01-14T13:16:42.5767500Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e353e60>
2025-01-14T13:16:42.5767620Z plasma = <tardis.plasma.base.BasePlasma object at 0x312a20650>
2025-01-14T13:16:42.5767730Z no_of_packets = 200000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5767740Z 
2025-01-14T13:16:42.5767800Z     def initialize_transport_state(
2025-01-14T13:16:42.5767850Z         self,
2025-01-14T13:16:42.5767910Z         simulation_state,
2025-01-14T13:16:42.5767960Z         opacity_state,
2025-01-14T13:16:42.5768010Z         macro_atom_state,
2025-01-14T13:16:42.5768060Z         plasma,
2025-01-14T13:16:42.5768110Z         no_of_packets,
2025-01-14T13:16:42.5768170Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5768220Z         iteration=0,
2025-01-14T13:16:42.5768260Z     ):
2025-01-14T13:16:42.5768360Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5768430Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5768480Z         else:
2025-01-14T13:16:42.5768530Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5768590Z     
2025-01-14T13:16:42.5768700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5768770Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5768820Z         )
2025-01-14T13:16:42.5768860Z     
2025-01-14T13:16:42.5768980Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5769080Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5769210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5769410Z         else:
2025-01-14T13:16:42.5769470Z             continuum_state = None
2025-01-14T13:16:42.5769540Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5769630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5769700Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5769790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5769880Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5769960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5770030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5770070Z         ).to_numba(
2025-01-14T13:16:42.5770130Z             macro_atom_state,
2025-01-14T13:16:42.5770190Z             self.line_interaction_type,
2025-01-14T13:16:42.5770240Z         )
2025-01-14T13:16:42.5770320Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5770540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5770580Z         ]
2025-01-14T13:16:42.5770830Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5770840Z 
2025-01-14T13:16:42.5770950Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5774400Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_simulation[-1-downbranch] _
2025-01-14T13:16:42.5774420Z 
2025-01-14T13:16:42.5774720Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5775250Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5775780Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5775780Z 
2025-01-14T13:16:42.5775850Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5775950Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5776020Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5776070Z     
2025-01-14T13:16:42.5776200Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5776340Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5776400Z             self.name += "_interp"
2025-01-14T13:16:42.5776440Z     
2025-01-14T13:16:42.5776540Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5776620Z >       simulation.run_convergence()
2025-01-14T13:16:42.5776620Z 
2025-01-14T13:16:42.5776730Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5776830Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5776920Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5777060Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5777140Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5777260Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5777350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5777360Z 
2025-01-14T13:16:42.5777570Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155f6a5a0>
2025-01-14T13:16:42.5777720Z simulation_state = <tardis.model.base.SimulationState object at 0x309d34b30>
2025-01-14T13:16:42.5777940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x155f56c60>
2025-01-14T13:16:42.5778170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x155f56960>
2025-01-14T13:16:42.5778400Z plasma = <tardis.plasma.base.BasePlasma object at 0x146ccb1a0>
2025-01-14T13:16:42.5778510Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5778510Z 
2025-01-14T13:16:42.5778570Z     def initialize_transport_state(
2025-01-14T13:16:42.5778620Z         self,
2025-01-14T13:16:42.5778670Z         simulation_state,
2025-01-14T13:16:42.5778730Z         opacity_state,
2025-01-14T13:16:42.5778780Z         macro_atom_state,
2025-01-14T13:16:42.5778820Z         plasma,
2025-01-14T13:16:42.5778870Z         no_of_packets,
2025-01-14T13:16:42.5778950Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5779000Z         iteration=0,
2025-01-14T13:16:42.5779040Z     ):
2025-01-14T13:16:42.5779140Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5779220Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5779270Z         else:
2025-01-14T13:16:42.5779340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5779390Z     
2025-01-14T13:16:42.5779500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5779570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5779630Z         )
2025-01-14T13:16:42.5779670Z     
2025-01-14T13:16:42.5779770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5779880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5780030Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5780080Z         else:
2025-01-14T13:16:42.5780140Z             continuum_state = None
2025-01-14T13:16:42.5780220Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5780300Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5780370Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5780540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5780650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5780730Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5780790Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5780840Z         ).to_numba(
2025-01-14T13:16:42.5780900Z             macro_atom_state,
2025-01-14T13:16:42.5780970Z             self.line_interaction_type,
2025-01-14T13:16:42.5781020Z         )
2025-01-14T13:16:42.5781110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5781360Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5781420Z         ]
2025-01-14T13:16:42.5781690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5781700Z 
2025-01-14T13:16:42.5781830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5781980Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5787470Z config {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Quantity 13. d>, 'luminosity_wavelength_start': <Quantity 0. Angstrom>, 'luminosity_wavelength_end': <Quantity inf Angstrom>}, 'atom_data': 'kurucz_cd23_chianti_H_He.h5', 'model': {'structure': {'type': 'specific', 'velocity': {'start': <Quantity 11000. km / s>, 'stop': <Quantity 20000. km / s>, 'num': 20}, 'density': {'type': 'branch85_w7', 'w7_time_0': <Quantity 0.00023148 d>, 'w7_rho_0': <Quantity 3.e+29 g / cm3>, 'w7_v_0': <Quantity 1. km / s>}}, 'abundances': {'type': 'uniform', 'O': 0.19, 'Mg': 0.03, 'Si': 0.52, 'S': 0.19, 'Ar': 0.04, 'Ca': 0.03, 'model_isotope_time_0': <Quantity 0. s>}}, 'plasma': {'ionization': 'lte', 'excitation': 'lte', 'radiative_rates_type': 'dilute-blackbody', 'line_interaction_type': 'downbranch', 'initial_t_inner': <Quantity -1. K>, 'initial_t_rad': <Quantity -1. K>, 'disable_electron_scattering': False, 'disable_line_scattering': False, 'w_epsilon': 1e-10, 'nlte': {'species': [], 'coronal_approximation': False, 'classical_nebular': False}, 'continuum_interaction': {'species': [], 'enable_adiabatic_cooling': False, 'enable_two_photon_decay': False}, 'helium_treatment': 'none', 'heating_rate_data_file': 'none', 'link_t_rad_t_electron': 0.9, 'nlte_ionization_species': [], 'nlte_excitation_species': [], 'nlte_solver': 'root'}, 'montecarlo': {'seed': 23111963, 'no_of_packets': 40000.0, 'iterations': 5, 'last_no_of_packets': 100000.0, 'no_of_virtual_packets': 0, 'convergence_strategy': {'type': 'damped', 'damping_constant': 0.5, 'threshold': 0.05, 'lock_t_inner_cycles': 1, 't_inner_update_exponent': -0.5, 'stop_if_converged': False, 'fraction': 0.8, 'hold_iterations': 3, 't_inner': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 't_rad': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 'w': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}}, 'nthreads': 1, 'virtual_spectrum_spawn_range': {'start': <Quantity 1. Angstrom>, 'end': <Quantity inf Angstrom>}, 'enable_full_relativity': False, 'enable_nonhomologous_expansion': False, 'tracking': {'track_rpacket': False, 'initial_array_length': 10}, 'debug_packets': False, 'logger_buffer': 1}, 'spectrum': {'start': <Quantity 500. Angstrom>, 'stop': <Quantity 20000. Angstrom>, 'num': 10000, 'virtual': {'virtual_packet_logging': True, 'tau_russian': 10.0, 'survival_probability': 0.0, 'enable_biasing': False}, 'method': 'integrated', 'integrated': {'points': 200, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5788450Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5788520Z 	
2025-01-14T13:16:42.5788990Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.5789420Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5789780Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.5789910Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5790290Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.5790520Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5790890Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5791080Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5791260Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.5791380Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5791430Z 	
2025-01-14T13:16:42.5791550Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.5791700Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5791850Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.5792130Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.5792460Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.5792850Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.5793290Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5793500Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.5793730Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.5793790Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.5794020Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_j_blue_estimators[-1-downbranch] _
2025-01-14T13:16:42.5794020Z 
2025-01-14T13:16:42.5794280Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5794770Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5795100Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5795110Z 
2025-01-14T13:16:42.5795170Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5795260Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5795340Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5795380Z     
2025-01-14T13:16:42.5795520Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5795630Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5795680Z             self.name += "_interp"
2025-01-14T13:16:42.5795730Z     
2025-01-14T13:16:42.5795800Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5795870Z >       simulation.run_convergence()
2025-01-14T13:16:42.5795880Z 
2025-01-14T13:16:42.5795990Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5796090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5796170Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5796380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5796460Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5796590Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5796670Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5796680Z 
2025-01-14T13:16:42.5796910Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155f6a5a0>
2025-01-14T13:16:42.5797080Z simulation_state = <tardis.model.base.SimulationState object at 0x309d34b30>
2025-01-14T13:16:42.5797250Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x155f56c60>
2025-01-14T13:16:42.5797470Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x155f56960>
2025-01-14T13:16:42.5797590Z plasma = <tardis.plasma.base.BasePlasma object at 0x146ccb1a0>
2025-01-14T13:16:42.5797710Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5797730Z 
2025-01-14T13:16:42.5797790Z     def initialize_transport_state(
2025-01-14T13:16:42.5797850Z         self,
2025-01-14T13:16:42.5797900Z         simulation_state,
2025-01-14T13:16:42.5797960Z         opacity_state,
2025-01-14T13:16:42.5798010Z         macro_atom_state,
2025-01-14T13:16:42.5798060Z         plasma,
2025-01-14T13:16:42.5798110Z         no_of_packets,
2025-01-14T13:16:42.5798170Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5798220Z         iteration=0,
2025-01-14T13:16:42.5798270Z     ):
2025-01-14T13:16:42.5798360Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5798430Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5798480Z         else:
2025-01-14T13:16:42.5798530Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5798580Z     
2025-01-14T13:16:42.5798680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5798760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5798810Z         )
2025-01-14T13:16:42.5798850Z     
2025-01-14T13:16:42.5798950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5799130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5799260Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5799300Z         else:
2025-01-14T13:16:42.5799370Z             continuum_state = None
2025-01-14T13:16:42.5799440Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5799530Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5799590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5799680Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5799750Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5799820Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5799880Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5799930Z         ).to_numba(
2025-01-14T13:16:42.5799980Z             macro_atom_state,
2025-01-14T13:16:42.5800040Z             self.line_interaction_type,
2025-01-14T13:16:42.5800090Z         )
2025-01-14T13:16:42.5800170Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5800390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5800440Z         ]
2025-01-14T13:16:42.5800690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5800690Z 
2025-01-14T13:16:42.5800810Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5801000Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum[-1-downbranch] _
2025-01-14T13:16:42.5801000Z 
2025-01-14T13:16:42.5801990Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5807290Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5807600Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5807610Z 
2025-01-14T13:16:42.5807660Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5807750Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5807830Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5807890Z     
2025-01-14T13:16:42.5808030Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5808140Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5808200Z             self.name += "_interp"
2025-01-14T13:16:42.5808240Z     
2025-01-14T13:16:42.5808330Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5808390Z >       simulation.run_convergence()
2025-01-14T13:16:42.5808400Z 
2025-01-14T13:16:42.5808500Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5808590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5808680Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5808790Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5808860Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5808980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5809070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5809070Z 
2025-01-14T13:16:42.5809280Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155f6a5a0>
2025-01-14T13:16:42.5809460Z simulation_state = <tardis.model.base.SimulationState object at 0x309d34b30>
2025-01-14T13:16:42.5809660Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x155f56c60>
2025-01-14T13:16:42.5810020Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x155f56960>
2025-01-14T13:16:42.5810150Z plasma = <tardis.plasma.base.BasePlasma object at 0x146ccb1a0>
2025-01-14T13:16:42.5810260Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5810270Z 
2025-01-14T13:16:42.5810330Z     def initialize_transport_state(
2025-01-14T13:16:42.5810380Z         self,
2025-01-14T13:16:42.5810440Z         simulation_state,
2025-01-14T13:16:42.5810490Z         opacity_state,
2025-01-14T13:16:42.5810540Z         macro_atom_state,
2025-01-14T13:16:42.5810580Z         plasma,
2025-01-14T13:16:42.5810640Z         no_of_packets,
2025-01-14T13:16:42.5810700Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5810750Z         iteration=0,
2025-01-14T13:16:42.5810790Z     ):
2025-01-14T13:16:42.5810890Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5810970Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5811030Z         else:
2025-01-14T13:16:42.5811090Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5811130Z     
2025-01-14T13:16:42.5811240Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5811330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5811380Z         )
2025-01-14T13:16:42.5811420Z     
2025-01-14T13:16:42.5811530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5811620Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5811750Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5811790Z         else:
2025-01-14T13:16:42.5811860Z             continuum_state = None
2025-01-14T13:16:42.5811930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5812020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5812160Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5812260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5812810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5812900Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5812970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5813010Z         ).to_numba(
2025-01-14T13:16:42.5813070Z             macro_atom_state,
2025-01-14T13:16:42.5813130Z             self.line_interaction_type,
2025-01-14T13:16:42.5813180Z         )
2025-01-14T13:16:42.5813250Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5813490Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5813530Z         ]
2025-01-14T13:16:42.5813800Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5813810Z 
2025-01-14T13:16:42.5813920Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5814150Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum_integrated[-1-downbranch] _
2025-01-14T13:16:42.5814150Z 
2025-01-14T13:16:42.5814440Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5814930Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5815230Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5815230Z 
2025-01-14T13:16:42.5815300Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5815390Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5815460Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5815500Z     
2025-01-14T13:16:42.5816010Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5816120Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5816170Z             self.name += "_interp"
2025-01-14T13:16:42.5816220Z     
2025-01-14T13:16:42.5816300Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5816360Z >       simulation.run_convergence()
2025-01-14T13:16:42.5816360Z 
2025-01-14T13:16:42.5816480Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5816570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5816670Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5816790Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5816860Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5816980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5817070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5817080Z 
2025-01-14T13:16:42.5817300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155f6a5a0>
2025-01-14T13:16:42.5817460Z simulation_state = <tardis.model.base.SimulationState object at 0x309d34b30>
2025-01-14T13:16:42.5817640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x155f56c60>
2025-01-14T13:16:42.5817870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x155f56960>
2025-01-14T13:16:42.5818010Z plasma = <tardis.plasma.base.BasePlasma object at 0x146ccb1a0>
2025-01-14T13:16:42.5818110Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5818120Z 
2025-01-14T13:16:42.5818190Z     def initialize_transport_state(
2025-01-14T13:16:42.5818500Z         self,
2025-01-14T13:16:42.5818550Z         simulation_state,
2025-01-14T13:16:42.5818600Z         opacity_state,
2025-01-14T13:16:42.5818650Z         macro_atom_state,
2025-01-14T13:16:42.5818710Z         plasma,
2025-01-14T13:16:42.5818750Z         no_of_packets,
2025-01-14T13:16:42.5818810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5818860Z         iteration=0,
2025-01-14T13:16:42.5818910Z     ):
2025-01-14T13:16:42.5819000Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5819080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5819120Z         else:
2025-01-14T13:16:42.5819170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5819220Z     
2025-01-14T13:16:42.5819320Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5819390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5819440Z         )
2025-01-14T13:16:42.5819480Z     
2025-01-14T13:16:42.5819580Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5819670Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5819800Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5819840Z         else:
2025-01-14T13:16:42.5819900Z             continuum_state = None
2025-01-14T13:16:42.5819980Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5820060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5820130Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5820210Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5820280Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5820350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5820410Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5820460Z         ).to_numba(
2025-01-14T13:16:42.5820510Z             macro_atom_state,
2025-01-14T13:16:42.5820570Z             self.line_interaction_type,
2025-01-14T13:16:42.5820610Z         )
2025-01-14T13:16:42.5820690Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5820970Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5821020Z         ]
2025-01-14T13:16:42.5821280Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5821290Z 
2025-01-14T13:16:42.5821400Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5821590Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_simulation[-1-macroatom] _
2025-01-14T13:16:42.5821590Z 
2025-01-14T13:16:42.5821840Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5822320Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5822640Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5822640Z 
2025-01-14T13:16:42.5822710Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5822800Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5822870Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5822920Z     
2025-01-14T13:16:42.5823070Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5823180Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5823230Z             self.name += "_interp"
2025-01-14T13:16:42.5823280Z     
2025-01-14T13:16:42.5823350Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5823430Z >       simulation.run_convergence()
2025-01-14T13:16:42.5823530Z 
2025-01-14T13:16:42.5823630Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5823720Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5823810Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5823930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5824000Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5824130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5824210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5824210Z 
2025-01-14T13:16:42.5824420Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306ed20>
2025-01-14T13:16:42.5824590Z simulation_state = <tardis.model.base.SimulationState object at 0x1718e0560>
2025-01-14T13:16:42.5824770Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17314b800>
2025-01-14T13:16:42.5825000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17314b200>
2025-01-14T13:16:42.5825120Z plasma = <tardis.plasma.base.BasePlasma object at 0x155fe5fa0>
2025-01-14T13:16:42.5825240Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5825240Z 
2025-01-14T13:16:42.5825300Z     def initialize_transport_state(
2025-01-14T13:16:42.5825350Z         self,
2025-01-14T13:16:42.5825400Z         simulation_state,
2025-01-14T13:16:42.5825450Z         opacity_state,
2025-01-14T13:16:42.5825500Z         macro_atom_state,
2025-01-14T13:16:42.5831040Z         plasma,
2025-01-14T13:16:42.5831160Z         no_of_packets,
2025-01-14T13:16:42.5831220Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5831270Z         iteration=0,
2025-01-14T13:16:42.5831310Z     ):
2025-01-14T13:16:42.5831420Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5831490Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5831550Z         else:
2025-01-14T13:16:42.5831610Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5831910Z     
2025-01-14T13:16:42.5832020Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5832090Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5832130Z         )
2025-01-14T13:16:42.5832170Z     
2025-01-14T13:16:42.5832270Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5832360Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5832480Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5832530Z         else:
2025-01-14T13:16:42.5832590Z             continuum_state = None
2025-01-14T13:16:42.5832670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5832750Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5832820Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5832900Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5832970Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5833050Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5833110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5833160Z         ).to_numba(
2025-01-14T13:16:42.5833210Z             macro_atom_state,
2025-01-14T13:16:42.5833280Z             self.line_interaction_type,
2025-01-14T13:16:42.5833320Z         )
2025-01-14T13:16:42.5833400Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5833610Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5833660Z         ]
2025-01-14T13:16:42.5833930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5833940Z 
2025-01-14T13:16:42.5834050Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5834300Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5839620Z config {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Quantity 13. d>, 'luminosity_wavelength_start': <Quantity 0. Angstrom>, 'luminosity_wavelength_end': <Quantity inf Angstrom>}, 'atom_data': 'kurucz_cd23_chianti_H_He.h5', 'model': {'structure': {'type': 'specific', 'velocity': {'start': <Quantity 11000. km / s>, 'stop': <Quantity 20000. km / s>, 'num': 20}, 'density': {'type': 'branch85_w7', 'w7_time_0': <Quantity 0.00023148 d>, 'w7_rho_0': <Quantity 3.e+29 g / cm3>, 'w7_v_0': <Quantity 1. km / s>}}, 'abundances': {'type': 'uniform', 'O': 0.19, 'Mg': 0.03, 'Si': 0.52, 'S': 0.19, 'Ar': 0.04, 'Ca': 0.03, 'model_isotope_time_0': <Quantity 0. s>}}, 'plasma': {'ionization': 'lte', 'excitation': 'lte', 'radiative_rates_type': 'dilute-blackbody', 'line_interaction_type': 'macroatom', 'initial_t_inner': <Quantity -1. K>, 'initial_t_rad': <Quantity -1. K>, 'disable_electron_scattering': False, 'disable_line_scattering': False, 'w_epsilon': 1e-10, 'nlte': {'species': [], 'coronal_approximation': False, 'classical_nebular': False}, 'continuum_interaction': {'species': [], 'enable_adiabatic_cooling': False, 'enable_two_photon_decay': False}, 'helium_treatment': 'none', 'heating_rate_data_file': 'none', 'link_t_rad_t_electron': 0.9, 'nlte_ionization_species': [], 'nlte_excitation_species': [], 'nlte_solver': 'root'}, 'montecarlo': {'seed': 23111963, 'no_of_packets': 40000.0, 'iterations': 5, 'last_no_of_packets': 100000.0, 'no_of_virtual_packets': 0, 'convergence_strategy': {'type': 'damped', 'damping_constant': 0.5, 'threshold': 0.05, 'lock_t_inner_cycles': 1, 't_inner_update_exponent': -0.5, 'stop_if_converged': False, 'fraction': 0.8, 'hold_iterations': 3, 't_inner': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 't_rad': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 'w': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}}, 'nthreads': 1, 'virtual_spectrum_spawn_range': {'start': <Quantity 1. Angstrom>, 'end': <Quantity inf Angstrom>}, 'enable_full_relativity': False, 'enable_nonhomologous_expansion': False, 'tracking': {'track_rpacket': False, 'initial_array_length': 10}, 'debug_packets': False, 'logger_buffer': 1}, 'spectrum': {'start': <Quantity 500. Angstrom>, 'stop': <Quantity 20000. Angstrom>, 'num': 10000, 'virtual': {'virtual_packet_logging': True, 'tau_russian': 10.0, 'survival_probability': 0.0, 'enable_biasing': False}, 'method': 'integrated', 'integrated': {'points': 200, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5840100Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5840150Z 	
2025-01-14T13:16:42.5840600Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.5840740Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5841090Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.5841220Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5841610Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.5841800Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5842160Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5842330Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5842530Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.5842670Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5842820Z 	
2025-01-14T13:16:42.5842950Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.5843080Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5843200Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.5843490Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.5843800Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.5844170Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.5844600Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5844810Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.5844910Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.5844970Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.5845190Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_j_blue_estimators[-1-macroatom] _
2025-01-14T13:16:42.5845190Z 
2025-01-14T13:16:42.5845440Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5845950Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5846260Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5846270Z 
2025-01-14T13:16:42.5846350Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5846450Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5846850Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5846900Z     
2025-01-14T13:16:42.5847030Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5847150Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5847200Z             self.name += "_interp"
2025-01-14T13:16:42.5847240Z     
2025-01-14T13:16:42.5847320Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5847380Z >       simulation.run_convergence()
2025-01-14T13:16:42.5847390Z 
2025-01-14T13:16:42.5847490Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5847580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5847690Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5847800Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5847880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5848010Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5848100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5848100Z 
2025-01-14T13:16:42.5848300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306ed20>
2025-01-14T13:16:42.5848460Z simulation_state = <tardis.model.base.SimulationState object at 0x1718e0560>
2025-01-14T13:16:42.5848640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17314b800>
2025-01-14T13:16:42.5848860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17314b200>
2025-01-14T13:16:42.5848990Z plasma = <tardis.plasma.base.BasePlasma object at 0x155fe5fa0>
2025-01-14T13:16:42.5849120Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5849630Z 
2025-01-14T13:16:42.5849720Z     def initialize_transport_state(
2025-01-14T13:16:42.5849770Z         self,
2025-01-14T13:16:42.5849830Z         simulation_state,
2025-01-14T13:16:42.5849880Z         opacity_state,
2025-01-14T13:16:42.5849940Z         macro_atom_state,
2025-01-14T13:16:42.5849980Z         plasma,
2025-01-14T13:16:42.5850030Z         no_of_packets,
2025-01-14T13:16:42.5850090Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5850130Z         iteration=0,
2025-01-14T13:16:42.5850180Z     ):
2025-01-14T13:16:42.5850280Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5850350Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5850400Z         else:
2025-01-14T13:16:42.5850450Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5850490Z     
2025-01-14T13:16:42.5850600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5850670Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5850720Z         )
2025-01-14T13:16:42.5850760Z     
2025-01-14T13:16:42.5850870Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5851930Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5852820Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5853030Z         else:
2025-01-14T13:16:42.5853220Z             continuum_state = None
2025-01-14T13:16:42.5853670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5854050Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5854260Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5854720Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5854960Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5855320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5855530Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5855690Z         ).to_numba(
2025-01-14T13:16:42.5855860Z             macro_atom_state,
2025-01-14T13:16:42.5856790Z             self.line_interaction_type,
2025-01-14T13:16:42.5856940Z         )
2025-01-14T13:16:42.5857150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5857780Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5857920Z         ]
2025-01-14T13:16:42.5858610Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5858630Z 
2025-01-14T13:16:42.5858950Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5859440Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum[-1-macroatom] _
2025-01-14T13:16:42.5859450Z 
2025-01-14T13:16:42.5860140Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5861470Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5862290Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5862300Z 
2025-01-14T13:16:42.5862480Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5862730Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5862930Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5863060Z     
2025-01-14T13:16:42.5863420Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5863720Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5863890Z             self.name += "_interp"
2025-01-14T13:16:42.5864020Z     
2025-01-14T13:16:42.5864490Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5864680Z >       simulation.run_convergence()
2025-01-14T13:16:42.5864700Z 
2025-01-14T13:16:42.5864980Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5865220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5865920Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5866950Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5867170Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5867530Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5867780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5867790Z 
2025-01-14T13:16:42.5868370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306ed20>
2025-01-14T13:16:42.5868800Z simulation_state = <tardis.model.base.SimulationState object at 0x1718e0560>
2025-01-14T13:16:42.5869290Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17314b800>
2025-01-14T13:16:42.5869870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17314b200>
2025-01-14T13:16:42.5870210Z plasma = <tardis.plasma.base.BasePlasma object at 0x155fe5fa0>
2025-01-14T13:16:42.5872030Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5872080Z 
2025-01-14T13:16:42.5872220Z     def initialize_transport_state(
2025-01-14T13:16:42.5872270Z         self,
2025-01-14T13:16:42.5872320Z         simulation_state,
2025-01-14T13:16:42.5872380Z         opacity_state,
2025-01-14T13:16:42.5872430Z         macro_atom_state,
2025-01-14T13:16:42.5872510Z         plasma,
2025-01-14T13:16:42.5872590Z         no_of_packets,
2025-01-14T13:16:42.5872660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5872700Z         iteration=0,
2025-01-14T13:16:42.5872750Z     ):
2025-01-14T13:16:42.5872890Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5873020Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5873440Z         else:
2025-01-14T13:16:42.5873510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5873550Z     
2025-01-14T13:16:42.5873670Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5873770Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5873820Z         )
2025-01-14T13:16:42.5873870Z     
2025-01-14T13:16:42.5873980Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5874130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5874260Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5874310Z         else:
2025-01-14T13:16:42.5874400Z             continuum_state = None
2025-01-14T13:16:42.5874530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5874640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5874720Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5874810Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5874900Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5874990Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5875070Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5875960Z         ).to_numba(
2025-01-14T13:16:42.5876440Z             macro_atom_state,
2025-01-14T13:16:42.5877120Z             self.line_interaction_type,
2025-01-14T13:16:42.5877760Z         )
2025-01-14T13:16:42.5878810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5880070Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5880390Z         ]
2025-01-14T13:16:42.5881170Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5882830Z 
2025-01-14T13:16:42.5883770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5884680Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum_integrated[-1-macroatom] _
2025-01-14T13:16:42.5884760Z 
2025-01-14T13:16:42.5886220Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5888240Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': -1, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5889200Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5889220Z 
2025-01-14T13:16:42.5889450Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5889760Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5890050Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5890370Z     
2025-01-14T13:16:42.5890590Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5890710Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5890770Z             self.name += "_interp"
2025-01-14T13:16:42.5890810Z     
2025-01-14T13:16:42.5890920Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5891020Z >       simulation.run_convergence()
2025-01-14T13:16:42.5891030Z 
2025-01-14T13:16:42.5891170Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5891290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5891380Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5892590Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5892880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5893310Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5896100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5896140Z 
2025-01-14T13:16:42.5896820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306ed20>
2025-01-14T13:16:42.5897770Z simulation_state = <tardis.model.base.SimulationState object at 0x1718e0560>
2025-01-14T13:16:42.5898480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17314b800>
2025-01-14T13:16:42.5898790Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17314b200>
2025-01-14T13:16:42.5898950Z plasma = <tardis.plasma.base.BasePlasma object at 0x155fe5fa0>
2025-01-14T13:16:42.5899140Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5899150Z 
2025-01-14T13:16:42.5899220Z     def initialize_transport_state(
2025-01-14T13:16:42.5899300Z         self,
2025-01-14T13:16:42.5899580Z         simulation_state,
2025-01-14T13:16:42.5899670Z         opacity_state,
2025-01-14T13:16:42.5899750Z         macro_atom_state,
2025-01-14T13:16:42.5899810Z         plasma,
2025-01-14T13:16:42.5899880Z         no_of_packets,
2025-01-14T13:16:42.5899980Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5900060Z         iteration=0,
2025-01-14T13:16:42.5900130Z     ):
2025-01-14T13:16:42.5900270Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5900380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5900460Z         else:
2025-01-14T13:16:42.5900520Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5900570Z     
2025-01-14T13:16:42.5900690Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5900780Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5900830Z         )
2025-01-14T13:16:42.5900870Z     
2025-01-14T13:16:42.5901000Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5901450Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5902040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5902110Z         else:
2025-01-14T13:16:42.5902200Z             continuum_state = None
2025-01-14T13:16:42.5902310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5902410Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5903390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5903540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5903630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5903740Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5903840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5903900Z         ).to_numba(
2025-01-14T13:16:42.5903960Z             macro_atom_state,
2025-01-14T13:16:42.5904040Z             self.line_interaction_type,
2025-01-14T13:16:42.5904080Z         )
2025-01-14T13:16:42.5904180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5905540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5905790Z         ]
2025-01-14T13:16:42.5906570Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5906590Z 
2025-01-14T13:16:42.5907710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5908670Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_simulation[30-macroatom] _
2025-01-14T13:16:42.5908700Z 
2025-01-14T13:16:42.5909780Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5911290Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5913210Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5913230Z 
2025-01-14T13:16:42.5913610Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5914110Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5914260Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5914340Z     
2025-01-14T13:16:42.5915730Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5916230Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5916550Z             self.name += "_interp"
2025-01-14T13:16:42.5916610Z     
2025-01-14T13:16:42.5916700Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5916810Z >       simulation.run_convergence()
2025-01-14T13:16:42.5916840Z 
2025-01-14T13:16:42.5916950Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5917440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5917870Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5918260Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5918520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5919710Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5919850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5919850Z 
2025-01-14T13:16:42.5921150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x303068ef0>
2025-01-14T13:16:42.5921430Z simulation_state = <tardis.model.base.SimulationState object at 0x17309be00>
2025-01-14T13:16:42.5921690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030698e0>
2025-01-14T13:16:42.5922960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x303062780>
2025-01-14T13:16:42.5923150Z plasma = <tardis.plasma.base.BasePlasma object at 0x173095280>
2025-01-14T13:16:42.5923770Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5923820Z 
2025-01-14T13:16:42.5924250Z     def initialize_transport_state(
2025-01-14T13:16:42.5924380Z         self,
2025-01-14T13:16:42.5924450Z         simulation_state,
2025-01-14T13:16:42.5924770Z         opacity_state,
2025-01-14T13:16:42.5924890Z         macro_atom_state,
2025-01-14T13:16:42.5924990Z         plasma,
2025-01-14T13:16:42.5925050Z         no_of_packets,
2025-01-14T13:16:42.5925140Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5925240Z         iteration=0,
2025-01-14T13:16:42.5925290Z     ):
2025-01-14T13:16:42.5925390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5925490Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5925570Z         else:
2025-01-14T13:16:42.5925680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5925760Z     
2025-01-14T13:16:42.5925930Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5926040Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5926120Z         )
2025-01-14T13:16:42.5926210Z     
2025-01-14T13:16:42.5926320Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5926910Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5927860Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5928140Z         else:
2025-01-14T13:16:42.5928470Z             continuum_state = None
2025-01-14T13:16:42.5930210Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5930400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5930540Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5930690Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5930780Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5932690Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5933630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5933720Z         ).to_numba(
2025-01-14T13:16:42.5934110Z             macro_atom_state,
2025-01-14T13:16:42.5934210Z             self.line_interaction_type,
2025-01-14T13:16:42.5934290Z         )
2025-01-14T13:16:42.5934580Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5935810Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5936070Z         ]
2025-01-14T13:16:42.5937700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5937770Z 
2025-01-14T13:16:42.5939270Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5939490Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.5940340Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5940440Z 	
2025-01-14T13:16:42.5941020Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.5941250Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5941730Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.5941940Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5943000Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.5944480Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.5945710Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.5946860Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5948410Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.5949090Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.5949340Z 	
2025-01-14T13:16:42.5949790Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.5949990Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.5950190Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.5950550Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.5950960Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.5951430Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.5952640Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.5952880Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.5952980Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.5953090Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.5953940Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_j_blue_estimators[30-macroatom] _
2025-01-14T13:16:42.5953970Z 
2025-01-14T13:16:42.5954290Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5955480Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5957500Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5957560Z 
2025-01-14T13:16:42.5957890Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5958180Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5958420Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5958600Z     
2025-01-14T13:16:42.5959560Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5959950Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5960070Z             self.name += "_interp"
2025-01-14T13:16:42.5960120Z     
2025-01-14T13:16:42.5960210Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5960280Z >       simulation.run_convergence()
2025-01-14T13:16:42.5960290Z 
2025-01-14T13:16:42.5960420Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5960560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5960680Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5960850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5960960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5961150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5961290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5961300Z 
2025-01-14T13:16:42.5961570Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x303068ef0>
2025-01-14T13:16:42.5961790Z simulation_state = <tardis.model.base.SimulationState object at 0x17309be00>
2025-01-14T13:16:42.5962260Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030698e0>
2025-01-14T13:16:42.5962590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x303062780>
2025-01-14T13:16:42.5962710Z plasma = <tardis.plasma.base.BasePlasma object at 0x173095280>
2025-01-14T13:16:42.5962840Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5962860Z 
2025-01-14T13:16:42.5962950Z     def initialize_transport_state(
2025-01-14T13:16:42.5963030Z         self,
2025-01-14T13:16:42.5963120Z         simulation_state,
2025-01-14T13:16:42.5963200Z         opacity_state,
2025-01-14T13:16:42.5963290Z         macro_atom_state,
2025-01-14T13:16:42.5963360Z         plasma,
2025-01-14T13:16:42.5964060Z         no_of_packets,
2025-01-14T13:16:42.5964320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5965000Z         iteration=0,
2025-01-14T13:16:42.5965150Z     ):
2025-01-14T13:16:42.5965330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5965450Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5965530Z         else:
2025-01-14T13:16:42.5965620Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5965700Z     
2025-01-14T13:16:42.5965880Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5966000Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5966070Z         )
2025-01-14T13:16:42.5966740Z     
2025-01-14T13:16:42.5966900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5967050Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5967230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5967310Z         else:
2025-01-14T13:16:42.5967410Z             continuum_state = None
2025-01-14T13:16:42.5967520Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5967620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5967710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5968080Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5968200Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5968310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5968420Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5968520Z         ).to_numba(
2025-01-14T13:16:42.5968610Z             macro_atom_state,
2025-01-14T13:16:42.5968720Z             self.line_interaction_type,
2025-01-14T13:16:42.5968800Z         )
2025-01-14T13:16:42.5968930Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5969260Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5969350Z         ]
2025-01-14T13:16:42.5970410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5970430Z 
2025-01-14T13:16:42.5970580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5970860Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum[30-macroatom] _
2025-01-14T13:16:42.5970870Z 
2025-01-14T13:16:42.5971450Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5972110Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5973370Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5973390Z 
2025-01-14T13:16:42.5973490Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5973620Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5973860Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5973930Z     
2025-01-14T13:16:42.5974110Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.5974300Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.5974380Z             self.name += "_interp"
2025-01-14T13:16:42.5974460Z     
2025-01-14T13:16:42.5974560Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.5974670Z >       simulation.run_convergence()
2025-01-14T13:16:42.5974680Z 
2025-01-14T13:16:42.5974790Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.5975470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5976580Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.5977020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.5977360Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.5977850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.5978150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.5978190Z 
2025-01-14T13:16:42.5978820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x303068ef0>
2025-01-14T13:16:42.5979490Z simulation_state = <tardis.model.base.SimulationState object at 0x17309be00>
2025-01-14T13:16:42.5979710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030698e0>
2025-01-14T13:16:42.5979990Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x303062780>
2025-01-14T13:16:42.5980160Z plasma = <tardis.plasma.base.BasePlasma object at 0x173095280>
2025-01-14T13:16:42.5980800Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.5980850Z 
2025-01-14T13:16:42.5982350Z     def initialize_transport_state(
2025-01-14T13:16:42.5982460Z         self,
2025-01-14T13:16:42.5982840Z         simulation_state,
2025-01-14T13:16:42.5983790Z         opacity_state,
2025-01-14T13:16:42.5985620Z         macro_atom_state,
2025-01-14T13:16:42.5985710Z         plasma,
2025-01-14T13:16:42.5985790Z         no_of_packets,
2025-01-14T13:16:42.5985870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.5985950Z         iteration=0,
2025-01-14T13:16:42.5986020Z     ):
2025-01-14T13:16:42.5986150Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.5986250Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.5986300Z         else:
2025-01-14T13:16:42.5986380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.5986450Z     
2025-01-14T13:16:42.5986610Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.5986710Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.5986790Z         )
2025-01-14T13:16:42.5986850Z     
2025-01-14T13:16:42.5986990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.5987110Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.5988830Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.5988920Z         else:
2025-01-14T13:16:42.5989020Z             continuum_state = None
2025-01-14T13:16:42.5989140Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.5989260Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.5989390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.5989530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.5989640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.5989750Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.5989820Z             continuum_state=continuum_state,
2025-01-14T13:16:42.5989870Z         ).to_numba(
2025-01-14T13:16:42.5989950Z             macro_atom_state,
2025-01-14T13:16:42.5990050Z             self.line_interaction_type,
2025-01-14T13:16:42.5992340Z         )
2025-01-14T13:16:42.5992460Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.5993690Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.5993770Z         ]
2025-01-14T13:16:42.5994090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.5994100Z 
2025-01-14T13:16:42.5994260Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.5994510Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum_integrated[30-macroatom] _
2025-01-14T13:16:42.5994530Z 
2025-01-14T13:16:42.5994870Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.5995460Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.5997460Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.5997480Z 
2025-01-14T13:16:42.5997610Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.5997760Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.5997890Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.5997960Z     
2025-01-14T13:16:42.5998130Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.6019240Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.6020000Z             self.name += "_interp"
2025-01-14T13:16:42.6020190Z     
2025-01-14T13:16:42.6020460Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.6021560Z >       simulation.run_convergence()
2025-01-14T13:16:42.6021640Z 
2025-01-14T13:16:42.6021980Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.6022240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6023340Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6023680Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6023880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6024240Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6024470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6024480Z 
2025-01-14T13:16:42.6025060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x303068ef0>
2025-01-14T13:16:42.6025480Z simulation_state = <tardis.model.base.SimulationState object at 0x17309be00>
2025-01-14T13:16:42.6025960Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030698e0>
2025-01-14T13:16:42.6026590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x303062780>
2025-01-14T13:16:42.6026950Z plasma = <tardis.plasma.base.BasePlasma object at 0x173095280>
2025-01-14T13:16:42.6027260Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6027260Z 
2025-01-14T13:16:42.6027690Z     def initialize_transport_state(
2025-01-14T13:16:42.6027850Z         self,
2025-01-14T13:16:42.6028020Z         simulation_state,
2025-01-14T13:16:42.6028180Z         opacity_state,
2025-01-14T13:16:42.6028340Z         macro_atom_state,
2025-01-14T13:16:42.6028490Z         plasma,
2025-01-14T13:16:42.6028640Z         no_of_packets,
2025-01-14T13:16:42.6028820Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6028980Z         iteration=0,
2025-01-14T13:16:42.6029140Z     ):
2025-01-14T13:16:42.6029410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6029610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6030550Z         else:
2025-01-14T13:16:42.6030770Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6030910Z     
2025-01-14T13:16:42.6031450Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6031820Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6031990Z         )
2025-01-14T13:16:42.6032120Z     
2025-01-14T13:16:42.6032410Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6032650Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6032990Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6033140Z         else:
2025-01-14T13:16:42.6033320Z             continuum_state = None
2025-01-14T13:16:42.6033550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6033800Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6034000Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6034270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6034500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6034710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6034940Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6035090Z         ).to_numba(
2025-01-14T13:16:42.6035250Z             macro_atom_state,
2025-01-14T13:16:42.6035440Z             self.line_interaction_type,
2025-01-14T13:16:42.6035940Z         )
2025-01-14T13:16:42.6036200Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6037550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6038320Z         ]
2025-01-14T13:16:42.6040440Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6040490Z 
2025-01-14T13:16:42.6040880Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6041430Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_simulation[30-downbranch] _
2025-01-14T13:16:42.6041990Z 
2025-01-14T13:16:42.6042840Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.6044250Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6045070Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.6045080Z 
2025-01-14T13:16:42.6045270Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.6045510Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.6045720Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.6045850Z     
2025-01-14T13:16:42.6046230Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.6046540Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.6046710Z             self.name += "_interp"
2025-01-14T13:16:42.6046850Z     
2025-01-14T13:16:42.6047070Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.6047260Z >       simulation.run_convergence()
2025-01-14T13:16:42.6047270Z 
2025-01-14T13:16:42.6047540Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.6047790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6048210Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6048790Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6049420Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6049780Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6050020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6050450Z 
2025-01-14T13:16:42.6051040Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30e82e900>
2025-01-14T13:16:42.6051480Z simulation_state = <tardis.model.base.SimulationState object at 0x303100d10>
2025-01-14T13:16:42.6052110Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e869190>
2025-01-14T13:16:42.6052810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e869bb0>
2025-01-14T13:16:42.6053170Z plasma = <tardis.plasma.base.BasePlasma object at 0x30316d910>
2025-01-14T13:16:42.6053920Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6053940Z 
2025-01-14T13:16:42.6054150Z     def initialize_transport_state(
2025-01-14T13:16:42.6054310Z         self,
2025-01-14T13:16:42.6054490Z         simulation_state,
2025-01-14T13:16:42.6054650Z         opacity_state,
2025-01-14T13:16:42.6054830Z         macro_atom_state,
2025-01-14T13:16:42.6054970Z         plasma,
2025-01-14T13:16:42.6055130Z         no_of_packets,
2025-01-14T13:16:42.6055300Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6055460Z         iteration=0,
2025-01-14T13:16:42.6055600Z     ):
2025-01-14T13:16:42.6055900Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6056110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6056250Z         else:
2025-01-14T13:16:42.6056410Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6056560Z     
2025-01-14T13:16:42.6056850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6057060Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6057370Z         )
2025-01-14T13:16:42.6057540Z     
2025-01-14T13:16:42.6057840Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6058100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6058460Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6058600Z         else:
2025-01-14T13:16:42.6059170Z             continuum_state = None
2025-01-14T13:16:42.6059390Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6059630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6059830Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6060240Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6060420Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6060500Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6060560Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6060610Z         ).to_numba(
2025-01-14T13:16:42.6060670Z             macro_atom_state,
2025-01-14T13:16:42.6060730Z             self.line_interaction_type,
2025-01-14T13:16:42.6060780Z         )
2025-01-14T13:16:42.6060870Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6061110Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6061170Z         ]
2025-01-14T13:16:42.6061430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6061430Z 
2025-01-14T13:16:42.6061550Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6061690Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.6067100Z config {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Quantity 13. d>, 'luminosity_wavelength_start': <Quantity 0. Angstrom>, 'luminosity_wavelength_end': <Quantity inf Angstrom>}, 'atom_data': 'kurucz_cd23_chianti_H_He.h5', 'model': {'structure': {'type': 'specific', 'velocity': {'start': <Quantity 11000. km / s>, 'stop': <Quantity 20000. km / s>, 'num': 20}, 'density': {'type': 'branch85_w7', 'w7_time_0': <Quantity 0.00023148 d>, 'w7_rho_0': <Quantity 3.e+29 g / cm3>, 'w7_v_0': <Quantity 1. km / s>}}, 'abundances': {'type': 'uniform', 'O': 0.19, 'Mg': 0.03, 'Si': 0.52, 'S': 0.19, 'Ar': 0.04, 'Ca': 0.03, 'model_isotope_time_0': <Quantity 0. s>}}, 'plasma': {'ionization': 'lte', 'excitation': 'lte', 'radiative_rates_type': 'dilute-blackbody', 'line_interaction_type': 'downbranch', 'initial_t_inner': <Quantity -1. K>, 'initial_t_rad': <Quantity -1. K>, 'disable_electron_scattering': False, 'disable_line_scattering': False, 'w_epsilon': 1e-10, 'nlte': {'species': [], 'coronal_approximation': False, 'classical_nebular': False}, 'continuum_interaction': {'species': [], 'enable_adiabatic_cooling': False, 'enable_two_photon_decay': False}, 'helium_treatment': 'none', 'heating_rate_data_file': 'none', 'link_t_rad_t_electron': 0.9, 'nlte_ionization_species': [], 'nlte_excitation_species': [], 'nlte_solver': 'root'}, 'montecarlo': {'seed': 23111963, 'no_of_packets': 40000.0, 'iterations': 5, 'last_no_of_packets': 100000.0, 'no_of_virtual_packets': 0, 'convergence_strategy': {'type': 'damped', 'damping_constant': 0.5, 'threshold': 0.05, 'lock_t_inner_cycles': 1, 't_inner_update_exponent': -0.5, 'stop_if_converged': False, 'fraction': 0.8, 'hold_iterations': 3, 't_inner': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 't_rad': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}, 'w': {'damping_constant': 0.5, 'threshold': 0.05, 'type': 'damped'}}, 'nthreads': 1, 'virtual_spectrum_spawn_range': {'start': <Quantity 1. Angstrom>, 'end': <Quantity inf Angstrom>}, 'enable_full_relativity': False, 'enable_nonhomologous_expansion': False, 'tracking': {'track_rpacket': False, 'initial_array_length': 10}, 'debug_packets': False, 'logger_buffer': 1}, 'spectrum': {'start': <Quantity 500. Angstrom>, 'stop': <Quantity 20000. Angstrom>, 'num': 10000, 'virtual': {'virtual_packet_logging': True, 'tau_russian': 10.0, 'survival_probability': 0.0, 'enable_biasing': False}, 'method': 'integrated', 'integrated': {'points': 200, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6068230Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6068290Z 	
2025-01-14T13:16:42.6068740Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.6068900Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6069240Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.6069370Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6069760Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.6069960Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.6070320Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.6070460Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6070620Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.6070750Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6070790Z 	
2025-01-14T13:16:42.6070900Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.6071030Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.6071150Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.6071430Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.6071730Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.6072340Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.6072760Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.6072940Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.6073020Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.6073070Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.6073290Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_j_blue_estimators[30-downbranch] _
2025-01-14T13:16:42.6073300Z 
2025-01-14T13:16:42.6073550Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.6074040Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6074350Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.6074360Z 
2025-01-14T13:16:42.6074420Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.6074520Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.6074590Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.6074630Z     
2025-01-14T13:16:42.6074770Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.6074890Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.6074950Z             self.name += "_interp"
2025-01-14T13:16:42.6074990Z     
2025-01-14T13:16:42.6075080Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.6075140Z >       simulation.run_convergence()
2025-01-14T13:16:42.6075240Z 
2025-01-14T13:16:42.6075350Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.6075440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6075540Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6075640Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6075720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6075840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6075930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6075930Z 
2025-01-14T13:16:42.6076140Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30e82e900>
2025-01-14T13:16:42.6076300Z simulation_state = <tardis.model.base.SimulationState object at 0x303100d10>
2025-01-14T13:16:42.6076480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e869190>
2025-01-14T13:16:42.6076710Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e869bb0>
2025-01-14T13:16:42.6076840Z plasma = <tardis.plasma.base.BasePlasma object at 0x30316d910>
2025-01-14T13:16:42.6076960Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6076960Z 
2025-01-14T13:16:42.6077030Z     def initialize_transport_state(
2025-01-14T13:16:42.6077070Z         self,
2025-01-14T13:16:42.6077130Z         simulation_state,
2025-01-14T13:16:42.6077180Z         opacity_state,
2025-01-14T13:16:42.6077230Z         macro_atom_state,
2025-01-14T13:16:42.6077280Z         plasma,
2025-01-14T13:16:42.6077330Z         no_of_packets,
2025-01-14T13:16:42.6077390Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6077430Z         iteration=0,
2025-01-14T13:16:42.6077480Z     ):
2025-01-14T13:16:42.6077630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6077710Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6077760Z         else:
2025-01-14T13:16:42.6077820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6077860Z     
2025-01-14T13:16:42.6077960Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6078030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6078090Z         )
2025-01-14T13:16:42.6078130Z     
2025-01-14T13:16:42.6078230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6078310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6078430Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6078490Z         else:
2025-01-14T13:16:42.6078540Z             continuum_state = None
2025-01-14T13:16:42.6078620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6078700Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6078780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6078860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6078940Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6079000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6079070Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6079120Z         ).to_numba(
2025-01-14T13:16:42.6079180Z             macro_atom_state,
2025-01-14T13:16:42.6079240Z             self.line_interaction_type,
2025-01-14T13:16:42.6079290Z         )
2025-01-14T13:16:42.6079360Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6079600Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6079650Z         ]
2025-01-14T13:16:42.6079900Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6079910Z 
2025-01-14T13:16:42.6080020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6080260Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum[30-downbranch] _
2025-01-14T13:16:42.6080270Z 
2025-01-14T13:16:42.6080520Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.6081010Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6081320Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.6081320Z 
2025-01-14T13:16:42.6081390Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.6081470Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.6081550Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.6081590Z     
2025-01-14T13:16:42.6081730Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.6081840Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.6081900Z             self.name += "_interp"
2025-01-14T13:16:42.6081940Z     
2025-01-14T13:16:42.6082020Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.6082080Z >       simulation.run_convergence()
2025-01-14T13:16:42.6082090Z 
2025-01-14T13:16:42.6082190Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.6082280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6082370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6082480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6082550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6082770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6082860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6082860Z 
2025-01-14T13:16:42.6083070Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30e82e900>
2025-01-14T13:16:42.6083220Z simulation_state = <tardis.model.base.SimulationState object at 0x303100d10>
2025-01-14T13:16:42.6083400Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e869190>
2025-01-14T13:16:42.6083620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e869bb0>
2025-01-14T13:16:42.6083750Z plasma = <tardis.plasma.base.BasePlasma object at 0x30316d910>
2025-01-14T13:16:42.6083860Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6083860Z 
2025-01-14T13:16:42.6083920Z     def initialize_transport_state(
2025-01-14T13:16:42.6083970Z         self,
2025-01-14T13:16:42.6084020Z         simulation_state,
2025-01-14T13:16:42.6084070Z         opacity_state,
2025-01-14T13:16:42.6084130Z         macro_atom_state,
2025-01-14T13:16:42.6084170Z         plasma,
2025-01-14T13:16:42.6084220Z         no_of_packets,
2025-01-14T13:16:42.6084280Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6084330Z         iteration=0,
2025-01-14T13:16:42.6084370Z     ):
2025-01-14T13:16:42.6084470Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6084530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6084590Z         else:
2025-01-14T13:16:42.6084640Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6084690Z     
2025-01-14T13:16:42.6084800Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6084870Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6084910Z         )
2025-01-14T13:16:42.6084950Z     
2025-01-14T13:16:42.6085050Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6085140Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6085330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6085380Z         else:
2025-01-14T13:16:42.6085430Z             continuum_state = None
2025-01-14T13:16:42.6085510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6085600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6085660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6085750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6085820Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6085890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6085950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6086000Z         ).to_numba(
2025-01-14T13:16:42.6086050Z             macro_atom_state,
2025-01-14T13:16:42.6086120Z             self.line_interaction_type,
2025-01-14T13:16:42.6086180Z         )
2025-01-14T13:16:42.6086260Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6086480Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6086530Z         ]
2025-01-14T13:16:42.6086770Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6086770Z 
2025-01-14T13:16:42.6086890Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6087100Z _ ERROR at setup of TestTransportSimpleFormalIntegral.test_spectrum_integrated[30-downbranch] _
2025-01-14T13:16:42.6087110Z 
2025-01-14T13:16:42.6087350Z self = <tardis.tests.test_tardis_full_formal_integral.TestTransportSimpleFormalIntegral object at 0x11a2f5640>
2025-01-14T13:16:42.6087840Z config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 200, 'interpolate_shells': 30, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6088210Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.6088220Z 
2025-01-14T13:16:42.6088290Z     @pytest.fixture(scope="class")
2025-01-14T13:16:42.6088380Z     def simulation(self, config, atomic_data_fname):
2025-01-14T13:16:42.6088440Z         config.atom_data = atomic_data_fname
2025-01-14T13:16:42.6088490Z     
2025-01-14T13:16:42.6088620Z         self.name = self._name + f"_{config.plasma.line_interaction_type:s}"
2025-01-14T13:16:42.6088730Z         if config.spectrum.integrated.interpolate_shells > 0:
2025-01-14T13:16:42.6088790Z             self.name += "_interp"
2025-01-14T13:16:42.6088840Z     
2025-01-14T13:16:42.6088920Z         simulation = Simulation.from_config(config)
2025-01-14T13:16:42.6088980Z >       simulation.run_convergence()
2025-01-14T13:16:42.6088990Z 
2025-01-14T13:16:42.6089090Z tardis/tests/test_tardis_full_formal_integral.py:63: 
2025-01-14T13:16:42.6089180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6089270Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6089380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6089450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6089560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6089650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6089650Z 
2025-01-14T13:16:42.6089860Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30e82e900>
2025-01-14T13:16:42.6090020Z simulation_state = <tardis.model.base.SimulationState object at 0x303100d10>
2025-01-14T13:16:42.6090190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e869190>
2025-01-14T13:16:42.6090420Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e869bb0>
2025-01-14T13:16:42.6090790Z plasma = <tardis.plasma.base.BasePlasma object at 0x30316d910>
2025-01-14T13:16:42.6090900Z no_of_packets = 40000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6090900Z 
2025-01-14T13:16:42.6090970Z     def initialize_transport_state(
2025-01-14T13:16:42.6091010Z         self,
2025-01-14T13:16:42.6091070Z         simulation_state,
2025-01-14T13:16:42.6091110Z         opacity_state,
2025-01-14T13:16:42.6091170Z         macro_atom_state,
2025-01-14T13:16:42.6091210Z         plasma,
2025-01-14T13:16:42.6091260Z         no_of_packets,
2025-01-14T13:16:42.6091320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6091370Z         iteration=0,
2025-01-14T13:16:42.6091410Z     ):
2025-01-14T13:16:42.6091500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6091570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6091620Z         else:
2025-01-14T13:16:42.6091680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6091730Z     
2025-01-14T13:16:42.6091840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6091910Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6091950Z         )
2025-01-14T13:16:42.6091990Z     
2025-01-14T13:16:42.6092090Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6092180Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6092310Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6092350Z         else:
2025-01-14T13:16:42.6092410Z             continuum_state = None
2025-01-14T13:16:42.6092490Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6092570Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6092640Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6093220Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6093300Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6093380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6093440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6093490Z         ).to_numba(
2025-01-14T13:16:42.6093550Z             macro_atom_state,
2025-01-14T13:16:42.6093610Z             self.line_interaction_type,
2025-01-14T13:16:42.6093650Z         )
2025-01-14T13:16:42.6093730Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6093960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6094010Z         ]
2025-01-14T13:16:42.6094260Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6094260Z 
2025-01-14T13:16:42.6094370Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6094520Z ____________ ERROR at setup of test_hdf_transport_state[output_nu] _____________
2025-01-14T13:16:42.6094530Z 
2025-01-14T13:16:42.6095060Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6095360Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6095370Z 
2025-01-14T13:16:42.6095440Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6095600Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6095680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6095740Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6095880Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6095920Z         )
2025-01-14T13:16:42.6095990Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6096140Z >       sim.run_final()
2025-01-14T13:16:42.6096150Z 
2025-01-14T13:16:42.6096210Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6096300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6096370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6096490Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6096560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6096690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6096780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6096780Z 
2025-01-14T13:16:42.6097000Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6097160Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6097340Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6097570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6097690Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6097800Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6097810Z 
2025-01-14T13:16:42.6097880Z     def initialize_transport_state(
2025-01-14T13:16:42.6097930Z         self,
2025-01-14T13:16:42.6097980Z         simulation_state,
2025-01-14T13:16:42.6098050Z         opacity_state,
2025-01-14T13:16:42.6098100Z         macro_atom_state,
2025-01-14T13:16:42.6098150Z         plasma,
2025-01-14T13:16:42.6098190Z         no_of_packets,
2025-01-14T13:16:42.6098250Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6098300Z         iteration=0,
2025-01-14T13:16:42.6098430Z     ):
2025-01-14T13:16:42.6098520Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6098600Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6098640Z         else:
2025-01-14T13:16:42.6098700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6098740Z     
2025-01-14T13:16:42.6098850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6098920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6098960Z         )
2025-01-14T13:16:42.6099010Z     
2025-01-14T13:16:42.6099110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6099200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6099330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6099380Z         else:
2025-01-14T13:16:42.6099430Z             continuum_state = None
2025-01-14T13:16:42.6099510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6099600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6099670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6099770Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6099840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6099910Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6099970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6100020Z         ).to_numba(
2025-01-14T13:16:42.6100070Z             macro_atom_state,
2025-01-14T13:16:42.6100140Z             self.line_interaction_type,
2025-01-14T13:16:42.6100180Z         )
2025-01-14T13:16:42.6100270Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6100500Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6100550Z         ]
2025-01-14T13:16:42.6100800Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6100810Z 
2025-01-14T13:16:42.6100930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6101170Z __________ ERROR at setup of test_hdf_transport_state[output_energy] ___________
2025-01-14T13:16:42.6101170Z 
2025-01-14T13:16:42.6101670Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6101960Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6101960Z 
2025-01-14T13:16:42.6102030Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6102200Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6102270Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6102330Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6102480Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6102520Z         )
2025-01-14T13:16:42.6102590Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6102640Z >       sim.run_final()
2025-01-14T13:16:42.6102640Z 
2025-01-14T13:16:42.6102700Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6102790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6102860Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6102960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6103030Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6103160Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6103240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6103300Z 
2025-01-14T13:16:42.6103520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6103680Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6103860Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6104070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6104200Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6104310Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6104310Z 
2025-01-14T13:16:42.6104370Z     def initialize_transport_state(
2025-01-14T13:16:42.6104420Z         self,
2025-01-14T13:16:42.6104470Z         simulation_state,
2025-01-14T13:16:42.6104520Z         opacity_state,
2025-01-14T13:16:42.6104570Z         macro_atom_state,
2025-01-14T13:16:42.6104620Z         plasma,
2025-01-14T13:16:42.6104670Z         no_of_packets,
2025-01-14T13:16:42.6104730Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6104780Z         iteration=0,
2025-01-14T13:16:42.6104830Z     ):
2025-01-14T13:16:42.6104940Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6105020Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6105060Z         else:
2025-01-14T13:16:42.6105120Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6105160Z     
2025-01-14T13:16:42.6105260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6105330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6105380Z         )
2025-01-14T13:16:42.6105420Z     
2025-01-14T13:16:42.6105520Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6105610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6105730Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6105780Z         else:
2025-01-14T13:16:42.6105840Z             continuum_state = None
2025-01-14T13:16:42.6105910Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6106070Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6106150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6106230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6106300Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6106370Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6106430Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6106480Z         ).to_numba(
2025-01-14T13:16:42.6106530Z             macro_atom_state,
2025-01-14T13:16:42.6106590Z             self.line_interaction_type,
2025-01-14T13:16:42.6106630Z         )
2025-01-14T13:16:42.6106710Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6106930Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6106980Z         ]
2025-01-14T13:16:42.6107220Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6107230Z 
2025-01-14T13:16:42.6107340Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6107480Z _________ ERROR at setup of test_hdf_transport_state[nu_bar_estimator] _________
2025-01-14T13:16:42.6107480Z 
2025-01-14T13:16:42.6108110Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6108400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6108410Z 
2025-01-14T13:16:42.6108470Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6108730Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6108810Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6108870Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6109000Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6109050Z         )
2025-01-14T13:16:42.6109110Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6109160Z >       sim.run_final()
2025-01-14T13:16:42.6109160Z 
2025-01-14T13:16:42.6109220Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6109310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6109380Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6109490Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6109560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6114840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6115020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6115030Z 
2025-01-14T13:16:42.6115250Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6115420Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6115600Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6115830Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6115960Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6116070Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6116080Z 
2025-01-14T13:16:42.6116140Z     def initialize_transport_state(
2025-01-14T13:16:42.6116190Z         self,
2025-01-14T13:16:42.6116240Z         simulation_state,
2025-01-14T13:16:42.6116300Z         opacity_state,
2025-01-14T13:16:42.6116360Z         macro_atom_state,
2025-01-14T13:16:42.6116850Z         plasma,
2025-01-14T13:16:42.6116900Z         no_of_packets,
2025-01-14T13:16:42.6116960Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6117010Z         iteration=0,
2025-01-14T13:16:42.6117060Z     ):
2025-01-14T13:16:42.6117160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6117230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6117290Z         else:
2025-01-14T13:16:42.6117340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6117390Z     
2025-01-14T13:16:42.6117500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6117570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6117620Z         )
2025-01-14T13:16:42.6117670Z     
2025-01-14T13:16:42.6117770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6117870Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6118000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6118040Z         else:
2025-01-14T13:16:42.6118110Z             continuum_state = None
2025-01-14T13:16:42.6118180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6118270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6118340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6118420Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6118490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6118560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6118630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6118670Z         ).to_numba(
2025-01-14T13:16:42.6118730Z             macro_atom_state,
2025-01-14T13:16:42.6118790Z             self.line_interaction_type,
2025-01-14T13:16:42.6119090Z         )
2025-01-14T13:16:42.6119180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6119400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6119450Z         ]
2025-01-14T13:16:42.6119700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6119710Z 
2025-01-14T13:16:42.6119820Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6119970Z ___________ ERROR at setup of test_hdf_transport_state[j_estimator] ____________
2025-01-14T13:16:42.6119970Z 
2025-01-14T13:16:42.6120490Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6120790Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6120800Z 
2025-01-14T13:16:42.6120870Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6121050Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6121140Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6121200Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6121350Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6121400Z         )
2025-01-14T13:16:42.6121460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6121510Z >       sim.run_final()
2025-01-14T13:16:42.6121510Z 
2025-01-14T13:16:42.6121570Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6121650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6121730Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6121840Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6121920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6122140Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6122220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6122230Z 
2025-01-14T13:16:42.6122440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6122600Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6122780Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6123010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6123130Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6123240Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6123250Z 
2025-01-14T13:16:42.6123310Z     def initialize_transport_state(
2025-01-14T13:16:42.6123360Z         self,
2025-01-14T13:16:42.6123420Z         simulation_state,
2025-01-14T13:16:42.6123470Z         opacity_state,
2025-01-14T13:16:42.6123520Z         macro_atom_state,
2025-01-14T13:16:42.6123570Z         plasma,
2025-01-14T13:16:42.6123610Z         no_of_packets,
2025-01-14T13:16:42.6123670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6123720Z         iteration=0,
2025-01-14T13:16:42.6123770Z     ):
2025-01-14T13:16:42.6123860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6123930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6123980Z         else:
2025-01-14T13:16:42.6124040Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6124080Z     
2025-01-14T13:16:42.6124180Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6124260Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6124380Z         )
2025-01-14T13:16:42.6124430Z     
2025-01-14T13:16:42.6124530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6124630Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6124750Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6124800Z         else:
2025-01-14T13:16:42.6124850Z             continuum_state = None
2025-01-14T13:16:42.6124930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6125030Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6125110Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6125190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6125260Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6125330Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6125400Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6125450Z         ).to_numba(
2025-01-14T13:16:42.6125510Z             macro_atom_state,
2025-01-14T13:16:42.6125570Z             self.line_interaction_type,
2025-01-14T13:16:42.6125610Z         )
2025-01-14T13:16:42.6125690Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6125920Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6125960Z         ]
2025-01-14T13:16:42.6126230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6126240Z 
2025-01-14T13:16:42.6126350Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6126500Z _______ ERROR at setup of test_hdf_transport_state[emitted_packet_mask] ________
2025-01-14T13:16:42.6126500Z 
2025-01-14T13:16:42.6127290Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6127870Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6127880Z 
2025-01-14T13:16:42.6127960Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6128130Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6128210Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6128270Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6128440Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6128490Z         )
2025-01-14T13:16:42.6128560Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6128610Z >       sim.run_final()
2025-01-14T13:16:42.6128610Z 
2025-01-14T13:16:42.6128670Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6128760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6128840Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6128960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6129040Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6129160Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6129250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6129250Z 
2025-01-14T13:16:42.6129470Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6129640Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6129840Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6130070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6130300Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6130420Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6130430Z 
2025-01-14T13:16:42.6130500Z     def initialize_transport_state(
2025-01-14T13:16:42.6130550Z         self,
2025-01-14T13:16:42.6130600Z         simulation_state,
2025-01-14T13:16:42.6130650Z         opacity_state,
2025-01-14T13:16:42.6130710Z         macro_atom_state,
2025-01-14T13:16:42.6130750Z         plasma,
2025-01-14T13:16:42.6130800Z         no_of_packets,
2025-01-14T13:16:42.6130870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6130910Z         iteration=0,
2025-01-14T13:16:42.6130960Z     ):
2025-01-14T13:16:42.6131060Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6132730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6132800Z         else:
2025-01-14T13:16:42.6132860Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6132900Z     
2025-01-14T13:16:42.6133040Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6133120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6133180Z         )
2025-01-14T13:16:42.6133230Z     
2025-01-14T13:16:42.6133330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6133420Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6133550Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6133600Z         else:
2025-01-14T13:16:42.6133650Z             continuum_state = None
2025-01-14T13:16:42.6133730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6133820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6133890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6133980Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6134050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6134130Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6134200Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6134390Z         ).to_numba(
2025-01-14T13:16:42.6134450Z             macro_atom_state,
2025-01-14T13:16:42.6134520Z             self.line_interaction_type,
2025-01-14T13:16:42.6134560Z         )
2025-01-14T13:16:42.6134640Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6134870Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6134920Z         ]
2025-01-14T13:16:42.6135170Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6135180Z 
2025-01-14T13:16:42.6135300Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6135450Z ______ ERROR at setup of test_hdf_transport_state[last_interaction_type] _______
2025-01-14T13:16:42.6135450Z 
2025-01-14T13:16:42.6135990Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6136290Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6136300Z 
2025-01-14T13:16:42.6136360Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6136530Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6136610Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6136680Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6136820Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6136870Z         )
2025-01-14T13:16:42.6136930Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6137050Z >       sim.run_final()
2025-01-14T13:16:42.6137050Z 
2025-01-14T13:16:42.6137120Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6137210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6137290Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6137400Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6137470Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6137600Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6137690Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6137690Z 
2025-01-14T13:16:42.6137900Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6138060Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6138240Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6138470Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6138610Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6138710Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6138720Z 
2025-01-14T13:16:42.6138780Z     def initialize_transport_state(
2025-01-14T13:16:42.6138830Z         self,
2025-01-14T13:16:42.6138880Z         simulation_state,
2025-01-14T13:16:42.6138930Z         opacity_state,
2025-01-14T13:16:42.6138990Z         macro_atom_state,
2025-01-14T13:16:42.6139040Z         plasma,
2025-01-14T13:16:42.6139090Z         no_of_packets,
2025-01-14T13:16:42.6139150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6139200Z         iteration=0,
2025-01-14T13:16:42.6139240Z     ):
2025-01-14T13:16:42.6139340Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6139410Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6139460Z         else:
2025-01-14T13:16:42.6139520Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6140050Z     
2025-01-14T13:16:42.6140170Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6140240Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6140280Z         )
2025-01-14T13:16:42.6140320Z     
2025-01-14T13:16:42.6140430Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6140520Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6140650Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6140690Z         else:
2025-01-14T13:16:42.6140750Z             continuum_state = None
2025-01-14T13:16:42.6140830Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6140910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6140980Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6141070Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6141150Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6141250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6141330Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6141380Z         ).to_numba(
2025-01-14T13:16:42.6141430Z             macro_atom_state,
2025-01-14T13:16:42.6141490Z             self.line_interaction_type,
2025-01-14T13:16:42.6141540Z         )
2025-01-14T13:16:42.6141620Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6141840Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6141890Z         ]
2025-01-14T13:16:42.6142140Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6142140Z 
2025-01-14T13:16:42.6142260Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6142650Z ______ ERROR at setup of test_hdf_transport_state[last_interaction_in_nu] ______
2025-01-14T13:16:42.6142650Z 
2025-01-14T13:16:42.6144660Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6145690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6145730Z 
2025-01-14T13:16:42.6145970Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6146440Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6146660Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6146840Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6147230Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6147410Z         )
2025-01-14T13:16:42.6147590Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6148020Z >       sim.run_final()
2025-01-14T13:16:42.6148030Z 
2025-01-14T13:16:42.6148200Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6148450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6148660Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6148980Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6149180Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6149520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6149750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6149770Z 
2025-01-14T13:16:42.6150340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6151050Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6151600Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6152960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6154010Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6154420Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6154430Z 
2025-01-14T13:16:42.6154620Z     def initialize_transport_state(
2025-01-14T13:16:42.6154770Z         self,
2025-01-14T13:16:42.6154940Z         simulation_state,
2025-01-14T13:16:42.6155100Z         opacity_state,
2025-01-14T13:16:42.6155260Z         macro_atom_state,
2025-01-14T13:16:42.6155440Z         plasma,
2025-01-14T13:16:42.6155600Z         no_of_packets,
2025-01-14T13:16:42.6155770Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6155920Z         iteration=0,
2025-01-14T13:16:42.6156220Z     ):
2025-01-14T13:16:42.6156670Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6156910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6157060Z         else:
2025-01-14T13:16:42.6157230Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6157370Z     
2025-01-14T13:16:42.6158570Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6159220Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6159770Z         )
2025-01-14T13:16:42.6159960Z     
2025-01-14T13:16:42.6160240Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6160500Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6160830Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6160970Z         else:
2025-01-14T13:16:42.6161150Z             continuum_state = None
2025-01-14T13:16:42.6161370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6162880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6163090Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6163570Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6164040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6164400Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6164610Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6164760Z         ).to_numba(
2025-01-14T13:16:42.6164930Z             macro_atom_state,
2025-01-14T13:16:42.6165120Z             self.line_interaction_type,
2025-01-14T13:16:42.6165260Z         )
2025-01-14T13:16:42.6165490Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6166180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6166320Z         ]
2025-01-14T13:16:42.6169780Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6169860Z 
2025-01-14T13:16:42.6170010Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6170180Z ______ ERROR at setup of test_hdf_transport_state[last_interaction_in_r] _______
2025-01-14T13:16:42.6170190Z 
2025-01-14T13:16:42.6170810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6171140Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6171150Z 
2025-01-14T13:16:42.6171220Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6171390Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6171470Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6171540Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6172270Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6173460Z         )
2025-01-14T13:16:42.6173530Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6173580Z >       sim.run_final()
2025-01-14T13:16:42.6173580Z 
2025-01-14T13:16:42.6173650Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6173740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6173810Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6173930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6174000Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6174130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6174220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6174230Z 
2025-01-14T13:16:42.6174440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6174600Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6174780Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6175000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6175120Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6175240Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6175240Z 
2025-01-14T13:16:42.6175310Z     def initialize_transport_state(
2025-01-14T13:16:42.6175360Z         self,
2025-01-14T13:16:42.6175420Z         simulation_state,
2025-01-14T13:16:42.6175470Z         opacity_state,
2025-01-14T13:16:42.6175520Z         macro_atom_state,
2025-01-14T13:16:42.6175570Z         plasma,
2025-01-14T13:16:42.6175760Z         no_of_packets,
2025-01-14T13:16:42.6175830Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6175870Z         iteration=0,
2025-01-14T13:16:42.6175920Z     ):
2025-01-14T13:16:42.6176020Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6176110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6176160Z         else:
2025-01-14T13:16:42.6176220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6176260Z     
2025-01-14T13:16:42.6176370Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6176440Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6176480Z         )
2025-01-14T13:16:42.6176530Z     
2025-01-14T13:16:42.6176650Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6176740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6176860Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6176920Z         else:
2025-01-14T13:16:42.6176970Z             continuum_state = None
2025-01-14T13:16:42.6177050Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6177140Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6177210Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6177290Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6177370Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6177430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6177500Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6177540Z         ).to_numba(
2025-01-14T13:16:42.6177590Z             macro_atom_state,
2025-01-14T13:16:42.6177660Z             self.line_interaction_type,
2025-01-14T13:16:42.6177700Z         )
2025-01-14T13:16:42.6177770Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6178000Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6178050Z         ]
2025-01-14T13:16:42.6178310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6178400Z 
2025-01-14T13:16:42.6178540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6178690Z ___ ERROR at setup of test_hdf_transport_state[last_line_interaction_out_id] ___
2025-01-14T13:16:42.6178700Z 
2025-01-14T13:16:42.6179210Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6179520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6179530Z 
2025-01-14T13:16:42.6179600Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6179780Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6179870Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6179940Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6180090Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6180130Z         )
2025-01-14T13:16:42.6180200Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6180250Z >       sim.run_final()
2025-01-14T13:16:42.6180260Z 
2025-01-14T13:16:42.6180320Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6180410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6180500Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6180610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6180680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6180800Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6180980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6180990Z 
2025-01-14T13:16:42.6181200Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6181370Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6181550Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6181780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6181900Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6182010Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6182010Z 
2025-01-14T13:16:42.6182080Z     def initialize_transport_state(
2025-01-14T13:16:42.6182120Z         self,
2025-01-14T13:16:42.6182180Z         simulation_state,
2025-01-14T13:16:42.6182220Z         opacity_state,
2025-01-14T13:16:42.6182290Z         macro_atom_state,
2025-01-14T13:16:42.6182330Z         plasma,
2025-01-14T13:16:42.6182390Z         no_of_packets,
2025-01-14T13:16:42.6182450Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6182490Z         iteration=0,
2025-01-14T13:16:42.6182540Z     ):
2025-01-14T13:16:42.6182630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6182700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6182750Z         else:
2025-01-14T13:16:42.6182800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6182840Z     
2025-01-14T13:16:42.6182950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6183020Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6183070Z         )
2025-01-14T13:16:42.6183120Z     
2025-01-14T13:16:42.6183220Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6183310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6183440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6183770Z         else:
2025-01-14T13:16:42.6183830Z             continuum_state = None
2025-01-14T13:16:42.6183920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6184000Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6184070Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6184160Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6184240Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6184310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6184380Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6184430Z         ).to_numba(
2025-01-14T13:16:42.6184490Z             macro_atom_state,
2025-01-14T13:16:42.6184550Z             self.line_interaction_type,
2025-01-14T13:16:42.6184590Z         )
2025-01-14T13:16:42.6184670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6184890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6184940Z         ]
2025-01-14T13:16:42.6185190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6185190Z 
2025-01-14T13:16:42.6185310Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6185450Z ___ ERROR at setup of test_hdf_transport_state[last_line_interaction_in_id] ____
2025-01-14T13:16:42.6185460Z 
2025-01-14T13:16:42.6185960Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6186240Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6186460Z 
2025-01-14T13:16:42.6186530Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6186700Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6186770Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6186840Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6186980Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6187020Z         )
2025-01-14T13:16:42.6187090Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6187140Z >       sim.run_final()
2025-01-14T13:16:42.6187140Z 
2025-01-14T13:16:42.6187200Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6187290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6187370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6187490Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6187560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6187700Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6187790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6187790Z 
2025-01-14T13:16:42.6188110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6188280Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6188450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6188680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6188800Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6188910Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6188920Z 
2025-01-14T13:16:42.6188980Z     def initialize_transport_state(
2025-01-14T13:16:42.6189030Z         self,
2025-01-14T13:16:42.6189170Z         simulation_state,
2025-01-14T13:16:42.6189220Z         opacity_state,
2025-01-14T13:16:42.6189280Z         macro_atom_state,
2025-01-14T13:16:42.6189320Z         plasma,
2025-01-14T13:16:42.6189380Z         no_of_packets,
2025-01-14T13:16:42.6189430Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6189480Z         iteration=0,
2025-01-14T13:16:42.6189530Z     ):
2025-01-14T13:16:42.6189630Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6189700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6189760Z         else:
2025-01-14T13:16:42.6189820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6189860Z     
2025-01-14T13:16:42.6189970Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6190040Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6190100Z         )
2025-01-14T13:16:42.6190140Z     
2025-01-14T13:16:42.6190250Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6190340Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6190470Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6190520Z         else:
2025-01-14T13:16:42.6190580Z             continuum_state = None
2025-01-14T13:16:42.6190650Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6190740Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6190810Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6190900Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6190970Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6191050Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6191110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6191160Z         ).to_numba(
2025-01-14T13:16:42.6191260Z             macro_atom_state,
2025-01-14T13:16:42.6191330Z             self.line_interaction_type,
2025-01-14T13:16:42.6191380Z         )
2025-01-14T13:16:42.6191450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6191680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6191720Z         ]
2025-01-14T13:16:42.6191980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6191980Z 
2025-01-14T13:16:42.6192100Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6196980Z __ ERROR at setup of test_hdf_transport_state[last_line_interaction_shell_id] __
2025-01-14T13:16:42.6197020Z 
2025-01-14T13:16:42.6197590Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6197920Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6197940Z 
2025-01-14T13:16:42.6198000Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6198170Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6198250Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6198310Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6198460Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6198500Z         )
2025-01-14T13:16:42.6198570Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6198620Z >       sim.run_final()
2025-01-14T13:16:42.6198620Z 
2025-01-14T13:16:42.6198680Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6198770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6198840Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6199220Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6199290Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6199420Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6199520Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6199520Z 
2025-01-14T13:16:42.6199740Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6199900Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6200100Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6200330Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6200450Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6200560Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6200570Z 
2025-01-14T13:16:42.6200630Z     def initialize_transport_state(
2025-01-14T13:16:42.6200680Z         self,
2025-01-14T13:16:42.6200730Z         simulation_state,
2025-01-14T13:16:42.6200780Z         opacity_state,
2025-01-14T13:16:42.6200830Z         macro_atom_state,
2025-01-14T13:16:42.6200880Z         plasma,
2025-01-14T13:16:42.6200930Z         no_of_packets,
2025-01-14T13:16:42.6200990Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6201030Z         iteration=0,
2025-01-14T13:16:42.6201080Z     ):
2025-01-14T13:16:42.6201180Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6201250Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6201300Z         else:
2025-01-14T13:16:42.6201350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6201390Z     
2025-01-14T13:16:42.6201630Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6201710Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6201760Z         )
2025-01-14T13:16:42.6201810Z     
2025-01-14T13:16:42.6201910Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6202000Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6202120Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6202170Z         else:
2025-01-14T13:16:42.6202230Z             continuum_state = None
2025-01-14T13:16:42.6202310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6202390Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6202460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6202540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6202620Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6202690Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6202760Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6202810Z         ).to_numba(
2025-01-14T13:16:42.6202860Z             macro_atom_state,
2025-01-14T13:16:42.6202930Z             self.line_interaction_type,
2025-01-14T13:16:42.6202970Z         )
2025-01-14T13:16:42.6203050Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6203270Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6203310Z         ]
2025-01-14T13:16:42.6203560Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6203570Z 
2025-01-14T13:16:42.6203690Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6203840Z _________ ERROR at setup of test_hdf_transport_state[virt_packet_nus] __________
2025-01-14T13:16:42.6203840Z 
2025-01-14T13:16:42.6204370Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6204770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6204780Z 
2025-01-14T13:16:42.6204840Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6205010Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6205080Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6205140Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6205280Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6205330Z         )
2025-01-14T13:16:42.6205390Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6205440Z >       sim.run_final()
2025-01-14T13:16:42.6205450Z 
2025-01-14T13:16:42.6205510Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6205600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6205680Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6205790Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6205850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6205970Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6206060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6206070Z 
2025-01-14T13:16:42.6206290Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6206450Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6206630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6206920Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6207050Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6207170Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6207170Z 
2025-01-14T13:16:42.6207240Z     def initialize_transport_state(
2025-01-14T13:16:42.6207290Z         self,
2025-01-14T13:16:42.6207340Z         simulation_state,
2025-01-14T13:16:42.6207400Z         opacity_state,
2025-01-14T13:16:42.6207450Z         macro_atom_state,
2025-01-14T13:16:42.6207490Z         plasma,
2025-01-14T13:16:42.6207540Z         no_of_packets,
2025-01-14T13:16:42.6207600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6207650Z         iteration=0,
2025-01-14T13:16:42.6207700Z     ):
2025-01-14T13:16:42.6207790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6207870Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6207920Z         else:
2025-01-14T13:16:42.6207980Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6208020Z     
2025-01-14T13:16:42.6208130Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6208200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6208250Z         )
2025-01-14T13:16:42.6208290Z     
2025-01-14T13:16:42.6208400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6208480Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6208610Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6208650Z         else:
2025-01-14T13:16:42.6208710Z             continuum_state = None
2025-01-14T13:16:42.6208790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6208870Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6208940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6209020Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6209100Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6209440Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6209510Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6209560Z         ).to_numba(
2025-01-14T13:16:42.6209620Z             macro_atom_state,
2025-01-14T13:16:42.6209670Z             self.line_interaction_type,
2025-01-14T13:16:42.6209730Z         )
2025-01-14T13:16:42.6209800Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6210030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6210080Z         ]
2025-01-14T13:16:42.6210320Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6210320Z 
2025-01-14T13:16:42.6210440Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6210580Z _______ ERROR at setup of test_hdf_transport_state[virt_packet_energies] _______
2025-01-14T13:16:42.6210590Z 
2025-01-14T13:16:42.6211110Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6211400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6211410Z 
2025-01-14T13:16:42.6211480Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6211650Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6211720Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6211790Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6211930Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6212460Z         )
2025-01-14T13:16:42.6212530Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6212600Z >       sim.run_final()
2025-01-14T13:16:42.6212600Z 
2025-01-14T13:16:42.6212660Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6212740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6212820Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6212930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6213000Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6213130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6213220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6213220Z 
2025-01-14T13:16:42.6213430Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6213590Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6213770Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6214000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6214120Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6214230Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6214230Z 
2025-01-14T13:16:42.6214310Z     def initialize_transport_state(
2025-01-14T13:16:42.6214350Z         self,
2025-01-14T13:16:42.6214400Z         simulation_state,
2025-01-14T13:16:42.6214460Z         opacity_state,
2025-01-14T13:16:42.6214510Z         macro_atom_state,
2025-01-14T13:16:42.6214560Z         plasma,
2025-01-14T13:16:42.6214610Z         no_of_packets,
2025-01-14T13:16:42.6214680Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6214730Z         iteration=0,
2025-01-14T13:16:42.6214770Z     ):
2025-01-14T13:16:42.6214880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6214950Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6215090Z         else:
2025-01-14T13:16:42.6215150Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6215190Z     
2025-01-14T13:16:42.6215310Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6215380Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6215430Z         )
2025-01-14T13:16:42.6215480Z     
2025-01-14T13:16:42.6215580Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6215670Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6215800Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6215850Z         else:
2025-01-14T13:16:42.6215910Z             continuum_state = None
2025-01-14T13:16:42.6215990Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6216080Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6216150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6216240Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6216320Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6216390Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6216460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6216500Z         ).to_numba(
2025-01-14T13:16:42.6216560Z             macro_atom_state,
2025-01-14T13:16:42.6216620Z             self.line_interaction_type,
2025-01-14T13:16:42.6216660Z         )
2025-01-14T13:16:42.6216730Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6216960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6217010Z         ]
2025-01-14T13:16:42.6217270Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6217330Z 
2025-01-14T13:16:42.6217460Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6217620Z ______ ERROR at setup of test_hdf_transport_state[virt_packet_initial_rs] ______
2025-01-14T13:16:42.6217620Z 
2025-01-14T13:16:42.6218160Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6218440Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6218440Z 
2025-01-14T13:16:42.6218510Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6218690Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6218760Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6218830Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6218970Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6219020Z         )
2025-01-14T13:16:42.6219080Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6219140Z >       sim.run_final()
2025-01-14T13:16:42.6219140Z 
2025-01-14T13:16:42.6219200Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6219290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6219370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6219480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6219550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6219680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6219760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6219770Z 
2025-01-14T13:16:42.6219990Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6220210Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6220390Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6220620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6220740Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6220850Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6220860Z 
2025-01-14T13:16:42.6220920Z     def initialize_transport_state(
2025-01-14T13:16:42.6220970Z         self,
2025-01-14T13:16:42.6221020Z         simulation_state,
2025-01-14T13:16:42.6221070Z         opacity_state,
2025-01-14T13:16:42.6221120Z         macro_atom_state,
2025-01-14T13:16:42.6221170Z         plasma,
2025-01-14T13:16:42.6221220Z         no_of_packets,
2025-01-14T13:16:42.6221280Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6221330Z         iteration=0,
2025-01-14T13:16:42.6221380Z     ):
2025-01-14T13:16:42.6221480Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6221550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6221600Z         else:
2025-01-14T13:16:42.6221660Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6221710Z     
2025-01-14T13:16:42.6221810Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6221880Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6221930Z         )
2025-01-14T13:16:42.6221980Z     
2025-01-14T13:16:42.6222090Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6222180Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6222310Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6222410Z         else:
2025-01-14T13:16:42.6222470Z             continuum_state = None
2025-01-14T13:16:42.6222550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6222640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6222710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6222800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6222870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6222940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6223010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6223060Z         ).to_numba(
2025-01-14T13:16:42.6223110Z             macro_atom_state,
2025-01-14T13:16:42.6223180Z             self.line_interaction_type,
2025-01-14T13:16:42.6223230Z         )
2025-01-14T13:16:42.6223310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6223540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6223590Z         ]
2025-01-14T13:16:42.6223850Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6223850Z 
2025-01-14T13:16:42.6223980Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6224130Z _____ ERROR at setup of test_hdf_transport_state[virt_packet_initial_mus] ______
2025-01-14T13:16:42.6224130Z 
2025-01-14T13:16:42.6224650Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6224940Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6224940Z 
2025-01-14T13:16:42.6225010Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6225170Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6225310Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6225370Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6225520Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6225560Z         )
2025-01-14T13:16:42.6225630Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6225680Z >       sim.run_final()
2025-01-14T13:16:42.6225680Z 
2025-01-14T13:16:42.6225740Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6225830Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6225900Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6226010Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6226080Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6226210Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6226300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6226300Z 
2025-01-14T13:16:42.6226520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6226680Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6226860Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6227080Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6227200Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6227310Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6227320Z 
2025-01-14T13:16:42.6227380Z     def initialize_transport_state(
2025-01-14T13:16:42.6227430Z         self,
2025-01-14T13:16:42.6227480Z         simulation_state,
2025-01-14T13:16:42.6227580Z         opacity_state,
2025-01-14T13:16:42.6227640Z         macro_atom_state,
2025-01-14T13:16:42.6227690Z         plasma,
2025-01-14T13:16:42.6227740Z         no_of_packets,
2025-01-14T13:16:42.6227790Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6227840Z         iteration=0,
2025-01-14T13:16:42.6227880Z     ):
2025-01-14T13:16:42.6228090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6228170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6228220Z         else:
2025-01-14T13:16:42.6228280Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6228330Z     
2025-01-14T13:16:42.6228440Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6228510Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6228550Z         )
2025-01-14T13:16:42.6228600Z     
2025-01-14T13:16:42.6228700Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6228790Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6228910Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6228960Z         else:
2025-01-14T13:16:42.6229020Z             continuum_state = None
2025-01-14T13:16:42.6229100Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6229180Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6229240Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6229320Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6229390Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6229460Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6229520Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6229570Z         ).to_numba(
2025-01-14T13:16:42.6229620Z             macro_atom_state,
2025-01-14T13:16:42.6229690Z             self.line_interaction_type,
2025-01-14T13:16:42.6229730Z         )
2025-01-14T13:16:42.6229810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6230030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6230380Z         ]
2025-01-14T13:16:42.6230630Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6230630Z 
2025-01-14T13:16:42.6230750Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6230900Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_interaction_in_nu] _
2025-01-14T13:16:42.6230910Z 
2025-01-14T13:16:42.6231420Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6231790Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6231840Z 
2025-01-14T13:16:42.6231930Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6232090Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6232160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6232230Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6232370Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6232410Z         )
2025-01-14T13:16:42.6232470Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6232530Z >       sim.run_final()
2025-01-14T13:16:42.6232530Z 
2025-01-14T13:16:42.6232590Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6232680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6232770Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6232870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6233320Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6233450Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6233540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6233540Z 
2025-01-14T13:16:42.6233770Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6233940Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6234110Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6234330Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6234460Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6234560Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6234570Z 
2025-01-14T13:16:42.6234630Z     def initialize_transport_state(
2025-01-14T13:16:42.6234680Z         self,
2025-01-14T13:16:42.6234730Z         simulation_state,
2025-01-14T13:16:42.6234780Z         opacity_state,
2025-01-14T13:16:42.6234840Z         macro_atom_state,
2025-01-14T13:16:42.6234880Z         plasma,
2025-01-14T13:16:42.6234930Z         no_of_packets,
2025-01-14T13:16:42.6234990Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6235040Z         iteration=0,
2025-01-14T13:16:42.6235080Z     ):
2025-01-14T13:16:42.6235170Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6235250Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6235290Z         else:
2025-01-14T13:16:42.6235350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6235390Z     
2025-01-14T13:16:42.6235500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6235560Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6235620Z         )
2025-01-14T13:16:42.6235660Z     
2025-01-14T13:16:42.6235760Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6235970Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6236090Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6236140Z         else:
2025-01-14T13:16:42.6236200Z             continuum_state = None
2025-01-14T13:16:42.6236270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6236360Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6236440Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6236520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6236600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6236660Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6236730Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6236770Z         ).to_numba(
2025-01-14T13:16:42.6236830Z             macro_atom_state,
2025-01-14T13:16:42.6236890Z             self.line_interaction_type,
2025-01-14T13:16:42.6236940Z         )
2025-01-14T13:16:42.6237010Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6237240Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6237280Z         ]
2025-01-14T13:16:42.6237530Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6237530Z 
2025-01-14T13:16:42.6237650Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6237800Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_interaction_in_r] _
2025-01-14T13:16:42.6237800Z 
2025-01-14T13:16:42.6238310Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6238700Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6238700Z 
2025-01-14T13:16:42.6238770Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6238930Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6239010Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6239070Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6239210Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6239250Z         )
2025-01-14T13:16:42.6239310Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6239370Z >       sim.run_final()
2025-01-14T13:16:42.6239370Z 
2025-01-14T13:16:42.6239420Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6239510Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6239580Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6239700Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6239770Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6239890Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6239980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6239980Z 
2025-01-14T13:16:42.6240190Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6240350Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6240520Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6240750Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6240880Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6240990Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6241060Z 
2025-01-14T13:16:42.6241120Z     def initialize_transport_state(
2025-01-14T13:16:42.6241170Z         self,
2025-01-14T13:16:42.6241220Z         simulation_state,
2025-01-14T13:16:42.6241270Z         opacity_state,
2025-01-14T13:16:42.6241330Z         macro_atom_state,
2025-01-14T13:16:42.6241370Z         plasma,
2025-01-14T13:16:42.6241420Z         no_of_packets,
2025-01-14T13:16:42.6241480Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6241540Z         iteration=0,
2025-01-14T13:16:42.6241580Z     ):
2025-01-14T13:16:42.6241680Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6241740Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6241800Z         else:
2025-01-14T13:16:42.6241850Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6241890Z     
2025-01-14T13:16:42.6242000Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6242080Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6242120Z         )
2025-01-14T13:16:42.6242170Z     
2025-01-14T13:16:42.6242270Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6242360Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6242490Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6242530Z         else:
2025-01-14T13:16:42.6242600Z             continuum_state = None
2025-01-14T13:16:42.6242670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6242770Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6242850Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6242930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6243010Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6243170Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6243230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6243280Z         ).to_numba(
2025-01-14T13:16:42.6243340Z             macro_atom_state,
2025-01-14T13:16:42.6243410Z             self.line_interaction_type,
2025-01-14T13:16:42.6243450Z         )
2025-01-14T13:16:42.6243520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6243750Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6243790Z         ]
2025-01-14T13:16:42.6244040Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6244050Z 
2025-01-14T13:16:42.6244160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6244320Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_interaction_type] _
2025-01-14T13:16:42.6244320Z 
2025-01-14T13:16:42.6244830Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6245130Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6245130Z 
2025-01-14T13:16:42.6245200Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6245360Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6245430Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6245500Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6245640Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6245690Z         )
2025-01-14T13:16:42.6245760Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6245810Z >       sim.run_final()
2025-01-14T13:16:42.6245810Z 
2025-01-14T13:16:42.6245880Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6246030Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6246110Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6246240Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6246310Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6246430Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6246510Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6246510Z 
2025-01-14T13:16:42.6246730Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6246880Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6247060Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6247280Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6247410Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6247530Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6247530Z 
2025-01-14T13:16:42.6247590Z     def initialize_transport_state(
2025-01-14T13:16:42.6247640Z         self,
2025-01-14T13:16:42.6247690Z         simulation_state,
2025-01-14T13:16:42.6247740Z         opacity_state,
2025-01-14T13:16:42.6247790Z         macro_atom_state,
2025-01-14T13:16:42.6247840Z         plasma,
2025-01-14T13:16:42.6247880Z         no_of_packets,
2025-01-14T13:16:42.6247940Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6247990Z         iteration=0,
2025-01-14T13:16:42.6248040Z     ):
2025-01-14T13:16:42.6248130Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6248210Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6248310Z         else:
2025-01-14T13:16:42.6248370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6248410Z     
2025-01-14T13:16:42.6248520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6248590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6248640Z         )
2025-01-14T13:16:42.6248680Z     
2025-01-14T13:16:42.6248780Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6248870Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6248990Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6249030Z         else:
2025-01-14T13:16:42.6249080Z             continuum_state = None
2025-01-14T13:16:42.6253660Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6253820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6253890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6253980Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6254060Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6254140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6254200Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6254250Z         ).to_numba(
2025-01-14T13:16:42.6254300Z             macro_atom_state,
2025-01-14T13:16:42.6254370Z             self.line_interaction_type,
2025-01-14T13:16:42.6254410Z         )
2025-01-14T13:16:42.6254490Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6254710Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6254760Z         ]
2025-01-14T13:16:42.6255000Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6255010Z 
2025-01-14T13:16:42.6255120Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6255290Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_line_interaction_in_id] _
2025-01-14T13:16:42.6255870Z 
2025-01-14T13:16:42.6256400Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6256680Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6256680Z 
2025-01-14T13:16:42.6256740Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6256910Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6256990Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6257050Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6257190Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6257240Z         )
2025-01-14T13:16:42.6257310Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6257360Z >       sim.run_final()
2025-01-14T13:16:42.6257370Z 
2025-01-14T13:16:42.6257430Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6257520Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6257590Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6257700Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6257770Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6257900Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6257980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6257990Z 
2025-01-14T13:16:42.6258200Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6258770Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6258950Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6259180Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6259300Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6259410Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6259410Z 
2025-01-14T13:16:42.6259480Z     def initialize_transport_state(
2025-01-14T13:16:42.6259520Z         self,
2025-01-14T13:16:42.6259580Z         simulation_state,
2025-01-14T13:16:42.6259620Z         opacity_state,
2025-01-14T13:16:42.6259680Z         macro_atom_state,
2025-01-14T13:16:42.6259720Z         plasma,
2025-01-14T13:16:42.6259770Z         no_of_packets,
2025-01-14T13:16:42.6259830Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6259880Z         iteration=0,
2025-01-14T13:16:42.6259940Z     ):
2025-01-14T13:16:42.6260030Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6260110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6260150Z         else:
2025-01-14T13:16:42.6260210Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6260250Z     
2025-01-14T13:16:42.6260350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6260420Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6260470Z         )
2025-01-14T13:16:42.6260510Z     
2025-01-14T13:16:42.6260610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6260700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6260830Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6260870Z         else:
2025-01-14T13:16:42.6260930Z             continuum_state = None
2025-01-14T13:16:42.6261920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6262450Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6262660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6263540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6263750Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6264170Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6264460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6264610Z         ).to_numba(
2025-01-14T13:16:42.6264780Z             macro_atom_state,
2025-01-14T13:16:42.6264970Z             self.line_interaction_type,
2025-01-14T13:16:42.6265120Z         )
2025-01-14T13:16:42.6265350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6266400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6266560Z         ]
2025-01-14T13:16:42.6267210Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6267260Z 
2025-01-14T13:16:42.6267420Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6267610Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_line_interaction_out_id] _
2025-01-14T13:16:42.6267610Z 
2025-01-14T13:16:42.6268300Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6268590Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6268600Z 
2025-01-14T13:16:42.6268670Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6268840Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6269150Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6269220Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6269370Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6269420Z         )
2025-01-14T13:16:42.6269480Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6269540Z >       sim.run_final()
2025-01-14T13:16:42.6269540Z 
2025-01-14T13:16:42.6269590Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6269690Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6269770Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6269880Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6269950Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6270070Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6270170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6270170Z 
2025-01-14T13:16:42.6270390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6270560Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6270750Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6270970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6271090Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6271210Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6271210Z 
2025-01-14T13:16:42.6271280Z     def initialize_transport_state(
2025-01-14T13:16:42.6271330Z         self,
2025-01-14T13:16:42.6271390Z         simulation_state,
2025-01-14T13:16:42.6271440Z         opacity_state,
2025-01-14T13:16:42.6271500Z         macro_atom_state,
2025-01-14T13:16:42.6271540Z         plasma,
2025-01-14T13:16:42.6271600Z         no_of_packets,
2025-01-14T13:16:42.6271660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6271810Z         iteration=0,
2025-01-14T13:16:42.6271850Z     ):
2025-01-14T13:16:42.6271960Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6272040Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6272090Z         else:
2025-01-14T13:16:42.6272150Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6272190Z     
2025-01-14T13:16:42.6272300Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6272370Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6272430Z         )
2025-01-14T13:16:42.6272470Z     
2025-01-14T13:16:42.6272570Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6272660Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6272790Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6272830Z         else:
2025-01-14T13:16:42.6272900Z             continuum_state = None
2025-01-14T13:16:42.6272970Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6273060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6273130Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6273220Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6273300Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6273370Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6273440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6273480Z         ).to_numba(
2025-01-14T13:16:42.6273540Z             macro_atom_state,
2025-01-14T13:16:42.6273600Z             self.line_interaction_type,
2025-01-14T13:16:42.6273650Z         )
2025-01-14T13:16:42.6273720Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6273950Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6274100Z         ]
2025-01-14T13:16:42.6274350Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6274360Z 
2025-01-14T13:16:42.6274470Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6274650Z _ ERROR at setup of test_hdf_transport_state[virt_packet_last_line_interaction_shell_id] _
2025-01-14T13:16:42.6274660Z 
2025-01-14T13:16:42.6275170Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6275460Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6275470Z 
2025-01-14T13:16:42.6275540Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.6275700Z     def simulation_verysimple_vpacket_tracking(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6275780Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6275840Z         sim = Simulation.from_config(
2025-01-14T13:16:42.6275990Z             config_verysimple, atom_data=atomic_data, virtual_packet_logging=True
2025-01-14T13:16:42.6276030Z         )
2025-01-14T13:16:42.6276090Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.6276140Z >       sim.run_final()
2025-01-14T13:16:42.6276140Z 
2025-01-14T13:16:42.6276200Z tardis/conftest.py:244: 
2025-01-14T13:16:42.6276290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6276360Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.6276480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6276550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6276680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6276760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6276830Z 
2025-01-14T13:16:42.6277060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30ee72c30>
2025-01-14T13:16:42.6277230Z simulation_state = <tardis.model.base.SimulationState object at 0x30e896480>
2025-01-14T13:16:42.6277410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30e876780>
2025-01-14T13:16:42.6277640Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x30e8774a0>
2025-01-14T13:16:42.6277760Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e8b7bf0>
2025-01-14T13:16:42.6277880Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.6277880Z 
2025-01-14T13:16:42.6277940Z     def initialize_transport_state(
2025-01-14T13:16:42.6277990Z         self,
2025-01-14T13:16:42.6278050Z         simulation_state,
2025-01-14T13:16:42.6278100Z         opacity_state,
2025-01-14T13:16:42.6278150Z         macro_atom_state,
2025-01-14T13:16:42.6278200Z         plasma,
2025-01-14T13:16:42.6278250Z         no_of_packets,
2025-01-14T13:16:42.6278310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6278360Z         iteration=0,
2025-01-14T13:16:42.6278400Z     ):
2025-01-14T13:16:42.6278500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6278570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6278620Z         else:
2025-01-14T13:16:42.6278670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6278720Z     
2025-01-14T13:16:42.6278820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6278890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6278930Z         )
2025-01-14T13:16:42.6278980Z     
2025-01-14T13:16:42.6279080Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6279220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6279340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6279390Z         else:
2025-01-14T13:16:42.6279450Z             continuum_state = None
2025-01-14T13:16:42.6279530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6279610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6279680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6279760Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6279830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6279900Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6279960Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6280010Z         ).to_numba(
2025-01-14T13:16:42.6280070Z             macro_atom_state,
2025-01-14T13:16:42.6280130Z             self.line_interaction_type,
2025-01-14T13:16:42.6280180Z         )
2025-01-14T13:16:42.6280260Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6280480Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6280530Z         ]
2025-01-14T13:16:42.6280770Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6280780Z 
2025-01-14T13:16:42.6280900Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6281030Z ____________________ ERROR at setup of test_thomson_scatter ____________________
2025-01-14T13:16:42.6281030Z 
2025-01-14T13:16:42.6281540Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6281830Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6282110Z 
2025-01-14T13:16:42.6282190Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6282330Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6282400Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6282540Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6282600Z >       sim.iterate(10)
2025-01-14T13:16:42.6282600Z 
2025-01-14T13:16:42.6282700Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6282790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6282860Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6282980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6283070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6283070Z 
2025-01-14T13:16:42.6283290Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6283450Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6283630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6283850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6284210Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6284330Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6284330Z 
2025-01-14T13:16:42.6284390Z     def initialize_transport_state(
2025-01-14T13:16:42.6284440Z         self,
2025-01-14T13:16:42.6284490Z         simulation_state,
2025-01-14T13:16:42.6284540Z         opacity_state,
2025-01-14T13:16:42.6284590Z         macro_atom_state,
2025-01-14T13:16:42.6284970Z         plasma,
2025-01-14T13:16:42.6285020Z         no_of_packets,
2025-01-14T13:16:42.6285080Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6285130Z         iteration=0,
2025-01-14T13:16:42.6285180Z     ):
2025-01-14T13:16:42.6285280Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6285350Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6285400Z         else:
2025-01-14T13:16:42.6285460Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6285500Z     
2025-01-14T13:16:42.6285600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6285680Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6285720Z         )
2025-01-14T13:16:42.6285760Z     
2025-01-14T13:16:42.6285860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6285950Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6286080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6286130Z         else:
2025-01-14T13:16:42.6286190Z             continuum_state = None
2025-01-14T13:16:42.6286270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6286360Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6286430Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6286520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6286590Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6286660Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6286730Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6286780Z         ).to_numba(
2025-01-14T13:16:42.6286840Z             macro_atom_state,
2025-01-14T13:16:42.6286900Z             self.line_interaction_type,
2025-01-14T13:16:42.6286950Z         )
2025-01-14T13:16:42.6287030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6287250Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6287300Z         ]
2025-01-14T13:16:42.6287610Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6287620Z 
2025-01-14T13:16:42.6287740Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6287870Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.6288290Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.6288640Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.6288780Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6288950Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.6289080Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6289140Z 	
2025-01-14T13:16:42.6289250Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.6289380Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.6289780Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.6289960Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.6290040Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.6290100Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.6290220Z ____________________ ERROR at setup of test_line_scatter[0] ____________________
2025-01-14T13:16:42.6290230Z 
2025-01-14T13:16:42.6290740Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6291120Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6291120Z 
2025-01-14T13:16:42.6291190Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6291320Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6291400Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6291540Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6291590Z >       sim.iterate(10)
2025-01-14T13:16:42.6291600Z 
2025-01-14T13:16:42.6291690Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6291780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6291850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6291970Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6292060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6292070Z 
2025-01-14T13:16:42.6292280Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6292450Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6292620Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6292850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6292980Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6293090Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6293090Z 
2025-01-14T13:16:42.6293150Z     def initialize_transport_state(
2025-01-14T13:16:42.6293200Z         self,
2025-01-14T13:16:42.6293250Z         simulation_state,
2025-01-14T13:16:42.6293300Z         opacity_state,
2025-01-14T13:16:42.6293360Z         macro_atom_state,
2025-01-14T13:16:42.6293410Z         plasma,
2025-01-14T13:16:42.6293530Z         no_of_packets,
2025-01-14T13:16:42.6293580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6293630Z         iteration=0,
2025-01-14T13:16:42.6293670Z     ):
2025-01-14T13:16:42.6293770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6293830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6293880Z         else:
2025-01-14T13:16:42.6293930Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6293980Z     
2025-01-14T13:16:42.6294080Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6294150Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6294190Z         )
2025-01-14T13:16:42.6294240Z     
2025-01-14T13:16:42.6294340Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6294430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6294560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6294610Z         else:
2025-01-14T13:16:42.6294670Z             continuum_state = None
2025-01-14T13:16:42.6294750Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6294850Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6294910Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6295000Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6295070Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6295140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6295210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6295260Z         ).to_numba(
2025-01-14T13:16:42.6295370Z             macro_atom_state,
2025-01-14T13:16:42.6295500Z             self.line_interaction_type,
2025-01-14T13:16:42.6295550Z         )
2025-01-14T13:16:42.6295820Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6296060Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6296110Z         ]
2025-01-14T13:16:42.6296370Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6296380Z 
2025-01-14T13:16:42.6296490Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6296620Z ____________________ ERROR at setup of test_line_scatter[1] ____________________
2025-01-14T13:16:42.6296620Z 
2025-01-14T13:16:42.6297150Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6297440Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6297440Z 
2025-01-14T13:16:42.6297510Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6297640Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6297710Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6297850Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6297910Z >       sim.iterate(10)
2025-01-14T13:16:42.6297910Z 
2025-01-14T13:16:42.6298000Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6298090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6298160Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6298290Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6298380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6298390Z 
2025-01-14T13:16:42.6298600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6298870Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6299050Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6299280Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6299410Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6299510Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6299520Z 
2025-01-14T13:16:42.6299580Z     def initialize_transport_state(
2025-01-14T13:16:42.6299630Z         self,
2025-01-14T13:16:42.6299680Z         simulation_state,
2025-01-14T13:16:42.6299740Z         opacity_state,
2025-01-14T13:16:42.6299790Z         macro_atom_state,
2025-01-14T13:16:42.6299840Z         plasma,
2025-01-14T13:16:42.6299900Z         no_of_packets,
2025-01-14T13:16:42.6299950Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6300000Z         iteration=0,
2025-01-14T13:16:42.6300050Z     ):
2025-01-14T13:16:42.6300160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6300230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6300300Z         else:
2025-01-14T13:16:42.6300360Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6300400Z     
2025-01-14T13:16:42.6300510Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6300590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6300630Z         )
2025-01-14T13:16:42.6300680Z     
2025-01-14T13:16:42.6300790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6300880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6301120Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6301270Z         else:
2025-01-14T13:16:42.6301330Z             continuum_state = None
2025-01-14T13:16:42.6301410Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6301510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6301570Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6301660Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6301730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6301800Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6301870Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6301920Z         ).to_numba(
2025-01-14T13:16:42.6301970Z             macro_atom_state,
2025-01-14T13:16:42.6302040Z             self.line_interaction_type,
2025-01-14T13:16:42.6302080Z         )
2025-01-14T13:16:42.6302150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6302370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6302420Z         ]
2025-01-14T13:16:42.6302670Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6302680Z 
2025-01-14T13:16:42.6302790Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6302920Z ____________________ ERROR at setup of test_line_scatter[2] ____________________
2025-01-14T13:16:42.6302920Z 
2025-01-14T13:16:42.6303430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6303720Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6303730Z 
2025-01-14T13:16:42.6303800Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6303940Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6304290Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6304440Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6304500Z >       sim.iterate(10)
2025-01-14T13:16:42.6304500Z 
2025-01-14T13:16:42.6304590Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6304680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6304750Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6304880Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6304970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6304970Z 
2025-01-14T13:16:42.6305180Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6305360Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6305540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6305770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6306380Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6307710Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6307740Z 
2025-01-14T13:16:42.6307820Z     def initialize_transport_state(
2025-01-14T13:16:42.6307870Z         self,
2025-01-14T13:16:42.6307930Z         simulation_state,
2025-01-14T13:16:42.6307980Z         opacity_state,
2025-01-14T13:16:42.6308040Z         macro_atom_state,
2025-01-14T13:16:42.6308090Z         plasma,
2025-01-14T13:16:42.6308280Z         no_of_packets,
2025-01-14T13:16:42.6308340Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6308390Z         iteration=0,
2025-01-14T13:16:42.6309070Z     ):
2025-01-14T13:16:42.6309170Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6309240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6309300Z         else:
2025-01-14T13:16:42.6309350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6309390Z     
2025-01-14T13:16:42.6309500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6309570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6309620Z         )
2025-01-14T13:16:42.6309660Z     
2025-01-14T13:16:42.6309760Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6309850Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6309980Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6310020Z         else:
2025-01-14T13:16:42.6310090Z             continuum_state = None
2025-01-14T13:16:42.6310170Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6310270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6310340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6310430Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6310500Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6310580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6310640Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6310690Z         ).to_numba(
2025-01-14T13:16:42.6310740Z             macro_atom_state,
2025-01-14T13:16:42.6310800Z             self.line_interaction_type,
2025-01-14T13:16:42.6310850Z         )
2025-01-14T13:16:42.6310930Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6311150Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6311190Z         ]
2025-01-14T13:16:42.6311450Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6311450Z 
2025-01-14T13:16:42.6311660Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6311810Z _________ ERROR at setup of test_line_emission[test_packet0-expected0] _________
2025-01-14T13:16:42.6311810Z 
2025-01-14T13:16:42.6312330Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6312620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6312620Z 
2025-01-14T13:16:42.6312690Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6312820Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6312900Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6313050Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6313100Z >       sim.iterate(10)
2025-01-14T13:16:42.6313110Z 
2025-01-14T13:16:42.6313200Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6313290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6313370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6313490Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6313570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6313580Z 
2025-01-14T13:16:42.6313790Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6313950Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6314140Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6314480Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6314610Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6314720Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6314720Z 
2025-01-14T13:16:42.6314780Z     def initialize_transport_state(
2025-01-14T13:16:42.6314830Z         self,
2025-01-14T13:16:42.6314890Z         simulation_state,
2025-01-14T13:16:42.6314950Z         opacity_state,
2025-01-14T13:16:42.6315000Z         macro_atom_state,
2025-01-14T13:16:42.6315050Z         plasma,
2025-01-14T13:16:42.6315100Z         no_of_packets,
2025-01-14T13:16:42.6315160Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6315210Z         iteration=0,
2025-01-14T13:16:42.6315250Z     ):
2025-01-14T13:16:42.6315350Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6315420Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6315480Z         else:
2025-01-14T13:16:42.6315530Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6315580Z     
2025-01-14T13:16:42.6315680Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6315760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6315810Z         )
2025-01-14T13:16:42.6315860Z     
2025-01-14T13:16:42.6315960Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6321220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6321400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6321450Z         else:
2025-01-14T13:16:42.6321510Z             continuum_state = None
2025-01-14T13:16:42.6321590Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6321680Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6321750Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6321840Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6321910Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6322200Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6322260Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6322310Z         ).to_numba(
2025-01-14T13:16:42.6322370Z             macro_atom_state,
2025-01-14T13:16:42.6322420Z             self.line_interaction_type,
2025-01-14T13:16:42.6322480Z         )
2025-01-14T13:16:42.6322550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6322770Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6322810Z         ]
2025-01-14T13:16:42.6323060Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6323070Z 
2025-01-14T13:16:42.6323180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6323340Z _________ ERROR at setup of test_line_emission[test_packet1-expected1] _________
2025-01-14T13:16:42.6323340Z 
2025-01-14T13:16:42.6323860Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6324140Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6324140Z 
2025-01-14T13:16:42.6324210Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6324340Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6324410Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6324550Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6324690Z >       sim.iterate(10)
2025-01-14T13:16:42.6324690Z 
2025-01-14T13:16:42.6324790Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6324880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6324960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6325070Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6325160Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6325170Z 
2025-01-14T13:16:42.6325370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6325540Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6325710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6325930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6326050Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6326160Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6326160Z 
2025-01-14T13:16:42.6326230Z     def initialize_transport_state(
2025-01-14T13:16:42.6326280Z         self,
2025-01-14T13:16:42.6326330Z         simulation_state,
2025-01-14T13:16:42.6326380Z         opacity_state,
2025-01-14T13:16:42.6326440Z         macro_atom_state,
2025-01-14T13:16:42.6326480Z         plasma,
2025-01-14T13:16:42.6326540Z         no_of_packets,
2025-01-14T13:16:42.6326590Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6326640Z         iteration=0,
2025-01-14T13:16:42.6326690Z     ):
2025-01-14T13:16:42.6326790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6326860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6326910Z         else:
2025-01-14T13:16:42.6326960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6327010Z     
2025-01-14T13:16:42.6327130Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6327200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6327320Z         )
2025-01-14T13:16:42.6327370Z     
2025-01-14T13:16:42.6327480Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6327570Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6327700Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6327750Z         else:
2025-01-14T13:16:42.6327810Z             continuum_state = None
2025-01-14T13:16:42.6327880Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6327970Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6328030Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6328140Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6328220Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6328300Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6328370Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6328420Z         ).to_numba(
2025-01-14T13:16:42.6328490Z             macro_atom_state,
2025-01-14T13:16:42.6328550Z             self.line_interaction_type,
2025-01-14T13:16:42.6328590Z         )
2025-01-14T13:16:42.6328670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6328890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6328940Z         ]
2025-01-14T13:16:42.6329200Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6329200Z 
2025-01-14T13:16:42.6329310Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6329460Z _________ ERROR at setup of test_line_emission[test_packet2-expected2] _________
2025-01-14T13:16:42.6329560Z 
2025-01-14T13:16:42.6330100Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6330400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6330400Z 
2025-01-14T13:16:42.6330480Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6330600Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6330680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6330820Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6330870Z >       sim.iterate(10)
2025-01-14T13:16:42.6330880Z 
2025-01-14T13:16:42.6330970Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6331060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6331140Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6331260Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6331350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6331350Z 
2025-01-14T13:16:42.6331560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6331730Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6331900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6332120Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6332240Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6332340Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6332350Z 
2025-01-14T13:16:42.6332420Z     def initialize_transport_state(
2025-01-14T13:16:42.6332820Z         self,
2025-01-14T13:16:42.6332870Z         simulation_state,
2025-01-14T13:16:42.6332920Z         opacity_state,
2025-01-14T13:16:42.6332990Z         macro_atom_state,
2025-01-14T13:16:42.6333030Z         plasma,
2025-01-14T13:16:42.6333080Z         no_of_packets,
2025-01-14T13:16:42.6333140Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6333190Z         iteration=0,
2025-01-14T13:16:42.6333230Z     ):
2025-01-14T13:16:42.6333330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6333390Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6333450Z         else:
2025-01-14T13:16:42.6333500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6333540Z     
2025-01-14T13:16:42.6333650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6333720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6333770Z         )
2025-01-14T13:16:42.6333820Z     
2025-01-14T13:16:42.6333920Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6334010Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6334140Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6334190Z         else:
2025-01-14T13:16:42.6334250Z             continuum_state = None
2025-01-14T13:16:42.6334330Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6334410Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6334480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6334560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6334630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6334700Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6334770Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6335060Z         ).to_numba(
2025-01-14T13:16:42.6335120Z             macro_atom_state,
2025-01-14T13:16:42.6335190Z             self.line_interaction_type,
2025-01-14T13:16:42.6335240Z         )
2025-01-14T13:16:42.6335310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6335540Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6335590Z         ]
2025-01-14T13:16:42.6335840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6335840Z 
2025-01-14T13:16:42.6335950Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6336080Z ________________ ERROR at setup of test_macro_atom[1963-10015] _________________
2025-01-14T13:16:42.6336080Z 
2025-01-14T13:16:42.6336600Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6336890Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6336890Z 
2025-01-14T13:16:42.6336960Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6337090Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6337160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6337300Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6337350Z >       sim.iterate(10)
2025-01-14T13:16:42.6337350Z 
2025-01-14T13:16:42.6337440Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6337530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6337600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6337730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6337820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6337890Z 
2025-01-14T13:16:42.6338100Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6338260Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6338440Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6338670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6338790Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6338900Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6338900Z 
2025-01-14T13:16:42.6338970Z     def initialize_transport_state(
2025-01-14T13:16:42.6339020Z         self,
2025-01-14T13:16:42.6339080Z         simulation_state,
2025-01-14T13:16:42.6339130Z         opacity_state,
2025-01-14T13:16:42.6339180Z         macro_atom_state,
2025-01-14T13:16:42.6339230Z         plasma,
2025-01-14T13:16:42.6339280Z         no_of_packets,
2025-01-14T13:16:42.6339340Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6339390Z         iteration=0,
2025-01-14T13:16:42.6339430Z     ):
2025-01-14T13:16:42.6339520Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6339590Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6339640Z         else:
2025-01-14T13:16:42.6339690Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6339730Z     
2025-01-14T13:16:42.6339840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6339910Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6339960Z         )
2025-01-14T13:16:42.6340010Z     
2025-01-14T13:16:42.6340110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6340250Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6340380Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6340420Z         else:
2025-01-14T13:16:42.6340480Z             continuum_state = None
2025-01-14T13:16:42.6340560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6340650Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6340720Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6340800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6340870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6340940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6341010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6341050Z         ).to_numba(
2025-01-14T13:16:42.6341110Z             macro_atom_state,
2025-01-14T13:16:42.6341160Z             self.line_interaction_type,
2025-01-14T13:16:42.6341210Z         )
2025-01-14T13:16:42.6341280Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6341510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6341550Z         ]
2025-01-14T13:16:42.6341810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6341810Z 
2025-01-14T13:16:42.6341920Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6342050Z __________________ ERROR at setup of test_macro_atom[1-9993] ___________________
2025-01-14T13:16:42.6342050Z 
2025-01-14T13:16:42.6342560Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6342840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6342890Z 
2025-01-14T13:16:42.6342960Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6343090Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6343160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6343300Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6343360Z >       sim.iterate(10)
2025-01-14T13:16:42.6343360Z 
2025-01-14T13:16:42.6343460Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6343540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6343610Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6343730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6343820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6343830Z 
2025-01-14T13:16:42.6344040Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6344210Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6344380Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6344600Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6344730Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6344830Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6344830Z 
2025-01-14T13:16:42.6344900Z     def initialize_transport_state(
2025-01-14T13:16:42.6344940Z         self,
2025-01-14T13:16:42.6345000Z         simulation_state,
2025-01-14T13:16:42.6345050Z         opacity_state,
2025-01-14T13:16:42.6345100Z         macro_atom_state,
2025-01-14T13:16:42.6345200Z         plasma,
2025-01-14T13:16:42.6345250Z         no_of_packets,
2025-01-14T13:16:42.6345310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6345370Z         iteration=0,
2025-01-14T13:16:42.6345410Z     ):
2025-01-14T13:16:42.6345500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6345580Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6345630Z         else:
2025-01-14T13:16:42.6345680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6345740Z     
2025-01-14T13:16:42.6345890Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6345950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6346000Z         )
2025-01-14T13:16:42.6346040Z     
2025-01-14T13:16:42.6346140Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6346230Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6346360Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6346420Z         else:
2025-01-14T13:16:42.6346480Z             continuum_state = None
2025-01-14T13:16:42.6346560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6346650Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6346720Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6346800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6346870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6346940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6347000Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6347050Z         ).to_numba(
2025-01-14T13:16:42.6347100Z             macro_atom_state,
2025-01-14T13:16:42.6347160Z             self.line_interaction_type,
2025-01-14T13:16:42.6347210Z         )
2025-01-14T13:16:42.6347290Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6347520Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6347690Z         ]
2025-01-14T13:16:42.6347940Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6347940Z 
2025-01-14T13:16:42.6348060Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6348190Z _______________ ERROR at setup of test_macro_atom[2111963-17296] _______________
2025-01-14T13:16:42.6348190Z 
2025-01-14T13:16:42.6348840Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6349130Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6349140Z 
2025-01-14T13:16:42.6349200Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6349330Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6349410Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6349550Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6349600Z >       sim.iterate(10)
2025-01-14T13:16:42.6349600Z 
2025-01-14T13:16:42.6349700Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6349780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6349860Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6349980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6350070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6350070Z 
2025-01-14T13:16:42.6350270Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6350550Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6350990Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6351230Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6351360Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6351460Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6351460Z 
2025-01-14T13:16:42.6351530Z     def initialize_transport_state(
2025-01-14T13:16:42.6351570Z         self,
2025-01-14T13:16:42.6351630Z         simulation_state,
2025-01-14T13:16:42.6351670Z         opacity_state,
2025-01-14T13:16:42.6351730Z         macro_atom_state,
2025-01-14T13:16:42.6351770Z         plasma,
2025-01-14T13:16:42.6351830Z         no_of_packets,
2025-01-14T13:16:42.6351880Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6351940Z         iteration=0,
2025-01-14T13:16:42.6351990Z     ):
2025-01-14T13:16:42.6352090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6352160Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6352210Z         else:
2025-01-14T13:16:42.6352270Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6352310Z     
2025-01-14T13:16:42.6352420Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6352480Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6352530Z         )
2025-01-14T13:16:42.6352570Z     
2025-01-14T13:16:42.6352680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6352760Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6352890Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6352930Z         else:
2025-01-14T13:16:42.6353000Z             continuum_state = None
2025-01-14T13:16:42.6353070Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6353160Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6353880Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6353960Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6354040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6354110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6354170Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6354220Z         ).to_numba(
2025-01-14T13:16:42.6354280Z             macro_atom_state,
2025-01-14T13:16:42.6354350Z             self.line_interaction_type,
2025-01-14T13:16:42.6354410Z         )
2025-01-14T13:16:42.6354480Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6354700Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6354750Z         ]
2025-01-14T13:16:42.6355000Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6355000Z 
2025-01-14T13:16:42.6355120Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6355250Z ________________ ERROR at setup of test_macro_atom[10000-9993] _________________
2025-01-14T13:16:42.6355250Z 
2025-01-14T13:16:42.6355760Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6356030Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6356040Z 
2025-01-14T13:16:42.6356100Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6356230Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6356590Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6356740Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6356800Z >       sim.iterate(10)
2025-01-14T13:16:42.6356800Z 
2025-01-14T13:16:42.6356900Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6356980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6357060Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6357180Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6357260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6357270Z 
2025-01-14T13:16:42.6357480Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6357650Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6357830Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6358040Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6358170Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6358270Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6358270Z 
2025-01-14T13:16:42.6358340Z     def initialize_transport_state(
2025-01-14T13:16:42.6358390Z         self,
2025-01-14T13:16:42.6358440Z         simulation_state,
2025-01-14T13:16:42.6358490Z         opacity_state,
2025-01-14T13:16:42.6358540Z         macro_atom_state,
2025-01-14T13:16:42.6358580Z         plasma,
2025-01-14T13:16:42.6358630Z         no_of_packets,
2025-01-14T13:16:42.6358690Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6358740Z         iteration=0,
2025-01-14T13:16:42.6358780Z     ):
2025-01-14T13:16:42.6358880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6358970Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6359020Z         else:
2025-01-14T13:16:42.6359170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6359210Z     
2025-01-14T13:16:42.6359320Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6359390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6359430Z         )
2025-01-14T13:16:42.6359470Z     
2025-01-14T13:16:42.6359580Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6359660Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6359790Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6359830Z         else:
2025-01-14T13:16:42.6359900Z             continuum_state = None
2025-01-14T13:16:42.6359970Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6360070Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6360150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6360230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6360310Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6360370Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6360440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6360490Z         ).to_numba(
2025-01-14T13:16:42.6360560Z             macro_atom_state,
2025-01-14T13:16:42.6360630Z             self.line_interaction_type,
2025-01-14T13:16:42.6360670Z         )
2025-01-14T13:16:42.6360750Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6360970Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6361010Z         ]
2025-01-14T13:16:42.6361260Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6361350Z 
2025-01-14T13:16:42.6361470Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6361610Z ________ ERROR at setup of test_opacity_state_initialize[scatter-False] ________
2025-01-14T13:16:42.6361620Z 
2025-01-14T13:16:42.6362120Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6362400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6362400Z 
2025-01-14T13:16:42.6362470Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6362610Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6362680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6362820Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6362870Z >       sim.iterate(10)
2025-01-14T13:16:42.6362870Z 
2025-01-14T13:16:42.6362980Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6363060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6363140Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6364390Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6364800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6364810Z 
2025-01-14T13:16:42.6365390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6365830Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6366300Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6366880Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6367250Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6368260Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6368270Z 
2025-01-14T13:16:42.6368460Z     def initialize_transport_state(
2025-01-14T13:16:42.6368610Z         self,
2025-01-14T13:16:42.6368780Z         simulation_state,
2025-01-14T13:16:42.6368930Z         opacity_state,
2025-01-14T13:16:42.6369090Z         macro_atom_state,
2025-01-14T13:16:42.6369230Z         plasma,
2025-01-14T13:16:42.6369390Z         no_of_packets,
2025-01-14T13:16:42.6369570Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6369710Z         iteration=0,
2025-01-14T13:16:42.6369860Z     ):
2025-01-14T13:16:42.6370130Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6370330Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6370480Z         else:
2025-01-14T13:16:42.6370650Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6370790Z     
2025-01-14T13:16:42.6371090Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6371300Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6371440Z         )
2025-01-14T13:16:42.6372290Z     
2025-01-14T13:16:42.6372740Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6372990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6373330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6373460Z         else:
2025-01-14T13:16:42.6373650Z             continuum_state = None
2025-01-14T13:16:42.6373870Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6374100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6374390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6374610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6375230Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6375430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6375650Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6375790Z         ).to_numba(
2025-01-14T13:16:42.6375960Z             macro_atom_state,
2025-01-14T13:16:42.6376140Z             self.line_interaction_type,
2025-01-14T13:16:42.6376280Z         )
2025-01-14T13:16:42.6376500Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6377100Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6377250Z         ]
2025-01-14T13:16:42.6377920Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6377930Z 
2025-01-14T13:16:42.6378250Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6378640Z _______ ERROR at setup of test_opacity_state_initialize[macroatom-False] _______
2025-01-14T13:16:42.6378660Z 
2025-01-14T13:16:42.6380080Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6380870Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6380890Z 
2025-01-14T13:16:42.6381080Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6381430Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6381630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6382110Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6382300Z >       sim.iterate(10)
2025-01-14T13:16:42.6382310Z 
2025-01-14T13:16:42.6382600Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6382840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6383420Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6383770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6384010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6384020Z 
2025-01-14T13:16:42.6384590Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6385020Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6385500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6386310Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6386830Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6387160Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6387170Z 
2025-01-14T13:16:42.6387370Z     def initialize_transport_state(
2025-01-14T13:16:42.6387510Z         self,
2025-01-14T13:16:42.6387690Z         simulation_state,
2025-01-14T13:16:42.6387840Z         opacity_state,
2025-01-14T13:16:42.6388160Z         macro_atom_state,
2025-01-14T13:16:42.6388530Z         plasma,
2025-01-14T13:16:42.6388690Z         no_of_packets,
2025-01-14T13:16:42.6388870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6389020Z         iteration=0,
2025-01-14T13:16:42.6389160Z     ):
2025-01-14T13:16:42.6389430Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6389640Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6390350Z         else:
2025-01-14T13:16:42.6390570Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6390710Z     
2025-01-14T13:16:42.6391020Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6391740Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6391890Z         )
2025-01-14T13:16:42.6392050Z     
2025-01-14T13:16:42.6392350Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6392590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6392930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6393080Z         else:
2025-01-14T13:16:42.6393270Z             continuum_state = None
2025-01-14T13:16:42.6393500Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6393730Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6393930Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6394190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6394410Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6394630Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6394860Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6395030Z         ).to_numba(
2025-01-14T13:16:42.6395220Z             macro_atom_state,
2025-01-14T13:16:42.6395410Z             self.line_interaction_type,
2025-01-14T13:16:42.6395560Z         )
2025-01-14T13:16:42.6395770Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6396370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6396520Z         ]
2025-01-14T13:16:42.6397180Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6397190Z 
2025-01-14T13:16:42.6397520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6397910Z _______ ERROR at setup of test_opacity_state_initialize[macroatom-True] ________
2025-01-14T13:16:42.6397920Z 
2025-01-14T13:16:42.6399340Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6400990Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6401020Z 
2025-01-14T13:16:42.6401210Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6417500Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6418320Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6418770Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6418920Z >       sim.iterate(10)
2025-01-14T13:16:42.6418930Z 
2025-01-14T13:16:42.6419230Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6419950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6420060Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6420200Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6420300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6420300Z 
2025-01-14T13:16:42.6420520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6420680Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6420860Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6421080Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6421210Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6421310Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6421320Z 
2025-01-14T13:16:42.6421390Z     def initialize_transport_state(
2025-01-14T13:16:42.6422210Z         self,
2025-01-14T13:16:42.6422270Z         simulation_state,
2025-01-14T13:16:42.6422320Z         opacity_state,
2025-01-14T13:16:42.6422390Z         macro_atom_state,
2025-01-14T13:16:42.6422440Z         plasma,
2025-01-14T13:16:42.6422490Z         no_of_packets,
2025-01-14T13:16:42.6422550Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6422600Z         iteration=0,
2025-01-14T13:16:42.6422640Z     ):
2025-01-14T13:16:42.6422740Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6422820Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6422860Z         else:
2025-01-14T13:16:42.6422920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6422960Z     
2025-01-14T13:16:42.6423070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6423140Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6423190Z         )
2025-01-14T13:16:42.6423230Z     
2025-01-14T13:16:42.6423340Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6423430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6423560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6423600Z         else:
2025-01-14T13:16:42.6423660Z             continuum_state = None
2025-01-14T13:16:42.6423740Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6423820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6423890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6423980Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6424050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6424120Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6424190Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6424240Z         ).to_numba(
2025-01-14T13:16:42.6424290Z             macro_atom_state,
2025-01-14T13:16:42.6424360Z             self.line_interaction_type,
2025-01-14T13:16:42.6424420Z         )
2025-01-14T13:16:42.6424810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6425040Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6425090Z         ]
2025-01-14T13:16:42.6425350Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6425350Z 
2025-01-14T13:16:42.6425470Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6425620Z ______ ERROR at setup of test_opacity_state_initialize[downbranch-False] _______
2025-01-14T13:16:42.6425620Z 
2025-01-14T13:16:42.6426150Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6426440Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6426450Z 
2025-01-14T13:16:42.6426520Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6426650Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6426730Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6426880Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6426930Z >       sim.iterate(10)
2025-01-14T13:16:42.6426930Z 
2025-01-14T13:16:42.6427030Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6427120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6427190Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6427310Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6427480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6427490Z 
2025-01-14T13:16:42.6427700Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6427850Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6428030Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6428240Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6428370Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6428470Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6428470Z 
2025-01-14T13:16:42.6428620Z     def initialize_transport_state(
2025-01-14T13:16:42.6428670Z         self,
2025-01-14T13:16:42.6428720Z         simulation_state,
2025-01-14T13:16:42.6428780Z         opacity_state,
2025-01-14T13:16:42.6428830Z         macro_atom_state,
2025-01-14T13:16:42.6428880Z         plasma,
2025-01-14T13:16:42.6428930Z         no_of_packets,
2025-01-14T13:16:42.6428990Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6429040Z         iteration=0,
2025-01-14T13:16:42.6429080Z     ):
2025-01-14T13:16:42.6429180Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6429250Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6429290Z         else:
2025-01-14T13:16:42.6429350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6429390Z     
2025-01-14T13:16:42.6429500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6429570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6429620Z         )
2025-01-14T13:16:42.6429660Z     
2025-01-14T13:16:42.6429760Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6429840Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6429960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6430090Z         else:
2025-01-14T13:16:42.6430150Z             continuum_state = None
2025-01-14T13:16:42.6430230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6430310Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6430380Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6430460Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6430540Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6430610Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6430670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6430720Z         ).to_numba(
2025-01-14T13:16:42.6430770Z             macro_atom_state,
2025-01-14T13:16:42.6430830Z             self.line_interaction_type,
2025-01-14T13:16:42.6430870Z         )
2025-01-14T13:16:42.6430950Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6431170Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6431220Z         ]
2025-01-14T13:16:42.6431470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6431470Z 
2025-01-14T13:16:42.6431590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6431740Z _______ ERROR at setup of test_opacity_state_initialize[downbranch-True] _______
2025-01-14T13:16:42.6431740Z 
2025-01-14T13:16:42.6432260Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6432540Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6432600Z 
2025-01-14T13:16:42.6432670Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6432810Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6432880Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6433030Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6433080Z >       sim.iterate(10)
2025-01-14T13:16:42.6433080Z 
2025-01-14T13:16:42.6433190Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6433270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6433350Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6433610Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6433710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6433710Z 
2025-01-14T13:16:42.6433930Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6434090Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6434280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6434500Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6434640Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6434740Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6434740Z 
2025-01-14T13:16:42.6434810Z     def initialize_transport_state(
2025-01-14T13:16:42.6434860Z         self,
2025-01-14T13:16:42.6434910Z         simulation_state,
2025-01-14T13:16:42.6434970Z         opacity_state,
2025-01-14T13:16:42.6435020Z         macro_atom_state,
2025-01-14T13:16:42.6435060Z         plasma,
2025-01-14T13:16:42.6435110Z         no_of_packets,
2025-01-14T13:16:42.6435180Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6435230Z         iteration=0,
2025-01-14T13:16:42.6435350Z     ):
2025-01-14T13:16:42.6435460Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6435530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6435580Z         else:
2025-01-14T13:16:42.6435630Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6435670Z     
2025-01-14T13:16:42.6435780Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6435850Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6435900Z         )
2025-01-14T13:16:42.6435940Z     
2025-01-14T13:16:42.6436040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6436130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6436250Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6436290Z         else:
2025-01-14T13:16:42.6436350Z             continuum_state = None
2025-01-14T13:16:42.6436430Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6436510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6436590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6436670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6436740Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6436800Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6436870Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6436910Z         ).to_numba(
2025-01-14T13:16:42.6436970Z             macro_atom_state,
2025-01-14T13:16:42.6437030Z             self.line_interaction_type,
2025-01-14T13:16:42.6437070Z         )
2025-01-14T13:16:42.6437150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6437370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6437460Z         ]
2025-01-14T13:16:42.6437710Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6437720Z 
2025-01-14T13:16:42.6437830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6437970Z _____________ ERROR at setup of test_VPacketCollection_add_packet ______________
2025-01-14T13:16:42.6437970Z 
2025-01-14T13:16:42.6438480Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6438840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6438870Z 
2025-01-14T13:16:42.6438940Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6439070Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6439140Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6439290Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6439340Z >       sim.iterate(10)
2025-01-14T13:16:42.6439340Z 
2025-01-14T13:16:42.6439450Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6439530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6439600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6439730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6439810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6439810Z 
2025-01-14T13:16:42.6440030Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6440190Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6440370Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6441000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6441130Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6441230Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6441240Z 
2025-01-14T13:16:42.6441300Z     def initialize_transport_state(
2025-01-14T13:16:42.6441350Z         self,
2025-01-14T13:16:42.6441400Z         simulation_state,
2025-01-14T13:16:42.6441460Z         opacity_state,
2025-01-14T13:16:42.6441510Z         macro_atom_state,
2025-01-14T13:16:42.6441560Z         plasma,
2025-01-14T13:16:42.6441610Z         no_of_packets,
2025-01-14T13:16:42.6441680Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6441730Z         iteration=0,
2025-01-14T13:16:42.6441780Z     ):
2025-01-14T13:16:42.6441880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6441960Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6442010Z         else:
2025-01-14T13:16:42.6442070Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6442110Z     
2025-01-14T13:16:42.6442220Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6442290Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6442330Z         )
2025-01-14T13:16:42.6442370Z     
2025-01-14T13:16:42.6442470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6442560Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6442680Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6442730Z         else:
2025-01-14T13:16:42.6442790Z             continuum_state = None
2025-01-14T13:16:42.6442870Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6443520Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6443590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6443680Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6443760Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6443830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6443900Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6443940Z         ).to_numba(
2025-01-14T13:16:42.6444000Z             macro_atom_state,
2025-01-14T13:16:42.6444070Z             self.line_interaction_type,
2025-01-14T13:16:42.6444110Z         )
2025-01-14T13:16:42.6444190Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6444410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6444460Z         ]
2025-01-14T13:16:42.6444720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6444720Z 
2025-01-14T13:16:42.6444840Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6445000Z _ ERROR at setup of test_move_packet_across_shell_boundary_emitted[132-11-132] _
2025-01-14T13:16:42.6445010Z 
2025-01-14T13:16:42.6445540Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6445840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6445850Z 
2025-01-14T13:16:42.6445920Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6446050Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6446120Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6446270Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6446430Z >       sim.iterate(10)
2025-01-14T13:16:42.6446430Z 
2025-01-14T13:16:42.6446530Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6446620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6446690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6446820Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6446910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6446910Z 
2025-01-14T13:16:42.6447130Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6447280Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6447460Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6447680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6447810Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6447910Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6447920Z 
2025-01-14T13:16:42.6447980Z     def initialize_transport_state(
2025-01-14T13:16:42.6448030Z         self,
2025-01-14T13:16:42.6448080Z         simulation_state,
2025-01-14T13:16:42.6448130Z         opacity_state,
2025-01-14T13:16:42.6448180Z         macro_atom_state,
2025-01-14T13:16:42.6448230Z         plasma,
2025-01-14T13:16:42.6448280Z         no_of_packets,
2025-01-14T13:16:42.6448340Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6448390Z         iteration=0,
2025-01-14T13:16:42.6448430Z     ):
2025-01-14T13:16:42.6448530Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6448600Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6448710Z         else:
2025-01-14T13:16:42.6448770Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6448810Z     
2025-01-14T13:16:42.6448920Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6448990Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6449040Z         )
2025-01-14T13:16:42.6449080Z     
2025-01-14T13:16:42.6449190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6449300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6449420Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6449470Z         else:
2025-01-14T13:16:42.6449520Z             continuum_state = None
2025-01-14T13:16:42.6449600Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6449680Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6449760Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6449840Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6449910Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6449990Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6450060Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6450110Z         ).to_numba(
2025-01-14T13:16:42.6450160Z             macro_atom_state,
2025-01-14T13:16:42.6450220Z             self.line_interaction_type,
2025-01-14T13:16:42.6450270Z         )
2025-01-14T13:16:42.6450350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6450570Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6450630Z         ]
2025-01-14T13:16:42.6450890Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6450890Z 
2025-01-14T13:16:42.6451010Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6451160Z _ ERROR at setup of test_move_packet_across_shell_boundary_emitted[132-1-133] __
2025-01-14T13:16:42.6451270Z 
2025-01-14T13:16:42.6451790Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6452080Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6452080Z 
2025-01-14T13:16:42.6452150Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6452280Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6452540Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6452700Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6452750Z >       sim.iterate(10)
2025-01-14T13:16:42.6452760Z 
2025-01-14T13:16:42.6452860Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6452950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6453010Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6453150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6453250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6453250Z 
2025-01-14T13:16:42.6453470Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6453620Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6453810Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6454020Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6454360Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6454460Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6454470Z 
2025-01-14T13:16:42.6454530Z     def initialize_transport_state(
2025-01-14T13:16:42.6454570Z         self,
2025-01-14T13:16:42.6454630Z         simulation_state,
2025-01-14T13:16:42.6454680Z         opacity_state,
2025-01-14T13:16:42.6454720Z         macro_atom_state,
2025-01-14T13:16:42.6454780Z         plasma,
2025-01-14T13:16:42.6454820Z         no_of_packets,
2025-01-14T13:16:42.6454880Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6454930Z         iteration=0,
2025-01-14T13:16:42.6454970Z     ):
2025-01-14T13:16:42.6455060Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6455140Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6455180Z         else:
2025-01-14T13:16:42.6455240Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6455280Z     
2025-01-14T13:16:42.6455390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6455470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6455510Z         )
2025-01-14T13:16:42.6455560Z     
2025-01-14T13:16:42.6455660Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6455740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6455860Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6455910Z         else:
2025-01-14T13:16:42.6455970Z             continuum_state = None
2025-01-14T13:16:42.6456040Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6456120Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6456190Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6456270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6456350Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6456420Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6456490Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6456610Z         ).to_numba(
2025-01-14T13:16:42.6456670Z             macro_atom_state,
2025-01-14T13:16:42.6456730Z             self.line_interaction_type,
2025-01-14T13:16:42.6456770Z         )
2025-01-14T13:16:42.6456850Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6458620Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6458760Z         ]
2025-01-14T13:16:42.6459030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6459040Z 
2025-01-14T13:16:42.6459170Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6459330Z _ ERROR at setup of test_move_packet_across_shell_boundary_emitted[132-2-133] __
2025-01-14T13:16:42.6459340Z 
2025-01-14T13:16:42.6459890Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6460190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6460190Z 
2025-01-14T13:16:42.6460270Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6460400Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6460850Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6461080Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6461180Z >       sim.iterate(10)
2025-01-14T13:16:42.6461200Z 
2025-01-14T13:16:42.6461310Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6461650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6462220Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6462410Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6462540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6462550Z 
2025-01-14T13:16:42.6462800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6463030Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6464390Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6465370Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6466580Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6467010Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6467080Z 
2025-01-14T13:16:42.6467380Z     def initialize_transport_state(
2025-01-14T13:16:42.6467610Z         self,
2025-01-14T13:16:42.6467890Z         simulation_state,
2025-01-14T13:16:42.6468520Z         opacity_state,
2025-01-14T13:16:42.6468780Z         macro_atom_state,
2025-01-14T13:16:42.6469020Z         plasma,
2025-01-14T13:16:42.6469240Z         no_of_packets,
2025-01-14T13:16:42.6469440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6469590Z         iteration=0,
2025-01-14T13:16:42.6469820Z     ):
2025-01-14T13:16:42.6470210Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6470490Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6470670Z         else:
2025-01-14T13:16:42.6471140Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6471340Z     
2025-01-14T13:16:42.6471750Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6471910Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6471990Z         )
2025-01-14T13:16:42.6472090Z     
2025-01-14T13:16:42.6472210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6473230Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6473410Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6473740Z         else:
2025-01-14T13:16:42.6474070Z             continuum_state = None
2025-01-14T13:16:42.6474550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6474700Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6474800Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6474910Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6475020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6475130Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6475230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6475320Z         ).to_numba(
2025-01-14T13:16:42.6475410Z             macro_atom_state,
2025-01-14T13:16:42.6475530Z             self.line_interaction_type,
2025-01-14T13:16:42.6475590Z         )
2025-01-14T13:16:42.6475910Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6476190Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6476240Z         ]
2025-01-14T13:16:42.6476540Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6476550Z 
2025-01-14T13:16:42.6476940Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6477160Z _ ERROR at setup of test_move_packet_across_shell_boundary_reabsorbed[132--133-132] _
2025-01-14T13:16:42.6477190Z 
2025-01-14T13:16:42.6477780Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6480320Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6480330Z 
2025-01-14T13:16:42.6480610Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6480770Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6480870Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6481050Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6481120Z >       sim.iterate(10)
2025-01-14T13:16:42.6481130Z 
2025-01-14T13:16:42.6481240Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6481350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6482330Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6483470Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6483620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6483640Z 
2025-01-14T13:16:42.6483890Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6484110Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6484320Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6485850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6486040Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6486170Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6486180Z 
2025-01-14T13:16:42.6486250Z     def initialize_transport_state(
2025-01-14T13:16:42.6486310Z         self,
2025-01-14T13:16:42.6486380Z         simulation_state,
2025-01-14T13:16:42.6486440Z         opacity_state,
2025-01-14T13:16:42.6486690Z         macro_atom_state,
2025-01-14T13:16:42.6486910Z         plasma,
2025-01-14T13:16:42.6486990Z         no_of_packets,
2025-01-14T13:16:42.6487060Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6487120Z         iteration=0,
2025-01-14T13:16:42.6487190Z     ):
2025-01-14T13:16:42.6487320Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6487400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6487450Z         else:
2025-01-14T13:16:42.6487520Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6487580Z     
2025-01-14T13:16:42.6487700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6487810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6487860Z         )
2025-01-14T13:16:42.6487910Z     
2025-01-14T13:16:42.6488220Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6488390Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6488570Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6488660Z         else:
2025-01-14T13:16:42.6488750Z             continuum_state = None
2025-01-14T13:16:42.6488840Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6489040Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6489140Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6489240Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6489360Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6489480Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6489580Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6489640Z         ).to_numba(
2025-01-14T13:16:42.6489710Z             macro_atom_state,
2025-01-14T13:16:42.6489810Z             self.line_interaction_type,
2025-01-14T13:16:42.6490040Z         )
2025-01-14T13:16:42.6490130Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6491050Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6491340Z         ]
2025-01-14T13:16:42.6492150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6492180Z 
2025-01-14T13:16:42.6492610Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6493170Z _ ERROR at setup of test_move_packet_across_shell_boundary_reabsorbed[132--133-133] _
2025-01-14T13:16:42.6493200Z 
2025-01-14T13:16:42.6495190Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6496290Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6496340Z 
2025-01-14T13:16:42.6496640Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6497130Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6497390Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6498640Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6499040Z >       sim.iterate(10)
2025-01-14T13:16:42.6499090Z 
2025-01-14T13:16:42.6500170Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6500320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6500400Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6500560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6500660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6500670Z 
2025-01-14T13:16:42.6501170Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6501560Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6501790Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6502050Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6502220Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6502330Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6502340Z 
2025-01-14T13:16:42.6502400Z     def initialize_transport_state(
2025-01-14T13:16:42.6502480Z         self,
2025-01-14T13:16:42.6502570Z         simulation_state,
2025-01-14T13:16:42.6502630Z         opacity_state,
2025-01-14T13:16:42.6502680Z         macro_atom_state,
2025-01-14T13:16:42.6502960Z         plasma,
2025-01-14T13:16:42.6503360Z         no_of_packets,
2025-01-14T13:16:42.6503930Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6504050Z         iteration=0,
2025-01-14T13:16:42.6519980Z     ):
2025-01-14T13:16:42.6520580Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6520720Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6520790Z         else:
2025-01-14T13:16:42.6520870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6520950Z     
2025-01-14T13:16:42.6521100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6521220Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6521300Z         )
2025-01-14T13:16:42.6521370Z     
2025-01-14T13:16:42.6521510Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6521610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6521760Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6522230Z         else:
2025-01-14T13:16:42.6522330Z             continuum_state = None
2025-01-14T13:16:42.6522430Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6523100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6523590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6524280Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6524570Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6524980Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6525100Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6525180Z         ).to_numba(
2025-01-14T13:16:42.6525260Z             macro_atom_state,
2025-01-14T13:16:42.6525380Z             self.line_interaction_type,
2025-01-14T13:16:42.6525430Z         )
2025-01-14T13:16:42.6525530Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6525790Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6525860Z         ]
2025-01-14T13:16:42.6526150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6526170Z 
2025-01-14T13:16:42.6526280Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6526500Z _ ERROR at setup of test_move_packet_across_shell_boundary_reabsorbed[132--1000000000.0-133] _
2025-01-14T13:16:42.6526510Z 
2025-01-14T13:16:42.6527500Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6527850Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6527870Z 
2025-01-14T13:16:42.6527950Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6528090Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6528400Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6528580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6528660Z >       sim.iterate(10)
2025-01-14T13:16:42.6528670Z 
2025-01-14T13:16:42.6528770Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6529430Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6529540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6529690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6529800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6529810Z 
2025-01-14T13:16:42.6530060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6531200Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6531410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6531680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6531840Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6531980Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6531980Z 
2025-01-14T13:16:42.6532050Z     def initialize_transport_state(
2025-01-14T13:16:42.6532100Z         self,
2025-01-14T13:16:42.6532480Z         simulation_state,
2025-01-14T13:16:42.6532560Z         opacity_state,
2025-01-14T13:16:42.6532610Z         macro_atom_state,
2025-01-14T13:16:42.6532670Z         plasma,
2025-01-14T13:16:42.6532750Z         no_of_packets,
2025-01-14T13:16:42.6532830Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6533040Z         iteration=0,
2025-01-14T13:16:42.6533090Z     ):
2025-01-14T13:16:42.6533220Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6533320Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6533370Z         else:
2025-01-14T13:16:42.6533420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6533470Z     
2025-01-14T13:16:42.6533600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6533700Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6533750Z         )
2025-01-14T13:16:42.6533790Z     
2025-01-14T13:16:42.6533900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6534020Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6534180Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6534240Z         else:
2025-01-14T13:16:42.6534290Z             continuum_state = None
2025-01-14T13:16:42.6534370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6534470Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6534550Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6534660Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6534760Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6534850Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6534910Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6535330Z         ).to_numba(
2025-01-14T13:16:42.6535890Z             macro_atom_state,
2025-01-14T13:16:42.6537410Z             self.line_interaction_type,
2025-01-14T13:16:42.6537510Z         )
2025-01-14T13:16:42.6537630Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6537910Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6537990Z         ]
2025-01-14T13:16:42.6538430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6540710Z 
2025-01-14T13:16:42.6541170Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6541600Z _ ERROR at setup of test_move_packet_across_shell_boundary_increment[132--1-199] _
2025-01-14T13:16:42.6541620Z 
2025-01-14T13:16:42.6542570Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6542940Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6542950Z 
2025-01-14T13:16:42.6543020Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6543160Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6543270Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6543440Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6543510Z >       sim.iterate(10)
2025-01-14T13:16:42.6543510Z 
2025-01-14T13:16:42.6543820Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6543930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6544020Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6544170Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6544270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6544270Z 
2025-01-14T13:16:42.6544510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6544740Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6546190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6546490Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6546670Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6546810Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6546820Z 
2025-01-14T13:16:42.6546900Z     def initialize_transport_state(
2025-01-14T13:16:42.6546980Z         self,
2025-01-14T13:16:42.6547070Z         simulation_state,
2025-01-14T13:16:42.6547150Z         opacity_state,
2025-01-14T13:16:42.6547230Z         macro_atom_state,
2025-01-14T13:16:42.6547300Z         plasma,
2025-01-14T13:16:42.6547380Z         no_of_packets,
2025-01-14T13:16:42.6547450Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6547500Z         iteration=0,
2025-01-14T13:16:42.6547540Z     ):
2025-01-14T13:16:42.6548090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6548230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6548300Z         else:
2025-01-14T13:16:42.6548370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6548410Z     
2025-01-14T13:16:42.6548550Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6548640Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6548710Z         )
2025-01-14T13:16:42.6548790Z     
2025-01-14T13:16:42.6548940Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6549070Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6549230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6549310Z         else:
2025-01-14T13:16:42.6549380Z             continuum_state = None
2025-01-14T13:16:42.6549470Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6549570Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6549640Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6549730Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6550010Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6550120Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6550220Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6550300Z         ).to_numba(
2025-01-14T13:16:42.6550380Z             macro_atom_state,
2025-01-14T13:16:42.6550460Z             self.line_interaction_type,
2025-01-14T13:16:42.6550510Z         )
2025-01-14T13:16:42.6550590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6550870Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6550940Z         ]
2025-01-14T13:16:42.6551670Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6552320Z 
2025-01-14T13:16:42.6552500Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6552690Z _ ERROR at setup of test_move_packet_across_shell_boundary_increment[132-0-132] _
2025-01-14T13:16:42.6552700Z 
2025-01-14T13:16:42.6553280Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6553620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6553630Z 
2025-01-14T13:16:42.6554370Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6554540Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6554620Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6556480Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6558020Z >       sim.iterate(10)
2025-01-14T13:16:42.6558050Z 
2025-01-14T13:16:42.6558740Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6558900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6559310Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6559910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6560020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6560020Z 
2025-01-14T13:16:42.6560240Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6560660Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6561700Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6561970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6562120Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6562240Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6562240Z 
2025-01-14T13:16:42.6562320Z     def initialize_transport_state(
2025-01-14T13:16:42.6562610Z         self,
2025-01-14T13:16:42.6562690Z         simulation_state,
2025-01-14T13:16:42.6562740Z         opacity_state,
2025-01-14T13:16:42.6562790Z         macro_atom_state,
2025-01-14T13:16:42.6562840Z         plasma,
2025-01-14T13:16:42.6562910Z         no_of_packets,
2025-01-14T13:16:42.6562970Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6563700Z         iteration=0,
2025-01-14T13:16:42.6563960Z     ):
2025-01-14T13:16:42.6564310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6564550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6564710Z         else:
2025-01-14T13:16:42.6564920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6565070Z     
2025-01-14T13:16:42.6565410Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6566190Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6566250Z         )
2025-01-14T13:16:42.6566290Z     
2025-01-14T13:16:42.6566410Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6566510Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6566650Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6566720Z         else:
2025-01-14T13:16:42.6566790Z             continuum_state = None
2025-01-14T13:16:42.6566860Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6566970Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6567050Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6567140Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6568830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6570430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6572230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6572330Z         ).to_numba(
2025-01-14T13:16:42.6572390Z             macro_atom_state,
2025-01-14T13:16:42.6572460Z             self.line_interaction_type,
2025-01-14T13:16:42.6572510Z         )
2025-01-14T13:16:42.6572590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6572830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6572880Z         ]
2025-01-14T13:16:42.6573770Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6573830Z 
2025-01-14T13:16:42.6574260Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6574770Z _ ERROR at setup of test_move_packet_across_shell_boundary_increment[132-20-154] _
2025-01-14T13:16:42.6575840Z 
2025-01-14T13:16:42.6577420Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...: {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}, 'config_dirname': 'tardis/io/configuration/tests/data'}
2025-01-14T13:16:42.6578000Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6578010Z 
2025-01-14T13:16:42.6578120Z     @pytest.fixture(scope="package")
2025-01-14T13:16:42.6578290Z     def nb_simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6578420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6578610Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.6578690Z >       sim.iterate(10)
2025-01-14T13:16:42.6578700Z 
2025-01-14T13:16:42.6578830Z tardis/transport/montecarlo/tests/conftest.py:43: 
2025-01-14T13:16:42.6578970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6579070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6579440Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6579560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6579580Z 
2025-01-14T13:16:42.6579840Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6580230Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6580480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6581020Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6581710Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6582120Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6582140Z 
2025-01-14T13:16:42.6582980Z     def initialize_transport_state(
2025-01-14T13:16:42.6583190Z         self,
2025-01-14T13:16:42.6583420Z         simulation_state,
2025-01-14T13:16:42.6583640Z         opacity_state,
2025-01-14T13:16:42.6583900Z         macro_atom_state,
2025-01-14T13:16:42.6584140Z         plasma,
2025-01-14T13:16:42.6584320Z         no_of_packets,
2025-01-14T13:16:42.6584500Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6584680Z         iteration=0,
2025-01-14T13:16:42.6584830Z     ):
2025-01-14T13:16:42.6585160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6585410Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6585590Z         else:
2025-01-14T13:16:42.6585760Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6585910Z     
2025-01-14T13:16:42.6586250Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6586590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6586800Z         )
2025-01-14T13:16:42.6586960Z     
2025-01-14T13:16:42.6587280Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6587610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6588010Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6588240Z         else:
2025-01-14T13:16:42.6588480Z             continuum_state = None
2025-01-14T13:16:42.6588750Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6589490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6590200Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6590620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6591180Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6591320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6591630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6591720Z         ).to_numba(
2025-01-14T13:16:42.6591810Z             macro_atom_state,
2025-01-14T13:16:42.6591910Z             self.line_interaction_type,
2025-01-14T13:16:42.6591980Z         )
2025-01-14T13:16:42.6592100Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6592370Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6592440Z         ]
2025-01-14T13:16:42.6592740Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6592760Z 
2025-01-14T13:16:42.6592880Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6593040Z _________________ ERROR at setup of test_boundary_interactions _________________
2025-01-14T13:16:42.6593040Z 
2025-01-14T13:16:42.6593220Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.6595920Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.6595940Z 
2025-01-14T13:16:42.6596030Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.6596140Z         "expected,obtained",
2025-01-14T13:16:42.6596190Z         [
2025-01-14T13:16:42.6596230Z             (
2025-01-14T13:16:42.6596340Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.6596460Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.6596510Z             ),
2025-01-14T13:16:42.6597510Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.6598090Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.6598240Z         ],
2025-01-14T13:16:42.6598420Z     )
2025-01-14T13:16:42.6598840Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.6599190Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6599210Z 
2025-01-14T13:16:42.6599660Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.6601300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6601600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6601720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6602020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6602110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6602350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6602460Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6602980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6603110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6603400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.6603470Z     raise exc
2025-01-14T13:16:42.6603700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.6603780Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.6604000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.6604180Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.6604410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6604640Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6604900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6605750Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6606070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.6606180Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.6606510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.6606590Z     yield
2025-01-14T13:16:42.6606950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.6607040Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.6608260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.6608320Z     yield
2025-01-14T13:16:42.6608570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.6608660Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.6609510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.6609760Z     yield
2025-01-14T13:16:42.6610490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.6610680Z     return (yield)
2025-01-14T13:16:42.6611740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.6611980Z     return (yield)
2025-01-14T13:16:42.6613100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.6613210Z     raise e
2025-01-14T13:16:42.6613480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.6613580Z     item.runtest()
2025-01-14T13:16:42.6613840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.6614210Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.6614450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6614670Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6614920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6615100Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6615400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.6615490Z     result = testfunction(**testargs)
2025-01-14T13:16:42.6615790Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.6615900Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6616160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6616280Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6616570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6616690Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6616910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6618050Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6618910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6619220Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6619500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.6619740Z     raise exc
2025-01-14T13:16:42.6620260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.6620580Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.6621070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.6621280Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.6621530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6621720Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6621950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6622090Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6622860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.6623250Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.6624190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.6624350Z     yield
2025-01-14T13:16:42.6625520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.6626230Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.6627320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.6627790Z     yield
2025-01-14T13:16:42.6628610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.6628900Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.6629840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.6630160Z     yield
2025-01-14T13:16:42.6630460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.6630550Z     return (yield)
2025-01-14T13:16:42.6630990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.6631410Z     return (yield)
2025-01-14T13:16:42.6631700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.6631770Z     raise e
2025-01-14T13:16:42.6632050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.6632130Z     item.runtest()
2025-01-14T13:16:42.6632360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.6632470Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.6633950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6634140Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6634340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6634490Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6634710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.6634780Z     result = testfunction(**testargs)
2025-01-14T13:16:42.6635000Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.6635100Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6635310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6635550Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6635800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6635880Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6636080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6636170Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6636410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6636480Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6636680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:42.6636820Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:42.6637020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6637170Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6637370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6637500Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6637880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:42.6637940Z     return (yield)
2025-01-14T13:16:42.6638180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:42.6638290Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:42.6638510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:42.6638590Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:42.6638690Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.6639050Z     sim = run_tardis(
2025-01-14T13:16:42.6639600Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6640000Z     simulation.run_convergence()
2025-01-14T13:16:42.6640370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6640690Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6640900Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6641760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6642170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6642190Z 
2025-01-14T13:16:42.6642450Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.6642620Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.6642800Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.6643030Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.6643160Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.6643280Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6643290Z 
2025-01-14T13:16:42.6643360Z     def initialize_transport_state(
2025-01-14T13:16:42.6643400Z         self,
2025-01-14T13:16:42.6643460Z         simulation_state,
2025-01-14T13:16:42.6643510Z         opacity_state,
2025-01-14T13:16:42.6643560Z         macro_atom_state,
2025-01-14T13:16:42.6643600Z         plasma,
2025-01-14T13:16:42.6643650Z         no_of_packets,
2025-01-14T13:16:42.6644290Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6644480Z         iteration=0,
2025-01-14T13:16:42.6644620Z     ):
2025-01-14T13:16:42.6644910Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6646100Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6646250Z         else:
2025-01-14T13:16:42.6646430Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6646580Z     
2025-01-14T13:16:42.6646890Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6647350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6647730Z         )
2025-01-14T13:16:42.6647900Z     
2025-01-14T13:16:42.6649890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6650180Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6650520Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6650670Z         else:
2025-01-14T13:16:42.6650840Z             continuum_state = None
2025-01-14T13:16:42.6651060Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6651300Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6651500Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6651730Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6651950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6652150Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6652350Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6652490Z         ).to_numba(
2025-01-14T13:16:42.6652730Z             macro_atom_state,
2025-01-14T13:16:42.6652910Z             self.line_interaction_type,
2025-01-14T13:16:42.6653350Z         )
2025-01-14T13:16:42.6653990Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6654260Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6654310Z         ]
2025-01-14T13:16:42.6654570Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6654590Z 
2025-01-14T13:16:42.6654710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6656360Z _____________ ERROR at setup of test_rpacket_trackers_to_dataframe _____________
2025-01-14T13:16:42.6656370Z 
2025-01-14T13:16:42.6656510Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.6656780Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.6656780Z 
2025-01-14T13:16:42.6656850Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.6656910Z         "expected,obtained",
2025-01-14T13:16:42.6656960Z         [
2025-01-14T13:16:42.6657000Z             (
2025-01-14T13:16:42.6657080Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.6657160Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.6657210Z             ),
2025-01-14T13:16:42.6657340Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.6657440Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.6657490Z         ],
2025-01-14T13:16:42.6657540Z     )
2025-01-14T13:16:42.6657670Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.6657760Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6657760Z 
2025-01-14T13:16:42.6657900Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.6657990Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6658210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6658300Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6658550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6658620Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6660860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6662330Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6662620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6662710Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6662910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.6662970Z     raise exc
2025-01-14T13:16:42.6663160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.6663230Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.6663420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.6663570Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.6663770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6663940Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6664150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6664280Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6664540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.6664620Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.6664910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.6670190Z     yield
2025-01-14T13:16:42.6670640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.6670740Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.6671050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.6671310Z     yield
2025-01-14T13:16:42.6671540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.6671610Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.6671820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.6671860Z     yield
2025-01-14T13:16:42.6672090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.6672140Z     return (yield)
2025-01-14T13:16:42.6672370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.6672430Z     return (yield)
2025-01-14T13:16:42.6672670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.6672740Z     raise e
2025-01-14T13:16:42.6672980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.6673030Z     item.runtest()
2025-01-14T13:16:42.6673230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.6673330Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.6673520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6673680Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6673900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6674040Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6674430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.6674500Z     result = testfunction(**testargs)
2025-01-14T13:16:42.6674730Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.6674820Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6675070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6675170Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6675410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6675490Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6675690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6675810Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6676040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6676120Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6676310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.6676360Z     raise exc
2025-01-14T13:16:42.6676550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.6676620Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.6676810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.6676940Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.6677130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6677300Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6677500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6677720Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6677970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.6678050Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.6678330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.6678390Z     yield
2025-01-14T13:16:42.6678650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.6678740Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.6679040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.6679090Z     yield
2025-01-14T13:16:42.6679320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.6679420Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.6679650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.6679690Z     yield
2025-01-14T13:16:42.6679920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.6679970Z     return (yield)
2025-01-14T13:16:42.6680200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.6680250Z     return (yield)
2025-01-14T13:16:42.6680470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.6680600Z     raise e
2025-01-14T13:16:42.6680830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.6680880Z     item.runtest()
2025-01-14T13:16:42.6681070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.6681160Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.6681350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6681670Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6681900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6682040Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6682260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.6682330Z     result = testfunction(**testargs)
2025-01-14T13:16:42.6682560Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.6682650Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6682860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.6682960Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.6683200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6683270Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6683480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.6683580Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.6683820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.6683890Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.6684100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:42.6684380Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:42.6684580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.6684860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.6685060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.6685200Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.6685440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:42.6685500Z     return (yield)
2025-01-14T13:16:42.6685740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:42.6685860Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:42.6686080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:42.6686150Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:42.6686260Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.6686300Z     sim = run_tardis(
2025-01-14T13:16:42.6686370Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6686440Z     simulation.run_convergence()
2025-01-14T13:16:42.6686530Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6686630Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6686710Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6686830Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6686920Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6687030Z 
2025-01-14T13:16:42.6687250Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.6687420Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.6687600Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.6687820Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.6687950Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.6688060Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6688060Z 
2025-01-14T13:16:42.6688130Z     def initialize_transport_state(
2025-01-14T13:16:42.6688180Z         self,
2025-01-14T13:16:42.6688230Z         simulation_state,
2025-01-14T13:16:42.6688280Z         opacity_state,
2025-01-14T13:16:42.6688350Z         macro_atom_state,
2025-01-14T13:16:42.6688400Z         plasma,
2025-01-14T13:16:42.6688450Z         no_of_packets,
2025-01-14T13:16:42.6688510Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6688560Z         iteration=0,
2025-01-14T13:16:42.6688600Z     ):
2025-01-14T13:16:42.6688700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6688780Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6688820Z         else:
2025-01-14T13:16:42.6688880Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6688920Z     
2025-01-14T13:16:42.6689030Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6689100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6689150Z         )
2025-01-14T13:16:42.6689190Z     
2025-01-14T13:16:42.6689440Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6689530Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6689660Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6689700Z         else:
2025-01-14T13:16:42.6689780Z             continuum_state = None
2025-01-14T13:16:42.6690200Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6690290Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6690360Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6690440Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6690520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6690580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6690650Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6690690Z         ).to_numba(
2025-01-14T13:16:42.6690750Z             macro_atom_state,
2025-01-14T13:16:42.6690810Z             self.line_interaction_type,
2025-01-14T13:16:42.6690870Z         )
2025-01-14T13:16:42.6690940Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6691320Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6691380Z         ]
2025-01-14T13:16:42.6691640Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6691650Z 
2025-01-14T13:16:42.6691770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6691910Z ______________ ERROR at setup of test_trace_vpacket_within_shell _______________
2025-01-14T13:16:42.6691910Z 
2025-01-14T13:16:42.6692020Z expected = 'nu_packet_collection', obtained = 'nu_to_check'
2025-01-14T13:16:42.6692260Z request = <FixtureRequest for <Function test_last_interaction_properties[nu_packet_collection-nu_to_check]>>
2025-01-14T13:16:42.6692260Z 
2025-01-14T13:16:42.6692320Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.6692380Z         "expected,obtained",
2025-01-14T13:16:42.6692420Z         [
2025-01-14T13:16:42.6692470Z             (
2025-01-14T13:16:42.6692830Z                 "interaction_type_in_use",
2025-01-14T13:16:42.6692910Z                 "interaction_type_to_check",
2025-01-14T13:16:42.6693010Z             ),
2025-01-14T13:16:42.6693060Z             (
2025-01-14T13:16:42.6693120Z                 "shell_id_in_use",
2025-01-14T13:16:42.6693180Z                 "shell_id_to_check",
2025-01-14T13:16:42.6693220Z             ),
2025-01-14T13:16:42.6693270Z             (
2025-01-14T13:16:42.6693310Z                 "r_in_use",
2025-01-14T13:16:42.6693370Z                 "r_to_check",
2025-01-14T13:16:42.6693410Z             ),
2025-01-14T13:16:42.6693490Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.6693530Z         ],
2025-01-14T13:16:42.6693580Z     )
2025-01-14T13:16:42.6694550Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.6694930Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6694940Z 
2025-01-14T13:16:42.6695620Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.6695770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6696060Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6696150Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6696430Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6696520Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6696790Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6696870Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6697060Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:42.6697110Z     sim.iterate(10)
2025-01-14T13:16:42.6697190Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6697320Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6697570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6697580Z 
2025-01-14T13:16:42.6697800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6697960Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6698150Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6698370Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6698500Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6698620Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6698620Z 
2025-01-14T13:16:42.6698690Z     def initialize_transport_state(
2025-01-14T13:16:42.6698740Z         self,
2025-01-14T13:16:42.6698800Z         simulation_state,
2025-01-14T13:16:42.6698860Z         opacity_state,
2025-01-14T13:16:42.6698910Z         macro_atom_state,
2025-01-14T13:16:42.6698960Z         plasma,
2025-01-14T13:16:42.6699010Z         no_of_packets,
2025-01-14T13:16:42.6699070Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6699120Z         iteration=0,
2025-01-14T13:16:42.6699160Z     ):
2025-01-14T13:16:42.6699260Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6699340Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6699380Z         else:
2025-01-14T13:16:42.6699440Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6699480Z     
2025-01-14T13:16:42.6699600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6699670Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6699720Z         )
2025-01-14T13:16:42.6699770Z     
2025-01-14T13:16:42.6699940Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6700040Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6700170Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6700230Z         else:
2025-01-14T13:16:42.6700290Z             continuum_state = None
2025-01-14T13:16:42.6700370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6700460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6700530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6700610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6700690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6700760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6700850Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6700910Z         ).to_numba(
2025-01-14T13:16:42.6700960Z             macro_atom_state,
2025-01-14T13:16:42.6701030Z             self.line_interaction_type,
2025-01-14T13:16:42.6701080Z         )
2025-01-14T13:16:42.6701160Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6701390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6701450Z         ]
2025-01-14T13:16:42.6701700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6701700Z 
2025-01-14T13:16:42.6701820Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6701950Z _____________________ ERROR at setup of test_trace_vpacket _____________________
2025-01-14T13:16:42.6701950Z 
2025-01-14T13:16:42.6702060Z expected = 'nu_packet_collection', obtained = 'nu_to_check'
2025-01-14T13:16:42.6702300Z request = <FixtureRequest for <Function test_last_interaction_properties[nu_packet_collection-nu_to_check]>>
2025-01-14T13:16:42.6702310Z 
2025-01-14T13:16:42.6702390Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.6702460Z         "expected,obtained",
2025-01-14T13:16:42.6702590Z         [
2025-01-14T13:16:42.6702640Z             (
2025-01-14T13:16:42.6702700Z                 "interaction_type_in_use",
2025-01-14T13:16:42.6702770Z                 "interaction_type_to_check",
2025-01-14T13:16:42.6702820Z             ),
2025-01-14T13:16:42.6702870Z             (
2025-01-14T13:16:42.6702920Z                 "shell_id_in_use",
2025-01-14T13:16:42.6702980Z                 "shell_id_to_check",
2025-01-14T13:16:42.6703020Z             ),
2025-01-14T13:16:42.6703070Z             (
2025-01-14T13:16:42.6703120Z                 "r_in_use",
2025-01-14T13:16:42.6703170Z                 "r_to_check",
2025-01-14T13:16:42.6703210Z             ),
2025-01-14T13:16:42.6703290Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.6703330Z         ],
2025-01-14T13:16:42.6703380Z     )
2025-01-14T13:16:42.6703510Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.6703600Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6703610Z 
2025-01-14T13:16:42.6703790Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.6703880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6704160Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6704240Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6704510Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6704600Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6704870Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6704960Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6705200Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:42.6705260Z     sim.iterate(10)
2025-01-14T13:16:42.6705320Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6705450Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6705530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6705530Z 
2025-01-14T13:16:42.6705740Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6705900Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6706090Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6706310Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6706430Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6706550Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6706550Z 
2025-01-14T13:16:42.6706610Z     def initialize_transport_state(
2025-01-14T13:16:42.6706660Z         self,
2025-01-14T13:16:42.6706710Z         simulation_state,
2025-01-14T13:16:42.6706770Z         opacity_state,
2025-01-14T13:16:42.6706820Z         macro_atom_state,
2025-01-14T13:16:42.6706880Z         plasma,
2025-01-14T13:16:42.6706930Z         no_of_packets,
2025-01-14T13:16:42.6706980Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6707030Z         iteration=0,
2025-01-14T13:16:42.6707070Z     ):
2025-01-14T13:16:42.6707160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6707240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6707280Z         else:
2025-01-14T13:16:42.6707340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6707380Z     
2025-01-14T13:16:42.6707480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6707560Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6707610Z         )
2025-01-14T13:16:42.6707710Z     
2025-01-14T13:16:42.6707810Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6707910Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6708030Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6708080Z         else:
2025-01-14T13:16:42.6708140Z             continuum_state = None
2025-01-14T13:16:42.6708220Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6708300Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6708370Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6708450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6708520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6708590Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6708660Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6708710Z         ).to_numba(
2025-01-14T13:16:42.6708770Z             macro_atom_state,
2025-01-14T13:16:42.6708840Z             self.line_interaction_type,
2025-01-14T13:16:42.6708880Z         )
2025-01-14T13:16:42.6708960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6709170Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6709220Z         ]
2025-01-14T13:16:42.6709470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6709470Z 
2025-01-14T13:16:42.6709590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6709720Z ___________________ ERROR at setup of test_trace_bad_vpacket ___________________
2025-01-14T13:16:42.6709730Z 
2025-01-14T13:16:42.6709860Z expected = 'nu_packet_collection', obtained = 'nu_to_check'
2025-01-14T13:16:42.6710210Z request = <FixtureRequest for <Function test_last_interaction_properties[nu_packet_collection-nu_to_check]>>
2025-01-14T13:16:42.6710210Z 
2025-01-14T13:16:42.6710280Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.6710340Z         "expected,obtained",
2025-01-14T13:16:42.6710380Z         [
2025-01-14T13:16:42.6710430Z             (
2025-01-14T13:16:42.6710490Z                 "interaction_type_in_use",
2025-01-14T13:16:42.6710560Z                 "interaction_type_to_check",
2025-01-14T13:16:42.6710600Z             ),
2025-01-14T13:16:42.6710650Z             (
2025-01-14T13:16:42.6710700Z                 "shell_id_in_use",
2025-01-14T13:16:42.6710760Z                 "shell_id_to_check",
2025-01-14T13:16:42.6710810Z             ),
2025-01-14T13:16:42.6710850Z             (
2025-01-14T13:16:42.6710900Z                 "r_in_use",
2025-01-14T13:16:42.6710950Z                 "r_to_check",
2025-01-14T13:16:42.6711000Z             ),
2025-01-14T13:16:42.6711080Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.6711130Z         ],
2025-01-14T13:16:42.6711170Z     )
2025-01-14T13:16:42.6711310Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.6711400Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6711410Z 
2025-01-14T13:16:42.6711590Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.6713430Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6714360Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6714720Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6715050Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6715140Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6715440Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.6716400Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.6716570Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:42.6716620Z     sim.iterate(10)
2025-01-14T13:16:42.6716690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6716820Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6716910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6716910Z 
2025-01-14T13:16:42.6717130Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.6717300Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.6717490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.6717730Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.6717860Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.6717960Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6717970Z 
2025-01-14T13:16:42.6718030Z     def initialize_transport_state(
2025-01-14T13:16:42.6718080Z         self,
2025-01-14T13:16:42.6718140Z         simulation_state,
2025-01-14T13:16:42.6718190Z         opacity_state,
2025-01-14T13:16:42.6718240Z         macro_atom_state,
2025-01-14T13:16:42.6718280Z         plasma,
2025-01-14T13:16:42.6718340Z         no_of_packets,
2025-01-14T13:16:42.6718390Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6718480Z         iteration=0,
2025-01-14T13:16:42.6718520Z     ):
2025-01-14T13:16:42.6718620Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6718690Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6719020Z         else:
2025-01-14T13:16:42.6719080Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6719120Z     
2025-01-14T13:16:42.6719230Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6719310Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6719350Z         )
2025-01-14T13:16:42.6719400Z     
2025-01-14T13:16:42.6719500Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6719590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6719710Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6719760Z         else:
2025-01-14T13:16:42.6719820Z             continuum_state = None
2025-01-14T13:16:42.6719900Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6719990Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6720050Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6720140Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6720220Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6720290Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6720380Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6720430Z         ).to_numba(
2025-01-14T13:16:42.6720490Z             macro_atom_state,
2025-01-14T13:16:42.6720550Z             self.line_interaction_type,
2025-01-14T13:16:42.6720600Z         )
2025-01-14T13:16:42.6720670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6720890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6720930Z         ]
2025-01-14T13:16:42.6721180Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6721180Z 
2025-01-14T13:16:42.6721300Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6721460Z ___ ERROR at setup of TestLIVPlotter.test_parse_species_list[_species_list] ____
2025-01-14T13:16:42.6721470Z 
2025-01-14T13:16:42.6722120Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6722410Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6722410Z 
2025-01-14T13:16:42.6722480Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6722590Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6722640Z         """
2025-01-14T13:16:42.6722720Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6722770Z     
2025-01-14T13:16:42.6722820Z         Parameters:
2025-01-14T13:16:42.6722870Z         -----------
2025-01-14T13:16:42.6722990Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6723110Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6723150Z     
2025-01-14T13:16:42.6723200Z         Returns:
2025-01-14T13:16:42.6723250Z         --------
2025-01-14T13:16:42.6723320Z         A TARDIS simulation object.
2025-01-14T13:16:42.6723360Z         """
2025-01-14T13:16:42.6723450Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6723540Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6723640Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6723790Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6723900Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6723970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6724020Z >       sim = run_tardis(
2025-01-14T13:16:42.6724140Z             config_verysimple,
2025-01-14T13:16:42.6724200Z             atom_data=atomic_data,
2025-01-14T13:16:42.6724250Z         )
2025-01-14T13:16:42.6724260Z 
2025-01-14T13:16:42.6724360Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6724450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6724510Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6724580Z     simulation.run_convergence()
2025-01-14T13:16:42.6724660Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6724780Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6724850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6724980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6725060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6725070Z 
2025-01-14T13:16:42.6725280Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6725450Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6725630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6725860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6725980Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6726090Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6726100Z 
2025-01-14T13:16:42.6726160Z     def initialize_transport_state(
2025-01-14T13:16:42.6726210Z         self,
2025-01-14T13:16:42.6726420Z         simulation_state,
2025-01-14T13:16:42.6726470Z         opacity_state,
2025-01-14T13:16:42.6726530Z         macro_atom_state,
2025-01-14T13:16:42.6726570Z         plasma,
2025-01-14T13:16:42.6726620Z         no_of_packets,
2025-01-14T13:16:42.6726680Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6726730Z         iteration=0,
2025-01-14T13:16:42.6726780Z     ):
2025-01-14T13:16:42.6727040Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6727120Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6727170Z         else:
2025-01-14T13:16:42.6727230Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6727270Z     
2025-01-14T13:16:42.6727380Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6727460Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6727520Z         )
2025-01-14T13:16:42.6727560Z     
2025-01-14T13:16:42.6727670Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6727750Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6727880Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6727930Z         else:
2025-01-14T13:16:42.6728000Z             continuum_state = None
2025-01-14T13:16:42.6728080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6728170Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6728240Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6728320Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6728390Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6728460Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6728530Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6728580Z         ).to_numba(
2025-01-14T13:16:42.6728630Z             macro_atom_state,
2025-01-14T13:16:42.6728690Z             self.line_interaction_type,
2025-01-14T13:16:42.6728740Z         )
2025-01-14T13:16:42.6728810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6729040Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6729210Z         ]
2025-01-14T13:16:42.6729610Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6729620Z 
2025-01-14T13:16:42.6729750Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6729890Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.6730310Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.6730680Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.6730840Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6731010Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.6731140Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.6731200Z 	
2025-01-14T13:16:42.6731320Z 	Starting iteration 1 of 3 ([1mbase.py[0m:444)
2025-01-14T13:16:42.6731450Z ------------------------------ Captured log setup ------------------------------
2025-01-14T13:16:42.6731860Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.6732040Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.6732130Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.6732190Z 	Starting iteration 1 of 3
2025-01-14T13:16:42.6732340Z ____ ERROR at setup of TestLIVPlotter.test_parse_species_list[_keep_colour] ____
2025-01-14T13:16:42.6732340Z 
2025-01-14T13:16:42.6732900Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6733200Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6733330Z 
2025-01-14T13:16:42.6733410Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6733520Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6741860Z         """
2025-01-14T13:16:42.6742050Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6742090Z     
2025-01-14T13:16:42.6742140Z         Parameters:
2025-01-14T13:16:42.6742200Z         -----------
2025-01-14T13:16:42.6742320Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6742430Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6742480Z     
2025-01-14T13:16:42.6742520Z         Returns:
2025-01-14T13:16:42.6742570Z         --------
2025-01-14T13:16:42.6742640Z         A TARDIS simulation object.
2025-01-14T13:16:42.6742680Z         """
2025-01-14T13:16:42.6742780Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6742880Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6742990Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6743140Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6743240Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6743310Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6743360Z >       sim = run_tardis(
2025-01-14T13:16:42.6743420Z             config_verysimple,
2025-01-14T13:16:42.6743480Z             atom_data=atomic_data,
2025-01-14T13:16:42.6743520Z         )
2025-01-14T13:16:42.6743520Z 
2025-01-14T13:16:42.6743630Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6743710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6743780Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6744080Z     simulation.run_convergence()
2025-01-14T13:16:42.6744170Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6744280Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6744350Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6744480Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6744570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6744570Z 
2025-01-14T13:16:42.6744780Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6744940Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6745120Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6745340Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6745470Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6745580Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6745580Z 
2025-01-14T13:16:42.6745650Z     def initialize_transport_state(
2025-01-14T13:16:42.6745690Z         self,
2025-01-14T13:16:42.6745750Z         simulation_state,
2025-01-14T13:16:42.6745800Z         opacity_state,
2025-01-14T13:16:42.6745850Z         macro_atom_state,
2025-01-14T13:16:42.6745900Z         plasma,
2025-01-14T13:16:42.6745950Z         no_of_packets,
2025-01-14T13:16:42.6746000Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6746050Z         iteration=0,
2025-01-14T13:16:42.6746090Z     ):
2025-01-14T13:16:42.6746190Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6746270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6746320Z         else:
2025-01-14T13:16:42.6746370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6746420Z     
2025-01-14T13:16:42.6746530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6746590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6747030Z         )
2025-01-14T13:16:42.6747080Z     
2025-01-14T13:16:42.6747190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6747280Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6747400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6747450Z         else:
2025-01-14T13:16:42.6747510Z             continuum_state = None
2025-01-14T13:16:42.6747590Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6747680Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6748970Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6749080Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6749160Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6749230Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6749310Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6749360Z         ).to_numba(
2025-01-14T13:16:42.6749410Z             macro_atom_state,
2025-01-14T13:16:42.6749470Z             self.line_interaction_type,
2025-01-14T13:16:42.6749520Z         )
2025-01-14T13:16:42.6749600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6749820Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6749870Z         ]
2025-01-14T13:16:42.6750130Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6750130Z 
2025-01-14T13:16:42.6750260Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6750420Z __ ERROR at setup of TestLIVPlotter.test_parse_species_list[_species_mapped] ___
2025-01-14T13:16:42.6750420Z 
2025-01-14T13:16:42.6751430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6751740Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6751740Z 
2025-01-14T13:16:42.6751810Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6751930Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6751970Z         """
2025-01-14T13:16:42.6752070Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6752110Z     
2025-01-14T13:16:42.6752170Z         Parameters:
2025-01-14T13:16:42.6752220Z         -----------
2025-01-14T13:16:42.6752330Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6752440Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6752500Z     
2025-01-14T13:16:42.6752550Z         Returns:
2025-01-14T13:16:42.6752600Z         --------
2025-01-14T13:16:42.6752660Z         A TARDIS simulation object.
2025-01-14T13:16:42.6752710Z         """
2025-01-14T13:16:42.6752800Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6752890Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6753000Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6753140Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6753250Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6753320Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6753380Z >       sim = run_tardis(
2025-01-14T13:16:42.6753430Z             config_verysimple,
2025-01-14T13:16:42.6753490Z             atom_data=atomic_data,
2025-01-14T13:16:42.6753540Z         )
2025-01-14T13:16:42.6753540Z 
2025-01-14T13:16:42.6753640Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6753810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6753990Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6754100Z     simulation.run_convergence()
2025-01-14T13:16:42.6754210Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6754330Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6754400Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6754540Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6754640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6754650Z 
2025-01-14T13:16:42.6754870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6755040Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6755220Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6755460Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6755580Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6755700Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6755710Z 
2025-01-14T13:16:42.6755770Z     def initialize_transport_state(
2025-01-14T13:16:42.6755820Z         self,
2025-01-14T13:16:42.6755870Z         simulation_state,
2025-01-14T13:16:42.6755930Z         opacity_state,
2025-01-14T13:16:42.6755980Z         macro_atom_state,
2025-01-14T13:16:42.6756020Z         plasma,
2025-01-14T13:16:42.6756070Z         no_of_packets,
2025-01-14T13:16:42.6756130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6756180Z         iteration=0,
2025-01-14T13:16:42.6756230Z     ):
2025-01-14T13:16:42.6756470Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6756560Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6756620Z         else:
2025-01-14T13:16:42.6756670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6756720Z     
2025-01-14T13:16:42.6756830Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6756910Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6756960Z         )
2025-01-14T13:16:42.6757000Z     
2025-01-14T13:16:42.6757100Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6757200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6757320Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6757380Z         else:
2025-01-14T13:16:42.6757430Z             continuum_state = None
2025-01-14T13:16:42.6757510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6757600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6757670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6757760Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6757830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6757910Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6757980Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6758030Z         ).to_numba(
2025-01-14T13:16:42.6758080Z             macro_atom_state,
2025-01-14T13:16:42.6758150Z             self.line_interaction_type,
2025-01-14T13:16:42.6758190Z         )
2025-01-14T13:16:42.6758430Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6758660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6758710Z         ]
2025-01-14T13:16:42.6758960Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6758960Z 
2025-01-14T13:16:42.6759090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6759380Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data0-plot_data] _
2025-01-14T13:16:42.6759380Z 
2025-01-14T13:16:42.6759930Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6760220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6760220Z 
2025-01-14T13:16:42.6760290Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6760400Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6760440Z         """
2025-01-14T13:16:42.6760530Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6760580Z     
2025-01-14T13:16:42.6760630Z         Parameters:
2025-01-14T13:16:42.6760690Z         -----------
2025-01-14T13:16:42.6760800Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6760910Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6760960Z     
2025-01-14T13:16:42.6761000Z         Returns:
2025-01-14T13:16:42.6761050Z         --------
2025-01-14T13:16:42.6761110Z         A TARDIS simulation object.
2025-01-14T13:16:42.6761150Z         """
2025-01-14T13:16:42.6761240Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6761350Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6761470Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6761610Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6761730Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6761910Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6761960Z >       sim = run_tardis(
2025-01-14T13:16:42.6762030Z             config_verysimple,
2025-01-14T13:16:42.6762080Z             atom_data=atomic_data,
2025-01-14T13:16:42.6762130Z         )
2025-01-14T13:16:42.6762130Z 
2025-01-14T13:16:42.6762240Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6762330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6762390Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6762460Z     simulation.run_convergence()
2025-01-14T13:16:42.6762540Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6762650Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6762720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6762840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6762940Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6762940Z 
2025-01-14T13:16:42.6763160Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6763320Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6763500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6763720Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6763840Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6763950Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6763950Z 
2025-01-14T13:16:42.6764010Z     def initialize_transport_state(
2025-01-14T13:16:42.6764070Z         self,
2025-01-14T13:16:42.6764120Z         simulation_state,
2025-01-14T13:16:42.6764170Z         opacity_state,
2025-01-14T13:16:42.6764220Z         macro_atom_state,
2025-01-14T13:16:42.6764270Z         plasma,
2025-01-14T13:16:42.6764320Z         no_of_packets,
2025-01-14T13:16:42.6764440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6764500Z         iteration=0,
2025-01-14T13:16:42.6764540Z     ):
2025-01-14T13:16:42.6764640Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6764700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6764760Z         else:
2025-01-14T13:16:42.6764820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6764870Z     
2025-01-14T13:16:42.6764970Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6765040Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6765090Z         )
2025-01-14T13:16:42.6765130Z     
2025-01-14T13:16:42.6765230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6765320Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6765450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6765500Z         else:
2025-01-14T13:16:42.6765560Z             continuum_state = None
2025-01-14T13:16:42.6765630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6765720Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6765790Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6765870Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6765940Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6766010Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6766080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6766120Z         ).to_numba(
2025-01-14T13:16:42.6766180Z             macro_atom_state,
2025-01-14T13:16:42.6766240Z             self.line_interaction_type,
2025-01-14T13:16:42.6766280Z         )
2025-01-14T13:16:42.6766360Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6766630Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6766680Z         ]
2025-01-14T13:16:42.6766930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6766930Z 
2025-01-14T13:16:42.6767050Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6767270Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data0-plot_colors] _
2025-01-14T13:16:42.6767270Z 
2025-01-14T13:16:42.6767840Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6768130Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6768130Z 
2025-01-14T13:16:42.6768200Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6768310Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6768360Z         """
2025-01-14T13:16:42.6768450Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6768500Z     
2025-01-14T13:16:42.6768540Z         Parameters:
2025-01-14T13:16:42.6768590Z         -----------
2025-01-14T13:16:42.6768700Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6768810Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6768850Z     
2025-01-14T13:16:42.6768900Z         Returns:
2025-01-14T13:16:42.6768950Z         --------
2025-01-14T13:16:42.6769010Z         A TARDIS simulation object.
2025-01-14T13:16:42.6769050Z         """
2025-01-14T13:16:42.6769140Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6769240Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6769340Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6770350Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6770470Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6770550Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6770600Z >       sim = run_tardis(
2025-01-14T13:16:42.6770660Z             config_verysimple,
2025-01-14T13:16:42.6770720Z             atom_data=atomic_data,
2025-01-14T13:16:42.6770770Z         )
2025-01-14T13:16:42.6770770Z 
2025-01-14T13:16:42.6770880Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6770980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6771050Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6771110Z     simulation.run_convergence()
2025-01-14T13:16:42.6771200Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6771320Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6771400Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6771520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6771630Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6771640Z 
2025-01-14T13:16:42.6771850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6772020Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6772190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6772420Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6772550Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6772910Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6772910Z 
2025-01-14T13:16:42.6772970Z     def initialize_transport_state(
2025-01-14T13:16:42.6773020Z         self,
2025-01-14T13:16:42.6773080Z         simulation_state,
2025-01-14T13:16:42.6773150Z         opacity_state,
2025-01-14T13:16:42.6773200Z         macro_atom_state,
2025-01-14T13:16:42.6773250Z         plasma,
2025-01-14T13:16:42.6773300Z         no_of_packets,
2025-01-14T13:16:42.6773360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6773400Z         iteration=0,
2025-01-14T13:16:42.6773450Z     ):
2025-01-14T13:16:42.6773550Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6773620Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6773670Z         else:
2025-01-14T13:16:42.6773720Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6773770Z     
2025-01-14T13:16:42.6773880Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6773960Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6774010Z         )
2025-01-14T13:16:42.6774050Z     
2025-01-14T13:16:42.6774160Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6774250Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6774380Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6774420Z         else:
2025-01-14T13:16:42.6774480Z             continuum_state = None
2025-01-14T13:16:42.6774560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6774640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6774710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6774790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6774870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6774940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6775010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6775060Z         ).to_numba(
2025-01-14T13:16:42.6775110Z             macro_atom_state,
2025-01-14T13:16:42.6775260Z             self.line_interaction_type,
2025-01-14T13:16:42.6775310Z         )
2025-01-14T13:16:42.6775380Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6775610Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6775650Z         ]
2025-01-14T13:16:42.6776070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6776070Z 
2025-01-14T13:16:42.6776200Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6776420Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data0-new_bin_edges] _
2025-01-14T13:16:42.6776420Z 
2025-01-14T13:16:42.6777000Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6777310Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6777310Z 
2025-01-14T13:16:42.6777380Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6777490Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6777540Z         """
2025-01-14T13:16:42.6777630Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6777670Z     
2025-01-14T13:16:42.6777720Z         Parameters:
2025-01-14T13:16:42.6777770Z         -----------
2025-01-14T13:16:42.6777880Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6778000Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6778160Z     
2025-01-14T13:16:42.6778210Z         Returns:
2025-01-14T13:16:42.6778260Z         --------
2025-01-14T13:16:42.6778320Z         A TARDIS simulation object.
2025-01-14T13:16:42.6778370Z         """
2025-01-14T13:16:42.6778460Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6778560Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6778660Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6778800Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6778910Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6778980Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6779040Z >       sim = run_tardis(
2025-01-14T13:16:42.6779090Z             config_verysimple,
2025-01-14T13:16:42.6779150Z             atom_data=atomic_data,
2025-01-14T13:16:42.6779190Z         )
2025-01-14T13:16:42.6779190Z 
2025-01-14T13:16:42.6779300Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6779390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6779460Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6779530Z     simulation.run_convergence()
2025-01-14T13:16:42.6779620Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6779850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6779930Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6780050Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6780140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6780140Z 
2025-01-14T13:16:42.6780370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6780530Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6780730Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6780960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6781180Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6781290Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6781300Z 
2025-01-14T13:16:42.6781360Z     def initialize_transport_state(
2025-01-14T13:16:42.6781410Z         self,
2025-01-14T13:16:42.6781460Z         simulation_state,
2025-01-14T13:16:42.6781510Z         opacity_state,
2025-01-14T13:16:42.6781560Z         macro_atom_state,
2025-01-14T13:16:42.6781620Z         plasma,
2025-01-14T13:16:42.6781680Z         no_of_packets,
2025-01-14T13:16:42.6781740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6781780Z         iteration=0,
2025-01-14T13:16:42.6781830Z     ):
2025-01-14T13:16:42.6781930Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6782010Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6782050Z         else:
2025-01-14T13:16:42.6782110Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6782150Z     
2025-01-14T13:16:42.6782270Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6782340Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6782380Z         )
2025-01-14T13:16:42.6782420Z     
2025-01-14T13:16:42.6782520Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6782610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6782730Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6782780Z         else:
2025-01-14T13:16:42.6782840Z             continuum_state = None
2025-01-14T13:16:42.6782910Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6783000Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6783160Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6783240Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6783320Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6783390Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6783460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6783500Z         ).to_numba(
2025-01-14T13:16:42.6783570Z             macro_atom_state,
2025-01-14T13:16:42.6783630Z             self.line_interaction_type,
2025-01-14T13:16:42.6783680Z         )
2025-01-14T13:16:42.6783750Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6783970Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6784020Z         ]
2025-01-14T13:16:42.6784580Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6784590Z 
2025-01-14T13:16:42.6784720Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6784930Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data1-plot_data] _
2025-01-14T13:16:42.6784940Z 
2025-01-14T13:16:42.6785500Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6785790Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6785790Z 
2025-01-14T13:16:42.6785850Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6785970Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6786010Z         """
2025-01-14T13:16:42.6786100Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6786140Z     
2025-01-14T13:16:42.6786200Z         Parameters:
2025-01-14T13:16:42.6786240Z         -----------
2025-01-14T13:16:42.6786360Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6786620Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6786660Z     
2025-01-14T13:16:42.6786710Z         Returns:
2025-01-14T13:16:42.6786750Z         --------
2025-01-14T13:16:42.6786820Z         A TARDIS simulation object.
2025-01-14T13:16:42.6786860Z         """
2025-01-14T13:16:42.6786950Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6787050Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6787150Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6787290Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6787400Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6787480Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6787530Z >       sim = run_tardis(
2025-01-14T13:16:42.6787590Z             config_verysimple,
2025-01-14T13:16:42.6787650Z             atom_data=atomic_data,
2025-01-14T13:16:42.6787690Z         )
2025-01-14T13:16:42.6787690Z 
2025-01-14T13:16:42.6787810Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6787900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6787960Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6788020Z     simulation.run_convergence()
2025-01-14T13:16:42.6788110Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6788220Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6788290Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6788420Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6788500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6790010Z 
2025-01-14T13:16:42.6790710Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6790910Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6791090Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6791330Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6791460Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6791570Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6791570Z 
2025-01-14T13:16:42.6792340Z     def initialize_transport_state(
2025-01-14T13:16:42.6792860Z         self,
2025-01-14T13:16:42.6793040Z         simulation_state,
2025-01-14T13:16:42.6793210Z         opacity_state,
2025-01-14T13:16:42.6793360Z         macro_atom_state,
2025-01-14T13:16:42.6793560Z         plasma,
2025-01-14T13:16:42.6793710Z         no_of_packets,
2025-01-14T13:16:42.6794860Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6795090Z         iteration=0,
2025-01-14T13:16:42.6795230Z     ):
2025-01-14T13:16:42.6795740Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6796050Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6796200Z         else:
2025-01-14T13:16:42.6796360Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6796500Z     
2025-01-14T13:16:42.6796890Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6797130Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6797290Z         )
2025-01-14T13:16:42.6797430Z     
2025-01-14T13:16:42.6797730Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6799440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6800000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6800180Z         else:
2025-01-14T13:16:42.6800350Z             continuum_state = None
2025-01-14T13:16:42.6801560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6801950Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6802410Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6803160Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6803390Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6803780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6805230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6805430Z         ).to_numba(
2025-01-14T13:16:42.6805600Z             macro_atom_state,
2025-01-14T13:16:42.6807050Z             self.line_interaction_type,
2025-01-14T13:16:42.6807570Z         )
2025-01-14T13:16:42.6807820Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6809440Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6809780Z         ]
2025-01-14T13:16:42.6810310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6810330Z 
2025-01-14T13:16:42.6810440Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6810660Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data1-plot_colors] _
2025-01-14T13:16:42.6810660Z 
2025-01-14T13:16:42.6811350Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6811650Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6812190Z 
2025-01-14T13:16:42.6812260Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6812390Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6812450Z         """
2025-01-14T13:16:42.6812540Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6812580Z     
2025-01-14T13:16:42.6812630Z         Parameters:
2025-01-14T13:16:42.6812680Z         -----------
2025-01-14T13:16:42.6819810Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6820020Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6820070Z     
2025-01-14T13:16:42.6820120Z         Returns:
2025-01-14T13:16:42.6820170Z         --------
2025-01-14T13:16:42.6820230Z         A TARDIS simulation object.
2025-01-14T13:16:42.6820270Z         """
2025-01-14T13:16:42.6820370Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6820460Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6820580Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6820720Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6820850Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6820920Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6820970Z >       sim = run_tardis(
2025-01-14T13:16:42.6821030Z             config_verysimple,
2025-01-14T13:16:42.6821090Z             atom_data=atomic_data,
2025-01-14T13:16:42.6821130Z         )
2025-01-14T13:16:42.6821130Z 
2025-01-14T13:16:42.6821250Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6821350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6821410Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6821480Z     simulation.run_convergence()
2025-01-14T13:16:42.6821570Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6821680Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6821760Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6822140Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6822240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6822240Z 
2025-01-14T13:16:42.6822450Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6822610Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6822780Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6823010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6823120Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6823230Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6823240Z 
2025-01-14T13:16:42.6823310Z     def initialize_transport_state(
2025-01-14T13:16:42.6823360Z         self,
2025-01-14T13:16:42.6823420Z         simulation_state,
2025-01-14T13:16:42.6823460Z         opacity_state,
2025-01-14T13:16:42.6823520Z         macro_atom_state,
2025-01-14T13:16:42.6823560Z         plasma,
2025-01-14T13:16:42.6823610Z         no_of_packets,
2025-01-14T13:16:42.6823670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6823720Z         iteration=0,
2025-01-14T13:16:42.6823760Z     ):
2025-01-14T13:16:42.6823860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6823930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6823980Z         else:
2025-01-14T13:16:42.6824030Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6824080Z     
2025-01-14T13:16:42.6824180Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6824260Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6824410Z         )
2025-01-14T13:16:42.6824450Z     
2025-01-14T13:16:42.6824550Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6824650Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6824780Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6824820Z         else:
2025-01-14T13:16:42.6824880Z             continuum_state = None
2025-01-14T13:16:42.6824960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6825050Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6825110Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6825200Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6825270Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6825340Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6825410Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6825460Z         ).to_numba(
2025-01-14T13:16:42.6825520Z             macro_atom_state,
2025-01-14T13:16:42.6825580Z             self.line_interaction_type,
2025-01-14T13:16:42.6825630Z         )
2025-01-14T13:16:42.6825700Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6825920Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6825960Z         ]
2025-01-14T13:16:42.6826210Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6826220Z 
2025-01-14T13:16:42.6826320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6827300Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data1-new_bin_edges] _
2025-01-14T13:16:42.6827400Z 
2025-01-14T13:16:42.6829850Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6831770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6831790Z 
2025-01-14T13:16:42.6831870Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6831990Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6832040Z         """
2025-01-14T13:16:42.6832120Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6832180Z     
2025-01-14T13:16:42.6832220Z         Parameters:
2025-01-14T13:16:42.6832280Z         -----------
2025-01-14T13:16:42.6832380Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6832500Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6832540Z     
2025-01-14T13:16:42.6832590Z         Returns:
2025-01-14T13:16:42.6832650Z         --------
2025-01-14T13:16:42.6832700Z         A TARDIS simulation object.
2025-01-14T13:16:42.6832750Z         """
2025-01-14T13:16:42.6832840Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6832940Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6833040Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6833190Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6833290Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6833360Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6833410Z >       sim = run_tardis(
2025-01-14T13:16:42.6833470Z             config_verysimple,
2025-01-14T13:16:42.6833520Z             atom_data=atomic_data,
2025-01-14T13:16:42.6833570Z         )
2025-01-14T13:16:42.6833570Z 
2025-01-14T13:16:42.6833680Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6833770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6834020Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6834090Z     simulation.run_convergence()
2025-01-14T13:16:42.6834170Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6834280Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6834350Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6834470Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6834560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6834560Z 
2025-01-14T13:16:42.6834760Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6834930Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6835100Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6835320Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6835450Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6835550Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6835550Z 
2025-01-14T13:16:42.6835620Z     def initialize_transport_state(
2025-01-14T13:16:42.6835660Z         self,
2025-01-14T13:16:42.6835720Z         simulation_state,
2025-01-14T13:16:42.6835770Z         opacity_state,
2025-01-14T13:16:42.6835830Z         macro_atom_state,
2025-01-14T13:16:42.6835870Z         plasma,
2025-01-14T13:16:42.6836040Z         no_of_packets,
2025-01-14T13:16:42.6836140Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6836200Z         iteration=0,
2025-01-14T13:16:42.6836240Z     ):
2025-01-14T13:16:42.6836360Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6836440Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6836500Z         else:
2025-01-14T13:16:42.6836560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6836600Z     
2025-01-14T13:16:42.6836860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6836940Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6836990Z         )
2025-01-14T13:16:42.6837040Z     
2025-01-14T13:16:42.6837150Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6837240Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6837370Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6837420Z         else:
2025-01-14T13:16:42.6837490Z             continuum_state = None
2025-01-14T13:16:42.6837560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6837660Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6837730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6837810Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6837900Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6837970Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6838040Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6838090Z         ).to_numba(
2025-01-14T13:16:42.6838150Z             macro_atom_state,
2025-01-14T13:16:42.6838210Z             self.line_interaction_type,
2025-01-14T13:16:42.6838250Z         )
2025-01-14T13:16:42.6838330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6838560Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6838600Z         ]
2025-01-14T13:16:42.6838860Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6838860Z 
2025-01-14T13:16:42.6838980Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6839370Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data2-plot_data] _
2025-01-14T13:16:42.6839390Z 
2025-01-14T13:16:42.6839950Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6840250Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6840260Z 
2025-01-14T13:16:42.6840330Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6840450Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6840500Z         """
2025-01-14T13:16:42.6840590Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6840640Z     
2025-01-14T13:16:42.6840690Z         Parameters:
2025-01-14T13:16:42.6840740Z         -----------
2025-01-14T13:16:42.6840850Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6840970Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6841020Z     
2025-01-14T13:16:42.6841070Z         Returns:
2025-01-14T13:16:42.6841110Z         --------
2025-01-14T13:16:42.6841170Z         A TARDIS simulation object.
2025-01-14T13:16:42.6841220Z         """
2025-01-14T13:16:42.6841310Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6841420Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6841520Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6841670Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6841780Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6841850Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6841910Z >       sim = run_tardis(
2025-01-14T13:16:42.6841970Z             config_verysimple,
2025-01-14T13:16:42.6842030Z             atom_data=atomic_data,
2025-01-14T13:16:42.6842580Z         )
2025-01-14T13:16:42.6842580Z 
2025-01-14T13:16:42.6842700Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6842790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6842860Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6842920Z     simulation.run_convergence()
2025-01-14T13:16:42.6843010Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6843120Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6843190Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6843320Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6843410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6843410Z 
2025-01-14T13:16:42.6843620Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6843790Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6843970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6844190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6844320Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6844420Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6844430Z 
2025-01-14T13:16:42.6844490Z     def initialize_transport_state(
2025-01-14T13:16:42.6844540Z         self,
2025-01-14T13:16:42.6844590Z         simulation_state,
2025-01-14T13:16:42.6844650Z         opacity_state,
2025-01-14T13:16:42.6844700Z         macro_atom_state,
2025-01-14T13:16:42.6844740Z         plasma,
2025-01-14T13:16:42.6844790Z         no_of_packets,
2025-01-14T13:16:42.6845080Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6845130Z         iteration=0,
2025-01-14T13:16:42.6845180Z     ):
2025-01-14T13:16:42.6845280Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6845350Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6845400Z         else:
2025-01-14T13:16:42.6845450Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6845490Z     
2025-01-14T13:16:42.6845600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6845670Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6845720Z         )
2025-01-14T13:16:42.6845760Z     
2025-01-14T13:16:42.6845860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6845950Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6846070Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6846130Z         else:
2025-01-14T13:16:42.6846190Z             continuum_state = None
2025-01-14T13:16:42.6846270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6846360Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6846840Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6846950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6847030Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6847090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6847160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6847210Z         ).to_numba(
2025-01-14T13:16:42.6847280Z             macro_atom_state,
2025-01-14T13:16:42.6847350Z             self.line_interaction_type,
2025-01-14T13:16:42.6847400Z         )
2025-01-14T13:16:42.6847470Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6847700Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6847760Z         ]
2025-01-14T13:16:42.6848050Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6848310Z 
2025-01-14T13:16:42.6848440Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6848660Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data2-plot_colors] _
2025-01-14T13:16:42.6848660Z 
2025-01-14T13:16:42.6849230Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6849520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6849520Z 
2025-01-14T13:16:42.6849590Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6849710Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6849770Z         """
2025-01-14T13:16:42.6849870Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6849920Z     
2025-01-14T13:16:42.6850810Z         Parameters:
2025-01-14T13:16:42.6850880Z         -----------
2025-01-14T13:16:42.6851000Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6851110Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6851160Z     
2025-01-14T13:16:42.6851210Z         Returns:
2025-01-14T13:16:42.6851250Z         --------
2025-01-14T13:16:42.6851320Z         A TARDIS simulation object.
2025-01-14T13:16:42.6851360Z         """
2025-01-14T13:16:42.6851460Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6851560Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6851680Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6851940Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6852050Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6852120Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6852180Z >       sim = run_tardis(
2025-01-14T13:16:42.6852230Z             config_verysimple,
2025-01-14T13:16:42.6852290Z             atom_data=atomic_data,
2025-01-14T13:16:42.6852330Z         )
2025-01-14T13:16:42.6852330Z 
2025-01-14T13:16:42.6852440Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6852640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6852700Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6852760Z     simulation.run_convergence()
2025-01-14T13:16:42.6852850Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6852980Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6853060Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6853190Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6853270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6853280Z 
2025-01-14T13:16:42.6853510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6853700Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6853910Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6854130Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6854250Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6854360Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6854360Z 
2025-01-14T13:16:42.6854420Z     def initialize_transport_state(
2025-01-14T13:16:42.6854470Z         self,
2025-01-14T13:16:42.6854530Z         simulation_state,
2025-01-14T13:16:42.6854580Z         opacity_state,
2025-01-14T13:16:42.6854780Z         macro_atom_state,
2025-01-14T13:16:42.6854850Z         plasma,
2025-01-14T13:16:42.6854900Z         no_of_packets,
2025-01-14T13:16:42.6854960Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6855010Z         iteration=0,
2025-01-14T13:16:42.6855070Z     ):
2025-01-14T13:16:42.6855170Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6855240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6855280Z         else:
2025-01-14T13:16:42.6855340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6855380Z     
2025-01-14T13:16:42.6855480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6855560Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6855610Z         )
2025-01-14T13:16:42.6855650Z     
2025-01-14T13:16:42.6855770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6855870Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6856000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6856050Z         else:
2025-01-14T13:16:42.6856110Z             continuum_state = None
2025-01-14T13:16:42.6856190Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6856270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6856340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6856420Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6856490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6856560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6856640Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6856700Z         ).to_numba(
2025-01-14T13:16:42.6856750Z             macro_atom_state,
2025-01-14T13:16:42.6856910Z             self.line_interaction_type,
2025-01-14T13:16:42.6856950Z         )
2025-01-14T13:16:42.6857030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6857270Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6857330Z         ]
2025-01-14T13:16:42.6857570Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6857580Z 
2025-01-14T13:16:42.6857710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6857960Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data2-new_bin_edges] _
2025-01-14T13:16:42.6857960Z 
2025-01-14T13:16:42.6858530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6858870Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6858880Z 
2025-01-14T13:16:42.6858960Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6859090Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6859160Z         """
2025-01-14T13:16:42.6859270Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6859330Z     
2025-01-14T13:16:42.6859370Z         Parameters:
2025-01-14T13:16:42.6859430Z         -----------
2025-01-14T13:16:42.6859540Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6859660Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6859710Z     
2025-01-14T13:16:42.6859780Z         Returns:
2025-01-14T13:16:42.6859840Z         --------
2025-01-14T13:16:42.6859900Z         A TARDIS simulation object.
2025-01-14T13:16:42.6859960Z         """
2025-01-14T13:16:42.6860060Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6860260Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6860370Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6860530Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6860650Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6860720Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6860770Z >       sim = run_tardis(
2025-01-14T13:16:42.6860830Z             config_verysimple,
2025-01-14T13:16:42.6860890Z             atom_data=atomic_data,
2025-01-14T13:16:42.6860940Z         )
2025-01-14T13:16:42.6860940Z 
2025-01-14T13:16:42.6861050Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6861140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6861210Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6861280Z     simulation.run_convergence()
2025-01-14T13:16:42.6861370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6861480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6861550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6861680Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6861770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6861770Z 
2025-01-14T13:16:42.6862000Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6862190Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6862380Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6862620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6862840Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6862960Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6862960Z 
2025-01-14T13:16:42.6863050Z     def initialize_transport_state(
2025-01-14T13:16:42.6863100Z         self,
2025-01-14T13:16:42.6863160Z         simulation_state,
2025-01-14T13:16:42.6863210Z         opacity_state,
2025-01-14T13:16:42.6863260Z         macro_atom_state,
2025-01-14T13:16:42.6863310Z         plasma,
2025-01-14T13:16:42.6863360Z         no_of_packets,
2025-01-14T13:16:42.6863420Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6863480Z         iteration=0,
2025-01-14T13:16:42.6863540Z     ):
2025-01-14T13:16:42.6863660Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6863730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6863780Z         else:
2025-01-14T13:16:42.6863840Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6863900Z     
2025-01-14T13:16:42.6864090Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6864190Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6864240Z         )
2025-01-14T13:16:42.6864290Z     
2025-01-14T13:16:42.6864390Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6864480Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6864610Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6864660Z         else:
2025-01-14T13:16:42.6864710Z             continuum_state = None
2025-01-14T13:16:42.6864790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6864880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6864950Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6865040Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6865140Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6865220Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6865840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6865920Z         ).to_numba(
2025-01-14T13:16:42.6865980Z             macro_atom_state,
2025-01-14T13:16:42.6866040Z             self.line_interaction_type,
2025-01-14T13:16:42.6866100Z         )
2025-01-14T13:16:42.6866170Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6866410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6866450Z         ]
2025-01-14T13:16:42.6866730Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6866740Z 
2025-01-14T13:16:42.6866870Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6867090Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data3-plot_data] _
2025-01-14T13:16:42.6867100Z 
2025-01-14T13:16:42.6867680Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6868000Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6868010Z 
2025-01-14T13:16:42.6868080Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6868190Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6868240Z         """
2025-01-14T13:16:42.6868320Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6868390Z     
2025-01-14T13:16:42.6868440Z         Parameters:
2025-01-14T13:16:42.6868490Z         -----------
2025-01-14T13:16:42.6868600Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6869000Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6869060Z     
2025-01-14T13:16:42.6869110Z         Returns:
2025-01-14T13:16:42.6869160Z         --------
2025-01-14T13:16:42.6869240Z         A TARDIS simulation object.
2025-01-14T13:16:42.6869300Z         """
2025-01-14T13:16:42.6869400Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6869510Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6869610Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6869770Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6869900Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6869990Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6870040Z >       sim = run_tardis(
2025-01-14T13:16:42.6870100Z             config_verysimple,
2025-01-14T13:16:42.6870160Z             atom_data=atomic_data,
2025-01-14T13:16:42.6870220Z         )
2025-01-14T13:16:42.6870230Z 
2025-01-14T13:16:42.6870350Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6870450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6870510Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6870570Z     simulation.run_convergence()
2025-01-14T13:16:42.6870660Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6870770Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6870850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6870990Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6871090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6871090Z 
2025-01-14T13:16:42.6871300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6871470Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6871660Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6871990Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6872120Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6872220Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6872220Z 
2025-01-14T13:16:42.6872290Z     def initialize_transport_state(
2025-01-14T13:16:42.6872350Z         self,
2025-01-14T13:16:42.6872420Z         simulation_state,
2025-01-14T13:16:42.6872460Z         opacity_state,
2025-01-14T13:16:42.6872520Z         macro_atom_state,
2025-01-14T13:16:42.6872560Z         plasma,
2025-01-14T13:16:42.6872620Z         no_of_packets,
2025-01-14T13:16:42.6872670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6872730Z         iteration=0,
2025-01-14T13:16:42.6872770Z     ):
2025-01-14T13:16:42.6872870Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6872950Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6872990Z         else:
2025-01-14T13:16:42.6873050Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6873090Z     
2025-01-14T13:16:42.6873220Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6873290Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6873340Z         )
2025-01-14T13:16:42.6873390Z     
2025-01-14T13:16:42.6873490Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6873600Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6873740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6873780Z         else:
2025-01-14T13:16:42.6873840Z             continuum_state = None
2025-01-14T13:16:42.6873930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6874120Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6874210Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6874290Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6874360Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6874440Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6874520Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6874570Z         ).to_numba(
2025-01-14T13:16:42.6874630Z             macro_atom_state,
2025-01-14T13:16:42.6874700Z             self.line_interaction_type,
2025-01-14T13:16:42.6874740Z         )
2025-01-14T13:16:42.6874820Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6875060Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6875100Z         ]
2025-01-14T13:16:42.6875400Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6875410Z 
2025-01-14T13:16:42.6875550Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6875790Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data3-plot_colors] _
2025-01-14T13:16:42.6875800Z 
2025-01-14T13:16:42.6876360Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6876670Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6876670Z 
2025-01-14T13:16:42.6876750Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6876880Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6876940Z         """
2025-01-14T13:16:42.6877050Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6877180Z     
2025-01-14T13:16:42.6877240Z         Parameters:
2025-01-14T13:16:42.6877280Z         -----------
2025-01-14T13:16:42.6877410Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6877520Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6877570Z     
2025-01-14T13:16:42.6877620Z         Returns:
2025-01-14T13:16:42.6877670Z         --------
2025-01-14T13:16:42.6882490Z         A TARDIS simulation object.
2025-01-14T13:16:42.6882590Z         """
2025-01-14T13:16:42.6882680Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6882790Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6882890Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6883030Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6883150Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6883220Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6883280Z >       sim = run_tardis(
2025-01-14T13:16:42.6883340Z             config_verysimple,
2025-01-14T13:16:42.6883400Z             atom_data=atomic_data,
2025-01-14T13:16:42.6883440Z         )
2025-01-14T13:16:42.6883450Z 
2025-01-14T13:16:42.6883550Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6883640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6883700Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6883760Z     simulation.run_convergence()
2025-01-14T13:16:42.6883850Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6883960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6884030Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6884160Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6884450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6884460Z 
2025-01-14T13:16:42.6884680Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6884840Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6885030Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6885250Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6885380Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6885480Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6885500Z 
2025-01-14T13:16:42.6885560Z     def initialize_transport_state(
2025-01-14T13:16:42.6885610Z         self,
2025-01-14T13:16:42.6886680Z         simulation_state,
2025-01-14T13:16:42.6887180Z         opacity_state,
2025-01-14T13:16:42.6888230Z         macro_atom_state,
2025-01-14T13:16:42.6888680Z         plasma,
2025-01-14T13:16:42.6888850Z         no_of_packets,
2025-01-14T13:16:42.6889770Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6890010Z         iteration=0,
2025-01-14T13:16:42.6890190Z     ):
2025-01-14T13:16:42.6891430Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6891680Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6891820Z         else:
2025-01-14T13:16:42.6891990Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6892140Z     
2025-01-14T13:16:42.6892500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6892740Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6892890Z         )
2025-01-14T13:16:42.6893550Z     
2025-01-14T13:16:42.6893890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6894210Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6894560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6895210Z         else:
2025-01-14T13:16:42.6895960Z             continuum_state = None
2025-01-14T13:16:42.6896640Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6897090Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6897320Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6898100Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6899640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6899890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6900120Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6900260Z         ).to_numba(
2025-01-14T13:16:42.6900430Z             macro_atom_state,
2025-01-14T13:16:42.6900640Z             self.line_interaction_type,
2025-01-14T13:16:42.6900810Z         )
2025-01-14T13:16:42.6901040Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6901650Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6901800Z         ]
2025-01-14T13:16:42.6902470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6902480Z 
2025-01-14T13:16:42.6902800Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6903380Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data3-new_bin_edges] _
2025-01-14T13:16:42.6903390Z 
2025-01-14T13:16:42.6907760Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6910490Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6910540Z 
2025-01-14T13:16:42.6910730Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6911150Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6911440Z         """
2025-01-14T13:16:42.6911730Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6911870Z     
2025-01-14T13:16:42.6912030Z         Parameters:
2025-01-14T13:16:42.6912180Z         -----------
2025-01-14T13:16:42.6912490Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6912790Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6913260Z     
2025-01-14T13:16:42.6913470Z         Returns:
2025-01-14T13:16:42.6913620Z         --------
2025-01-14T13:16:42.6913810Z         A TARDIS simulation object.
2025-01-14T13:16:42.6914090Z         """
2025-01-14T13:16:42.6914560Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6914830Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6915130Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6915510Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6915810Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6916010Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6916170Z >       sim = run_tardis(
2025-01-14T13:16:42.6916350Z             config_verysimple,
2025-01-14T13:16:42.6916540Z             atom_data=atomic_data,
2025-01-14T13:16:42.6916670Z         )
2025-01-14T13:16:42.6916680Z 
2025-01-14T13:16:42.6916980Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6917270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6917500Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6917700Z     simulation.run_convergence()
2025-01-14T13:16:42.6917940Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6919130Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6919330Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6920740Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6921000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6921010Z 
2025-01-14T13:16:42.6921600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6922040Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6922560Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6923170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6923490Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6924540Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6924590Z 
2025-01-14T13:16:42.6924810Z     def initialize_transport_state(
2025-01-14T13:16:42.6924960Z         self,
2025-01-14T13:16:42.6925130Z         simulation_state,
2025-01-14T13:16:42.6925290Z         opacity_state,
2025-01-14T13:16:42.6925630Z         macro_atom_state,
2025-01-14T13:16:42.6925850Z         plasma,
2025-01-14T13:16:42.6926300Z         no_of_packets,
2025-01-14T13:16:42.6926520Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6926670Z         iteration=0,
2025-01-14T13:16:42.6926820Z     ):
2025-01-14T13:16:42.6927120Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6927330Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6928740Z         else:
2025-01-14T13:16:42.6929300Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6929460Z     
2025-01-14T13:16:42.6929770Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6931470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6933200Z         )
2025-01-14T13:16:42.6933380Z     
2025-01-14T13:16:42.6934140Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6934980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6936020Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6936190Z         else:
2025-01-14T13:16:42.6936360Z             continuum_state = None
2025-01-14T13:16:42.6936580Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6936810Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6937020Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6937540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6937750Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6937980Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6938310Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6938470Z         ).to_numba(
2025-01-14T13:16:42.6938630Z             macro_atom_state,
2025-01-14T13:16:42.6938820Z             self.line_interaction_type,
2025-01-14T13:16:42.6938960Z         )
2025-01-14T13:16:42.6939220Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6940290Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6940580Z         ]
2025-01-14T13:16:42.6941310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6941340Z 
2025-01-14T13:16:42.6941670Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6942260Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data4-plot_data] _
2025-01-14T13:16:42.6942280Z 
2025-01-14T13:16:42.6943810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6945640Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6945660Z 
2025-01-14T13:16:42.6945840Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6946160Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6946310Z         """
2025-01-14T13:16:42.6946550Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6946690Z     
2025-01-14T13:16:42.6946860Z         Parameters:
2025-01-14T13:16:42.6947040Z         -----------
2025-01-14T13:16:42.6947330Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6950810Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6951040Z     
2025-01-14T13:16:42.6951100Z         Returns:
2025-01-14T13:16:42.6951160Z         --------
2025-01-14T13:16:42.6951230Z         A TARDIS simulation object.
2025-01-14T13:16:42.6951280Z         """
2025-01-14T13:16:42.6951380Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6951480Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6951590Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6951740Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6951850Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6951930Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6951980Z >       sim = run_tardis(
2025-01-14T13:16:42.6952050Z             config_verysimple,
2025-01-14T13:16:42.6952100Z             atom_data=atomic_data,
2025-01-14T13:16:42.6952150Z         )
2025-01-14T13:16:42.6952390Z 
2025-01-14T13:16:42.6952510Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6952610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6952670Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6952740Z     simulation.run_convergence()
2025-01-14T13:16:42.6952820Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6952940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6953010Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6953130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6953220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6953220Z 
2025-01-14T13:16:42.6953440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6953600Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6953790Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6954020Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6954140Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6954270Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6954280Z 
2025-01-14T13:16:42.6954350Z     def initialize_transport_state(
2025-01-14T13:16:42.6954400Z         self,
2025-01-14T13:16:42.6954450Z         simulation_state,
2025-01-14T13:16:42.6954500Z         opacity_state,
2025-01-14T13:16:42.6954550Z         macro_atom_state,
2025-01-14T13:16:42.6954600Z         plasma,
2025-01-14T13:16:42.6954650Z         no_of_packets,
2025-01-14T13:16:42.6954710Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6954760Z         iteration=0,
2025-01-14T13:16:42.6954800Z     ):
2025-01-14T13:16:42.6954910Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6954990Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6955180Z         else:
2025-01-14T13:16:42.6955230Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6955280Z     
2025-01-14T13:16:42.6955390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6955470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6955510Z         )
2025-01-14T13:16:42.6955550Z     
2025-01-14T13:16:42.6955650Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6955740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6955880Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6955930Z         else:
2025-01-14T13:16:42.6956000Z             continuum_state = None
2025-01-14T13:16:42.6956080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6956170Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6956250Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6956330Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6956410Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6956480Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6956550Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6956600Z         ).to_numba(
2025-01-14T13:16:42.6956650Z             macro_atom_state,
2025-01-14T13:16:42.6956710Z             self.line_interaction_type,
2025-01-14T13:16:42.6956760Z         )
2025-01-14T13:16:42.6956840Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6957060Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6957110Z         ]
2025-01-14T13:16:42.6957380Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6957470Z 
2025-01-14T13:16:42.6957590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6957820Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data4-plot_colors] _
2025-01-14T13:16:42.6957830Z 
2025-01-14T13:16:42.6959750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6961170Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6961220Z 
2025-01-14T13:16:42.6961830Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6962170Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6962320Z         """
2025-01-14T13:16:42.6962550Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6962730Z     
2025-01-14T13:16:42.6962880Z         Parameters:
2025-01-14T13:16:42.6963230Z         -----------
2025-01-14T13:16:42.6964010Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6964380Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6964520Z     
2025-01-14T13:16:42.6964660Z         Returns:
2025-01-14T13:16:42.6964810Z         --------
2025-01-14T13:16:42.6965000Z         A TARDIS simulation object.
2025-01-14T13:16:42.6965160Z         """
2025-01-14T13:16:42.6966010Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6966240Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6966350Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6966510Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6966620Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6966720Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6966770Z >       sim = run_tardis(
2025-01-14T13:16:42.6967050Z             config_verysimple,
2025-01-14T13:16:42.6967110Z             atom_data=atomic_data,
2025-01-14T13:16:42.6967170Z         )
2025-01-14T13:16:42.6967180Z 
2025-01-14T13:16:42.6967300Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6967400Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6967470Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6967540Z     simulation.run_convergence()
2025-01-14T13:16:42.6967630Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6967740Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6967820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6967950Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6968060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6968060Z 
2025-01-14T13:16:42.6968280Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6968450Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6968630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6968860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6968980Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6969090Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6969100Z 
2025-01-14T13:16:42.6969160Z     def initialize_transport_state(
2025-01-14T13:16:42.6969210Z         self,
2025-01-14T13:16:42.6969260Z         simulation_state,
2025-01-14T13:16:42.6969320Z         opacity_state,
2025-01-14T13:16:42.6969490Z         macro_atom_state,
2025-01-14T13:16:42.6969540Z         plasma,
2025-01-14T13:16:42.6969590Z         no_of_packets,
2025-01-14T13:16:42.6969650Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6969710Z         iteration=0,
2025-01-14T13:16:42.6969750Z     ):
2025-01-14T13:16:42.6969850Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6969930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6969980Z         else:
2025-01-14T13:16:42.6970030Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6970070Z     
2025-01-14T13:16:42.6970180Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6970250Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6970300Z         )
2025-01-14T13:16:42.6970340Z     
2025-01-14T13:16:42.6970450Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6970540Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6970660Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6970710Z         else:
2025-01-14T13:16:42.6970770Z             continuum_state = None
2025-01-14T13:16:42.6970850Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6970940Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6971010Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6971090Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6971160Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6971230Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6971300Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6971340Z         ).to_numba(
2025-01-14T13:16:42.6971400Z             macro_atom_state,
2025-01-14T13:16:42.6971460Z             self.line_interaction_type,
2025-01-14T13:16:42.6971500Z         )
2025-01-14T13:16:42.6971590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6971830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6972170Z         ]
2025-01-14T13:16:42.6972430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6972440Z 
2025-01-14T13:16:42.6972570Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6972790Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data4-new_bin_edges] _
2025-01-14T13:16:42.6972790Z 
2025-01-14T13:16:42.6974850Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6975280Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6975290Z 
2025-01-14T13:16:42.6975370Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6975510Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6975560Z         """
2025-01-14T13:16:42.6975660Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6975710Z     
2025-01-14T13:16:42.6975770Z         Parameters:
2025-01-14T13:16:42.6975810Z         -----------
2025-01-14T13:16:42.6975940Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6976060Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6976110Z     
2025-01-14T13:16:42.6976160Z         Returns:
2025-01-14T13:16:42.6976210Z         --------
2025-01-14T13:16:42.6976270Z         A TARDIS simulation object.
2025-01-14T13:16:42.6976310Z         """
2025-01-14T13:16:42.6976410Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6977180Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6977290Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6977450Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6977560Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6977630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6977690Z >       sim = run_tardis(
2025-01-14T13:16:42.6977740Z             config_verysimple,
2025-01-14T13:16:42.6977810Z             atom_data=atomic_data,
2025-01-14T13:16:42.6977850Z         )
2025-01-14T13:16:42.6977860Z 
2025-01-14T13:16:42.6977970Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6978070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6978130Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6978200Z     simulation.run_convergence()
2025-01-14T13:16:42.6978290Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6978430Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6978520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6978640Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6978730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6978730Z 
2025-01-14T13:16:42.6978950Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6979120Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6979290Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6979520Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6979650Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6980360Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6980470Z 
2025-01-14T13:16:42.6980730Z     def initialize_transport_state(
2025-01-14T13:16:42.6981890Z         self,
2025-01-14T13:16:42.6982060Z         simulation_state,
2025-01-14T13:16:42.6982240Z         opacity_state,
2025-01-14T13:16:42.6982390Z         macro_atom_state,
2025-01-14T13:16:42.6982550Z         plasma,
2025-01-14T13:16:42.6982700Z         no_of_packets,
2025-01-14T13:16:42.6982880Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6983030Z         iteration=0,
2025-01-14T13:16:42.6983180Z     ):
2025-01-14T13:16:42.6983460Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6983670Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6983810Z         else:
2025-01-14T13:16:42.6983980Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6984110Z     
2025-01-14T13:16:42.6984420Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6984630Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6985700Z         )
2025-01-14T13:16:42.6985800Z     
2025-01-14T13:16:42.6985950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6986040Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6986170Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6986220Z         else:
2025-01-14T13:16:42.6986280Z             continuum_state = None
2025-01-14T13:16:42.6986360Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6986460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6986530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6986610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6986700Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6986770Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6986830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6987070Z         ).to_numba(
2025-01-14T13:16:42.6987140Z             macro_atom_state,
2025-01-14T13:16:42.6987210Z             self.line_interaction_type,
2025-01-14T13:16:42.6987260Z         )
2025-01-14T13:16:42.6987340Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6987560Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6987610Z         ]
2025-01-14T13:16:42.6987860Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6987870Z 
2025-01-14T13:16:42.6987990Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6988210Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data5-plot_data] _
2025-01-14T13:16:42.6988210Z 
2025-01-14T13:16:42.6988770Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6989160Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6989170Z 
2025-01-14T13:16:42.6989240Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6989350Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6989400Z         """
2025-01-14T13:16:42.6989490Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6989540Z     
2025-01-14T13:16:42.6989580Z         Parameters:
2025-01-14T13:16:42.6989640Z         -----------
2025-01-14T13:16:42.6989750Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6989860Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6989910Z     
2025-01-14T13:16:42.6989960Z         Returns:
2025-01-14T13:16:42.6990000Z         --------
2025-01-14T13:16:42.6990070Z         A TARDIS simulation object.
2025-01-14T13:16:42.6990220Z         """
2025-01-14T13:16:42.6990320Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6990410Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6990530Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.6990670Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.6990790Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.6990880Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.6990930Z >       sim = run_tardis(
2025-01-14T13:16:42.6990990Z             config_verysimple,
2025-01-14T13:16:42.6991050Z             atom_data=atomic_data,
2025-01-14T13:16:42.6991090Z         )
2025-01-14T13:16:42.6991100Z 
2025-01-14T13:16:42.6991200Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.6991310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6991370Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.6991440Z     simulation.run_convergence()
2025-01-14T13:16:42.6991530Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.6991640Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.6991710Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.6991840Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.6991920Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.6991930Z 
2025-01-14T13:16:42.6992140Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.6992310Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.6992490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.6992810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.6992940Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.6993050Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.6993060Z 
2025-01-14T13:16:42.6993120Z     def initialize_transport_state(
2025-01-14T13:16:42.6993170Z         self,
2025-01-14T13:16:42.6993220Z         simulation_state,
2025-01-14T13:16:42.6993280Z         opacity_state,
2025-01-14T13:16:42.6993330Z         macro_atom_state,
2025-01-14T13:16:42.6993380Z         plasma,
2025-01-14T13:16:42.6993430Z         no_of_packets,
2025-01-14T13:16:42.6993490Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.6993540Z         iteration=0,
2025-01-14T13:16:42.6993590Z     ):
2025-01-14T13:16:42.6993700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.6993770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.6993830Z         else:
2025-01-14T13:16:42.6993880Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.6993930Z     
2025-01-14T13:16:42.6994040Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.6994110Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.6994160Z         )
2025-01-14T13:16:42.6994200Z     
2025-01-14T13:16:42.6994300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.6994390Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.6994520Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.6994640Z         else:
2025-01-14T13:16:42.6994700Z             continuum_state = None
2025-01-14T13:16:42.6994780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.6994870Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.6994940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.6995030Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.6995200Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.6995270Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.6995340Z             continuum_state=continuum_state,
2025-01-14T13:16:42.6995380Z         ).to_numba(
2025-01-14T13:16:42.6995440Z             macro_atom_state,
2025-01-14T13:16:42.6995500Z             self.line_interaction_type,
2025-01-14T13:16:42.6995550Z         )
2025-01-14T13:16:42.6995630Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.6995860Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.6995900Z         ]
2025-01-14T13:16:42.6996150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.6996160Z 
2025-01-14T13:16:42.6996270Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.6996500Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data5-plot_colors] _
2025-01-14T13:16:42.6996500Z 
2025-01-14T13:16:42.6997040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.6997330Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.6997340Z 
2025-01-14T13:16:42.6997400Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.6997520Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.6997570Z         """
2025-01-14T13:16:42.6997650Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.6997700Z     
2025-01-14T13:16:42.6997810Z         Parameters:
2025-01-14T13:16:42.6997860Z         -----------
2025-01-14T13:16:42.6997970Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.6998090Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.6998130Z     
2025-01-14T13:16:42.6998190Z         Returns:
2025-01-14T13:16:42.6998230Z         --------
2025-01-14T13:16:42.6998300Z         A TARDIS simulation object.
2025-01-14T13:16:42.6998340Z         """
2025-01-14T13:16:42.6998440Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.6998530Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.6998650Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7004220Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7004470Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7004550Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7004630Z >       sim = run_tardis(
2025-01-14T13:16:42.7004690Z             config_verysimple,
2025-01-14T13:16:42.7004750Z             atom_data=atomic_data,
2025-01-14T13:16:42.7004800Z         )
2025-01-14T13:16:42.7004810Z 
2025-01-14T13:16:42.7004930Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7005020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7005090Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7005160Z     simulation.run_convergence()
2025-01-14T13:16:42.7005250Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7005360Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7005440Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7005560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7005660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7005670Z 
2025-01-14T13:16:42.7005890Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7006480Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7006660Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7006880Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7007010Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7007120Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7007120Z 
2025-01-14T13:16:42.7007190Z     def initialize_transport_state(
2025-01-14T13:16:42.7007230Z         self,
2025-01-14T13:16:42.7007280Z         simulation_state,
2025-01-14T13:16:42.7007330Z         opacity_state,
2025-01-14T13:16:42.7007390Z         macro_atom_state,
2025-01-14T13:16:42.7007460Z         plasma,
2025-01-14T13:16:42.7007520Z         no_of_packets,
2025-01-14T13:16:42.7007580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7007640Z         iteration=0,
2025-01-14T13:16:42.7007680Z     ):
2025-01-14T13:16:42.7007780Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7007860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7007910Z         else:
2025-01-14T13:16:42.7007960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7008020Z     
2025-01-14T13:16:42.7008120Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7008190Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7008240Z         )
2025-01-14T13:16:42.7008280Z     
2025-01-14T13:16:42.7008480Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7008570Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7008700Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7008980Z         else:
2025-01-14T13:16:42.7009050Z             continuum_state = None
2025-01-14T13:16:42.7009130Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7009220Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7009290Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7009390Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7009460Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7009530Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7009590Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7009640Z         ).to_numba(
2025-01-14T13:16:42.7009700Z             macro_atom_state,
2025-01-14T13:16:42.7009760Z             self.line_interaction_type,
2025-01-14T13:16:42.7009800Z         )
2025-01-14T13:16:42.7009880Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7010120Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7010170Z         ]
2025-01-14T13:16:42.7010440Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7010440Z 
2025-01-14T13:16:42.7010560Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7010780Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data5-new_bin_edges] _
2025-01-14T13:16:42.7010790Z 
2025-01-14T13:16:42.7011330Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7011620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7011630Z 
2025-01-14T13:16:42.7011690Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7011800Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7011930Z         """
2025-01-14T13:16:42.7012020Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7012060Z     
2025-01-14T13:16:42.7012110Z         Parameters:
2025-01-14T13:16:42.7012160Z         -----------
2025-01-14T13:16:42.7012260Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7012380Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7012420Z     
2025-01-14T13:16:42.7012470Z         Returns:
2025-01-14T13:16:42.7012520Z         --------
2025-01-14T13:16:42.7012580Z         A TARDIS simulation object.
2025-01-14T13:16:42.7012630Z         """
2025-01-14T13:16:42.7012710Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7012810Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7012920Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7013070Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7018120Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7018950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7019040Z >       sim = run_tardis(
2025-01-14T13:16:42.7019150Z             config_verysimple,
2025-01-14T13:16:42.7019250Z             atom_data=atomic_data,
2025-01-14T13:16:42.7019330Z         )
2025-01-14T13:16:42.7019330Z 
2025-01-14T13:16:42.7019470Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7019610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7019700Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7019760Z     simulation.run_convergence()
2025-01-14T13:16:42.7020140Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7020550Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7020920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7021070Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7021210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7021220Z 
2025-01-14T13:16:42.7021510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7022530Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7023490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7023770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7023990Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7024180Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7024190Z 
2025-01-14T13:16:42.7024310Z     def initialize_transport_state(
2025-01-14T13:16:42.7024400Z         self,
2025-01-14T13:16:42.7024520Z         simulation_state,
2025-01-14T13:16:42.7024610Z         opacity_state,
2025-01-14T13:16:42.7024680Z         macro_atom_state,
2025-01-14T13:16:42.7024730Z         plasma,
2025-01-14T13:16:42.7024780Z         no_of_packets,
2025-01-14T13:16:42.7025100Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7025210Z         iteration=0,
2025-01-14T13:16:42.7025290Z     ):
2025-01-14T13:16:42.7025450Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7025570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7025650Z         else:
2025-01-14T13:16:42.7025750Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7025810Z     
2025-01-14T13:16:42.7025950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7026050Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7026120Z         )
2025-01-14T13:16:42.7026170Z     
2025-01-14T13:16:42.7026300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7026600Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7027180Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7027270Z         else:
2025-01-14T13:16:42.7027370Z             continuum_state = None
2025-01-14T13:16:42.7027480Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7027600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7027710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7027820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7028160Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7028320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7028430Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7028510Z         ).to_numba(
2025-01-14T13:16:42.7028630Z             macro_atom_state,
2025-01-14T13:16:42.7028730Z             self.line_interaction_type,
2025-01-14T13:16:42.7028820Z         )
2025-01-14T13:16:42.7028940Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7029550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7029610Z         ]
2025-01-14T13:16:42.7030180Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7030190Z 
2025-01-14T13:16:42.7030330Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7030780Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data6-plot_data] _
2025-01-14T13:16:42.7030790Z 
2025-01-14T13:16:42.7031430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7031950Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7031960Z 
2025-01-14T13:16:42.7032050Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7032200Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7032270Z         """
2025-01-14T13:16:42.7032420Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7032490Z     
2025-01-14T13:16:42.7032590Z         Parameters:
2025-01-14T13:16:42.7032680Z         -----------
2025-01-14T13:16:42.7033190Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7034550Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7034800Z     
2025-01-14T13:16:42.7034990Z         Returns:
2025-01-14T13:16:42.7035250Z         --------
2025-01-14T13:16:42.7035520Z         A TARDIS simulation object.
2025-01-14T13:16:42.7035720Z         """
2025-01-14T13:16:42.7036090Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7036430Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7036790Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7037290Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7037480Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7037580Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7037670Z >       sim = run_tardis(
2025-01-14T13:16:42.7037760Z             config_verysimple,
2025-01-14T13:16:42.7037850Z             atom_data=atomic_data,
2025-01-14T13:16:42.7037940Z         )
2025-01-14T13:16:42.7037950Z 
2025-01-14T13:16:42.7038070Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7038170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7038280Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7038500Z     simulation.run_convergence()
2025-01-14T13:16:42.7039310Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7039440Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7039540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7039700Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7039800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7039810Z 
2025-01-14T13:16:42.7040910Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7041710Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7041950Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7042190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7042660Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7042810Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7042820Z 
2025-01-14T13:16:42.7042910Z     def initialize_transport_state(
2025-01-14T13:16:42.7042990Z         self,
2025-01-14T13:16:42.7043070Z         simulation_state,
2025-01-14T13:16:42.7043140Z         opacity_state,
2025-01-14T13:16:42.7043180Z         macro_atom_state,
2025-01-14T13:16:42.7043250Z         plasma,
2025-01-14T13:16:42.7043320Z         no_of_packets,
2025-01-14T13:16:42.7043400Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7043470Z         iteration=0,
2025-01-14T13:16:42.7043550Z     ):
2025-01-14T13:16:42.7043710Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7043790Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7043950Z         else:
2025-01-14T13:16:42.7044020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7044070Z     
2025-01-14T13:16:42.7044210Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7044300Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7044360Z         )
2025-01-14T13:16:42.7044420Z     
2025-01-14T13:16:42.7044570Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7044720Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7044930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7045020Z         else:
2025-01-14T13:16:42.7045110Z             continuum_state = None
2025-01-14T13:16:42.7045260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7045630Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7045730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7045820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7045960Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7046070Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7046210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7046290Z         ).to_numba(
2025-01-14T13:16:42.7046970Z             macro_atom_state,
2025-01-14T13:16:42.7047280Z             self.line_interaction_type,
2025-01-14T13:16:42.7047910Z         )
2025-01-14T13:16:42.7048200Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7048490Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7048550Z         ]
2025-01-14T13:16:42.7048810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7048810Z 
2025-01-14T13:16:42.7048940Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7049170Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data6-plot_colors] _
2025-01-14T13:16:42.7053360Z 
2025-01-14T13:16:42.7054080Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7054400Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7054400Z 
2025-01-14T13:16:42.7054470Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7055210Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7055450Z         """
2025-01-14T13:16:42.7055740Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7055880Z     
2025-01-14T13:16:42.7056050Z         Parameters:
2025-01-14T13:16:42.7056230Z         -----------
2025-01-14T13:16:42.7056550Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7056880Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7057030Z     
2025-01-14T13:16:42.7057180Z         Returns:
2025-01-14T13:16:42.7063220Z         --------
2025-01-14T13:16:42.7063360Z         A TARDIS simulation object.
2025-01-14T13:16:42.7063410Z         """
2025-01-14T13:16:42.7064700Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7064840Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7064980Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7065140Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7065280Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7065900Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7065990Z >       sim = run_tardis(
2025-01-14T13:16:42.7067140Z             config_verysimple,
2025-01-14T13:16:42.7067200Z             atom_data=atomic_data,
2025-01-14T13:16:42.7067260Z         )
2025-01-14T13:16:42.7067260Z 
2025-01-14T13:16:42.7067370Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7067460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7067520Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7067590Z     simulation.run_convergence()
2025-01-14T13:16:42.7067680Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7067800Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7067870Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7068010Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7068100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7068110Z 
2025-01-14T13:16:42.7070530Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7070730Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7070930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7074700Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7074850Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7074970Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7074970Z 
2025-01-14T13:16:42.7075040Z     def initialize_transport_state(
2025-01-14T13:16:42.7075090Z         self,
2025-01-14T13:16:42.7075150Z         simulation_state,
2025-01-14T13:16:42.7075200Z         opacity_state,
2025-01-14T13:16:42.7075250Z         macro_atom_state,
2025-01-14T13:16:42.7075300Z         plasma,
2025-01-14T13:16:42.7075350Z         no_of_packets,
2025-01-14T13:16:42.7075420Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7075480Z         iteration=0,
2025-01-14T13:16:42.7075520Z     ):
2025-01-14T13:16:42.7076550Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7076630Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7076680Z         else:
2025-01-14T13:16:42.7076740Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7076810Z     
2025-01-14T13:16:42.7078100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7078200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7078250Z         )
2025-01-14T13:16:42.7078290Z     
2025-01-14T13:16:42.7078400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7078490Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7078620Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7078670Z         else:
2025-01-14T13:16:42.7078730Z             continuum_state = None
2025-01-14T13:16:42.7078810Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7078910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7078970Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7079060Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7079140Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7079220Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7079280Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7079330Z         ).to_numba(
2025-01-14T13:16:42.7079400Z             macro_atom_state,
2025-01-14T13:16:42.7079460Z             self.line_interaction_type,
2025-01-14T13:16:42.7079510Z         )
2025-01-14T13:16:42.7079580Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7079800Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7080010Z         ]
2025-01-14T13:16:42.7080270Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7080280Z 
2025-01-14T13:16:42.7080410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7080630Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data6-new_bin_edges] _
2025-01-14T13:16:42.7080630Z 
2025-01-14T13:16:42.7081200Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7085370Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7085390Z 
2025-01-14T13:16:42.7085470Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7085600Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7085650Z         """
2025-01-14T13:16:42.7085740Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7085790Z     
2025-01-14T13:16:42.7085840Z         Parameters:
2025-01-14T13:16:42.7085890Z         -----------
2025-01-14T13:16:42.7087020Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7090650Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7090740Z     
2025-01-14T13:16:42.7090790Z         Returns:
2025-01-14T13:16:42.7090840Z         --------
2025-01-14T13:16:42.7090910Z         A TARDIS simulation object.
2025-01-14T13:16:42.7090960Z         """
2025-01-14T13:16:42.7091050Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7091580Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7091700Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7092650Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7094170Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7095080Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7095240Z >       sim = run_tardis(
2025-01-14T13:16:42.7095420Z             config_verysimple,
2025-01-14T13:16:42.7095590Z             atom_data=atomic_data,
2025-01-14T13:16:42.7095730Z         )
2025-01-14T13:16:42.7095740Z 
2025-01-14T13:16:42.7096040Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7096290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7096480Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7096670Z     simulation.run_convergence()
2025-01-14T13:16:42.7096920Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7097230Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7097440Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7097810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7098070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7098080Z 
2025-01-14T13:16:42.7098640Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7099100Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7099590Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7100200Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7100520Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7100860Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7100870Z 
2025-01-14T13:16:42.7101090Z     def initialize_transport_state(
2025-01-14T13:16:42.7101520Z         self,
2025-01-14T13:16:42.7101690Z         simulation_state,
2025-01-14T13:16:42.7101850Z         opacity_state,
2025-01-14T13:16:42.7102030Z         macro_atom_state,
2025-01-14T13:16:42.7102170Z         plasma,
2025-01-14T13:16:42.7102330Z         no_of_packets,
2025-01-14T13:16:42.7102500Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7102670Z         iteration=0,
2025-01-14T13:16:42.7102820Z     ):
2025-01-14T13:16:42.7103080Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7103530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7103680Z         else:
2025-01-14T13:16:42.7103840Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7103990Z     
2025-01-14T13:16:42.7104310Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7104590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7104750Z         )
2025-01-14T13:16:42.7104890Z     
2025-01-14T13:16:42.7105190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7105510Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7105890Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7106050Z         else:
2025-01-14T13:16:42.7106240Z             continuum_state = None
2025-01-14T13:16:42.7136880Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7138160Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7138450Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7138570Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7138650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7138730Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7138800Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7138860Z         ).to_numba(
2025-01-14T13:16:42.7138920Z             macro_atom_state,
2025-01-14T13:16:42.7139010Z             self.line_interaction_type,
2025-01-14T13:16:42.7139070Z         )
2025-01-14T13:16:42.7139140Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7139890Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7139940Z         ]
2025-01-14T13:16:42.7140210Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7140210Z 
2025-01-14T13:16:42.7140330Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7140550Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data7-plot_data] _
2025-01-14T13:16:42.7140550Z 
2025-01-14T13:16:42.7141120Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7141740Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7141760Z 
2025-01-14T13:16:42.7141840Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7141960Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7142010Z         """
2025-01-14T13:16:42.7142100Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7142150Z     
2025-01-14T13:16:42.7142200Z         Parameters:
2025-01-14T13:16:42.7142250Z         -----------
2025-01-14T13:16:42.7142360Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7142890Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7142960Z     
2025-01-14T13:16:42.7143010Z         Returns:
2025-01-14T13:16:42.7143050Z         --------
2025-01-14T13:16:42.7143110Z         A TARDIS simulation object.
2025-01-14T13:16:42.7143360Z         """
2025-01-14T13:16:42.7143450Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7143800Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7144340Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7145000Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7145140Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7145220Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7145280Z >       sim = run_tardis(
2025-01-14T13:16:42.7145340Z             config_verysimple,
2025-01-14T13:16:42.7145400Z             atom_data=atomic_data,
2025-01-14T13:16:42.7145450Z         )
2025-01-14T13:16:42.7145450Z 
2025-01-14T13:16:42.7145570Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7145660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7145740Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7145810Z     simulation.run_convergence()
2025-01-14T13:16:42.7146920Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7147060Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7147150Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7147270Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7147370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7147380Z 
2025-01-14T13:16:42.7147600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7147770Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7147970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7148200Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7148340Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7151120Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7151140Z 
2025-01-14T13:16:42.7151220Z     def initialize_transport_state(
2025-01-14T13:16:42.7151520Z         self,
2025-01-14T13:16:42.7151610Z         simulation_state,
2025-01-14T13:16:42.7151670Z         opacity_state,
2025-01-14T13:16:42.7151730Z         macro_atom_state,
2025-01-14T13:16:42.7151780Z         plasma,
2025-01-14T13:16:42.7151830Z         no_of_packets,
2025-01-14T13:16:42.7151890Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7151950Z         iteration=0,
2025-01-14T13:16:42.7152000Z     ):
2025-01-14T13:16:42.7152100Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7152180Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7152230Z         else:
2025-01-14T13:16:42.7152290Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7152340Z     
2025-01-14T13:16:42.7152460Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7152530Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7152590Z         )
2025-01-14T13:16:42.7152630Z     
2025-01-14T13:16:42.7152750Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7152840Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7152980Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7153020Z         else:
2025-01-14T13:16:42.7153090Z             continuum_state = None
2025-01-14T13:16:42.7153180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7153260Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7153340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7153740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7153840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7154920Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7155010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7155060Z         ).to_numba(
2025-01-14T13:16:42.7155120Z             macro_atom_state,
2025-01-14T13:16:42.7155190Z             self.line_interaction_type,
2025-01-14T13:16:42.7155250Z         )
2025-01-14T13:16:42.7155330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7155550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7155600Z         ]
2025-01-14T13:16:42.7155870Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7155870Z 
2025-01-14T13:16:42.7155990Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7156220Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data7-plot_colors] _
2025-01-14T13:16:42.7156230Z 
2025-01-14T13:16:42.7156800Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7157100Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7157110Z 
2025-01-14T13:16:42.7157170Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7157290Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7157330Z         """
2025-01-14T13:16:42.7157420Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7157460Z     
2025-01-14T13:16:42.7157510Z         Parameters:
2025-01-14T13:16:42.7157560Z         -----------
2025-01-14T13:16:42.7157670Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7157790Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7157950Z     
2025-01-14T13:16:42.7158000Z         Returns:
2025-01-14T13:16:42.7158050Z         --------
2025-01-14T13:16:42.7158110Z         A TARDIS simulation object.
2025-01-14T13:16:42.7158150Z         """
2025-01-14T13:16:42.7158240Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7158340Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7158440Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7158580Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7158690Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7158760Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7158810Z >       sim = run_tardis(
2025-01-14T13:16:42.7158870Z             config_verysimple,
2025-01-14T13:16:42.7163340Z             atom_data=atomic_data,
2025-01-14T13:16:42.7163390Z         )
2025-01-14T13:16:42.7163390Z 
2025-01-14T13:16:42.7163510Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7163590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7163660Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7163720Z     simulation.run_convergence()
2025-01-14T13:16:42.7163800Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7163910Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7163970Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7164100Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7164180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7164190Z 
2025-01-14T13:16:42.7164400Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7164640Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7164820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7165040Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7165160Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7165270Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7165270Z 
2025-01-14T13:16:42.7165330Z     def initialize_transport_state(
2025-01-14T13:16:42.7165380Z         self,
2025-01-14T13:16:42.7165430Z         simulation_state,
2025-01-14T13:16:42.7165480Z         opacity_state,
2025-01-14T13:16:42.7165530Z         macro_atom_state,
2025-01-14T13:16:42.7165580Z         plasma,
2025-01-14T13:16:42.7165630Z         no_of_packets,
2025-01-14T13:16:42.7165690Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7165740Z         iteration=0,
2025-01-14T13:16:42.7165790Z     ):
2025-01-14T13:16:42.7165880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7165960Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7166000Z         else:
2025-01-14T13:16:42.7166070Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7166110Z     
2025-01-14T13:16:42.7166210Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7166280Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7166330Z         )
2025-01-14T13:16:42.7166370Z     
2025-01-14T13:16:42.7166470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7166560Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7166690Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7166730Z         else:
2025-01-14T13:16:42.7166780Z             continuum_state = None
2025-01-14T13:16:42.7166860Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7166950Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7167070Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7167150Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7167220Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7167290Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7167350Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7167400Z         ).to_numba(
2025-01-14T13:16:42.7167460Z             macro_atom_state,
2025-01-14T13:16:42.7167520Z             self.line_interaction_type,
2025-01-14T13:16:42.7167560Z         )
2025-01-14T13:16:42.7167640Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7167850Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7167900Z         ]
2025-01-14T13:16:42.7168140Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7168150Z 
2025-01-14T13:16:42.7168270Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7168480Z _ ERROR at setup of TestLIVPlotter.test_prepare_plot_data[plotter_prepare_plot_data7-new_bin_edges] _
2025-01-14T13:16:42.7168490Z 
2025-01-14T13:16:42.7169020Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7169300Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7169300Z 
2025-01-14T13:16:42.7169360Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7169480Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7169570Z         """
2025-01-14T13:16:42.7169650Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7169700Z     
2025-01-14T13:16:42.7169750Z         Parameters:
2025-01-14T13:16:42.7169800Z         -----------
2025-01-14T13:16:42.7169900Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7170020Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7170060Z     
2025-01-14T13:16:42.7170100Z         Returns:
2025-01-14T13:16:42.7170140Z         --------
2025-01-14T13:16:42.7170200Z         A TARDIS simulation object.
2025-01-14T13:16:42.7170240Z         """
2025-01-14T13:16:42.7170330Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7170420Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7170530Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7170670Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7170780Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7170850Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7170900Z >       sim = run_tardis(
2025-01-14T13:16:42.7170960Z             config_verysimple,
2025-01-14T13:16:42.7171010Z             atom_data=atomic_data,
2025-01-14T13:16:42.7171050Z         )
2025-01-14T13:16:42.7171060Z 
2025-01-14T13:16:42.7171160Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7171250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7171310Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7171370Z     simulation.run_convergence()
2025-01-14T13:16:42.7171460Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7171570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7171630Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7171750Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7171840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7171900Z 
2025-01-14T13:16:42.7172110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7172280Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7172450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7172670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7172790Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7172910Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7172910Z 
2025-01-14T13:16:42.7172970Z     def initialize_transport_state(
2025-01-14T13:16:42.7173010Z         self,
2025-01-14T13:16:42.7173060Z         simulation_state,
2025-01-14T13:16:42.7173110Z         opacity_state,
2025-01-14T13:16:42.7173160Z         macro_atom_state,
2025-01-14T13:16:42.7173210Z         plasma,
2025-01-14T13:16:42.7173260Z         no_of_packets,
2025-01-14T13:16:42.7173310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7173360Z         iteration=0,
2025-01-14T13:16:42.7173400Z     ):
2025-01-14T13:16:42.7173500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7173570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7173620Z         else:
2025-01-14T13:16:42.7173670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7173710Z     
2025-01-14T13:16:42.7173820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7173890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7173930Z         )
2025-01-14T13:16:42.7173970Z     
2025-01-14T13:16:42.7174070Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7174200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7174320Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7174370Z         else:
2025-01-14T13:16:42.7174420Z             continuum_state = None
2025-01-14T13:16:42.7174510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7174590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7174660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7174740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7174810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7174880Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7174940Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7174990Z         ).to_numba(
2025-01-14T13:16:42.7175050Z             macro_atom_state,
2025-01-14T13:16:42.7175110Z             self.line_interaction_type,
2025-01-14T13:16:42.7175160Z         )
2025-01-14T13:16:42.7175230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7175450Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7175500Z         ]
2025-01-14T13:16:42.7175750Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7175750Z 
2025-01-14T13:16:42.7175860Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7176040Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl0] _
2025-01-14T13:16:42.7176050Z 
2025-01-14T13:16:42.7176570Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7180190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7181350Z 
2025-01-14T13:16:42.7199930Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7200200Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7200250Z         """
2025-01-14T13:16:42.7200340Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7200380Z     
2025-01-14T13:16:42.7200430Z         Parameters:
2025-01-14T13:16:42.7200490Z         -----------
2025-01-14T13:16:42.7200600Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7200730Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7200780Z     
2025-01-14T13:16:42.7200830Z         Returns:
2025-01-14T13:16:42.7200870Z         --------
2025-01-14T13:16:42.7200930Z         A TARDIS simulation object.
2025-01-14T13:16:42.7200980Z         """
2025-01-14T13:16:42.7201070Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7201190Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7201300Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7201440Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7201550Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7201630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7201680Z >       sim = run_tardis(
2025-01-14T13:16:42.7201740Z             config_verysimple,
2025-01-14T13:16:42.7201790Z             atom_data=atomic_data,
2025-01-14T13:16:42.7201840Z         )
2025-01-14T13:16:42.7201840Z 
2025-01-14T13:16:42.7201950Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7202040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7202100Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7202170Z     simulation.run_convergence()
2025-01-14T13:16:42.7202770Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7202890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7202970Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7203090Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7203180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7203190Z 
2025-01-14T13:16:42.7203390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7203550Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7203720Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7203960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7204080Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7204190Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7204200Z 
2025-01-14T13:16:42.7204260Z     def initialize_transport_state(
2025-01-14T13:16:42.7204310Z         self,
2025-01-14T13:16:42.7204360Z         simulation_state,
2025-01-14T13:16:42.7204410Z         opacity_state,
2025-01-14T13:16:42.7204460Z         macro_atom_state,
2025-01-14T13:16:42.7204500Z         plasma,
2025-01-14T13:16:42.7204550Z         no_of_packets,
2025-01-14T13:16:42.7204610Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7204650Z         iteration=0,
2025-01-14T13:16:42.7204690Z     ):
2025-01-14T13:16:42.7204790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7204860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7204910Z         else:
2025-01-14T13:16:42.7204960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7205000Z     
2025-01-14T13:16:42.7205110Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7205180Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7205390Z         )
2025-01-14T13:16:42.7205430Z     
2025-01-14T13:16:42.7205530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7205610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7205740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7205780Z         else:
2025-01-14T13:16:42.7205850Z             continuum_state = None
2025-01-14T13:16:42.7205920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7206010Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7206070Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7206170Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7206250Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7206320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7206390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7206430Z         ).to_numba(
2025-01-14T13:16:42.7206500Z             macro_atom_state,
2025-01-14T13:16:42.7207390Z             self.line_interaction_type,
2025-01-14T13:16:42.7208000Z         )
2025-01-14T13:16:42.7208370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7209470Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7209630Z         ]
2025-01-14T13:16:42.7211230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7211270Z 
2025-01-14T13:16:42.7211850Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7212720Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl1] _
2025-01-14T13:16:42.7212740Z 
2025-01-14T13:16:42.7216050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7217030Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7217060Z 
2025-01-14T13:16:42.7217260Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7217570Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7217720Z         """
2025-01-14T13:16:42.7217960Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7218100Z     
2025-01-14T13:16:42.7218250Z         Parameters:
2025-01-14T13:16:42.7218400Z         -----------
2025-01-14T13:16:42.7218690Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7219010Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7219170Z     
2025-01-14T13:16:42.7219300Z         Returns:
2025-01-14T13:16:42.7219460Z         --------
2025-01-14T13:16:42.7219630Z         A TARDIS simulation object.
2025-01-14T13:16:42.7219770Z         """
2025-01-14T13:16:42.7220010Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7220270Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7220550Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7220930Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7221220Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7221420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7221580Z >       sim = run_tardis(
2025-01-14T13:16:42.7221750Z             config_verysimple,
2025-01-14T13:16:42.7221920Z             atom_data=atomic_data,
2025-01-14T13:16:42.7222060Z         )
2025-01-14T13:16:42.7222080Z 
2025-01-14T13:16:42.7222380Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7222620Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7223320Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7223500Z     simulation.run_convergence()
2025-01-14T13:16:42.7223750Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7226210Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7226680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7227020Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7227310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7227330Z 
2025-01-14T13:16:42.7227950Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7228440Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7228970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7229590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7229960Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7230580Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7230620Z 
2025-01-14T13:16:42.7231000Z     def initialize_transport_state(
2025-01-14T13:16:42.7231320Z         self,
2025-01-14T13:16:42.7231690Z         simulation_state,
2025-01-14T13:16:42.7232000Z         opacity_state,
2025-01-14T13:16:42.7232410Z         macro_atom_state,
2025-01-14T13:16:42.7233100Z         plasma,
2025-01-14T13:16:42.7233470Z         no_of_packets,
2025-01-14T13:16:42.7233630Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7233700Z         iteration=0,
2025-01-14T13:16:42.7233750Z     ):
2025-01-14T13:16:42.7233860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7234300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7234360Z         else:
2025-01-14T13:16:42.7234420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7234460Z     
2025-01-14T13:16:42.7234580Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7234690Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7234750Z         )
2025-01-14T13:16:42.7234790Z     
2025-01-14T13:16:42.7234890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7234980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7235110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7235160Z         else:
2025-01-14T13:16:42.7235230Z             continuum_state = None
2025-01-14T13:16:42.7235320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7235400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7235480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7235560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7235640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7235710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7235780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7235830Z         ).to_numba(
2025-01-14T13:16:42.7235880Z             macro_atom_state,
2025-01-14T13:16:42.7235950Z             self.line_interaction_type,
2025-01-14T13:16:42.7236000Z         )
2025-01-14T13:16:42.7236090Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7236590Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7236660Z         ]
2025-01-14T13:16:42.7236930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7236950Z 
2025-01-14T13:16:42.7237080Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7237440Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl2] _
2025-01-14T13:16:42.7237450Z 
2025-01-14T13:16:42.7238040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7238350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7238370Z 
2025-01-14T13:16:42.7238440Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7238560Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7238600Z         """
2025-01-14T13:16:42.7238700Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7238740Z     
2025-01-14T13:16:42.7238800Z         Parameters:
2025-01-14T13:16:42.7238850Z         -----------
2025-01-14T13:16:42.7238960Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7239090Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7239130Z     
2025-01-14T13:16:42.7239180Z         Returns:
2025-01-14T13:16:42.7239230Z         --------
2025-01-14T13:16:42.7239300Z         A TARDIS simulation object.
2025-01-14T13:16:42.7239340Z         """
2025-01-14T13:16:42.7239430Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7239530Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7239630Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7239790Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7239920Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7240080Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7240140Z >       sim = run_tardis(
2025-01-14T13:16:42.7240190Z             config_verysimple,
2025-01-14T13:16:42.7240270Z             atom_data=atomic_data,
2025-01-14T13:16:42.7240320Z         )
2025-01-14T13:16:42.7240320Z 
2025-01-14T13:16:42.7240430Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7240530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7240610Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7240670Z     simulation.run_convergence()
2025-01-14T13:16:42.7240770Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7240890Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7240960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7241200Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7241300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7241300Z 
2025-01-14T13:16:42.7241530Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7241700Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7241900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7242130Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7242270Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7242390Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7242390Z 
2025-01-14T13:16:42.7242460Z     def initialize_transport_state(
2025-01-14T13:16:42.7242510Z         self,
2025-01-14T13:16:42.7242560Z         simulation_state,
2025-01-14T13:16:42.7242610Z         opacity_state,
2025-01-14T13:16:42.7242660Z         macro_atom_state,
2025-01-14T13:16:42.7242710Z         plasma,
2025-01-14T13:16:42.7242760Z         no_of_packets,
2025-01-14T13:16:42.7243120Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7243170Z         iteration=0,
2025-01-14T13:16:42.7243210Z     ):
2025-01-14T13:16:42.7243300Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7243380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7243420Z         else:
2025-01-14T13:16:42.7243480Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7243520Z     
2025-01-14T13:16:42.7243630Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7243700Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7243750Z         )
2025-01-14T13:16:42.7243790Z     
2025-01-14T13:16:42.7243890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7243980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7244100Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7244150Z         else:
2025-01-14T13:16:42.7244210Z             continuum_state = None
2025-01-14T13:16:42.7244300Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7244390Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7244460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7244540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7244610Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7244670Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7244740Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7244790Z         ).to_numba(
2025-01-14T13:16:42.7244840Z             macro_atom_state,
2025-01-14T13:16:42.7244900Z             self.line_interaction_type,
2025-01-14T13:16:42.7244950Z         )
2025-01-14T13:16:42.7245030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7245520Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7245570Z         ]
2025-01-14T13:16:42.7245820Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7245820Z 
2025-01-14T13:16:42.7245940Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7246120Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl3] _
2025-01-14T13:16:42.7246120Z 
2025-01-14T13:16:42.7246670Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7246950Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7246960Z 
2025-01-14T13:16:42.7247020Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7247140Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7247190Z         """
2025-01-14T13:16:42.7247280Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7247320Z     
2025-01-14T13:16:42.7247370Z         Parameters:
2025-01-14T13:16:42.7247410Z         -----------
2025-01-14T13:16:42.7247530Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7247640Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7247680Z     
2025-01-14T13:16:42.7247740Z         Returns:
2025-01-14T13:16:42.7247780Z         --------
2025-01-14T13:16:42.7247840Z         A TARDIS simulation object.
2025-01-14T13:16:42.7247880Z         """
2025-01-14T13:16:42.7247960Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7248060Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7248170Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7248310Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7248480Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7248550Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7248610Z >       sim = run_tardis(
2025-01-14T13:16:42.7248660Z             config_verysimple,
2025-01-14T13:16:42.7248730Z             atom_data=atomic_data,
2025-01-14T13:16:42.7248770Z         )
2025-01-14T13:16:42.7248770Z 
2025-01-14T13:16:42.7248870Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7248970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7249030Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7249090Z     simulation.run_convergence()
2025-01-14T13:16:42.7249180Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7249290Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7249360Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7249490Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7249580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7249580Z 
2025-01-14T13:16:42.7249800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7250460Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7250650Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7250870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7250990Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7251100Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7251220Z 
2025-01-14T13:16:42.7251280Z     def initialize_transport_state(
2025-01-14T13:16:42.7251330Z         self,
2025-01-14T13:16:42.7251380Z         simulation_state,
2025-01-14T13:16:42.7251440Z         opacity_state,
2025-01-14T13:16:42.7251490Z         macro_atom_state,
2025-01-14T13:16:42.7251540Z         plasma,
2025-01-14T13:16:42.7251590Z         no_of_packets,
2025-01-14T13:16:42.7251660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7251700Z         iteration=0,
2025-01-14T13:16:42.7251750Z     ):
2025-01-14T13:16:42.7251840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7251910Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7251960Z         else:
2025-01-14T13:16:42.7252010Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7252050Z     
2025-01-14T13:16:42.7252150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7252220Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7252270Z         )
2025-01-14T13:16:42.7252320Z     
2025-01-14T13:16:42.7252420Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7252510Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7252630Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7252680Z         else:
2025-01-14T13:16:42.7252730Z             continuum_state = None
2025-01-14T13:16:42.7252810Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7252900Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7252960Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7253040Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7253110Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7253180Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7253250Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7253300Z         ).to_numba(
2025-01-14T13:16:42.7253350Z             macro_atom_state,
2025-01-14T13:16:42.7253410Z             self.line_interaction_type,
2025-01-14T13:16:42.7253510Z         )
2025-01-14T13:16:42.7253590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7253810Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7253850Z         ]
2025-01-14T13:16:42.7254090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7254100Z 
2025-01-14T13:16:42.7254210Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7254390Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl4] _
2025-01-14T13:16:42.7254400Z 
2025-01-14T13:16:42.7254950Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7255260Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7255260Z 
2025-01-14T13:16:42.7255330Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7255440Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7255480Z         """
2025-01-14T13:16:42.7255560Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7255600Z     
2025-01-14T13:16:42.7255650Z         Parameters:
2025-01-14T13:16:42.7255700Z         -----------
2025-01-14T13:16:42.7255810Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7255920Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7255960Z     
2025-01-14T13:16:42.7256020Z         Returns:
2025-01-14T13:16:42.7256170Z         --------
2025-01-14T13:16:42.7256240Z         A TARDIS simulation object.
2025-01-14T13:16:42.7256280Z         """
2025-01-14T13:16:42.7256370Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7256460Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7256570Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7256710Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7256810Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7256890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7256930Z >       sim = run_tardis(
2025-01-14T13:16:42.7256990Z             config_verysimple,
2025-01-14T13:16:42.7257060Z             atom_data=atomic_data,
2025-01-14T13:16:42.7257110Z         )
2025-01-14T13:16:42.7257110Z 
2025-01-14T13:16:42.7257220Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7257310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7257370Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7262360Z     simulation.run_convergence()
2025-01-14T13:16:42.7262460Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7262580Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7262650Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7262770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7262860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7262870Z 
2025-01-14T13:16:42.7263070Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7263240Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7263410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7263640Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7263880Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7263990Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7264000Z 
2025-01-14T13:16:42.7264060Z     def initialize_transport_state(
2025-01-14T13:16:42.7264440Z         self,
2025-01-14T13:16:42.7264540Z         simulation_state,
2025-01-14T13:16:42.7264590Z         opacity_state,
2025-01-14T13:16:42.7264650Z         macro_atom_state,
2025-01-14T13:16:42.7264690Z         plasma,
2025-01-14T13:16:42.7264750Z         no_of_packets,
2025-01-14T13:16:42.7264820Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7264870Z         iteration=0,
2025-01-14T13:16:42.7264920Z     ):
2025-01-14T13:16:42.7265040Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7265110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7265170Z         else:
2025-01-14T13:16:42.7265220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7265270Z     
2025-01-14T13:16:42.7265390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7265470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7265520Z         )
2025-01-14T13:16:42.7265560Z     
2025-01-14T13:16:42.7265670Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7265750Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7265880Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7265920Z         else:
2025-01-14T13:16:42.7265990Z             continuum_state = None
2025-01-14T13:16:42.7266070Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7266150Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7266220Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7266440Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7266520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7266600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7266660Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7266710Z         ).to_numba(
2025-01-14T13:16:42.7266760Z             macro_atom_state,
2025-01-14T13:16:42.7266820Z             self.line_interaction_type,
2025-01-14T13:16:42.7266870Z         )
2025-01-14T13:16:42.7266940Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7267180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7267220Z         ]
2025-01-14T13:16:42.7267470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7267480Z 
2025-01-14T13:16:42.7267590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7267790Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl5] _
2025-01-14T13:16:42.7267790Z 
2025-01-14T13:16:42.7268350Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7268630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7268640Z 
2025-01-14T13:16:42.7268700Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7268810Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7268860Z         """
2025-01-14T13:16:42.7268940Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7268980Z     
2025-01-14T13:16:42.7269030Z         Parameters:
2025-01-14T13:16:42.7269090Z         -----------
2025-01-14T13:16:42.7269190Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7269630Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7269670Z     
2025-01-14T13:16:42.7269720Z         Returns:
2025-01-14T13:16:42.7269770Z         --------
2025-01-14T13:16:42.7269820Z         A TARDIS simulation object.
2025-01-14T13:16:42.7269870Z         """
2025-01-14T13:16:42.7269970Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7270070Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7270340Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7270500Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7270620Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7270700Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7270750Z >       sim = run_tardis(
2025-01-14T13:16:42.7270820Z             config_verysimple,
2025-01-14T13:16:42.7270870Z             atom_data=atomic_data,
2025-01-14T13:16:42.7270930Z         )
2025-01-14T13:16:42.7270930Z 
2025-01-14T13:16:42.7271040Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7271130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7271190Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7271260Z     simulation.run_convergence()
2025-01-14T13:16:42.7271340Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7271450Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7271510Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7271630Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7271730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7271730Z 
2025-01-14T13:16:42.7272190Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7272360Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7272540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7272760Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7272890Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7272990Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7273000Z 
2025-01-14T13:16:42.7273060Z     def initialize_transport_state(
2025-01-14T13:16:42.7273110Z         self,
2025-01-14T13:16:42.7273160Z         simulation_state,
2025-01-14T13:16:42.7273210Z         opacity_state,
2025-01-14T13:16:42.7273260Z         macro_atom_state,
2025-01-14T13:16:42.7273300Z         plasma,
2025-01-14T13:16:42.7273360Z         no_of_packets,
2025-01-14T13:16:42.7273410Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7273460Z         iteration=0,
2025-01-14T13:16:42.7273520Z     ):
2025-01-14T13:16:42.7273620Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7273700Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7273740Z         else:
2025-01-14T13:16:42.7273800Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7273840Z     
2025-01-14T13:16:42.7273950Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7274010Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7274060Z         )
2025-01-14T13:16:42.7274100Z     
2025-01-14T13:16:42.7274200Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7274290Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7274580Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7274640Z         else:
2025-01-14T13:16:42.7274700Z             continuum_state = None
2025-01-14T13:16:42.7274770Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7274960Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7275030Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7275110Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7275180Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7275250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7275320Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7275360Z         ).to_numba(
2025-01-14T13:16:42.7275420Z             macro_atom_state,
2025-01-14T13:16:42.7275480Z             self.line_interaction_type,
2025-01-14T13:16:42.7275530Z         )
2025-01-14T13:16:42.7275600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7275820Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7275870Z         ]
2025-01-14T13:16:42.7276120Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7276120Z 
2025-01-14T13:16:42.7276240Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7276410Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl6] _
2025-01-14T13:16:42.7276420Z 
2025-01-14T13:16:42.7276960Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7277240Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7277240Z 
2025-01-14T13:16:42.7277310Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7277470Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7277520Z         """
2025-01-14T13:16:42.7277600Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7277650Z     
2025-01-14T13:16:42.7277700Z         Parameters:
2025-01-14T13:16:42.7277740Z         -----------
2025-01-14T13:16:42.7277850Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7277960Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7278010Z     
2025-01-14T13:16:42.7278050Z         Returns:
2025-01-14T13:16:42.7278090Z         --------
2025-01-14T13:16:42.7278150Z         A TARDIS simulation object.
2025-01-14T13:16:42.7278200Z         """
2025-01-14T13:16:42.7278280Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7278380Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7278480Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7278630Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7278730Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7278800Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7278860Z >       sim = run_tardis(
2025-01-14T13:16:42.7278910Z             config_verysimple,
2025-01-14T13:16:42.7278970Z             atom_data=atomic_data,
2025-01-14T13:16:42.7279010Z         )
2025-01-14T13:16:42.7279010Z 
2025-01-14T13:16:42.7279120Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7279200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7279260Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7279320Z     simulation.run_convergence()
2025-01-14T13:16:42.7279410Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7279510Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7279590Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7279710Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7279850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7279850Z 
2025-01-14T13:16:42.7280060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7280220Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7280400Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7280620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7280740Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7280850Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7280850Z 
2025-01-14T13:16:42.7280910Z     def initialize_transport_state(
2025-01-14T13:16:42.7280960Z         self,
2025-01-14T13:16:42.7281010Z         simulation_state,
2025-01-14T13:16:42.7281060Z         opacity_state,
2025-01-14T13:16:42.7281110Z         macro_atom_state,
2025-01-14T13:16:42.7281280Z         plasma,
2025-01-14T13:16:42.7281330Z         no_of_packets,
2025-01-14T13:16:42.7281390Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7281440Z         iteration=0,
2025-01-14T13:16:42.7281490Z     ):
2025-01-14T13:16:42.7281580Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7281650Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7281700Z         else:
2025-01-14T13:16:42.7281750Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7281790Z     
2025-01-14T13:16:42.7281900Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7281970Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7282010Z         )
2025-01-14T13:16:42.7282050Z     
2025-01-14T13:16:42.7282150Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7282310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7282450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7282500Z         else:
2025-01-14T13:16:42.7282550Z             continuum_state = None
2025-01-14T13:16:42.7282620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7282700Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7282780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7282850Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7282930Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7282990Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7283060Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7283100Z         ).to_numba(
2025-01-14T13:16:42.7283150Z             macro_atom_state,
2025-01-14T13:16:42.7283220Z             self.line_interaction_type,
2025-01-14T13:16:42.7283260Z         )
2025-01-14T13:16:42.7283340Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7283560Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7283610Z         ]
2025-01-14T13:16:42.7283850Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7283860Z 
2025-01-14T13:16:42.7283970Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7284150Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_mpl[plotter_generate_plot_mpl7] _
2025-01-14T13:16:42.7284150Z 
2025-01-14T13:16:42.7284700Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7285000Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7285070Z 
2025-01-14T13:16:42.7285140Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7285250Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7285290Z         """
2025-01-14T13:16:42.7285380Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7285420Z     
2025-01-14T13:16:42.7285470Z         Parameters:
2025-01-14T13:16:42.7285520Z         -----------
2025-01-14T13:16:42.7285630Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7285740Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7285780Z     
2025-01-14T13:16:42.7285830Z         Returns:
2025-01-14T13:16:42.7285870Z         --------
2025-01-14T13:16:42.7285930Z         A TARDIS simulation object.
2025-01-14T13:16:42.7285980Z         """
2025-01-14T13:16:42.7286190Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7286330Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7286440Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7286580Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7286690Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7286760Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7286810Z >       sim = run_tardis(
2025-01-14T13:16:42.7286860Z             config_verysimple,
2025-01-14T13:16:42.7286920Z             atom_data=atomic_data,
2025-01-14T13:16:42.7286960Z         )
2025-01-14T13:16:42.7286970Z 
2025-01-14T13:16:42.7287070Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7287160Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7287340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7287400Z     simulation.run_convergence()
2025-01-14T13:16:42.7287490Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7287600Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7287670Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7287800Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7287880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7287880Z 
2025-01-14T13:16:42.7288090Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7288250Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7288440Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7288670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7288800Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7288910Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7288910Z 
2025-01-14T13:16:42.7288980Z     def initialize_transport_state(
2025-01-14T13:16:42.7289020Z         self,
2025-01-14T13:16:42.7289080Z         simulation_state,
2025-01-14T13:16:42.7289130Z         opacity_state,
2025-01-14T13:16:42.7289180Z         macro_atom_state,
2025-01-14T13:16:42.7289230Z         plasma,
2025-01-14T13:16:42.7289280Z         no_of_packets,
2025-01-14T13:16:42.7289340Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7289940Z         iteration=0,
2025-01-14T13:16:42.7290000Z     ):
2025-01-14T13:16:42.7290100Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7290170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7290210Z         else:
2025-01-14T13:16:42.7290270Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7290330Z     
2025-01-14T13:16:42.7290440Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7290800Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7290840Z         )
2025-01-14T13:16:42.7290890Z     
2025-01-14T13:16:42.7290990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7291070Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7291230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7291290Z         else:
2025-01-14T13:16:42.7291340Z             continuum_state = None
2025-01-14T13:16:42.7291420Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7291510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7291580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7291670Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7291740Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7291820Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7291880Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7291930Z         ).to_numba(
2025-01-14T13:16:42.7291990Z             macro_atom_state,
2025-01-14T13:16:42.7292060Z             self.line_interaction_type,
2025-01-14T13:16:42.7292100Z         )
2025-01-14T13:16:42.7292180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7292400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7292450Z         ]
2025-01-14T13:16:42.7292700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7292710Z 
2025-01-14T13:16:42.7292830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7292990Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl0] __
2025-01-14T13:16:42.7293230Z 
2025-01-14T13:16:42.7293780Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7294080Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7294080Z 
2025-01-14T13:16:42.7294140Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7294250Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7294300Z         """
2025-01-14T13:16:42.7294380Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7294430Z     
2025-01-14T13:16:42.7294480Z         Parameters:
2025-01-14T13:16:42.7294520Z         -----------
2025-01-14T13:16:42.7294630Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7294750Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7294790Z     
2025-01-14T13:16:42.7294840Z         Returns:
2025-01-14T13:16:42.7294890Z         --------
2025-01-14T13:16:42.7294950Z         A TARDIS simulation object.
2025-01-14T13:16:42.7294990Z         """
2025-01-14T13:16:42.7295080Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7295170Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7295280Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7295420Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7295530Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7295600Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7295650Z >       sim = run_tardis(
2025-01-14T13:16:42.7295710Z             config_verysimple,
2025-01-14T13:16:42.7295770Z             atom_data=atomic_data,
2025-01-14T13:16:42.7295810Z         )
2025-01-14T13:16:42.7295810Z 
2025-01-14T13:16:42.7295920Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7296070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7296120Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7296180Z     simulation.run_convergence()
2025-01-14T13:16:42.7296270Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7296380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7296450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7296570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7296660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7296660Z 
2025-01-14T13:16:42.7296870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7297030Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7297210Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7297450Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7297570Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7297680Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7297680Z 
2025-01-14T13:16:42.7297770Z     def initialize_transport_state(
2025-01-14T13:16:42.7297820Z         self,
2025-01-14T13:16:42.7297870Z         simulation_state,
2025-01-14T13:16:42.7297920Z         opacity_state,
2025-01-14T13:16:42.7297970Z         macro_atom_state,
2025-01-14T13:16:42.7298010Z         plasma,
2025-01-14T13:16:42.7298070Z         no_of_packets,
2025-01-14T13:16:42.7298120Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7298170Z         iteration=0,
2025-01-14T13:16:42.7298290Z     ):
2025-01-14T13:16:42.7298390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7298460Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7298510Z         else:
2025-01-14T13:16:42.7298560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7298610Z     
2025-01-14T13:16:42.7298710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7298780Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7298830Z         )
2025-01-14T13:16:42.7298870Z     
2025-01-14T13:16:42.7298970Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7299060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7299180Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7299220Z         else:
2025-01-14T13:16:42.7299290Z             continuum_state = None
2025-01-14T13:16:42.7299360Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7299450Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7299510Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7299600Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7299680Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7299770Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7299840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7299890Z         ).to_numba(
2025-01-14T13:16:42.7299940Z             macro_atom_state,
2025-01-14T13:16:42.7300000Z             self.line_interaction_type,
2025-01-14T13:16:42.7300040Z         )
2025-01-14T13:16:42.7300120Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7300330Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7300390Z         ]
2025-01-14T13:16:42.7300640Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7300650Z 
2025-01-14T13:16:42.7300760Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7301000Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl1] __
2025-01-14T13:16:42.7301010Z 
2025-01-14T13:16:42.7301530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7301820Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7301820Z 
2025-01-14T13:16:42.7301880Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7301990Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7302040Z         """
2025-01-14T13:16:42.7302120Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7302170Z     
2025-01-14T13:16:42.7302210Z         Parameters:
2025-01-14T13:16:42.7302270Z         -----------
2025-01-14T13:16:42.7302370Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7302480Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7302530Z     
2025-01-14T13:16:42.7302570Z         Returns:
2025-01-14T13:16:42.7302620Z         --------
2025-01-14T13:16:42.7302670Z         A TARDIS simulation object.
2025-01-14T13:16:42.7302720Z         """
2025-01-14T13:16:42.7302800Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7302900Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7303000Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7303150Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7303250Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7303390Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7303440Z >       sim = run_tardis(
2025-01-14T13:16:42.7303500Z             config_verysimple,
2025-01-14T13:16:42.7303560Z             atom_data=atomic_data,
2025-01-14T13:16:42.7303610Z         )
2025-01-14T13:16:42.7303610Z 
2025-01-14T13:16:42.7303710Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7303800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7303860Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7303920Z     simulation.run_convergence()
2025-01-14T13:16:42.7304010Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7304120Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7304200Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7304320Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7304410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7304420Z 
2025-01-14T13:16:42.7304620Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7304780Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7304960Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7305200Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7305320Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7305440Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7305450Z 
2025-01-14T13:16:42.7305510Z     def initialize_transport_state(
2025-01-14T13:16:42.7305560Z         self,
2025-01-14T13:16:42.7305610Z         simulation_state,
2025-01-14T13:16:42.7305660Z         opacity_state,
2025-01-14T13:16:42.7305730Z         macro_atom_state,
2025-01-14T13:16:42.7305770Z         plasma,
2025-01-14T13:16:42.7305910Z         no_of_packets,
2025-01-14T13:16:42.7305960Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7306010Z         iteration=0,
2025-01-14T13:16:42.7306060Z     ):
2025-01-14T13:16:42.7306150Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7306230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7306280Z         else:
2025-01-14T13:16:42.7306330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7306370Z     
2025-01-14T13:16:42.7306480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7306550Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7306600Z         )
2025-01-14T13:16:42.7306640Z     
2025-01-14T13:16:42.7306750Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7306840Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7306970Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7307020Z         else:
2025-01-14T13:16:42.7307080Z             continuum_state = None
2025-01-14T13:16:42.7307160Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7307240Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7307330Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7307410Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7307490Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7307550Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7307630Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7307670Z         ).to_numba(
2025-01-14T13:16:42.7307740Z             macro_atom_state,
2025-01-14T13:16:42.7307800Z             self.line_interaction_type,
2025-01-14T13:16:42.7307840Z         )
2025-01-14T13:16:42.7307920Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7308210Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7308260Z         ]
2025-01-14T13:16:42.7308510Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7308510Z 
2025-01-14T13:16:42.7308630Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7308790Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl2] __
2025-01-14T13:16:42.7308790Z 
2025-01-14T13:16:42.7309350Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7309640Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7309650Z 
2025-01-14T13:16:42.7309710Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7309830Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7309870Z         """
2025-01-14T13:16:42.7309960Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7310000Z     
2025-01-14T13:16:42.7310050Z         Parameters:
2025-01-14T13:16:42.7310100Z         -----------
2025-01-14T13:16:42.7310200Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7310330Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7310380Z     
2025-01-14T13:16:42.7310420Z         Returns:
2025-01-14T13:16:42.7310470Z         --------
2025-01-14T13:16:42.7310520Z         A TARDIS simulation object.
2025-01-14T13:16:42.7310570Z         """
2025-01-14T13:16:42.7310740Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7310840Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7310940Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7311350Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7311450Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7311520Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7311580Z >       sim = run_tardis(
2025-01-14T13:16:42.7311630Z             config_verysimple,
2025-01-14T13:16:42.7311690Z             atom_data=atomic_data,
2025-01-14T13:16:42.7311730Z         )
2025-01-14T13:16:42.7311730Z 
2025-01-14T13:16:42.7311830Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7311920Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7311980Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7312040Z     simulation.run_convergence()
2025-01-14T13:16:42.7312130Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7312250Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7312350Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7317120Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7317250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7317260Z 
2025-01-14T13:16:42.7318520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7319160Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7319640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7320620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7321080Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7323510Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7323540Z 
2025-01-14T13:16:42.7323950Z     def initialize_transport_state(
2025-01-14T13:16:42.7324210Z         self,
2025-01-14T13:16:42.7324310Z         simulation_state,
2025-01-14T13:16:42.7324360Z         opacity_state,
2025-01-14T13:16:42.7324410Z         macro_atom_state,
2025-01-14T13:16:42.7324460Z         plasma,
2025-01-14T13:16:42.7324510Z         no_of_packets,
2025-01-14T13:16:42.7324580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7324620Z         iteration=0,
2025-01-14T13:16:42.7324670Z     ):
2025-01-14T13:16:42.7324770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7324840Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7324890Z         else:
2025-01-14T13:16:42.7324950Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7324990Z     
2025-01-14T13:16:42.7325100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7325190Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7325230Z         )
2025-01-14T13:16:42.7325280Z     
2025-01-14T13:16:42.7325390Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7325480Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7325600Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7325660Z         else:
2025-01-14T13:16:42.7325720Z             continuum_state = None
2025-01-14T13:16:42.7325820Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7325900Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7325970Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7326050Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7326130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7326200Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7326270Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7326320Z         ).to_numba(
2025-01-14T13:16:42.7326370Z             macro_atom_state,
2025-01-14T13:16:42.7326660Z             self.line_interaction_type,
2025-01-14T13:16:42.7326710Z         )
2025-01-14T13:16:42.7326780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7327020Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7327080Z         ]
2025-01-14T13:16:42.7327320Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7327320Z 
2025-01-14T13:16:42.7327450Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7327600Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl3] __
2025-01-14T13:16:42.7327610Z 
2025-01-14T13:16:42.7328160Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7328460Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7328470Z 
2025-01-14T13:16:42.7328530Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7328650Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7328700Z         """
2025-01-14T13:16:42.7328800Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7328850Z     
2025-01-14T13:16:42.7328910Z         Parameters:
2025-01-14T13:16:42.7328950Z         -----------
2025-01-14T13:16:42.7329060Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7329170Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7329220Z     
2025-01-14T13:16:42.7329380Z         Returns:
2025-01-14T13:16:42.7329430Z         --------
2025-01-14T13:16:42.7329490Z         A TARDIS simulation object.
2025-01-14T13:16:42.7329530Z         """
2025-01-14T13:16:42.7329620Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7329720Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7329830Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7329970Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7330070Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7330140Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7330190Z >       sim = run_tardis(
2025-01-14T13:16:42.7330240Z             config_verysimple,
2025-01-14T13:16:42.7330300Z             atom_data=atomic_data,
2025-01-14T13:16:42.7330340Z         )
2025-01-14T13:16:42.7330350Z 
2025-01-14T13:16:42.7330450Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7330550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7330610Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7330680Z     simulation.run_convergence()
2025-01-14T13:16:42.7330760Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7330870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7330940Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7331060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7331150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7331150Z 
2025-01-14T13:16:42.7331360Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7331520Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7331690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7331910Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7332100Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7332210Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7332210Z 
2025-01-14T13:16:42.7332270Z     def initialize_transport_state(
2025-01-14T13:16:42.7332320Z         self,
2025-01-14T13:16:42.7332380Z         simulation_state,
2025-01-14T13:16:42.7332430Z         opacity_state,
2025-01-14T13:16:42.7332490Z         macro_atom_state,
2025-01-14T13:16:42.7332550Z         plasma,
2025-01-14T13:16:42.7332590Z         no_of_packets,
2025-01-14T13:16:42.7332650Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7332700Z         iteration=0,
2025-01-14T13:16:42.7332750Z     ):
2025-01-14T13:16:42.7332860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7332930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7332980Z         else:
2025-01-14T13:16:42.7333030Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7333080Z     
2025-01-14T13:16:42.7333180Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7333260Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7333310Z         )
2025-01-14T13:16:42.7333350Z     
2025-01-14T13:16:42.7333450Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7333540Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7333660Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7333710Z         else:
2025-01-14T13:16:42.7333760Z             continuum_state = None
2025-01-14T13:16:42.7333850Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7333930Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7333990Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7334160Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7334240Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7334310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7334380Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7334430Z         ).to_numba(
2025-01-14T13:16:42.7334480Z             macro_atom_state,
2025-01-14T13:16:42.7334540Z             self.line_interaction_type,
2025-01-14T13:16:42.7334580Z         )
2025-01-14T13:16:42.7334660Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7334880Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7334920Z         ]
2025-01-14T13:16:42.7335170Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7335180Z 
2025-01-14T13:16:42.7335300Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7335490Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl4] __
2025-01-14T13:16:42.7335490Z 
2025-01-14T13:16:42.7336040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7336340Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7336340Z 
2025-01-14T13:16:42.7336400Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7336510Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7336560Z         """
2025-01-14T13:16:42.7336650Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7336690Z     
2025-01-14T13:16:42.7336740Z         Parameters:
2025-01-14T13:16:42.7336800Z         -----------
2025-01-14T13:16:42.7336900Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7337110Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7337150Z     
2025-01-14T13:16:42.7337200Z         Returns:
2025-01-14T13:16:42.7337250Z         --------
2025-01-14T13:16:42.7337310Z         A TARDIS simulation object.
2025-01-14T13:16:42.7337350Z         """
2025-01-14T13:16:42.7337440Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7337540Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7337650Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7337780Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7337900Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7337970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7338020Z >       sim = run_tardis(
2025-01-14T13:16:42.7338100Z             config_verysimple,
2025-01-14T13:16:42.7338170Z             atom_data=atomic_data,
2025-01-14T13:16:42.7338210Z         )
2025-01-14T13:16:42.7338220Z 
2025-01-14T13:16:42.7338320Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7338610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7338680Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7338740Z     simulation.run_convergence()
2025-01-14T13:16:42.7338820Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7338930Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7339000Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7339120Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7339210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7339330Z 
2025-01-14T13:16:42.7339540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7339710Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7339880Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7340100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7340220Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7340330Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7340330Z 
2025-01-14T13:16:42.7340400Z     def initialize_transport_state(
2025-01-14T13:16:42.7340440Z         self,
2025-01-14T13:16:42.7340500Z         simulation_state,
2025-01-14T13:16:42.7340550Z         opacity_state,
2025-01-14T13:16:42.7340600Z         macro_atom_state,
2025-01-14T13:16:42.7340640Z         plasma,
2025-01-14T13:16:42.7340690Z         no_of_packets,
2025-01-14T13:16:42.7340750Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7340800Z         iteration=0,
2025-01-14T13:16:42.7340850Z     ):
2025-01-14T13:16:42.7340940Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7341010Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7341290Z         else:
2025-01-14T13:16:42.7342410Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7342590Z     
2025-01-14T13:16:42.7343370Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7343860Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7344010Z         )
2025-01-14T13:16:42.7344150Z     
2025-01-14T13:16:42.7344470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7344730Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7345070Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7345240Z         else:
2025-01-14T13:16:42.7345420Z             continuum_state = None
2025-01-14T13:16:42.7345630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7347250Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7348580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7348860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7349070Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7349280Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7349930Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7350370Z         ).to_numba(
2025-01-14T13:16:42.7350490Z             macro_atom_state,
2025-01-14T13:16:42.7350560Z             self.line_interaction_type,
2025-01-14T13:16:42.7350610Z         )
2025-01-14T13:16:42.7350680Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7350910Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7350970Z         ]
2025-01-14T13:16:42.7351230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7351240Z 
2025-01-14T13:16:42.7351350Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7351520Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl5] __
2025-01-14T13:16:42.7351520Z 
2025-01-14T13:16:42.7352060Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7352360Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7352360Z 
2025-01-14T13:16:42.7352430Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7352960Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7353010Z         """
2025-01-14T13:16:42.7353100Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7353170Z     
2025-01-14T13:16:42.7353220Z         Parameters:
2025-01-14T13:16:42.7353270Z         -----------
2025-01-14T13:16:42.7353380Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7353490Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7353530Z     
2025-01-14T13:16:42.7353580Z         Returns:
2025-01-14T13:16:42.7353630Z         --------
2025-01-14T13:16:42.7353690Z         A TARDIS simulation object.
2025-01-14T13:16:42.7353730Z         """
2025-01-14T13:16:42.7353840Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7353970Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7354080Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7354230Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7354340Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7354420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7354470Z >       sim = run_tardis(
2025-01-14T13:16:42.7354530Z             config_verysimple,
2025-01-14T13:16:42.7354580Z             atom_data=atomic_data,
2025-01-14T13:16:42.7354630Z         )
2025-01-14T13:16:42.7354640Z 
2025-01-14T13:16:42.7354750Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7354840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7354910Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7354980Z     simulation.run_convergence()
2025-01-14T13:16:42.7355070Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7355180Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7355260Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7355390Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7355600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7355610Z 
2025-01-14T13:16:42.7355820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7356000Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7356180Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7357070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7358170Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7358500Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7358520Z 
2025-01-14T13:16:42.7358710Z     def initialize_transport_state(
2025-01-14T13:16:42.7358870Z         self,
2025-01-14T13:16:42.7359570Z         simulation_state,
2025-01-14T13:16:42.7359680Z         opacity_state,
2025-01-14T13:16:42.7359740Z         macro_atom_state,
2025-01-14T13:16:42.7359790Z         plasma,
2025-01-14T13:16:42.7359840Z         no_of_packets,
2025-01-14T13:16:42.7359900Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7359950Z         iteration=0,
2025-01-14T13:16:42.7359990Z     ):
2025-01-14T13:16:42.7360090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7360170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7360230Z         else:
2025-01-14T13:16:42.7360290Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7360330Z     
2025-01-14T13:16:42.7360440Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7360510Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7360570Z         )
2025-01-14T13:16:42.7360610Z     
2025-01-14T13:16:42.7360870Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7360960Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7361090Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7361140Z         else:
2025-01-14T13:16:42.7361190Z             continuum_state = None
2025-01-14T13:16:42.7361270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7361490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7361560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7361640Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7361710Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7361780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7361850Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7361890Z         ).to_numba(
2025-01-14T13:16:42.7362100Z             macro_atom_state,
2025-01-14T13:16:42.7362180Z             self.line_interaction_type,
2025-01-14T13:16:42.7362230Z         )
2025-01-14T13:16:42.7362310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7362560Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7362610Z         ]
2025-01-14T13:16:42.7362850Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7362860Z 
2025-01-14T13:16:42.7362980Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7363160Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl6] __
2025-01-14T13:16:42.7363160Z 
2025-01-14T13:16:42.7363710Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7364000Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7364120Z 
2025-01-14T13:16:42.7364190Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7364300Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7364350Z         """
2025-01-14T13:16:42.7364430Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7364470Z     
2025-01-14T13:16:42.7364530Z         Parameters:
2025-01-14T13:16:42.7364590Z         -----------
2025-01-14T13:16:42.7364700Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7364810Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7364860Z     
2025-01-14T13:16:42.7364910Z         Returns:
2025-01-14T13:16:42.7364960Z         --------
2025-01-14T13:16:42.7365020Z         A TARDIS simulation object.
2025-01-14T13:16:42.7365060Z         """
2025-01-14T13:16:42.7365150Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7365260Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7365360Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7365500Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7365600Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7365670Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7365730Z >       sim = run_tardis(
2025-01-14T13:16:42.7365780Z             config_verysimple,
2025-01-14T13:16:42.7365840Z             atom_data=atomic_data,
2025-01-14T13:16:42.7365880Z         )
2025-01-14T13:16:42.7365880Z 
2025-01-14T13:16:42.7365990Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7366090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7366250Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7366310Z     simulation.run_convergence()
2025-01-14T13:16:42.7366410Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7366510Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7366580Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7366700Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7366790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7366790Z 
2025-01-14T13:16:42.7367000Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7367160Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7367340Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7367550Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7367680Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7367790Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7367800Z 
2025-01-14T13:16:42.7367860Z     def initialize_transport_state(
2025-01-14T13:16:42.7367900Z         self,
2025-01-14T13:16:42.7367950Z         simulation_state,
2025-01-14T13:16:42.7368000Z         opacity_state,
2025-01-14T13:16:42.7368050Z         macro_atom_state,
2025-01-14T13:16:42.7368100Z         plasma,
2025-01-14T13:16:42.7368150Z         no_of_packets,
2025-01-14T13:16:42.7368200Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7368250Z         iteration=0,
2025-01-14T13:16:42.7368290Z     ):
2025-01-14T13:16:42.7368390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7368470Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7368510Z         else:
2025-01-14T13:16:42.7368560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7368610Z     
2025-01-14T13:16:42.7368710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7368850Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7368890Z         )
2025-01-14T13:16:42.7368940Z     
2025-01-14T13:16:42.7369040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7369130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7369250Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7369290Z         else:
2025-01-14T13:16:42.7369350Z             continuum_state = None
2025-01-14T13:16:42.7369430Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7369510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7369580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7369650Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7369730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7369790Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7369860Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7369900Z         ).to_numba(
2025-01-14T13:16:42.7369960Z             macro_atom_state,
2025-01-14T13:16:42.7370020Z             self.line_interaction_type,
2025-01-14T13:16:42.7370060Z         )
2025-01-14T13:16:42.7370140Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7370350Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7370400Z         ]
2025-01-14T13:16:42.7370650Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7370650Z 
2025-01-14T13:16:42.7370770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7370930Z _ ERROR at setup of TestLIVPlotter.test_mpl_image[plotter_generate_plot_mpl7] __
2025-01-14T13:16:42.7370970Z 
2025-01-14T13:16:42.7371500Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7371790Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7371790Z 
2025-01-14T13:16:42.7371850Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7371970Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7372020Z         """
2025-01-14T13:16:42.7372100Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7372150Z     
2025-01-14T13:16:42.7372200Z         Parameters:
2025-01-14T13:16:42.7372240Z         -----------
2025-01-14T13:16:42.7372350Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7372460Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7372520Z     
2025-01-14T13:16:42.7372560Z         Returns:
2025-01-14T13:16:42.7372610Z         --------
2025-01-14T13:16:42.7372670Z         A TARDIS simulation object.
2025-01-14T13:16:42.7372920Z         """
2025-01-14T13:16:42.7373630Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7373900Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7374190Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7375110Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7375460Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7375680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7375860Z >       sim = run_tardis(
2025-01-14T13:16:42.7376020Z             config_verysimple,
2025-01-14T13:16:42.7376240Z             atom_data=atomic_data,
2025-01-14T13:16:42.7376390Z         )
2025-01-14T13:16:42.7376400Z 
2025-01-14T13:16:42.7376730Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7378720Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7378930Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7379260Z     simulation.run_convergence()
2025-01-14T13:16:42.7379410Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7379520Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7379590Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7379720Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7379800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7379810Z 
2025-01-14T13:16:42.7380020Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7380200Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7380380Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7380630Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7380760Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7380880Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7380890Z 
2025-01-14T13:16:42.7380950Z     def initialize_transport_state(
2025-01-14T13:16:42.7381010Z         self,
2025-01-14T13:16:42.7381060Z         simulation_state,
2025-01-14T13:16:42.7381110Z         opacity_state,
2025-01-14T13:16:42.7381160Z         macro_atom_state,
2025-01-14T13:16:42.7381210Z         plasma,
2025-01-14T13:16:42.7381260Z         no_of_packets,
2025-01-14T13:16:42.7381320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7381360Z         iteration=0,
2025-01-14T13:16:42.7381850Z     ):
2025-01-14T13:16:42.7381960Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7382030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7382080Z         else:
2025-01-14T13:16:42.7382130Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7382180Z     
2025-01-14T13:16:42.7382280Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7382350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7382400Z         )
2025-01-14T13:16:42.7382440Z     
2025-01-14T13:16:42.7382540Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7382630Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7382750Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7382800Z         else:
2025-01-14T13:16:42.7382850Z             continuum_state = None
2025-01-14T13:16:42.7382930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7383010Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7383090Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7383170Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7383240Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7383310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7383370Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7383420Z         ).to_numba(
2025-01-14T13:16:42.7383470Z             macro_atom_state,
2025-01-14T13:16:42.7383530Z             self.line_interaction_type,
2025-01-14T13:16:42.7383570Z         )
2025-01-14T13:16:42.7383640Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7383860Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7383910Z         ]
2025-01-14T13:16:42.7384150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7384160Z 
2025-01-14T13:16:42.7384360Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7384550Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply0] _
2025-01-14T13:16:42.7384560Z 
2025-01-14T13:16:42.7385090Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7385370Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7385370Z 
2025-01-14T13:16:42.7385440Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7385550Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7385600Z         """
2025-01-14T13:16:42.7385690Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7385740Z     
2025-01-14T13:16:42.7385790Z         Parameters:
2025-01-14T13:16:42.7385860Z         -----------
2025-01-14T13:16:42.7385960Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7386090Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7386130Z     
2025-01-14T13:16:42.7386180Z         Returns:
2025-01-14T13:16:42.7386220Z         --------
2025-01-14T13:16:42.7386290Z         A TARDIS simulation object.
2025-01-14T13:16:42.7386330Z         """
2025-01-14T13:16:42.7386420Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7386510Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7386610Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7386750Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7386950Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7387020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7387080Z >       sim = run_tardis(
2025-01-14T13:16:42.7387130Z             config_verysimple,
2025-01-14T13:16:42.7387190Z             atom_data=atomic_data,
2025-01-14T13:16:42.7387250Z         )
2025-01-14T13:16:42.7387260Z 
2025-01-14T13:16:42.7387370Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7387460Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7387520Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7387590Z     simulation.run_convergence()
2025-01-14T13:16:42.7387670Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7387780Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7387850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7387980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7388070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7388080Z 
2025-01-14T13:16:42.7388290Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7388450Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7388630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7394150Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7394330Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7394450Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7394450Z 
2025-01-14T13:16:42.7394510Z     def initialize_transport_state(
2025-01-14T13:16:42.7394560Z         self,
2025-01-14T13:16:42.7394610Z         simulation_state,
2025-01-14T13:16:42.7394670Z         opacity_state,
2025-01-14T13:16:42.7394720Z         macro_atom_state,
2025-01-14T13:16:42.7394770Z         plasma,
2025-01-14T13:16:42.7395000Z         no_of_packets,
2025-01-14T13:16:42.7395050Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7395100Z         iteration=0,
2025-01-14T13:16:42.7395140Z     ):
2025-01-14T13:16:42.7395240Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7395310Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7395360Z         else:
2025-01-14T13:16:42.7395410Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7395450Z     
2025-01-14T13:16:42.7395560Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7395630Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7395670Z         )
2025-01-14T13:16:42.7395710Z     
2025-01-14T13:16:42.7395820Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7395900Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7396030Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7396080Z         else:
2025-01-14T13:16:42.7396140Z             continuum_state = None
2025-01-14T13:16:42.7396210Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7396300Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7396370Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7396450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7396520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7396600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7396660Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7396700Z         ).to_numba(
2025-01-14T13:16:42.7396760Z             macro_atom_state,
2025-01-14T13:16:42.7396830Z             self.line_interaction_type,
2025-01-14T13:16:42.7396880Z         )
2025-01-14T13:16:42.7397060Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7397290Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7397330Z         ]
2025-01-14T13:16:42.7397590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7397600Z 
2025-01-14T13:16:42.7397710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7397900Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply1] _
2025-01-14T13:16:42.7397900Z 
2025-01-14T13:16:42.7398620Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7398930Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7398950Z 
2025-01-14T13:16:42.7399030Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7399140Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7399190Z         """
2025-01-14T13:16:42.7399280Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7399330Z     
2025-01-14T13:16:42.7399380Z         Parameters:
2025-01-14T13:16:42.7399430Z         -----------
2025-01-14T13:16:42.7399530Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7399640Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7399680Z     
2025-01-14T13:16:42.7399730Z         Returns:
2025-01-14T13:16:42.7399790Z         --------
2025-01-14T13:16:42.7399840Z         A TARDIS simulation object.
2025-01-14T13:16:42.7399890Z         """
2025-01-14T13:16:42.7399970Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7400080Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7400180Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7400440Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7400560Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7400640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7400690Z >       sim = run_tardis(
2025-01-14T13:16:42.7400750Z             config_verysimple,
2025-01-14T13:16:42.7400800Z             atom_data=atomic_data,
2025-01-14T13:16:42.7400840Z         )
2025-01-14T13:16:42.7400850Z 
2025-01-14T13:16:42.7400970Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7401080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7401160Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7401220Z     simulation.run_convergence()
2025-01-14T13:16:42.7401310Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7401420Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7401630Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7401910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7402020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7402020Z 
2025-01-14T13:16:42.7402240Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7402420Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7402590Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7402810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7402930Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7403140Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7403140Z 
2025-01-14T13:16:42.7403210Z     def initialize_transport_state(
2025-01-14T13:16:42.7403250Z         self,
2025-01-14T13:16:42.7403310Z         simulation_state,
2025-01-14T13:16:42.7403360Z         opacity_state,
2025-01-14T13:16:42.7403430Z         macro_atom_state,
2025-01-14T13:16:42.7403470Z         plasma,
2025-01-14T13:16:42.7403520Z         no_of_packets,
2025-01-14T13:16:42.7403580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7403620Z         iteration=0,
2025-01-14T13:16:42.7403670Z     ):
2025-01-14T13:16:42.7403760Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7403830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7403880Z         else:
2025-01-14T13:16:42.7403940Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7403980Z     
2025-01-14T13:16:42.7404080Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7404160Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7404210Z         )
2025-01-14T13:16:42.7404250Z     
2025-01-14T13:16:42.7404360Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7404440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7404570Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7404620Z         else:
2025-01-14T13:16:42.7404680Z             continuum_state = None
2025-01-14T13:16:42.7404760Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7404850Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7404920Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7405000Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7405080Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7405150Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7405230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7405290Z         ).to_numba(
2025-01-14T13:16:42.7405680Z             macro_atom_state,
2025-01-14T13:16:42.7405750Z             self.line_interaction_type,
2025-01-14T13:16:42.7405800Z         )
2025-01-14T13:16:42.7405890Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7406130Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7406180Z         ]
2025-01-14T13:16:42.7406420Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7406430Z 
2025-01-14T13:16:42.7406540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7406720Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply2] _
2025-01-14T13:16:42.7406720Z 
2025-01-14T13:16:42.7407270Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7407560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7407570Z 
2025-01-14T13:16:42.7407630Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7407740Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7407790Z         """
2025-01-14T13:16:42.7407880Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7407920Z     
2025-01-14T13:16:42.7407970Z         Parameters:
2025-01-14T13:16:42.7408020Z         -----------
2025-01-14T13:16:42.7408130Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7408240Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7408610Z     
2025-01-14T13:16:42.7408670Z         Returns:
2025-01-14T13:16:42.7408720Z         --------
2025-01-14T13:16:42.7408800Z         A TARDIS simulation object.
2025-01-14T13:16:42.7408850Z         """
2025-01-14T13:16:42.7408950Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7409060Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7409160Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7409320Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7409440Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7409540Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7409600Z >       sim = run_tardis(
2025-01-14T13:16:42.7409660Z             config_verysimple,
2025-01-14T13:16:42.7409720Z             atom_data=atomic_data,
2025-01-14T13:16:42.7409760Z         )
2025-01-14T13:16:42.7409760Z 
2025-01-14T13:16:42.7409890Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7409980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7410050Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7410110Z     simulation.run_convergence()
2025-01-14T13:16:42.7410200Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7410310Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7410380Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7410500Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7410590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7410590Z 
2025-01-14T13:16:42.7411090Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7411250Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7411450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7411670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7411920Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7412040Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7412050Z 
2025-01-14T13:16:42.7412110Z     def initialize_transport_state(
2025-01-14T13:16:42.7412160Z         self,
2025-01-14T13:16:42.7412240Z         simulation_state,
2025-01-14T13:16:42.7412300Z         opacity_state,
2025-01-14T13:16:42.7412350Z         macro_atom_state,
2025-01-14T13:16:42.7412410Z         plasma,
2025-01-14T13:16:42.7412450Z         no_of_packets,
2025-01-14T13:16:42.7412510Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7412560Z         iteration=0,
2025-01-14T13:16:42.7412600Z     ):
2025-01-14T13:16:42.7412700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7412790Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7412840Z         else:
2025-01-14T13:16:42.7412900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7412940Z     
2025-01-14T13:16:42.7413050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7413120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7413170Z         )
2025-01-14T13:16:42.7413210Z     
2025-01-14T13:16:42.7413330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7413420Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7413540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7413590Z         else:
2025-01-14T13:16:42.7413640Z             continuum_state = None
2025-01-14T13:16:42.7413720Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7413800Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7413960Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7414050Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7414130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7414190Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7414270Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7414310Z         ).to_numba(
2025-01-14T13:16:42.7414380Z             macro_atom_state,
2025-01-14T13:16:42.7414450Z             self.line_interaction_type,
2025-01-14T13:16:42.7414490Z         )
2025-01-14T13:16:42.7414570Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7414820Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7414880Z         ]
2025-01-14T13:16:42.7415130Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7415130Z 
2025-01-14T13:16:42.7415250Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7415420Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply3] _
2025-01-14T13:16:42.7415430Z 
2025-01-14T13:16:42.7415970Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7416280Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7416290Z 
2025-01-14T13:16:42.7416360Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7416480Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7416520Z         """
2025-01-14T13:16:42.7416610Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7416660Z     
2025-01-14T13:16:42.7416730Z         Parameters:
2025-01-14T13:16:42.7416790Z         -----------
2025-01-14T13:16:42.7416980Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7417090Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7417140Z     
2025-01-14T13:16:42.7417180Z         Returns:
2025-01-14T13:16:42.7417230Z         --------
2025-01-14T13:16:42.7417280Z         A TARDIS simulation object.
2025-01-14T13:16:42.7417330Z         """
2025-01-14T13:16:42.7417410Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7417510Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7417610Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7417750Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7417860Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7417930Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7417990Z >       sim = run_tardis(
2025-01-14T13:16:42.7418040Z             config_verysimple,
2025-01-14T13:16:42.7418100Z             atom_data=atomic_data,
2025-01-14T13:16:42.7418140Z         )
2025-01-14T13:16:42.7418140Z 
2025-01-14T13:16:42.7418250Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7418340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7418400Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7418460Z     simulation.run_convergence()
2025-01-14T13:16:42.7418550Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7418660Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7418720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7418860Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7418940Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7419010Z 
2025-01-14T13:16:42.7419230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7419400Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7419580Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7420640Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7421170Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7421520Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7421530Z 
2025-01-14T13:16:42.7421720Z     def initialize_transport_state(
2025-01-14T13:16:42.7421940Z         self,
2025-01-14T13:16:42.7422100Z         simulation_state,
2025-01-14T13:16:42.7422400Z         opacity_state,
2025-01-14T13:16:42.7422510Z         macro_atom_state,
2025-01-14T13:16:42.7422580Z         plasma,
2025-01-14T13:16:42.7422630Z         no_of_packets,
2025-01-14T13:16:42.7422690Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7422740Z         iteration=0,
2025-01-14T13:16:42.7422950Z     ):
2025-01-14T13:16:42.7423050Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7423120Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7423180Z         else:
2025-01-14T13:16:42.7423230Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7423280Z     
2025-01-14T13:16:42.7423390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7423460Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7423510Z         )
2025-01-14T13:16:42.7423550Z     
2025-01-14T13:16:42.7423650Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7423740Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7423870Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7423920Z         else:
2025-01-14T13:16:42.7423980Z             continuum_state = None
2025-01-14T13:16:42.7424270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7424360Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7424430Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7424520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7424600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7424670Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7424730Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7424780Z         ).to_numba(
2025-01-14T13:16:42.7424830Z             macro_atom_state,
2025-01-14T13:16:42.7424890Z             self.line_interaction_type,
2025-01-14T13:16:42.7424930Z         )
2025-01-14T13:16:42.7425020Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7425240Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7425290Z         ]
2025-01-14T13:16:42.7425540Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7425550Z 
2025-01-14T13:16:42.7425680Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7425890Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply4] _
2025-01-14T13:16:42.7425890Z 
2025-01-14T13:16:42.7426480Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7426810Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7426910Z 
2025-01-14T13:16:42.7426980Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7427100Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7427150Z         """
2025-01-14T13:16:42.7427240Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7427290Z     
2025-01-14T13:16:42.7427340Z         Parameters:
2025-01-14T13:16:42.7427400Z         -----------
2025-01-14T13:16:42.7427500Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7427620Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7427660Z     
2025-01-14T13:16:42.7427710Z         Returns:
2025-01-14T13:16:42.7427760Z         --------
2025-01-14T13:16:42.7427810Z         A TARDIS simulation object.
2025-01-14T13:16:42.7427860Z         """
2025-01-14T13:16:42.7427960Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7428050Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7428170Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7428310Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7428420Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7428490Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7428550Z >       sim = run_tardis(
2025-01-14T13:16:42.7428600Z             config_verysimple,
2025-01-14T13:16:42.7428660Z             atom_data=atomic_data,
2025-01-14T13:16:42.7428700Z         )
2025-01-14T13:16:42.7428710Z 
2025-01-14T13:16:42.7428810Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7428910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7428980Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7429050Z     simulation.run_convergence()
2025-01-14T13:16:42.7429130Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7429240Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7429310Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7429730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7429820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7429820Z 
2025-01-14T13:16:42.7430030Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7430190Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7430360Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7430580Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7430700Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7430810Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7430820Z 
2025-01-14T13:16:42.7430880Z     def initialize_transport_state(
2025-01-14T13:16:42.7430920Z         self,
2025-01-14T13:16:42.7430980Z         simulation_state,
2025-01-14T13:16:42.7431030Z         opacity_state,
2025-01-14T13:16:42.7431080Z         macro_atom_state,
2025-01-14T13:16:42.7431120Z         plasma,
2025-01-14T13:16:42.7431170Z         no_of_packets,
2025-01-14T13:16:42.7431230Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7431270Z         iteration=0,
2025-01-14T13:16:42.7431320Z     ):
2025-01-14T13:16:42.7431410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7431480Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7431530Z         else:
2025-01-14T13:16:42.7431580Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7431620Z     
2025-01-14T13:16:42.7431720Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7431800Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7432050Z         )
2025-01-14T13:16:42.7432110Z     
2025-01-14T13:16:42.7432210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7432300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7432430Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7432470Z         else:
2025-01-14T13:16:42.7432530Z             continuum_state = None
2025-01-14T13:16:42.7432610Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7432690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7432760Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7432850Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7432920Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7432990Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7433050Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7433100Z         ).to_numba(
2025-01-14T13:16:42.7433160Z             macro_atom_state,
2025-01-14T13:16:42.7433240Z             self.line_interaction_type,
2025-01-14T13:16:42.7433290Z         )
2025-01-14T13:16:42.7433380Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7433610Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7433660Z         ]
2025-01-14T13:16:42.7433930Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7433940Z 
2025-01-14T13:16:42.7434060Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7434260Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply5] _
2025-01-14T13:16:42.7434260Z 
2025-01-14T13:16:42.7434810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7435200Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7435200Z 
2025-01-14T13:16:42.7435270Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7435380Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7435430Z         """
2025-01-14T13:16:42.7435640Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7435700Z     
2025-01-14T13:16:42.7435740Z         Parameters:
2025-01-14T13:16:42.7435800Z         -----------
2025-01-14T13:16:42.7435900Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7436020Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7436060Z     
2025-01-14T13:16:42.7436110Z         Returns:
2025-01-14T13:16:42.7436160Z         --------
2025-01-14T13:16:42.7436210Z         A TARDIS simulation object.
2025-01-14T13:16:42.7436260Z         """
2025-01-14T13:16:42.7436350Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7436450Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7436550Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7436690Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7436790Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7436870Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7436910Z >       sim = run_tardis(
2025-01-14T13:16:42.7436970Z             config_verysimple,
2025-01-14T13:16:42.7437030Z             atom_data=atomic_data,
2025-01-14T13:16:42.7437070Z         )
2025-01-14T13:16:42.7437070Z 
2025-01-14T13:16:42.7437180Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7437270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7437450Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7437510Z     simulation.run_convergence()
2025-01-14T13:16:42.7437600Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7437710Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7437800Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7437920Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7438010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7438010Z 
2025-01-14T13:16:42.7438220Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7438380Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7438560Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7438780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7438910Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7439010Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7439020Z 
2025-01-14T13:16:42.7439080Z     def initialize_transport_state(
2025-01-14T13:16:42.7439240Z         self,
2025-01-14T13:16:42.7439300Z         simulation_state,
2025-01-14T13:16:42.7439350Z         opacity_state,
2025-01-14T13:16:42.7439410Z         macro_atom_state,
2025-01-14T13:16:42.7439450Z         plasma,
2025-01-14T13:16:42.7439520Z         no_of_packets,
2025-01-14T13:16:42.7439580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7439630Z         iteration=0,
2025-01-14T13:16:42.7439670Z     ):
2025-01-14T13:16:42.7439770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7439840Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7439890Z         else:
2025-01-14T13:16:42.7439960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7440000Z     
2025-01-14T13:16:42.7440210Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7440290Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7440330Z         )
2025-01-14T13:16:42.7440370Z     
2025-01-14T13:16:42.7440470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7440560Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7440690Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7440730Z         else:
2025-01-14T13:16:42.7440800Z             continuum_state = None
2025-01-14T13:16:42.7440880Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7440970Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7441040Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7441120Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7441190Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7441260Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7441340Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7441390Z         ).to_numba(
2025-01-14T13:16:42.7441440Z             macro_atom_state,
2025-01-14T13:16:42.7441500Z             self.line_interaction_type,
2025-01-14T13:16:42.7441810Z         )
2025-01-14T13:16:42.7441910Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7442130Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7442180Z         ]
2025-01-14T13:16:42.7442430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7442430Z 
2025-01-14T13:16:42.7442540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7442850Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply6] _
2025-01-14T13:16:42.7442860Z 
2025-01-14T13:16:42.7443400Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7443670Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7443680Z 
2025-01-14T13:16:42.7443740Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7443850Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7443900Z         """
2025-01-14T13:16:42.7443990Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7444030Z     
2025-01-14T13:16:42.7444080Z         Parameters:
2025-01-14T13:16:42.7444130Z         -----------
2025-01-14T13:16:42.7444250Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7444380Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7444430Z     
2025-01-14T13:16:42.7444480Z         Returns:
2025-01-14T13:16:42.7444530Z         --------
2025-01-14T13:16:42.7444590Z         A TARDIS simulation object.
2025-01-14T13:16:42.7444630Z         """
2025-01-14T13:16:42.7444720Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7444830Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7444940Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7445080Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7445190Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7445260Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7445320Z >       sim = run_tardis(
2025-01-14T13:16:42.7445380Z             config_verysimple,
2025-01-14T13:16:42.7445440Z             atom_data=atomic_data,
2025-01-14T13:16:42.7445480Z         )
2025-01-14T13:16:42.7445580Z 
2025-01-14T13:16:42.7445690Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7445780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7445840Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7445900Z     simulation.run_convergence()
2025-01-14T13:16:42.7445990Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7446090Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7446170Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7446300Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7446380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7446390Z 
2025-01-14T13:16:42.7446600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7446910Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7447100Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7447320Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7447440Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7447550Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7447550Z 
2025-01-14T13:16:42.7447620Z     def initialize_transport_state(
2025-01-14T13:16:42.7447670Z         self,
2025-01-14T13:16:42.7453050Z         simulation_state,
2025-01-14T13:16:42.7453150Z         opacity_state,
2025-01-14T13:16:42.7453200Z         macro_atom_state,
2025-01-14T13:16:42.7453250Z         plasma,
2025-01-14T13:16:42.7453300Z         no_of_packets,
2025-01-14T13:16:42.7453560Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7453610Z         iteration=0,
2025-01-14T13:16:42.7453660Z     ):
2025-01-14T13:16:42.7453750Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7453830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7453870Z         else:
2025-01-14T13:16:42.7454060Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7454120Z     
2025-01-14T13:16:42.7454220Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7454290Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7454340Z         )
2025-01-14T13:16:42.7454380Z     
2025-01-14T13:16:42.7454480Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7454560Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7454680Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7454730Z         else:
2025-01-14T13:16:42.7454790Z             continuum_state = None
2025-01-14T13:16:42.7454870Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7454950Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7455030Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7455110Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7455190Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7455250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7455330Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7455390Z         ).to_numba(
2025-01-14T13:16:42.7455440Z             macro_atom_state,
2025-01-14T13:16:42.7455500Z             self.line_interaction_type,
2025-01-14T13:16:42.7455540Z         )
2025-01-14T13:16:42.7455620Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7455830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7455880Z         ]
2025-01-14T13:16:42.7456130Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7456440Z 
2025-01-14T13:16:42.7456570Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7456750Z _ ERROR at setup of TestLIVPlotter.test_generate_plot_ply[plotter_generate_plot_ply7] _
2025-01-14T13:16:42.7456750Z 
2025-01-14T13:16:42.7457280Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7457560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7457570Z 
2025-01-14T13:16:42.7457630Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7457740Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7457780Z         """
2025-01-14T13:16:42.7457870Z         Fixture to create a simple TARDIS simulation.
2025-01-14T13:16:42.7457920Z     
2025-01-14T13:16:42.7457970Z         Parameters:
2025-01-14T13:16:42.7458020Z         -----------
2025-01-14T13:16:42.7459090Z         config_verysimple: A basic TARDIS configuration object.
2025-01-14T13:16:42.7459540Z         atomic_dataset: An atomic dataset to use in the simulation.
2025-01-14T13:16:42.7459690Z     
2025-01-14T13:16:42.7459830Z         Returns:
2025-01-14T13:16:42.7459990Z         --------
2025-01-14T13:16:42.7460180Z         A TARDIS simulation object.
2025-01-14T13:16:42.7460320Z         """
2025-01-14T13:16:42.7460570Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7461010Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7461200Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7461350Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7461810Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7461890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7461950Z >       sim = run_tardis(
2025-01-14T13:16:42.7462010Z             config_verysimple,
2025-01-14T13:16:42.7462070Z             atom_data=atomic_data,
2025-01-14T13:16:42.7462240Z         )
2025-01-14T13:16:42.7462240Z 
2025-01-14T13:16:42.7462370Z tardis/visualization/tools/tests/test_liv_plot.py:57: 
2025-01-14T13:16:42.7462470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7462530Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7462600Z     simulation.run_convergence()
2025-01-14T13:16:42.7462700Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7462820Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7462890Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7463020Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7463120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7463120Z 
2025-01-14T13:16:42.7463360Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17306c530>
2025-01-14T13:16:42.7463520Z simulation_state = <tardis.model.base.SimulationState object at 0x30ec10ef0>
2025-01-14T13:16:42.7463710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3128af680>
2025-01-14T13:16:42.7463930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321d09130>
2025-01-14T13:16:42.7464060Z plasma = <tardis.plasma.base.BasePlasma object at 0x3050d0770>
2025-01-14T13:16:42.7464180Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7464180Z 
2025-01-14T13:16:42.7464250Z     def initialize_transport_state(
2025-01-14T13:16:42.7464300Z         self,
2025-01-14T13:16:42.7464350Z         simulation_state,
2025-01-14T13:16:42.7464410Z         opacity_state,
2025-01-14T13:16:42.7464770Z         macro_atom_state,
2025-01-14T13:16:42.7464830Z         plasma,
2025-01-14T13:16:42.7464890Z         no_of_packets,
2025-01-14T13:16:42.7464950Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7465000Z         iteration=0,
2025-01-14T13:16:42.7465050Z     ):
2025-01-14T13:16:42.7465160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7465230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7465280Z         else:
2025-01-14T13:16:42.7465340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7465380Z     
2025-01-14T13:16:42.7465500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7465590Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7465640Z         )
2025-01-14T13:16:42.7465690Z     
2025-01-14T13:16:42.7465800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7465900Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7466040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7466090Z         else:
2025-01-14T13:16:42.7466150Z             continuum_state = None
2025-01-14T13:16:42.7466230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7466320Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7466390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7466470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7466550Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7466650Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7466730Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7467050Z         ).to_numba(
2025-01-14T13:16:42.7467120Z             macro_atom_state,
2025-01-14T13:16:42.7467200Z             self.line_interaction_type,
2025-01-14T13:16:42.7467400Z         )
2025-01-14T13:16:42.7467500Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7467730Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7467780Z         ]
2025-01-14T13:16:42.7468030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7468040Z 
2025-01-14T13:16:42.7468160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7468330Z __ ERROR at setup of TestRPacketPlotter.test_get_coordinates_with_theta_init ___
2025-01-14T13:16:42.7468330Z 
2025-01-14T13:16:42.7469270Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7469580Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7469590Z 
2025-01-14T13:16:42.7469660Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7469720Z         "expected,obtained",
2025-01-14T13:16:42.7469770Z         [
2025-01-14T13:16:42.7469820Z             (
2025-01-14T13:16:42.7469900Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7469990Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7470040Z             ),
2025-01-14T13:16:42.7470170Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7470280Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7470320Z         ],
2025-01-14T13:16:42.7470380Z     )
2025-01-14T13:16:42.7470530Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7470630Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7470630Z 
2025-01-14T13:16:42.7470770Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7470860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7471090Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7471300Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7471520Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7471610Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7471720Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7471770Z     sim = run_tardis(
2025-01-14T13:16:42.7471830Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7471890Z     simulation.run_convergence()
2025-01-14T13:16:42.7472000Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7472100Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7472180Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7472300Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7472400Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7472410Z 
2025-01-14T13:16:42.7472610Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7472770Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7472960Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7473180Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7473300Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7473410Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7473410Z 
2025-01-14T13:16:42.7473480Z     def initialize_transport_state(
2025-01-14T13:16:42.7473530Z         self,
2025-01-14T13:16:42.7473590Z         simulation_state,
2025-01-14T13:16:42.7473730Z         opacity_state,
2025-01-14T13:16:42.7474120Z         macro_atom_state,
2025-01-14T13:16:42.7474170Z         plasma,
2025-01-14T13:16:42.7474240Z         no_of_packets,
2025-01-14T13:16:42.7474310Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7474360Z         iteration=0,
2025-01-14T13:16:42.7474410Z     ):
2025-01-14T13:16:42.7474510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7474590Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7474630Z         else:
2025-01-14T13:16:42.7474690Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7474730Z     
2025-01-14T13:16:42.7474850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7474920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7474970Z         )
2025-01-14T13:16:42.7475010Z     
2025-01-14T13:16:42.7475110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7475200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7475330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7475380Z         else:
2025-01-14T13:16:42.7475450Z             continuum_state = None
2025-01-14T13:16:42.7475520Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7475610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7475680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7475760Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7475840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7475900Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7475980Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7476020Z         ).to_numba(
2025-01-14T13:16:42.7476080Z             macro_atom_state,
2025-01-14T13:16:42.7476140Z             self.line_interaction_type,
2025-01-14T13:16:42.7476180Z         )
2025-01-14T13:16:42.7476260Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7476480Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7476990Z         ]
2025-01-14T13:16:42.7477250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7477250Z 
2025-01-14T13:16:42.7477370Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7477540Z _ ERROR at setup of TestRPacketPlotter.test_get_coordinates_multiple_packets[2] _
2025-01-14T13:16:42.7477540Z 
2025-01-14T13:16:42.7477820Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7478100Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7478100Z 
2025-01-14T13:16:42.7478170Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7478230Z         "expected,obtained",
2025-01-14T13:16:42.7478280Z         [
2025-01-14T13:16:42.7478320Z             (
2025-01-14T13:16:42.7478410Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7478500Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7478550Z             ),
2025-01-14T13:16:42.7479220Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7479360Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7479430Z         ],
2025-01-14T13:16:42.7479470Z     )
2025-01-14T13:16:42.7479610Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7479710Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7479710Z 
2025-01-14T13:16:42.7479860Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7481210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7481580Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7481680Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7482040Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7482130Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7482240Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7482290Z     sim = run_tardis(
2025-01-14T13:16:42.7482350Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7482410Z     simulation.run_convergence()
2025-01-14T13:16:42.7482500Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7482610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7482680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7482810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7482900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7482910Z 
2025-01-14T13:16:42.7483120Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7483290Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7483460Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7483690Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7483810Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7483920Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7483930Z 
2025-01-14T13:16:42.7483990Z     def initialize_transport_state(
2025-01-14T13:16:42.7484030Z         self,
2025-01-14T13:16:42.7484090Z         simulation_state,
2025-01-14T13:16:42.7484140Z         opacity_state,
2025-01-14T13:16:42.7484190Z         macro_atom_state,
2025-01-14T13:16:42.7484240Z         plasma,
2025-01-14T13:16:42.7484290Z         no_of_packets,
2025-01-14T13:16:42.7484600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7484650Z         iteration=0,
2025-01-14T13:16:42.7484690Z     ):
2025-01-14T13:16:42.7484790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7484860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7484910Z         else:
2025-01-14T13:16:42.7484960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7485000Z     
2025-01-14T13:16:42.7485100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7485180Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7485220Z         )
2025-01-14T13:16:42.7485270Z     
2025-01-14T13:16:42.7485370Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7485460Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7485590Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7485640Z         else:
2025-01-14T13:16:42.7485700Z             continuum_state = None
2025-01-14T13:16:42.7485780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7485880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7485950Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7486030Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7486100Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7486180Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7486240Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7486290Z         ).to_numba(
2025-01-14T13:16:42.7486340Z             macro_atom_state,
2025-01-14T13:16:42.7486410Z             self.line_interaction_type,
2025-01-14T13:16:42.7486450Z         )
2025-01-14T13:16:42.7486520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7487490Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7487830Z         ]
2025-01-14T13:16:42.7488550Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7488560Z 
2025-01-14T13:16:42.7488880Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7490180Z _ ERROR at setup of TestRPacketPlotter.test_get_coordinates_multiple_packets[5] _
2025-01-14T13:16:42.7490200Z 
2025-01-14T13:16:42.7490570Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7491330Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7491350Z 
2025-01-14T13:16:42.7491530Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7491720Z         "expected,obtained",
2025-01-14T13:16:42.7491880Z         [
2025-01-14T13:16:42.7492020Z             (
2025-01-14T13:16:42.7492270Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7492510Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7492660Z             ),
2025-01-14T13:16:42.7492990Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7493320Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7493430Z         ],
2025-01-14T13:16:42.7493490Z     )
2025-01-14T13:16:42.7493640Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7493740Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7493740Z 
2025-01-14T13:16:42.7493880Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7493980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7494220Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7494330Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7494880Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7494980Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7495090Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7495140Z     sim = run_tardis(
2025-01-14T13:16:42.7495200Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7495270Z     simulation.run_convergence()
2025-01-14T13:16:42.7495360Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7495480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7495560Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7495690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7495780Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7495790Z 
2025-01-14T13:16:42.7496010Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7496170Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7496350Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7496570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7496710Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7496830Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7496830Z 
2025-01-14T13:16:42.7496890Z     def initialize_transport_state(
2025-01-14T13:16:42.7496940Z         self,
2025-01-14T13:16:42.7496990Z         simulation_state,
2025-01-14T13:16:42.7497050Z         opacity_state,
2025-01-14T13:16:42.7497100Z         macro_atom_state,
2025-01-14T13:16:42.7497270Z         plasma,
2025-01-14T13:16:42.7497330Z         no_of_packets,
2025-01-14T13:16:42.7497390Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7497440Z         iteration=0,
2025-01-14T13:16:42.7497490Z     ):
2025-01-14T13:16:42.7497840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7497940Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7497990Z         else:
2025-01-14T13:16:42.7498050Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7498100Z     
2025-01-14T13:16:42.7498210Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7498280Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7498330Z         )
2025-01-14T13:16:42.7498370Z     
2025-01-14T13:16:42.7498490Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7498590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7498710Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7498760Z         else:
2025-01-14T13:16:42.7498820Z             continuum_state = None
2025-01-14T13:16:42.7498920Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7499020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7499100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7499180Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7499260Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7499330Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7499400Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7499450Z         ).to_numba(
2025-01-14T13:16:42.7499520Z             macro_atom_state,
2025-01-14T13:16:42.7499580Z             self.line_interaction_type,
2025-01-14T13:16:42.7499630Z         )
2025-01-14T13:16:42.7499710Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7499940Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7500130Z         ]
2025-01-14T13:16:42.7500400Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7500410Z 
2025-01-14T13:16:42.7500520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7500690Z _ ERROR at setup of TestRPacketPlotter.test_get_coordinates_multiple_packets[10] _
2025-01-14T13:16:42.7500700Z 
2025-01-14T13:16:42.7500840Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7501100Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7501110Z 
2025-01-14T13:16:42.7501170Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7501230Z         "expected,obtained",
2025-01-14T13:16:42.7501280Z         [
2025-01-14T13:16:42.7501330Z             (
2025-01-14T13:16:42.7501420Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7501500Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7501550Z             ),
2025-01-14T13:16:42.7501680Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7501770Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7501820Z         ],
2025-01-14T13:16:42.7501860Z     )
2025-01-14T13:16:42.7501990Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7502080Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7502090Z 
2025-01-14T13:16:42.7502220Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7502310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7502540Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7502730Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7502960Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7503060Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7503170Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7503220Z     sim = run_tardis(
2025-01-14T13:16:42.7503280Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7503340Z     simulation.run_convergence()
2025-01-14T13:16:42.7503430Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7503540Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7503620Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7503740Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7503830Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7503840Z 
2025-01-14T13:16:42.7504040Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7504210Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7504380Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7504610Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7504730Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7504840Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7504840Z 
2025-01-14T13:16:42.7504910Z     def initialize_transport_state(
2025-01-14T13:16:42.7504950Z         self,
2025-01-14T13:16:42.7505000Z         simulation_state,
2025-01-14T13:16:42.7505050Z         opacity_state,
2025-01-14T13:16:42.7505110Z         macro_atom_state,
2025-01-14T13:16:42.7505150Z         plasma,
2025-01-14T13:16:42.7505210Z         no_of_packets,
2025-01-14T13:16:42.7505260Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7505310Z         iteration=0,
2025-01-14T13:16:42.7505430Z     ):
2025-01-14T13:16:42.7505540Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7505610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7505660Z         else:
2025-01-14T13:16:42.7505710Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7505750Z     
2025-01-14T13:16:42.7505860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7505930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7505980Z         )
2025-01-14T13:16:42.7506020Z     
2025-01-14T13:16:42.7506120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7506210Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7506330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7506380Z         else:
2025-01-14T13:16:42.7506440Z             continuum_state = None
2025-01-14T13:16:42.7506510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7507530Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7507980Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7508230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7509720Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7510230Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7510340Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7510390Z         ).to_numba(
2025-01-14T13:16:42.7510440Z             macro_atom_state,
2025-01-14T13:16:42.7510500Z             self.line_interaction_type,
2025-01-14T13:16:42.7510560Z         )
2025-01-14T13:16:42.7510640Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7510870Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7511080Z         ]
2025-01-14T13:16:42.7511350Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7511360Z 
2025-01-14T13:16:42.7511480Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7511640Z ______ ERROR at setup of TestRPacketPlotter.test_get_equal_array_size[2] _______
2025-01-14T13:16:42.7511640Z 
2025-01-14T13:16:42.7511770Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7512040Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7512050Z 
2025-01-14T13:16:42.7512110Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7512170Z         "expected,obtained",
2025-01-14T13:16:42.7512220Z         [
2025-01-14T13:16:42.7512260Z             (
2025-01-14T13:16:42.7512350Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7512430Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7512490Z             ),
2025-01-14T13:16:42.7512620Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7512730Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7512770Z         ],
2025-01-14T13:16:42.7512810Z     )
2025-01-14T13:16:42.7512940Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7513030Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7513030Z 
2025-01-14T13:16:42.7513180Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7513270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7513500Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7513590Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7513820Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7514190Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7514300Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7514350Z     sim = run_tardis(
2025-01-14T13:16:42.7514410Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7514480Z     simulation.run_convergence()
2025-01-14T13:16:42.7514570Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7514690Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7514750Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7514890Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7514970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7514980Z 
2025-01-14T13:16:42.7515190Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7515350Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7515540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7515770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7515910Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7516020Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7516020Z 
2025-01-14T13:16:42.7516080Z     def initialize_transport_state(
2025-01-14T13:16:42.7516130Z         self,
2025-01-14T13:16:42.7516180Z         simulation_state,
2025-01-14T13:16:42.7516240Z         opacity_state,
2025-01-14T13:16:42.7516290Z         macro_atom_state,
2025-01-14T13:16:42.7516330Z         plasma,
2025-01-14T13:16:42.7516380Z         no_of_packets,
2025-01-14T13:16:42.7516710Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7516760Z         iteration=0,
2025-01-14T13:16:42.7516810Z     ):
2025-01-14T13:16:42.7516910Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7516980Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7517030Z         else:
2025-01-14T13:16:42.7517090Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7517130Z     
2025-01-14T13:16:42.7517230Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7517310Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7517350Z         )
2025-01-14T13:16:42.7517400Z     
2025-01-14T13:16:42.7517500Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7517590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7517710Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7517760Z         else:
2025-01-14T13:16:42.7517820Z             continuum_state = None
2025-01-14T13:16:42.7517900Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7517990Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7518060Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7518140Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7518220Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7518290Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7518350Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7518410Z         ).to_numba(
2025-01-14T13:16:42.7524120Z             macro_atom_state,
2025-01-14T13:16:42.7524240Z             self.line_interaction_type,
2025-01-14T13:16:42.7524290Z         )
2025-01-14T13:16:42.7524370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7524600Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7524660Z         ]
2025-01-14T13:16:42.7524910Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7525070Z 
2025-01-14T13:16:42.7525200Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7525350Z ______ ERROR at setup of TestRPacketPlotter.test_get_equal_array_size[5] _______
2025-01-14T13:16:42.7525360Z 
2025-01-14T13:16:42.7525490Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7525860Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7525870Z 
2025-01-14T13:16:42.7525950Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7526010Z         "expected,obtained",
2025-01-14T13:16:42.7526050Z         [
2025-01-14T13:16:42.7526100Z             (
2025-01-14T13:16:42.7526180Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7526270Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7526320Z             ),
2025-01-14T13:16:42.7526450Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7526540Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7526590Z         ],
2025-01-14T13:16:42.7526640Z     )
2025-01-14T13:16:42.7526760Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7526860Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7526860Z 
2025-01-14T13:16:42.7526990Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7527080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7527300Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7527390Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7527740Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7527820Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7527930Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7527980Z     sim = run_tardis(
2025-01-14T13:16:42.7528040Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7528100Z     simulation.run_convergence()
2025-01-14T13:16:42.7528190Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7528290Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7528370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7528490Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7528580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7528580Z 
2025-01-14T13:16:42.7528790Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7528950Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7529120Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7529340Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7529470Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7529580Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7529580Z 
2025-01-14T13:16:42.7529650Z     def initialize_transport_state(
2025-01-14T13:16:42.7529700Z         self,
2025-01-14T13:16:42.7529750Z         simulation_state,
2025-01-14T13:16:42.7529810Z         opacity_state,
2025-01-14T13:16:42.7529870Z         macro_atom_state,
2025-01-14T13:16:42.7529910Z         plasma,
2025-01-14T13:16:42.7529970Z         no_of_packets,
2025-01-14T13:16:42.7530020Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7530070Z         iteration=0,
2025-01-14T13:16:42.7530110Z     ):
2025-01-14T13:16:42.7530210Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7530350Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7530400Z         else:
2025-01-14T13:16:42.7530450Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7530490Z     
2025-01-14T13:16:42.7530600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7530680Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7530730Z         )
2025-01-14T13:16:42.7530770Z     
2025-01-14T13:16:42.7530870Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7530960Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7531080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7531120Z         else:
2025-01-14T13:16:42.7531190Z             continuum_state = None
2025-01-14T13:16:42.7531270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7531350Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7531420Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7531510Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7531580Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7531650Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7531720Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7531770Z         ).to_numba(
2025-01-14T13:16:42.7531830Z             macro_atom_state,
2025-01-14T13:16:42.7531890Z             self.line_interaction_type,
2025-01-14T13:16:42.7531930Z         )
2025-01-14T13:16:42.7532010Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7532240Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7532280Z         ]
2025-01-14T13:16:42.7532880Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7532890Z 
2025-01-14T13:16:42.7533010Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7533170Z ______ ERROR at setup of TestRPacketPlotter.test_get_equal_array_size[10] ______
2025-01-14T13:16:42.7533180Z 
2025-01-14T13:16:42.7533320Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7533580Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7533590Z 
2025-01-14T13:16:42.7533670Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7533720Z         "expected,obtained",
2025-01-14T13:16:42.7533770Z         [
2025-01-14T13:16:42.7533810Z             (
2025-01-14T13:16:42.7533890Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7533970Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7534030Z             ),
2025-01-14T13:16:42.7534160Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7534260Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7534320Z         ],
2025-01-14T13:16:42.7534360Z     )
2025-01-14T13:16:42.7534490Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7534590Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7534590Z 
2025-01-14T13:16:42.7534720Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7534810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7535040Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7535120Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7535350Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7535440Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7535640Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7535700Z     sim = run_tardis(
2025-01-14T13:16:42.7535760Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7535820Z     simulation.run_convergence()
2025-01-14T13:16:42.7535910Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7536020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7536090Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7536210Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7536300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7536300Z 
2025-01-14T13:16:42.7536520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7536680Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7536860Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7537090Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7537210Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7537320Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7537320Z 
2025-01-14T13:16:42.7537380Z     def initialize_transport_state(
2025-01-14T13:16:42.7537430Z         self,
2025-01-14T13:16:42.7537490Z         simulation_state,
2025-01-14T13:16:42.7537540Z         opacity_state,
2025-01-14T13:16:42.7537590Z         macro_atom_state,
2025-01-14T13:16:42.7537800Z         plasma,
2025-01-14T13:16:42.7537850Z         no_of_packets,
2025-01-14T13:16:42.7537910Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7537960Z         iteration=0,
2025-01-14T13:16:42.7538080Z     ):
2025-01-14T13:16:42.7538190Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7538260Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7538320Z         else:
2025-01-14T13:16:42.7538370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7538550Z     
2025-01-14T13:16:42.7538660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7538740Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7538780Z         )
2025-01-14T13:16:42.7538830Z     
2025-01-14T13:16:42.7538930Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7539020Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7539140Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7539190Z         else:
2025-01-14T13:16:42.7539250Z             continuum_state = None
2025-01-14T13:16:42.7539320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7539420Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7539480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7539570Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7539640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7539710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7539780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7539830Z         ).to_numba(
2025-01-14T13:16:42.7539880Z             macro_atom_state,
2025-01-14T13:16:42.7539940Z             self.line_interaction_type,
2025-01-14T13:16:42.7539980Z         )
2025-01-14T13:16:42.7540060Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7540280Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7540330Z         ]
2025-01-14T13:16:42.7540590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7540600Z 
2025-01-14T13:16:42.7540710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7541890Z ________ ERROR at setup of TestRPacketPlotter.test_get_frames[light-2] _________
2025-01-14T13:16:42.7541950Z 
2025-01-14T13:16:42.7542100Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7542380Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7542380Z 
2025-01-14T13:16:42.7542440Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7542510Z         "expected,obtained",
2025-01-14T13:16:42.7542560Z         [
2025-01-14T13:16:42.7542600Z             (
2025-01-14T13:16:42.7542690Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7542770Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7542820Z             ),
2025-01-14T13:16:42.7542950Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7543050Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7543100Z         ],
2025-01-14T13:16:42.7543150Z     )
2025-01-14T13:16:42.7543280Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7543370Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7543370Z 
2025-01-14T13:16:42.7543500Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7543600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7543830Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7543920Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7544140Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7544630Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7544740Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7544790Z     sim = run_tardis(
2025-01-14T13:16:42.7544860Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7544920Z     simulation.run_convergence()
2025-01-14T13:16:42.7545010Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7545130Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7545200Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7545330Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7545420Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7545430Z 
2025-01-14T13:16:42.7545740Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7546840Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7547050Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7547290Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7547430Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7547540Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7547540Z 
2025-01-14T13:16:42.7547610Z     def initialize_transport_state(
2025-01-14T13:16:42.7547650Z         self,
2025-01-14T13:16:42.7547710Z         simulation_state,
2025-01-14T13:16:42.7547760Z         opacity_state,
2025-01-14T13:16:42.7547810Z         macro_atom_state,
2025-01-14T13:16:42.7547870Z         plasma,
2025-01-14T13:16:42.7547930Z         no_of_packets,
2025-01-14T13:16:42.7547990Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7548030Z         iteration=0,
2025-01-14T13:16:42.7548080Z     ):
2025-01-14T13:16:42.7548170Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7548250Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7548430Z         else:
2025-01-14T13:16:42.7548500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7548540Z     
2025-01-14T13:16:42.7548660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7548730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7548770Z         )
2025-01-14T13:16:42.7548810Z     
2025-01-14T13:16:42.7548920Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7549000Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7549140Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7549190Z         else:
2025-01-14T13:16:42.7549240Z             continuum_state = None
2025-01-14T13:16:42.7549320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7549400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7549480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7549560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7549640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7549700Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7549780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7549820Z         ).to_numba(
2025-01-14T13:16:42.7549880Z             macro_atom_state,
2025-01-14T13:16:42.7549940Z             self.line_interaction_type,
2025-01-14T13:16:42.7549990Z         )
2025-01-14T13:16:42.7550060Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7550280Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7550330Z         ]
2025-01-14T13:16:42.7550570Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7550640Z 
2025-01-14T13:16:42.7550770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7551360Z ________ ERROR at setup of TestRPacketPlotter.test_get_frames[light-5] _________
2025-01-14T13:16:42.7551370Z 
2025-01-14T13:16:42.7551520Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7551780Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7551780Z 
2025-01-14T13:16:42.7551850Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7551900Z         "expected,obtained",
2025-01-14T13:16:42.7551950Z         [
2025-01-14T13:16:42.7552000Z             (
2025-01-14T13:16:42.7552080Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7552160Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7552200Z             ),
2025-01-14T13:16:42.7552330Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7552420Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7552480Z         ],
2025-01-14T13:16:42.7552520Z     )
2025-01-14T13:16:42.7552650Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7552740Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7552740Z 
2025-01-14T13:16:42.7552880Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7552970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7553190Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7553280Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7553500Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7554350Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7554470Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7554520Z     sim = run_tardis(
2025-01-14T13:16:42.7554690Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7554750Z     simulation.run_convergence()
2025-01-14T13:16:42.7554840Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7554960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7555030Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7555150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7555240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7555240Z 
2025-01-14T13:16:42.7555450Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7555610Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7555790Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7556020Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7556140Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7556260Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7556260Z 
2025-01-14T13:16:42.7556320Z     def initialize_transport_state(
2025-01-14T13:16:42.7556370Z         self,
2025-01-14T13:16:42.7556420Z         simulation_state,
2025-01-14T13:16:42.7556470Z         opacity_state,
2025-01-14T13:16:42.7556520Z         macro_atom_state,
2025-01-14T13:16:42.7556570Z         plasma,
2025-01-14T13:16:42.7556710Z         no_of_packets,
2025-01-14T13:16:42.7556800Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7556850Z         iteration=0,
2025-01-14T13:16:42.7556890Z     ):
2025-01-14T13:16:42.7556990Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7557170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7557220Z         else:
2025-01-14T13:16:42.7557280Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7557330Z     
2025-01-14T13:16:42.7557430Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7557510Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7557550Z         )
2025-01-14T13:16:42.7557600Z     
2025-01-14T13:16:42.7557700Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7557790Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7557920Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7557970Z         else:
2025-01-14T13:16:42.7558030Z             continuum_state = None
2025-01-14T13:16:42.7558120Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7558220Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7558300Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7558380Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7558460Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7558530Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7558600Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7558640Z         ).to_numba(
2025-01-14T13:16:42.7558700Z             macro_atom_state,
2025-01-14T13:16:42.7558770Z             self.line_interaction_type,
2025-01-14T13:16:42.7558820Z         )
2025-01-14T13:16:42.7558900Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7559130Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7559180Z         ]
2025-01-14T13:16:42.7559430Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7559430Z 
2025-01-14T13:16:42.7559550Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7559710Z ________ ERROR at setup of TestRPacketPlotter.test_get_frames[light-10] ________
2025-01-14T13:16:42.7559830Z 
2025-01-14T13:16:42.7559970Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7562530Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7562590Z 
2025-01-14T13:16:42.7563060Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7563170Z         "expected,obtained",
2025-01-14T13:16:42.7563220Z         [
2025-01-14T13:16:42.7563270Z             (
2025-01-14T13:16:42.7563360Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7563440Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7563490Z             ),
2025-01-14T13:16:42.7563610Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7563720Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7563760Z         ],
2025-01-14T13:16:42.7563810Z     )
2025-01-14T13:16:42.7563940Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7564040Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7564050Z 
2025-01-14T13:16:42.7564190Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7564280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7564510Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7564590Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7564820Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7564900Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7565000Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7565210Z     sim = run_tardis(
2025-01-14T13:16:42.7565280Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7565340Z     simulation.run_convergence()
2025-01-14T13:16:42.7565440Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7565550Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7565620Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7566830Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7566930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7566940Z 
2025-01-14T13:16:42.7567140Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7567580Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7568180Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7568850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7569220Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7569520Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7569540Z 
2025-01-14T13:16:42.7569730Z     def initialize_transport_state(
2025-01-14T13:16:42.7569880Z         self,
2025-01-14T13:16:42.7570030Z         simulation_state,
2025-01-14T13:16:42.7570950Z         opacity_state,
2025-01-14T13:16:42.7571060Z         macro_atom_state,
2025-01-14T13:16:42.7571110Z         plasma,
2025-01-14T13:16:42.7571160Z         no_of_packets,
2025-01-14T13:16:42.7571220Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7571260Z         iteration=0,
2025-01-14T13:16:42.7571310Z     ):
2025-01-14T13:16:42.7571410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7571480Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7571530Z         else:
2025-01-14T13:16:42.7571590Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7572000Z     
2025-01-14T13:16:42.7572120Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7572180Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7572230Z         )
2025-01-14T13:16:42.7572280Z     
2025-01-14T13:16:42.7572380Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7572470Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7572590Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7572630Z         else:
2025-01-14T13:16:42.7572690Z             continuum_state = None
2025-01-14T13:16:42.7572770Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7572850Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7572920Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7573010Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7573090Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7573160Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7573230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7573270Z         ).to_numba(
2025-01-14T13:16:42.7573330Z             macro_atom_state,
2025-01-14T13:16:42.7573390Z             self.line_interaction_type,
2025-01-14T13:16:42.7573430Z         )
2025-01-14T13:16:42.7573510Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7573740Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7573790Z         ]
2025-01-14T13:16:42.7574050Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7574060Z 
2025-01-14T13:16:42.7574180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7574610Z _________ ERROR at setup of TestRPacketPlotter.test_get_frames[dark-2] _________
2025-01-14T13:16:42.7574620Z 
2025-01-14T13:16:42.7574760Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7575030Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7575030Z 
2025-01-14T13:16:42.7575100Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7575170Z         "expected,obtained",
2025-01-14T13:16:42.7575210Z         [
2025-01-14T13:16:42.7575250Z             (
2025-01-14T13:16:42.7575330Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7575420Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7575460Z             ),
2025-01-14T13:16:42.7575580Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7575680Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7575730Z         ],
2025-01-14T13:16:42.7575780Z     )
2025-01-14T13:16:42.7575910Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7576010Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7576020Z 
2025-01-14T13:16:42.7576150Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7576250Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7576460Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7576550Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7576770Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7576860Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7576960Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7577010Z     sim = run_tardis(
2025-01-14T13:16:42.7577070Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7577140Z     simulation.run_convergence()
2025-01-14T13:16:42.7577290Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7577400Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7577470Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7578230Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7578630Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7578650Z 
2025-01-14T13:16:42.7579370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7579590Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7579760Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7579980Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7580110Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7580230Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7580230Z 
2025-01-14T13:16:42.7580310Z     def initialize_transport_state(
2025-01-14T13:16:42.7580360Z         self,
2025-01-14T13:16:42.7580410Z         simulation_state,
2025-01-14T13:16:42.7580460Z         opacity_state,
2025-01-14T13:16:42.7580510Z         macro_atom_state,
2025-01-14T13:16:42.7580560Z         plasma,
2025-01-14T13:16:42.7580610Z         no_of_packets,
2025-01-14T13:16:42.7580660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7580710Z         iteration=0,
2025-01-14T13:16:42.7580760Z     ):
2025-01-14T13:16:42.7580860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7580920Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7580980Z         else:
2025-01-14T13:16:42.7581200Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7581260Z     
2025-01-14T13:16:42.7581370Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7581440Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7581490Z         )
2025-01-14T13:16:42.7581530Z     
2025-01-14T13:16:42.7581630Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7581720Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7581860Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7581900Z         else:
2025-01-14T13:16:42.7581960Z             continuum_state = None
2025-01-14T13:16:42.7582030Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7582120Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7582190Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7582270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7582350Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7582430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7582510Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7582550Z         ).to_numba(
2025-01-14T13:16:42.7582610Z             macro_atom_state,
2025-01-14T13:16:42.7582670Z             self.line_interaction_type,
2025-01-14T13:16:42.7582720Z         )
2025-01-14T13:16:42.7582790Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7583010Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7583050Z         ]
2025-01-14T13:16:42.7583300Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7583310Z 
2025-01-14T13:16:42.7583420Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7583570Z _________ ERROR at setup of TestRPacketPlotter.test_get_frames[dark-5] _________
2025-01-14T13:16:42.7583580Z 
2025-01-14T13:16:42.7583720Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7584080Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7584080Z 
2025-01-14T13:16:42.7584820Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7585240Z         "expected,obtained",
2025-01-14T13:16:42.7585410Z         [
2025-01-14T13:16:42.7585560Z             (
2025-01-14T13:16:42.7585810Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7586110Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7586270Z             ),
2025-01-14T13:16:42.7586600Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7587080Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7587290Z         ],
2025-01-14T13:16:42.7587420Z     )
2025-01-14T13:16:42.7588000Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7588140Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7588140Z 
2025-01-14T13:16:42.7588280Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7588360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7588590Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7588670Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7588890Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7588980Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7589750Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7590040Z     sim = run_tardis(
2025-01-14T13:16:42.7591040Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7591240Z     simulation.run_convergence()
2025-01-14T13:16:42.7591500Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7597750Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7597870Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7598000Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7598090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7598090Z 
2025-01-14T13:16:42.7598300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7598460Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7598650Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7598870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7599010Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7599130Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7599140Z 
2025-01-14T13:16:42.7599200Z     def initialize_transport_state(
2025-01-14T13:16:42.7599260Z         self,
2025-01-14T13:16:42.7599490Z         simulation_state,
2025-01-14T13:16:42.7600180Z         opacity_state,
2025-01-14T13:16:42.7600380Z         macro_atom_state,
2025-01-14T13:16:42.7600540Z         plasma,
2025-01-14T13:16:42.7600690Z         no_of_packets,
2025-01-14T13:16:42.7600880Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7601030Z         iteration=0,
2025-01-14T13:16:42.7601170Z     ):
2025-01-14T13:16:42.7601470Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7601690Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7601840Z         else:
2025-01-14T13:16:42.7602160Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7602590Z     
2025-01-14T13:16:42.7602700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7603030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7603080Z         )
2025-01-14T13:16:42.7603120Z     
2025-01-14T13:16:42.7603230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7603330Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7603450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7603500Z         else:
2025-01-14T13:16:42.7603560Z             continuum_state = None
2025-01-14T13:16:42.7603640Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7603720Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7603800Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7603880Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7603970Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7604050Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7604120Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7604170Z         ).to_numba(
2025-01-14T13:16:42.7604230Z             macro_atom_state,
2025-01-14T13:16:42.7604300Z             self.line_interaction_type,
2025-01-14T13:16:42.7604340Z         )
2025-01-14T13:16:42.7604420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7604640Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7604700Z         ]
2025-01-14T13:16:42.7604950Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7604950Z 
2025-01-14T13:16:42.7605070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7605220Z ________ ERROR at setup of TestRPacketPlotter.test_get_frames[dark-10] _________
2025-01-14T13:16:42.7605620Z 
2025-01-14T13:16:42.7605770Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7606030Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7606040Z 
2025-01-14T13:16:42.7606090Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7606160Z         "expected,obtained",
2025-01-14T13:16:42.7606210Z         [
2025-01-14T13:16:42.7606250Z             (
2025-01-14T13:16:42.7606330Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7606410Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7606450Z             ),
2025-01-14T13:16:42.7606580Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7606670Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7606720Z         ],
2025-01-14T13:16:42.7606770Z     )
2025-01-14T13:16:42.7606900Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7606990Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7607000Z 
2025-01-14T13:16:42.7607130Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7607220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7607440Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7607530Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7607740Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7607830Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7607930Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7608000Z     sim = run_tardis(
2025-01-14T13:16:42.7608180Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7608280Z     simulation.run_convergence()
2025-01-14T13:16:42.7608370Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7608820Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7608900Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7609020Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7609130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7609130Z 
2025-01-14T13:16:42.7609340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7609510Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7609690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7609930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7610060Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7610170Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7610180Z 
2025-01-14T13:16:42.7610240Z     def initialize_transport_state(
2025-01-14T13:16:42.7610290Z         self,
2025-01-14T13:16:42.7610350Z         simulation_state,
2025-01-14T13:16:42.7610400Z         opacity_state,
2025-01-14T13:16:42.7610450Z         macro_atom_state,
2025-01-14T13:16:42.7610500Z         plasma,
2025-01-14T13:16:42.7610550Z         no_of_packets,
2025-01-14T13:16:42.7610610Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7610660Z         iteration=0,
2025-01-14T13:16:42.7610700Z     ):
2025-01-14T13:16:42.7610800Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7610870Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7610910Z         else:
2025-01-14T13:16:42.7610970Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7611010Z     
2025-01-14T13:16:42.7611400Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7611640Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7611700Z         )
2025-01-14T13:16:42.7611740Z     
2025-01-14T13:16:42.7611860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7611950Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7612080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7612120Z         else:
2025-01-14T13:16:42.7612180Z             continuum_state = None
2025-01-14T13:16:42.7612260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7612350Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7612420Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7612510Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7612580Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7612650Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7612730Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7612780Z         ).to_numba(
2025-01-14T13:16:42.7612860Z             macro_atom_state,
2025-01-14T13:16:42.7612920Z             self.line_interaction_type,
2025-01-14T13:16:42.7612960Z         )
2025-01-14T13:16:42.7613040Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7613270Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7613320Z         ]
2025-01-14T13:16:42.7613570Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7613570Z 
2025-01-14T13:16:42.7613690Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7613830Z ________ ERROR at setup of TestRPacketPlotter.test_get_slider_steps[10] ________
2025-01-14T13:16:42.7613840Z 
2025-01-14T13:16:42.7614010Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7614280Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7614420Z 
2025-01-14T13:16:42.7614490Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7614550Z         "expected,obtained",
2025-01-14T13:16:42.7614870Z         [
2025-01-14T13:16:42.7614930Z             (
2025-01-14T13:16:42.7615020Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7615100Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7615140Z             ),
2025-01-14T13:16:42.7615270Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7615360Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7615410Z         ],
2025-01-14T13:16:42.7615450Z     )
2025-01-14T13:16:42.7615580Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7615680Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7615690Z 
2025-01-14T13:16:42.7615820Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7615910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7616130Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7616220Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7616440Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7616520Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7616620Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7616680Z     sim = run_tardis(
2025-01-14T13:16:42.7616730Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7616790Z     simulation.run_convergence()
2025-01-14T13:16:42.7616960Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7617080Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7617150Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7617280Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7617380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7617390Z 
2025-01-14T13:16:42.7617600Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7617760Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7618480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7619590Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7619930Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7620420Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7620440Z 
2025-01-14T13:16:42.7620630Z     def initialize_transport_state(
2025-01-14T13:16:42.7620770Z         self,
2025-01-14T13:16:42.7620930Z         simulation_state,
2025-01-14T13:16:42.7621100Z         opacity_state,
2025-01-14T13:16:42.7621250Z         macro_atom_state,
2025-01-14T13:16:42.7621410Z         plasma,
2025-01-14T13:16:42.7621570Z         no_of_packets,
2025-01-14T13:16:42.7621740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7621900Z         iteration=0,
2025-01-14T13:16:42.7622040Z     ):
2025-01-14T13:16:42.7622320Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7622520Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7623030Z         else:
2025-01-14T13:16:42.7623250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7623400Z     
2025-01-14T13:16:42.7623710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7623950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7624090Z         )
2025-01-14T13:16:42.7624950Z     
2025-01-14T13:16:42.7625310Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7625780Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7626340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7626450Z         else:
2025-01-14T13:16:42.7626510Z             continuum_state = None
2025-01-14T13:16:42.7626590Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7626690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7626770Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7626850Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7626920Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7627000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7627090Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7627140Z         ).to_numba(
2025-01-14T13:16:42.7627200Z             macro_atom_state,
2025-01-14T13:16:42.7627270Z             self.line_interaction_type,
2025-01-14T13:16:42.7627310Z         )
2025-01-14T13:16:42.7627380Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7627600Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7627650Z         ]
2025-01-14T13:16:42.7627900Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7627910Z 
2025-01-14T13:16:42.7628020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7628170Z ________ ERROR at setup of TestRPacketPlotter.test_get_slider_steps[30] ________
2025-01-14T13:16:42.7628180Z 
2025-01-14T13:16:42.7628310Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7628940Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7628960Z 
2025-01-14T13:16:42.7629020Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7629090Z         "expected,obtained",
2025-01-14T13:16:42.7629130Z         [
2025-01-14T13:16:42.7629170Z             (
2025-01-14T13:16:42.7629260Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7629340Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7629390Z             ),
2025-01-14T13:16:42.7629520Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7629610Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7629660Z         ],
2025-01-14T13:16:42.7629710Z     )
2025-01-14T13:16:42.7629830Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7629930Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7629930Z 
2025-01-14T13:16:42.7630070Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7630160Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7630390Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7630470Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7630700Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7630780Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7630890Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7630940Z     sim = run_tardis(
2025-01-14T13:16:42.7631010Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7631090Z     simulation.run_convergence()
2025-01-14T13:16:42.7631180Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7631300Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7631370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7631620Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7631710Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7631720Z 
2025-01-14T13:16:42.7631930Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7632090Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7632270Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7632490Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7632620Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7632720Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7632730Z 
2025-01-14T13:16:42.7632800Z     def initialize_transport_state(
2025-01-14T13:16:42.7632840Z         self,
2025-01-14T13:16:42.7632900Z         simulation_state,
2025-01-14T13:16:42.7632950Z         opacity_state,
2025-01-14T13:16:42.7633010Z         macro_atom_state,
2025-01-14T13:16:42.7633050Z         plasma,
2025-01-14T13:16:42.7633100Z         no_of_packets,
2025-01-14T13:16:42.7633170Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7633210Z         iteration=0,
2025-01-14T13:16:42.7633260Z     ):
2025-01-14T13:16:42.7633350Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7633430Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7633470Z         else:
2025-01-14T13:16:42.7633530Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7633570Z     
2025-01-14T13:16:42.7633670Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7633750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7633860Z         )
2025-01-14T13:16:42.7633900Z     
2025-01-14T13:16:42.7634010Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7634100Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7634230Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7634270Z         else:
2025-01-14T13:16:42.7634330Z             continuum_state = None
2025-01-14T13:16:42.7634410Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7634490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7634550Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7634630Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7634710Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7634780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7634840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7634900Z         ).to_numba(
2025-01-14T13:16:42.7634970Z             macro_atom_state,
2025-01-14T13:16:42.7635040Z             self.line_interaction_type,
2025-01-14T13:16:42.7635090Z         )
2025-01-14T13:16:42.7635160Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7635390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7635440Z         ]
2025-01-14T13:16:42.7635680Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7635680Z 
2025-01-14T13:16:42.7635800Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7636060Z ________ ERROR at setup of TestRPacketPlotter.test_get_slider_steps[50] ________
2025-01-14T13:16:42.7636070Z 
2025-01-14T13:16:42.7636220Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7636480Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7636820Z 
2025-01-14T13:16:42.7636890Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7636950Z         "expected,obtained",
2025-01-14T13:16:42.7636990Z         [
2025-01-14T13:16:42.7637040Z             (
2025-01-14T13:16:42.7637120Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7637210Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7637250Z             ),
2025-01-14T13:16:42.7637380Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7637470Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7637520Z         ],
2025-01-14T13:16:42.7637570Z     )
2025-01-14T13:16:42.7637700Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7637790Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7637790Z 
2025-01-14T13:16:42.7637930Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7638030Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7638800Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7638910Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7639130Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7639230Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7639340Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7639390Z     sim = run_tardis(
2025-01-14T13:16:42.7639450Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7639520Z     simulation.run_convergence()
2025-01-14T13:16:42.7639600Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7639720Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7640070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7640200Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7640300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7640300Z 
2025-01-14T13:16:42.7640510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7640670Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7640840Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7641070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7641190Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7641300Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7641300Z 
2025-01-14T13:16:42.7641370Z     def initialize_transport_state(
2025-01-14T13:16:42.7641410Z         self,
2025-01-14T13:16:42.7641470Z         simulation_state,
2025-01-14T13:16:42.7641520Z         opacity_state,
2025-01-14T13:16:42.7641580Z         macro_atom_state,
2025-01-14T13:16:42.7641620Z         plasma,
2025-01-14T13:16:42.7641680Z         no_of_packets,
2025-01-14T13:16:42.7641730Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7641780Z         iteration=0,
2025-01-14T13:16:42.7641820Z     ):
2025-01-14T13:16:42.7641920Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7641990Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7642030Z         else:
2025-01-14T13:16:42.7642080Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7642130Z     
2025-01-14T13:16:42.7642230Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7642300Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7642350Z         )
2025-01-14T13:16:42.7642390Z     
2025-01-14T13:16:42.7642640Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7642830Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7642950Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7642990Z         else:
2025-01-14T13:16:42.7643060Z             continuum_state = None
2025-01-14T13:16:42.7643130Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7643220Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7643280Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7643370Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7643440Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7643510Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7643570Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7643620Z         ).to_numba(
2025-01-14T13:16:42.7643670Z             macro_atom_state,
2025-01-14T13:16:42.7644200Z             self.line_interaction_type,
2025-01-14T13:16:42.7644530Z         )
2025-01-14T13:16:42.7644770Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7645390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7645540Z         ]
2025-01-14T13:16:42.7646220Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7646230Z 
2025-01-14T13:16:42.7646540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7646960Z _______ ERROR at setup of TestRPacketPlotter.test_generate_plot[light-2] _______
2025-01-14T13:16:42.7646970Z 
2025-01-14T13:16:42.7647330Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7648390Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7649330Z 
2025-01-14T13:16:42.7649550Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7649730Z         "expected,obtained",
2025-01-14T13:16:42.7649870Z         [
2025-01-14T13:16:42.7650010Z             (
2025-01-14T13:16:42.7650250Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7650470Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7650620Z             ),
2025-01-14T13:16:42.7650940Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7651210Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7651380Z         ],
2025-01-14T13:16:42.7651540Z     )
2025-01-14T13:16:42.7651980Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7652590Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7652620Z 
2025-01-14T13:16:42.7652780Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7652890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7653140Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7653250Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7653490Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7653570Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7653680Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7653730Z     sim = run_tardis(
2025-01-14T13:16:42.7653790Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7653850Z     simulation.run_convergence()
2025-01-14T13:16:42.7653940Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7654050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7654120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7654250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7654570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7654580Z 
2025-01-14T13:16:42.7654800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7654950Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7655130Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7655350Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7655480Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7655580Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7655590Z 
2025-01-14T13:16:42.7655650Z     def initialize_transport_state(
2025-01-14T13:16:42.7655710Z         self,
2025-01-14T13:16:42.7655760Z         simulation_state,
2025-01-14T13:16:42.7655810Z         opacity_state,
2025-01-14T13:16:42.7655860Z         macro_atom_state,
2025-01-14T13:16:42.7655910Z         plasma,
2025-01-14T13:16:42.7655950Z         no_of_packets,
2025-01-14T13:16:42.7656010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7656060Z         iteration=0,
2025-01-14T13:16:42.7656100Z     ):
2025-01-14T13:16:42.7656200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7656270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7656320Z         else:
2025-01-14T13:16:42.7656380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7656420Z     
2025-01-14T13:16:42.7656520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7656600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7656640Z         )
2025-01-14T13:16:42.7656680Z     
2025-01-14T13:16:42.7656860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7656960Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7657080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7657130Z         else:
2025-01-14T13:16:42.7657190Z             continuum_state = None
2025-01-14T13:16:42.7657260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7657460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7657530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7657610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7657690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7657750Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7657820Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7657870Z         ).to_numba(
2025-01-14T13:16:42.7657920Z             macro_atom_state,
2025-01-14T13:16:42.7657980Z             self.line_interaction_type,
2025-01-14T13:16:42.7658030Z         )
2025-01-14T13:16:42.7658110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7658330Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7658380Z         ]
2025-01-14T13:16:42.7658620Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7658630Z 
2025-01-14T13:16:42.7658740Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7658890Z _______ ERROR at setup of TestRPacketPlotter.test_generate_plot[light-5] _______
2025-01-14T13:16:42.7658900Z 
2025-01-14T13:16:42.7659030Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7659290Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7659300Z 
2025-01-14T13:16:42.7659450Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7659540Z         "expected,obtained",
2025-01-14T13:16:42.7659720Z         [
2025-01-14T13:16:42.7659770Z             (
2025-01-14T13:16:42.7659850Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7659930Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7659970Z             ),
2025-01-14T13:16:42.7660100Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7660200Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7660240Z         ],
2025-01-14T13:16:42.7660280Z     )
2025-01-14T13:16:42.7660410Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7660500Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7660510Z 
2025-01-14T13:16:42.7660640Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7660740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7660960Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7661050Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7661260Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7661350Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7661450Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7661500Z     sim = run_tardis(
2025-01-14T13:16:42.7661570Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7661630Z     simulation.run_convergence()
2025-01-14T13:16:42.7661720Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7661840Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7661910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7662090Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7662190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7662190Z 
2025-01-14T13:16:42.7662390Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7662830Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7663020Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7663230Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7663380Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7663490Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7663490Z 
2025-01-14T13:16:42.7663580Z     def initialize_transport_state(
2025-01-14T13:16:42.7663630Z         self,
2025-01-14T13:16:42.7663690Z         simulation_state,
2025-01-14T13:16:42.7663740Z         opacity_state,
2025-01-14T13:16:42.7663790Z         macro_atom_state,
2025-01-14T13:16:42.7663830Z         plasma,
2025-01-14T13:16:42.7663890Z         no_of_packets,
2025-01-14T13:16:42.7663940Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7663990Z         iteration=0,
2025-01-14T13:16:42.7664040Z     ):
2025-01-14T13:16:42.7664130Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7664200Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7664250Z         else:
2025-01-14T13:16:42.7664300Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7664340Z     
2025-01-14T13:16:42.7664450Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7664520Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7664570Z         )
2025-01-14T13:16:42.7664610Z     
2025-01-14T13:16:42.7664710Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7664800Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7664930Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7665410Z         else:
2025-01-14T13:16:42.7665470Z             continuum_state = None
2025-01-14T13:16:42.7665550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7671010Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7671100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7671190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7671260Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7671430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7671520Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7671560Z         ).to_numba(
2025-01-14T13:16:42.7671620Z             macro_atom_state,
2025-01-14T13:16:42.7671670Z             self.line_interaction_type,
2025-01-14T13:16:42.7671730Z         )
2025-01-14T13:16:42.7671800Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7672040Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7672080Z         ]
2025-01-14T13:16:42.7672330Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7672330Z 
2025-01-14T13:16:42.7672440Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7672610Z ______ ERROR at setup of TestRPacketPlotter.test_generate_plot[light-10] _______
2025-01-14T13:16:42.7672620Z 
2025-01-14T13:16:42.7672760Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7673020Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7673020Z 
2025-01-14T13:16:42.7673520Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7673670Z         "expected,obtained",
2025-01-14T13:16:42.7673750Z         [
2025-01-14T13:16:42.7673800Z             (
2025-01-14T13:16:42.7673890Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7673980Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7674040Z             ),
2025-01-14T13:16:42.7674160Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7674260Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7674310Z         ],
2025-01-14T13:16:42.7674350Z     )
2025-01-14T13:16:42.7674480Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7674570Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7674570Z 
2025-01-14T13:16:42.7674710Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7674810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7675040Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7675130Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7675360Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7675440Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7675540Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7675600Z     sim = run_tardis(
2025-01-14T13:16:42.7675670Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7675740Z     simulation.run_convergence()
2025-01-14T13:16:42.7675830Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7675940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7676010Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7676130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7676220Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7676360Z 
2025-01-14T13:16:42.7676580Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7676750Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7676940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7677180Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7677310Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7677420Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7677430Z 
2025-01-14T13:16:42.7677490Z     def initialize_transport_state(
2025-01-14T13:16:42.7677540Z         self,
2025-01-14T13:16:42.7677590Z         simulation_state,
2025-01-14T13:16:42.7677650Z         opacity_state,
2025-01-14T13:16:42.7677700Z         macro_atom_state,
2025-01-14T13:16:42.7677750Z         plasma,
2025-01-14T13:16:42.7677800Z         no_of_packets,
2025-01-14T13:16:42.7677860Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7677910Z         iteration=0,
2025-01-14T13:16:42.7677970Z     ):
2025-01-14T13:16:42.7678070Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7678140Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7678190Z         else:
2025-01-14T13:16:42.7678250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7678290Z     
2025-01-14T13:16:42.7678390Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7678470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7678510Z         )
2025-01-14T13:16:42.7678550Z     
2025-01-14T13:16:42.7678660Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7678750Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7678960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7679020Z         else:
2025-01-14T13:16:42.7679080Z             continuum_state = None
2025-01-14T13:16:42.7679160Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7679270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7679340Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7679520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7679620Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7679690Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7679750Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7679800Z         ).to_numba(
2025-01-14T13:16:42.7679860Z             macro_atom_state,
2025-01-14T13:16:42.7679920Z             self.line_interaction_type,
2025-01-14T13:16:42.7679960Z         )
2025-01-14T13:16:42.7680050Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7680280Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7680330Z         ]
2025-01-14T13:16:42.7680580Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7680590Z 
2025-01-14T13:16:42.7680710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7680870Z _______ ERROR at setup of TestRPacketPlotter.test_generate_plot[dark-2] ________
2025-01-14T13:16:42.7680870Z 
2025-01-14T13:16:42.7681010Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7681280Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7681280Z 
2025-01-14T13:16:42.7681350Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7681410Z         "expected,obtained",
2025-01-14T13:16:42.7681450Z         [
2025-01-14T13:16:42.7681500Z             (
2025-01-14T13:16:42.7681700Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7681790Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7681840Z             ),
2025-01-14T13:16:42.7681960Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7682060Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7682410Z         ],
2025-01-14T13:16:42.7682480Z     )
2025-01-14T13:16:42.7682730Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7682820Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7682820Z 
2025-01-14T13:16:42.7682950Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7683050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7683270Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7683380Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7683600Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7683690Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7683800Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7683840Z     sim = run_tardis(
2025-01-14T13:16:42.7683910Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7683970Z     simulation.run_convergence()
2025-01-14T13:16:42.7684050Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7684160Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7684240Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7684360Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7684550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7684560Z 
2025-01-14T13:16:42.7684770Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7684930Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7685110Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7685330Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7685460Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7685570Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7685570Z 
2025-01-14T13:16:42.7685640Z     def initialize_transport_state(
2025-01-14T13:16:42.7685680Z         self,
2025-01-14T13:16:42.7685740Z         simulation_state,
2025-01-14T13:16:42.7685790Z         opacity_state,
2025-01-14T13:16:42.7685850Z         macro_atom_state,
2025-01-14T13:16:42.7685900Z         plasma,
2025-01-14T13:16:42.7685950Z         no_of_packets,
2025-01-14T13:16:42.7686010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7686060Z         iteration=0,
2025-01-14T13:16:42.7686100Z     ):
2025-01-14T13:16:42.7686200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7686270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7686310Z         else:
2025-01-14T13:16:42.7686380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7686420Z     
2025-01-14T13:16:42.7686530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7686600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7686650Z         )
2025-01-14T13:16:42.7686690Z     
2025-01-14T13:16:42.7686790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7686880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7687010Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7687390Z         else:
2025-01-14T13:16:42.7687590Z             continuum_state = None
2025-01-14T13:16:42.7687680Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7687760Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7687840Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7687930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7688010Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7688080Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7688150Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7688190Z         ).to_numba(
2025-01-14T13:16:42.7688250Z             macro_atom_state,
2025-01-14T13:16:42.7688310Z             self.line_interaction_type,
2025-01-14T13:16:42.7688350Z         )
2025-01-14T13:16:42.7688430Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7688650Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7688700Z         ]
2025-01-14T13:16:42.7688960Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7688960Z 
2025-01-14T13:16:42.7689080Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7689240Z _______ ERROR at setup of TestRPacketPlotter.test_generate_plot[dark-5] ________
2025-01-14T13:16:42.7689250Z 
2025-01-14T13:16:42.7689400Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7689680Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7689690Z 
2025-01-14T13:16:42.7689750Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7689830Z         "expected,obtained",
2025-01-14T13:16:42.7689970Z         [
2025-01-14T13:16:42.7690030Z             (
2025-01-14T13:16:42.7690110Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7690200Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7690240Z             ),
2025-01-14T13:16:42.7690380Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7690480Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7690520Z         ],
2025-01-14T13:16:42.7690570Z     )
2025-01-14T13:16:42.7690700Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7690790Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7690790Z 
2025-01-14T13:16:42.7690950Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7691050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7691270Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7691360Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7691580Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7691660Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7691770Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7691820Z     sim = run_tardis(
2025-01-14T13:16:42.7691880Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7691940Z     simulation.run_convergence()
2025-01-14T13:16:42.7692030Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7692140Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7692200Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7692330Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7692420Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7692430Z 
2025-01-14T13:16:42.7692640Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7694540Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7695500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7696110Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7696440Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7696790Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7696810Z 
2025-01-14T13:16:42.7696990Z     def initialize_transport_state(
2025-01-14T13:16:42.7697150Z         self,
2025-01-14T13:16:42.7697310Z         simulation_state,
2025-01-14T13:16:42.7697480Z         opacity_state,
2025-01-14T13:16:42.7697670Z         macro_atom_state,
2025-01-14T13:16:42.7697850Z         plasma,
2025-01-14T13:16:42.7698000Z         no_of_packets,
2025-01-14T13:16:42.7698170Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7698350Z         iteration=0,
2025-01-14T13:16:42.7698490Z     ):
2025-01-14T13:16:42.7698970Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7699220Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7699370Z         else:
2025-01-14T13:16:42.7699540Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7700920Z     
2025-01-14T13:16:42.7701960Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7702280Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7702430Z         )
2025-01-14T13:16:42.7703370Z     
2025-01-14T13:16:42.7703540Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7703650Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7703780Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7705370Z         else:
2025-01-14T13:16:42.7705690Z             continuum_state = None
2025-01-14T13:16:42.7706770Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7707060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7707270Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7708470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7708830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7709100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7709300Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7709460Z         ).to_numba(
2025-01-14T13:16:42.7710200Z             macro_atom_state,
2025-01-14T13:16:42.7710660Z             self.line_interaction_type,
2025-01-14T13:16:42.7710720Z         )
2025-01-14T13:16:42.7710800Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7711030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7711090Z         ]
2025-01-14T13:16:42.7711360Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7711360Z 
2025-01-14T13:16:42.7711480Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7711660Z _______ ERROR at setup of TestRPacketPlotter.test_generate_plot[dark-10] _______
2025-01-14T13:16:42.7711660Z 
2025-01-14T13:16:42.7711800Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:42.7712070Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:42.7712070Z 
2025-01-14T13:16:42.7712130Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.7712190Z         "expected,obtained",
2025-01-14T13:16:42.7712240Z         [
2025-01-14T13:16:42.7712290Z             (
2025-01-14T13:16:42.7712380Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:42.7712460Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:42.7712680Z             ),
2025-01-14T13:16:42.7713080Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:42.7713200Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:42.7713250Z         ],
2025-01-14T13:16:42.7713300Z     )
2025-01-14T13:16:42.7714080Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:42.7714410Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7714420Z 
2025-01-14T13:16:42.7715040Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:42.7715430Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7715710Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7715810Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7716040Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:42.7716140Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.7716260Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:42.7716310Z     sim = run_tardis(
2025-01-14T13:16:42.7716380Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7716440Z     simulation.run_convergence()
2025-01-14T13:16:42.7716540Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7716670Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7716750Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7716880Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7716980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7717110Z 
2025-01-14T13:16:42.7717340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:42.7717500Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:42.7717690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:42.7717920Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:42.7718050Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:42.7718160Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7718170Z 
2025-01-14T13:16:42.7718230Z     def initialize_transport_state(
2025-01-14T13:16:42.7718280Z         self,
2025-01-14T13:16:42.7718340Z         simulation_state,
2025-01-14T13:16:42.7718390Z         opacity_state,
2025-01-14T13:16:42.7718440Z         macro_atom_state,
2025-01-14T13:16:42.7718490Z         plasma,
2025-01-14T13:16:42.7718540Z         no_of_packets,
2025-01-14T13:16:42.7718600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7718650Z         iteration=0,
2025-01-14T13:16:42.7718700Z     ):
2025-01-14T13:16:42.7718800Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7718880Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7718930Z         else:
2025-01-14T13:16:42.7718990Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7719030Z     
2025-01-14T13:16:42.7719150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7719230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7719280Z         )
2025-01-14T13:16:42.7719320Z     
2025-01-14T13:16:42.7719430Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7719790Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7720200Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7720450Z         else:
2025-01-14T13:16:42.7720530Z             continuum_state = None
2025-01-14T13:16:42.7720610Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7720780Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7720860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7720950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7721030Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7721100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7721190Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7721240Z         ).to_numba(
2025-01-14T13:16:42.7721580Z             macro_atom_state,
2025-01-14T13:16:42.7721670Z             self.line_interaction_type,
2025-01-14T13:16:42.7721720Z         )
2025-01-14T13:16:42.7721800Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7722030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7722100Z         ]
2025-01-14T13:16:42.7722360Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7722360Z 
2025-01-14T13:16:42.7722920Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7723130Z _ ERROR at setup of TestSDECPlotter.test_parse_species_list[_full_species_list] _
2025-01-14T13:16:42.7723130Z 
2025-01-14T13:16:42.7723740Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7724040Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7724040Z 
2025-01-14T13:16:42.7724110Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7724350Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7724400Z         """
2025-01-14T13:16:42.7724530Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7724580Z     
2025-01-14T13:16:42.7724630Z         Parameters
2025-01-14T13:16:42.7724680Z         ----------
2025-01-14T13:16:42.7724810Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7724910Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7725010Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7725070Z             Atomic data.
2025-01-14T13:16:42.7725110Z     
2025-01-14T13:16:42.7725170Z         Returns
2025-01-14T13:16:42.7725230Z         -------
2025-01-14T13:16:42.7725310Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7725370Z             Simulation object.
2025-01-14T13:16:42.7725420Z         """
2025-01-14T13:16:42.7725550Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7725700Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7725800Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7725920Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7726030Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7726180Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7726290Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7726370Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7726450Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7726500Z >       sim = run_tardis(
2025-01-14T13:16:42.7726560Z             config_verysimple,
2025-01-14T13:16:42.7726620Z             atom_data=atomic_data,
2025-01-14T13:16:42.7726680Z             show_convergence_plots=False,
2025-01-14T13:16:42.7726750Z             log_level="CRITICAl",
2025-01-14T13:16:42.7726810Z         )
2025-01-14T13:16:42.7726810Z 
2025-01-14T13:16:42.7727020Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7727130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7727200Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7727260Z     simulation.run_convergence()
2025-01-14T13:16:42.7727350Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7727470Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7727530Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7727650Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7728750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7728770Z 
2025-01-14T13:16:42.7729000Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7729170Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7729350Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7730380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7730950Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7731310Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7731320Z 
2025-01-14T13:16:42.7731540Z     def initialize_transport_state(
2025-01-14T13:16:42.7731720Z         self,
2025-01-14T13:16:42.7731910Z         simulation_state,
2025-01-14T13:16:42.7732080Z         opacity_state,
2025-01-14T13:16:42.7732240Z         macro_atom_state,
2025-01-14T13:16:42.7732390Z         plasma,
2025-01-14T13:16:42.7732860Z         no_of_packets,
2025-01-14T13:16:42.7732970Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7733160Z         iteration=0,
2025-01-14T13:16:42.7733200Z     ):
2025-01-14T13:16:42.7733310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7733380Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7733450Z         else:
2025-01-14T13:16:42.7733510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7733550Z     
2025-01-14T13:16:42.7733830Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7733920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7733960Z         )
2025-01-14T13:16:42.7734000Z     
2025-01-14T13:16:42.7734110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7734200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7734330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7734380Z         else:
2025-01-14T13:16:42.7734450Z             continuum_state = None
2025-01-14T13:16:42.7734530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7734620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7734700Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7734790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7734860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7734940Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7735000Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7735050Z         ).to_numba(
2025-01-14T13:16:42.7735300Z             macro_atom_state,
2025-01-14T13:16:42.7735850Z             self.line_interaction_type,
2025-01-14T13:16:42.7735940Z         )
2025-01-14T13:16:42.7736020Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7736510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7736570Z         ]
2025-01-14T13:16:42.7736840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7737470Z 
2025-01-14T13:16:42.7737610Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7737750Z ---------------------------- Captured stdout setup -----------------------------
2025-01-14T13:16:42.7738180Z log_level is defined both in Functional Argument & YAML Configuration {debug section}
2025-01-14T13:16:42.7738490Z log_level = CRITICAL will be used for Log Level Determination
2025-01-14T13:16:42.7738510Z 
2025-01-14T13:16:42.7738690Z ___ ERROR at setup of TestSDECPlotter.test_parse_species_list[_species_list] ___
2025-01-14T13:16:42.7738690Z 
2025-01-14T13:16:42.7739790Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7740100Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7740110Z 
2025-01-14T13:16:42.7740180Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7740300Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7740340Z         """
2025-01-14T13:16:42.7740470Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7740510Z     
2025-01-14T13:16:42.7740560Z         Parameters
2025-01-14T13:16:42.7740610Z         ----------
2025-01-14T13:16:42.7740730Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7740840Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7740930Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7740980Z             Atomic data.
2025-01-14T13:16:42.7741550Z     
2025-01-14T13:16:42.7741950Z         Returns
2025-01-14T13:16:42.7743130Z         -------
2025-01-14T13:16:42.7743390Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7743590Z             Simulation object.
2025-01-14T13:16:42.7744000Z         """
2025-01-14T13:16:42.7744340Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7744500Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7744590Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7744690Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7744800Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7744950Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7745070Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7745140Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7745220Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7745280Z >       sim = run_tardis(
2025-01-14T13:16:42.7745350Z             config_verysimple,
2025-01-14T13:16:42.7745410Z             atom_data=atomic_data,
2025-01-14T13:16:42.7745480Z             show_convergence_plots=False,
2025-01-14T13:16:42.7745530Z             log_level="CRITICAl",
2025-01-14T13:16:42.7745990Z         )
2025-01-14T13:16:42.7746020Z 
2025-01-14T13:16:42.7746730Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7747010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7747340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7747770Z     simulation.run_convergence()
2025-01-14T13:16:42.7748040Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7748680Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7748960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7749410Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7749560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7749690Z 
2025-01-14T13:16:42.7749920Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7750080Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7750650Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7751290Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7752750Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7752930Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7752940Z 
2025-01-14T13:16:42.7753030Z     def initialize_transport_state(
2025-01-14T13:16:42.7753110Z         self,
2025-01-14T13:16:42.7753210Z         simulation_state,
2025-01-14T13:16:42.7753270Z         opacity_state,
2025-01-14T13:16:42.7753330Z         macro_atom_state,
2025-01-14T13:16:42.7753370Z         plasma,
2025-01-14T13:16:42.7753450Z         no_of_packets,
2025-01-14T13:16:42.7753550Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7753630Z         iteration=0,
2025-01-14T13:16:42.7753700Z     ):
2025-01-14T13:16:42.7753840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7753930Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7753980Z         else:
2025-01-14T13:16:42.7754050Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7754110Z     
2025-01-14T13:16:42.7754260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7754350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7754430Z         )
2025-01-14T13:16:42.7754480Z     
2025-01-14T13:16:42.7754580Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7754670Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7754980Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7755040Z         else:
2025-01-14T13:16:42.7755100Z             continuum_state = None
2025-01-14T13:16:42.7756450Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7756580Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7756890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7757240Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7757650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7758560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7773180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7773290Z         ).to_numba(
2025-01-14T13:16:42.7773360Z             macro_atom_state,
2025-01-14T13:16:42.7773430Z             self.line_interaction_type,
2025-01-14T13:16:42.7773480Z         )
2025-01-14T13:16:42.7773560Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7773830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7773880Z         ]
2025-01-14T13:16:42.7774150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7774160Z 
2025-01-14T13:16:42.7774280Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7774470Z ___ ERROR at setup of TestSDECPlotter.test_parse_species_list[_keep_colour] ____
2025-01-14T13:16:42.7774470Z 
2025-01-14T13:16:42.7775250Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7775970Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7775990Z 
2025-01-14T13:16:42.7776070Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7777430Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7777500Z         """
2025-01-14T13:16:42.7777650Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7777720Z     
2025-01-14T13:16:42.7777790Z         Parameters
2025-01-14T13:16:42.7777870Z         ----------
2025-01-14T13:16:42.7778010Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7778240Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7778400Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7778480Z             Atomic data.
2025-01-14T13:16:42.7778550Z     
2025-01-14T13:16:42.7778600Z         Returns
2025-01-14T13:16:42.7778650Z         -------
2025-01-14T13:16:42.7779360Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7779690Z             Simulation object.
2025-01-14T13:16:42.7779830Z         """
2025-01-14T13:16:42.7780200Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7780620Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7780880Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7781180Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7781490Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7781880Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7782180Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7782400Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7782600Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7782790Z >       sim = run_tardis(
2025-01-14T13:16:42.7783010Z             config_verysimple,
2025-01-14T13:16:42.7783860Z             atom_data=atomic_data,
2025-01-14T13:16:42.7784060Z             show_convergence_plots=False,
2025-01-14T13:16:42.7784250Z             log_level="CRITICAl",
2025-01-14T13:16:42.7784390Z         )
2025-01-14T13:16:42.7784400Z 
2025-01-14T13:16:42.7784720Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7785000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7785180Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7785370Z     simulation.run_convergence()
2025-01-14T13:16:42.7785620Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7785940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7786160Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7786540Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7786810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7786840Z 
2025-01-14T13:16:42.7787420Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7787890Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7788370Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7788970Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7789300Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7789740Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7789760Z 
2025-01-14T13:16:42.7789950Z     def initialize_transport_state(
2025-01-14T13:16:42.7790110Z         self,
2025-01-14T13:16:42.7790390Z         simulation_state,
2025-01-14T13:16:42.7790920Z         opacity_state,
2025-01-14T13:16:42.7791160Z         macro_atom_state,
2025-01-14T13:16:42.7791560Z         plasma,
2025-01-14T13:16:42.7791870Z         no_of_packets,
2025-01-14T13:16:42.7791970Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7792640Z         iteration=0,
2025-01-14T13:16:42.7792690Z     ):
2025-01-14T13:16:42.7792790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7792870Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7792920Z         else:
2025-01-14T13:16:42.7792980Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7793030Z     
2025-01-14T13:16:42.7793150Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7793230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7793270Z         )
2025-01-14T13:16:42.7793330Z     
2025-01-14T13:16:42.7793450Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7793550Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7793680Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7793740Z         else:
2025-01-14T13:16:42.7793800Z             continuum_state = None
2025-01-14T13:16:42.7793890Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7793990Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7794250Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7794620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7794830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7795050Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7795280Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7795430Z         ).to_numba(
2025-01-14T13:16:42.7795810Z             macro_atom_state,
2025-01-14T13:16:42.7796110Z             self.line_interaction_type,
2025-01-14T13:16:42.7796270Z         )
2025-01-14T13:16:42.7796530Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7797390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7798010Z         ]
2025-01-14T13:16:42.7798320Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7798330Z 
2025-01-14T13:16:42.7798450Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7798780Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data0] _
2025-01-14T13:16:42.7798790Z 
2025-01-14T13:16:42.7799750Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7800670Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7800710Z 
2025-01-14T13:16:42.7801040Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7802140Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7802330Z         """
2025-01-14T13:16:42.7802670Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7802990Z     
2025-01-14T13:16:42.7803390Z         Parameters
2025-01-14T13:16:42.7803550Z         ----------
2025-01-14T13:16:42.7803880Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7804200Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7804680Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7804870Z             Atomic data.
2025-01-14T13:16:42.7805040Z     
2025-01-14T13:16:42.7805210Z         Returns
2025-01-14T13:16:42.7805360Z         -------
2025-01-14T13:16:42.7806000Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7806230Z             Simulation object.
2025-01-14T13:16:42.7806450Z         """
2025-01-14T13:16:42.7806860Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7808760Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7808880Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7808990Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7809100Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7809270Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7809390Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7809490Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7809590Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7809680Z >       sim = run_tardis(
2025-01-14T13:16:42.7809760Z             config_verysimple,
2025-01-14T13:16:42.7809820Z             atom_data=atomic_data,
2025-01-14T13:16:42.7809940Z             show_convergence_plots=False,
2025-01-14T13:16:42.7810010Z             log_level="CRITICAl",
2025-01-14T13:16:42.7810090Z         )
2025-01-14T13:16:42.7810100Z 
2025-01-14T13:16:42.7810230Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7810350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7810420Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7810480Z     simulation.run_convergence()
2025-01-14T13:16:42.7810580Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7810690Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7810780Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7811130Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7811270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7811280Z 
2025-01-14T13:16:42.7813970Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7814190Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7814450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7814900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7815080Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7815230Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7815240Z 
2025-01-14T13:16:42.7815310Z     def initialize_transport_state(
2025-01-14T13:16:42.7815350Z         self,
2025-01-14T13:16:42.7815420Z         simulation_state,
2025-01-14T13:16:42.7815470Z         opacity_state,
2025-01-14T13:16:42.7815520Z         macro_atom_state,
2025-01-14T13:16:42.7815600Z         plasma,
2025-01-14T13:16:42.7815670Z         no_of_packets,
2025-01-14T13:16:42.7815770Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7815850Z         iteration=0,
2025-01-14T13:16:42.7815940Z     ):
2025-01-14T13:16:42.7816070Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7816170Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7816240Z         else:
2025-01-14T13:16:42.7816330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7816380Z     
2025-01-14T13:16:42.7816520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7816610Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7816690Z         )
2025-01-14T13:16:42.7816750Z     
2025-01-14T13:16:42.7817210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7817630Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7818440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7818640Z         else:
2025-01-14T13:16:42.7818930Z             continuum_state = None
2025-01-14T13:16:42.7819260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7820160Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7820580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7820730Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7820860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7820970Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7821070Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7821140Z         ).to_numba(
2025-01-14T13:16:42.7821240Z             macro_atom_state,
2025-01-14T13:16:42.7821340Z             self.line_interaction_type,
2025-01-14T13:16:42.7821420Z         )
2025-01-14T13:16:42.7821960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7822290Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7822380Z         ]
2025-01-14T13:16:42.7822700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7822720Z 
2025-01-14T13:16:42.7822910Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7823170Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data1] _
2025-01-14T13:16:42.7823190Z 
2025-01-14T13:16:42.7823910Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7824290Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7824320Z 
2025-01-14T13:16:42.7824420Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7824860Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7824910Z         """
2025-01-14T13:16:42.7825250Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7825320Z     
2025-01-14T13:16:42.7825390Z         Parameters
2025-01-14T13:16:42.7825460Z         ----------
2025-01-14T13:16:42.7825630Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7825740Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7826960Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7827330Z             Atomic data.
2025-01-14T13:16:42.7827460Z     
2025-01-14T13:16:42.7827530Z         Returns
2025-01-14T13:16:42.7827630Z         -------
2025-01-14T13:16:42.7827760Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7827850Z             Simulation object.
2025-01-14T13:16:42.7827930Z         """
2025-01-14T13:16:42.7828100Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7828320Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7828450Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7828610Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7828770Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7829060Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7829650Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7830420Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7830570Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7830660Z >       sim = run_tardis(
2025-01-14T13:16:42.7830750Z             config_verysimple,
2025-01-14T13:16:42.7830840Z             atom_data=atomic_data,
2025-01-14T13:16:42.7830940Z             show_convergence_plots=False,
2025-01-14T13:16:42.7831030Z             log_level="CRITICAl",
2025-01-14T13:16:42.7831100Z         )
2025-01-14T13:16:42.7831110Z 
2025-01-14T13:16:42.7831460Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7831570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7831650Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7831750Z     simulation.run_convergence()
2025-01-14T13:16:42.7831840Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7831950Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7832020Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7832620Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7833230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7833260Z 
2025-01-14T13:16:42.7833930Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7834440Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7834960Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7835310Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7835500Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7835650Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7835660Z 
2025-01-14T13:16:42.7835720Z     def initialize_transport_state(
2025-01-14T13:16:42.7835780Z         self,
2025-01-14T13:16:42.7835870Z         simulation_state,
2025-01-14T13:16:42.7835950Z         opacity_state,
2025-01-14T13:16:42.7836040Z         macro_atom_state,
2025-01-14T13:16:42.7836100Z         plasma,
2025-01-14T13:16:42.7836150Z         no_of_packets,
2025-01-14T13:16:42.7836210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7836480Z         iteration=0,
2025-01-14T13:16:42.7836530Z     ):
2025-01-14T13:16:42.7836640Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7836740Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7836810Z         else:
2025-01-14T13:16:42.7836890Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7836960Z     
2025-01-14T13:16:42.7837100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7837210Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7837270Z         )
2025-01-14T13:16:42.7837340Z     
2025-01-14T13:16:42.7837470Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7837590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7837750Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7837810Z         else:
2025-01-14T13:16:42.7837880Z             continuum_state = None
2025-01-14T13:16:42.7838130Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7838260Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7838380Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7838490Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7838600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7838700Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7838790Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7838860Z         ).to_numba(
2025-01-14T13:16:42.7838910Z             macro_atom_state,
2025-01-14T13:16:42.7838980Z             self.line_interaction_type,
2025-01-14T13:16:42.7839020Z         )
2025-01-14T13:16:42.7839110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7839400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7839470Z         ]
2025-01-14T13:16:42.7839800Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7839980Z 
2025-01-14T13:16:42.7840130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7840420Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data2] _
2025-01-14T13:16:42.7840440Z 
2025-01-14T13:16:42.7841250Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7841610Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7841620Z 
2025-01-14T13:16:42.7841690Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7841800Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7841850Z         """
2025-01-14T13:16:42.7842800Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7842890Z     
2025-01-14T13:16:42.7842970Z         Parameters
2025-01-14T13:16:42.7843050Z         ----------
2025-01-14T13:16:42.7843200Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7843350Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7843470Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7843560Z             Atomic data.
2025-01-14T13:16:42.7843630Z     
2025-01-14T13:16:42.7843720Z         Returns
2025-01-14T13:16:42.7843800Z         -------
2025-01-14T13:16:42.7843920Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7844020Z             Simulation object.
2025-01-14T13:16:42.7844100Z         """
2025-01-14T13:16:42.7844270Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7844620Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7844760Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7844900Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7845020Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7845190Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7845340Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7845440Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7845550Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7845630Z >       sim = run_tardis(
2025-01-14T13:16:42.7845720Z             config_verysimple,
2025-01-14T13:16:42.7845810Z             atom_data=atomic_data,
2025-01-14T13:16:42.7845920Z             show_convergence_plots=False,
2025-01-14T13:16:42.7846020Z             log_level="CRITICAl",
2025-01-14T13:16:42.7846090Z         )
2025-01-14T13:16:42.7846100Z 
2025-01-14T13:16:42.7846260Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7846380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7846480Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7846580Z     simulation.run_convergence()
2025-01-14T13:16:42.7846700Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7846850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7846960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7847150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7847290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7847300Z 
2025-01-14T13:16:42.7847580Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7847800Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7848060Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7848760Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7848960Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7849100Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7849110Z 
2025-01-14T13:16:42.7849170Z     def initialize_transport_state(
2025-01-14T13:16:42.7849220Z         self,
2025-01-14T13:16:42.7849280Z         simulation_state,
2025-01-14T13:16:42.7849360Z         opacity_state,
2025-01-14T13:16:42.7849460Z         macro_atom_state,
2025-01-14T13:16:42.7849540Z         plasma,
2025-01-14T13:16:42.7849620Z         no_of_packets,
2025-01-14T13:16:42.7849720Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7849800Z         iteration=0,
2025-01-14T13:16:42.7849890Z     ):
2025-01-14T13:16:42.7850010Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7850080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7850140Z         else:
2025-01-14T13:16:42.7850220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7850280Z     
2025-01-14T13:16:42.7850420Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7850520Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7850610Z         )
2025-01-14T13:16:42.7850680Z     
2025-01-14T13:16:42.7850800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7850920Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7851080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7851170Z         else:
2025-01-14T13:16:42.7851240Z             continuum_state = None
2025-01-14T13:16:42.7851360Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7852500Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7853080Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7853630Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7853950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7854460Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7854830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7855070Z         ).to_numba(
2025-01-14T13:16:42.7855460Z             macro_atom_state,
2025-01-14T13:16:42.7855850Z             self.line_interaction_type,
2025-01-14T13:16:42.7855940Z         )
2025-01-14T13:16:42.7856040Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7856510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7856590Z         ]
2025-01-14T13:16:42.7856880Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7856900Z 
2025-01-14T13:16:42.7857020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7857260Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data3] _
2025-01-14T13:16:42.7857270Z 
2025-01-14T13:16:42.7857890Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7858620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7858640Z 
2025-01-14T13:16:42.7858730Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7859050Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7859110Z         """
2025-01-14T13:16:42.7859240Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7859280Z     
2025-01-14T13:16:42.7859350Z         Parameters
2025-01-14T13:16:42.7860240Z         ----------
2025-01-14T13:16:42.7860390Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7860520Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7860650Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7860720Z             Atomic data.
2025-01-14T13:16:42.7860800Z     
2025-01-14T13:16:42.7860860Z         Returns
2025-01-14T13:16:42.7860900Z         -------
2025-01-14T13:16:42.7860980Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7861030Z             Simulation object.
2025-01-14T13:16:42.7861080Z         """
2025-01-14T13:16:42.7861200Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7861350Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7861470Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7865580Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7866060Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7866460Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7866760Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7866980Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7867190Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7867340Z >       sim = run_tardis(
2025-01-14T13:16:42.7867580Z             config_verysimple,
2025-01-14T13:16:42.7867750Z             atom_data=atomic_data,
2025-01-14T13:16:42.7867950Z             show_convergence_plots=False,
2025-01-14T13:16:42.7868110Z             log_level="CRITICAl",
2025-01-14T13:16:42.7868280Z         )
2025-01-14T13:16:42.7868300Z 
2025-01-14T13:16:42.7868850Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7869890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7870120Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7870310Z     simulation.run_convergence()
2025-01-14T13:16:42.7870680Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7870850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7870920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7871040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7871140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7871140Z 
2025-01-14T13:16:42.7871360Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7871530Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7871710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7871960Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7872100Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7872210Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7872220Z 
2025-01-14T13:16:42.7872280Z     def initialize_transport_state(
2025-01-14T13:16:42.7872330Z         self,
2025-01-14T13:16:42.7872380Z         simulation_state,
2025-01-14T13:16:42.7872440Z         opacity_state,
2025-01-14T13:16:42.7872500Z         macro_atom_state,
2025-01-14T13:16:42.7872550Z         plasma,
2025-01-14T13:16:42.7872600Z         no_of_packets,
2025-01-14T13:16:42.7872650Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7872700Z         iteration=0,
2025-01-14T13:16:42.7872750Z     ):
2025-01-14T13:16:42.7872850Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7872920Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7872980Z         else:
2025-01-14T13:16:42.7873250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7873300Z     
2025-01-14T13:16:42.7873410Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7873490Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7873540Z         )
2025-01-14T13:16:42.7873580Z     
2025-01-14T13:16:42.7873680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7873770Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7873910Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7873950Z         else:
2025-01-14T13:16:42.7874010Z             continuum_state = None
2025-01-14T13:16:42.7874090Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7874180Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7874270Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7874360Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7874440Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7874510Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7874580Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7874630Z         ).to_numba(
2025-01-14T13:16:42.7874680Z             macro_atom_state,
2025-01-14T13:16:42.7874740Z             self.line_interaction_type,
2025-01-14T13:16:42.7874790Z         )
2025-01-14T13:16:42.7874860Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7875090Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7875130Z         ]
2025-01-14T13:16:42.7875380Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7875390Z 
2025-01-14T13:16:42.7875630Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7875850Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data4] _
2025-01-14T13:16:42.7875860Z 
2025-01-14T13:16:42.7876430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7876720Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7876730Z 
2025-01-14T13:16:42.7876800Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7876920Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7876960Z         """
2025-01-14T13:16:42.7877100Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7877170Z     
2025-01-14T13:16:42.7877220Z         Parameters
2025-01-14T13:16:42.7877270Z         ----------
2025-01-14T13:16:42.7877390Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7877500Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7877590Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7877640Z             Atomic data.
2025-01-14T13:16:42.7878020Z     
2025-01-14T13:16:42.7878070Z         Returns
2025-01-14T13:16:42.7878120Z         -------
2025-01-14T13:16:42.7878200Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7878260Z             Simulation object.
2025-01-14T13:16:42.7878300Z         """
2025-01-14T13:16:42.7878430Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7878580Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7878660Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7878760Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7878870Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7879120Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7879240Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7879320Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7879400Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7879460Z >       sim = run_tardis(
2025-01-14T13:16:42.7879520Z             config_verysimple,
2025-01-14T13:16:42.7879570Z             atom_data=atomic_data,
2025-01-14T13:16:42.7879640Z             show_convergence_plots=False,
2025-01-14T13:16:42.7879690Z             log_level="CRITICAl",
2025-01-14T13:16:42.7879730Z         )
2025-01-14T13:16:42.7879740Z 
2025-01-14T13:16:42.7879850Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7879950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7889340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7889510Z     simulation.run_convergence()
2025-01-14T13:16:42.7889600Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7889710Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7889780Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7889900Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7889990Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7889990Z 
2025-01-14T13:16:42.7890340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7890500Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7890700Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7891160Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7891290Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7891390Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7891390Z 
2025-01-14T13:16:42.7891450Z     def initialize_transport_state(
2025-01-14T13:16:42.7891500Z         self,
2025-01-14T13:16:42.7891550Z         simulation_state,
2025-01-14T13:16:42.7891600Z         opacity_state,
2025-01-14T13:16:42.7891650Z         macro_atom_state,
2025-01-14T13:16:42.7891700Z         plasma,
2025-01-14T13:16:42.7891740Z         no_of_packets,
2025-01-14T13:16:42.7891800Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7891850Z         iteration=0,
2025-01-14T13:16:42.7891890Z     ):
2025-01-14T13:16:42.7891980Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7892060Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7892110Z         else:
2025-01-14T13:16:42.7892170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7892210Z     
2025-01-14T13:16:42.7892310Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7892390Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7892430Z         )
2025-01-14T13:16:42.7892470Z     
2025-01-14T13:16:42.7892570Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7892660Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7892780Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7892830Z         else:
2025-01-14T13:16:42.7892880Z             continuum_state = None
2025-01-14T13:16:42.7892950Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7893040Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7893100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7893190Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7893610Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7893970Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7894040Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7894090Z         ).to_numba(
2025-01-14T13:16:42.7894140Z             macro_atom_state,
2025-01-14T13:16:42.7894210Z             self.line_interaction_type,
2025-01-14T13:16:42.7894250Z         )
2025-01-14T13:16:42.7894330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7894550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7894600Z         ]
2025-01-14T13:16:42.7894840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7894850Z 
2025-01-14T13:16:42.7894960Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7895180Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data5] _
2025-01-14T13:16:42.7895180Z 
2025-01-14T13:16:42.7897550Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7898640Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7898660Z 
2025-01-14T13:16:42.7898840Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7899150Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7899290Z         """
2025-01-14T13:16:42.7899600Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7899740Z     
2025-01-14T13:16:42.7899890Z         Parameters
2025-01-14T13:16:42.7901580Z         ----------
2025-01-14T13:16:42.7901930Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7902390Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7902650Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7902810Z             Atomic data.
2025-01-14T13:16:42.7902940Z     
2025-01-14T13:16:42.7903210Z         Returns
2025-01-14T13:16:42.7903350Z         -------
2025-01-14T13:16:42.7903570Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7903870Z             Simulation object.
2025-01-14T13:16:42.7904070Z         """
2025-01-14T13:16:42.7904410Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7904790Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7905020Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7905290Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7905590Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7906120Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7906300Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7906380Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7906460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7906510Z >       sim = run_tardis(
2025-01-14T13:16:42.7906560Z             config_verysimple,
2025-01-14T13:16:42.7906620Z             atom_data=atomic_data,
2025-01-14T13:16:42.7906690Z             show_convergence_plots=False,
2025-01-14T13:16:42.7906740Z             log_level="CRITICAl",
2025-01-14T13:16:42.7906790Z         )
2025-01-14T13:16:42.7906790Z 
2025-01-14T13:16:42.7906910Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7907000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7907070Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7907130Z     simulation.run_convergence()
2025-01-14T13:16:42.7907440Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7907540Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7907610Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7907730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7907820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7907830Z 
2025-01-14T13:16:42.7908050Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7908230Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7908400Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7908620Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7908750Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7908860Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7908860Z 
2025-01-14T13:16:42.7908930Z     def initialize_transport_state(
2025-01-14T13:16:42.7908970Z         self,
2025-01-14T13:16:42.7909030Z         simulation_state,
2025-01-14T13:16:42.7909080Z         opacity_state,
2025-01-14T13:16:42.7909130Z         macro_atom_state,
2025-01-14T13:16:42.7909170Z         plasma,
2025-01-14T13:16:42.7909240Z         no_of_packets,
2025-01-14T13:16:42.7909300Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7909350Z         iteration=0,
2025-01-14T13:16:42.7909390Z     ):
2025-01-14T13:16:42.7909590Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7909680Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7909730Z         else:
2025-01-14T13:16:42.7909780Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7909950Z     
2025-01-14T13:16:42.7910070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7910140Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7910190Z         )
2025-01-14T13:16:42.7910230Z     
2025-01-14T13:16:42.7910330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7910410Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7910540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7910590Z         else:
2025-01-14T13:16:42.7910650Z             continuum_state = None
2025-01-14T13:16:42.7910720Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7910810Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7910870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7910950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7911040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7911110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7911180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7911220Z         ).to_numba(
2025-01-14T13:16:42.7911280Z             macro_atom_state,
2025-01-14T13:16:42.7911340Z             self.line_interaction_type,
2025-01-14T13:16:42.7911390Z         )
2025-01-14T13:16:42.7911460Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7911680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7911730Z         ]
2025-01-14T13:16:42.7911980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7911980Z 
2025-01-14T13:16:42.7912090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7912300Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data6] _
2025-01-14T13:16:42.7912310Z 
2025-01-14T13:16:42.7913030Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7913420Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7913430Z 
2025-01-14T13:16:42.7913490Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7913600Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7913650Z         """
2025-01-14T13:16:42.7913760Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7913820Z     
2025-01-14T13:16:42.7913870Z         Parameters
2025-01-14T13:16:42.7913910Z         ----------
2025-01-14T13:16:42.7914030Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7914130Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7914230Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7914270Z             Atomic data.
2025-01-14T13:16:42.7914320Z     
2025-01-14T13:16:42.7914360Z         Returns
2025-01-14T13:16:42.7914410Z         -------
2025-01-14T13:16:42.7914480Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7914670Z             Simulation object.
2025-01-14T13:16:42.7914720Z         """
2025-01-14T13:16:42.7914840Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7914970Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7915060Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7915160Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7915260Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7915480Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7915580Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7915660Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7915720Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7915780Z >       sim = run_tardis(
2025-01-14T13:16:42.7915840Z             config_verysimple,
2025-01-14T13:16:42.7915900Z             atom_data=atomic_data,
2025-01-14T13:16:42.7915960Z             show_convergence_plots=False,
2025-01-14T13:16:42.7916020Z             log_level="CRITICAl",
2025-01-14T13:16:42.7916060Z         )
2025-01-14T13:16:42.7916060Z 
2025-01-14T13:16:42.7916170Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7916270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7916330Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7916400Z     simulation.run_convergence()
2025-01-14T13:16:42.7916480Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7916600Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7916670Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7916790Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7916880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7916890Z 
2025-01-14T13:16:42.7917280Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7917450Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7917620Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7917840Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7917960Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7918080Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7918220Z 
2025-01-14T13:16:42.7918290Z     def initialize_transport_state(
2025-01-14T13:16:42.7918330Z         self,
2025-01-14T13:16:42.7918390Z         simulation_state,
2025-01-14T13:16:42.7918430Z         opacity_state,
2025-01-14T13:16:42.7918480Z         macro_atom_state,
2025-01-14T13:16:42.7918530Z         plasma,
2025-01-14T13:16:42.7918570Z         no_of_packets,
2025-01-14T13:16:42.7918630Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7919090Z         iteration=0,
2025-01-14T13:16:42.7919480Z     ):
2025-01-14T13:16:42.7919790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7920000Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7920140Z         else:
2025-01-14T13:16:42.7920330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7920490Z     
2025-01-14T13:16:42.7920820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7921030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7921180Z         )
2025-01-14T13:16:42.7921320Z     
2025-01-14T13:16:42.7921620Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7921880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7922210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7922360Z         else:
2025-01-14T13:16:42.7922540Z             continuum_state = None
2025-01-14T13:16:42.7922790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7923020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7923220Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7923450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7923650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7925130Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7925260Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7925330Z         ).to_numba(
2025-01-14T13:16:42.7925380Z             macro_atom_state,
2025-01-14T13:16:42.7925450Z             self.line_interaction_type,
2025-01-14T13:16:42.7925490Z         )
2025-01-14T13:16:42.7925580Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7925800Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7925850Z         ]
2025-01-14T13:16:42.7926090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7926100Z 
2025-01-14T13:16:42.7926220Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7926440Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data7] _
2025-01-14T13:16:42.7926460Z 
2025-01-14T13:16:42.7927020Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7927310Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7927320Z 
2025-01-14T13:16:42.7927390Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7927500Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7927550Z         """
2025-01-14T13:16:42.7927670Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7927710Z     
2025-01-14T13:16:42.7927760Z         Parameters
2025-01-14T13:16:42.7927820Z         ----------
2025-01-14T13:16:42.7927930Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7928040Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7928120Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7928590Z             Atomic data.
2025-01-14T13:16:42.7928630Z     
2025-01-14T13:16:42.7928680Z         Returns
2025-01-14T13:16:42.7928730Z         -------
2025-01-14T13:16:42.7928810Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7928870Z             Simulation object.
2025-01-14T13:16:42.7928910Z         """
2025-01-14T13:16:42.7929030Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7929170Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7929260Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7929360Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7929480Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7929620Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7929730Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7929810Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7929880Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7929920Z >       sim = run_tardis(
2025-01-14T13:16:42.7929980Z             config_verysimple,
2025-01-14T13:16:42.7930030Z             atom_data=atomic_data,
2025-01-14T13:16:42.7930100Z             show_convergence_plots=False,
2025-01-14T13:16:42.7930150Z             log_level="CRITICAl",
2025-01-14T13:16:42.7930200Z         )
2025-01-14T13:16:42.7930200Z 
2025-01-14T13:16:42.7930310Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7930390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7930460Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7930520Z     simulation.run_convergence()
2025-01-14T13:16:42.7930600Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7930960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7931040Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7931160Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7931260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7931260Z 
2025-01-14T13:16:42.7931470Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7931630Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7931820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7932030Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7932160Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7932270Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7932270Z 
2025-01-14T13:16:42.7932340Z     def initialize_transport_state(
2025-01-14T13:16:42.7932520Z         self,
2025-01-14T13:16:42.7932580Z         simulation_state,
2025-01-14T13:16:42.7932630Z         opacity_state,
2025-01-14T13:16:42.7932680Z         macro_atom_state,
2025-01-14T13:16:42.7932720Z         plasma,
2025-01-14T13:16:42.7932780Z         no_of_packets,
2025-01-14T13:16:42.7932830Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7932880Z         iteration=0,
2025-01-14T13:16:42.7932930Z     ):
2025-01-14T13:16:42.7933020Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7933100Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7933140Z         else:
2025-01-14T13:16:42.7933200Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7933240Z     
2025-01-14T13:16:42.7933350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7933420Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7933470Z         )
2025-01-14T13:16:42.7933510Z     
2025-01-14T13:16:42.7933820Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7933900Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7934030Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7934070Z         else:
2025-01-14T13:16:42.7934130Z             continuum_state = None
2025-01-14T13:16:42.7934210Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7934290Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7934360Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7934440Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7934520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7934580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7934650Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7934700Z         ).to_numba(
2025-01-14T13:16:42.7934760Z             macro_atom_state,
2025-01-14T13:16:42.7934820Z             self.line_interaction_type,
2025-01-14T13:16:42.7934860Z         )
2025-01-14T13:16:42.7934940Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7935160Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7935210Z         ]
2025-01-14T13:16:42.7935450Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7935460Z 
2025-01-14T13:16:42.7935580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7935790Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data8] _
2025-01-14T13:16:42.7935800Z 
2025-01-14T13:16:42.7936330Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7936680Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7936690Z 
2025-01-14T13:16:42.7936750Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7936860Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7936900Z         """
2025-01-14T13:16:42.7937020Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7937060Z     
2025-01-14T13:16:42.7937110Z         Parameters
2025-01-14T13:16:42.7937160Z         ----------
2025-01-14T13:16:42.7937280Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7937380Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7937470Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7937520Z             Atomic data.
2025-01-14T13:16:42.7937570Z     
2025-01-14T13:16:42.7937610Z         Returns
2025-01-14T13:16:42.7937660Z         -------
2025-01-14T13:16:42.7937740Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7937910Z             Simulation object.
2025-01-14T13:16:42.7937960Z         """
2025-01-14T13:16:42.7938080Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7938220Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7938300Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7938400Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7938500Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7938680Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7938820Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7938900Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7939110Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7939170Z >       sim = run_tardis(
2025-01-14T13:16:42.7939220Z             config_verysimple,
2025-01-14T13:16:42.7939280Z             atom_data=atomic_data,
2025-01-14T13:16:42.7939340Z             show_convergence_plots=False,
2025-01-14T13:16:42.7939400Z             log_level="CRITICAl",
2025-01-14T13:16:42.7939440Z         )
2025-01-14T13:16:42.7939440Z 
2025-01-14T13:16:42.7939550Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7939640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7939720Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7939790Z     simulation.run_convergence()
2025-01-14T13:16:42.7939870Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7939990Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7940060Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7940190Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7940270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7940280Z 
2025-01-14T13:16:42.7940480Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7940640Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7940820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7941040Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7941160Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7941270Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7941360Z 
2025-01-14T13:16:42.7941440Z     def initialize_transport_state(
2025-01-14T13:16:42.7941480Z         self,
2025-01-14T13:16:42.7941540Z         simulation_state,
2025-01-14T13:16:42.7941600Z         opacity_state,
2025-01-14T13:16:42.7941650Z         macro_atom_state,
2025-01-14T13:16:42.7941690Z         plasma,
2025-01-14T13:16:42.7941740Z         no_of_packets,
2025-01-14T13:16:42.7941810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7941850Z         iteration=0,
2025-01-14T13:16:42.7941900Z     ):
2025-01-14T13:16:42.7941990Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7942060Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7942100Z         else:
2025-01-14T13:16:42.7942160Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7942200Z     
2025-01-14T13:16:42.7942320Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7942400Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7942450Z         )
2025-01-14T13:16:42.7942490Z     
2025-01-14T13:16:42.7942590Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7942690Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7942810Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7942850Z         else:
2025-01-14T13:16:42.7942910Z             continuum_state = None
2025-01-14T13:16:42.7942980Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7943070Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7943140Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7943220Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7943290Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7943360Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7943430Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7943480Z         ).to_numba(
2025-01-14T13:16:42.7943530Z             macro_atom_state,
2025-01-14T13:16:42.7943590Z             self.line_interaction_type,
2025-01-14T13:16:42.7943720Z         )
2025-01-14T13:16:42.7943810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7944030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7944080Z         ]
2025-01-14T13:16:42.7944330Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7944330Z 
2025-01-14T13:16:42.7944450Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7944670Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data9] _
2025-01-14T13:16:42.7944670Z 
2025-01-14T13:16:42.7945210Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7945500Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7945510Z 
2025-01-14T13:16:42.7945570Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7945850Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7945910Z         """
2025-01-14T13:16:42.7946020Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7946070Z     
2025-01-14T13:16:42.7946120Z         Parameters
2025-01-14T13:16:42.7946170Z         ----------
2025-01-14T13:16:42.7946280Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7946380Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7946470Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7946620Z             Atomic data.
2025-01-14T13:16:42.7946670Z     
2025-01-14T13:16:42.7946710Z         Returns
2025-01-14T13:16:42.7946760Z         -------
2025-01-14T13:16:42.7946840Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7946900Z             Simulation object.
2025-01-14T13:16:42.7946940Z         """
2025-01-14T13:16:42.7947060Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7947200Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7947290Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7947380Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7947490Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7947620Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7947740Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7947810Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7947890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7947940Z >       sim = run_tardis(
2025-01-14T13:16:42.7948000Z             config_verysimple,
2025-01-14T13:16:42.7948060Z             atom_data=atomic_data,
2025-01-14T13:16:42.7948120Z             show_convergence_plots=False,
2025-01-14T13:16:42.7948180Z             log_level="CRITICAl",
2025-01-14T13:16:42.7948220Z         )
2025-01-14T13:16:42.7948220Z 
2025-01-14T13:16:42.7948330Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7948420Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7948480Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7948540Z     simulation.run_convergence()
2025-01-14T13:16:42.7948630Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7948740Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7948820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7948930Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7949570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7949570Z 
2025-01-14T13:16:42.7949800Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7949970Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7950140Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7950360Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7950480Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7950590Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7950590Z 
2025-01-14T13:16:42.7950650Z     def initialize_transport_state(
2025-01-14T13:16:42.7950700Z         self,
2025-01-14T13:16:42.7950760Z         simulation_state,
2025-01-14T13:16:42.7950810Z         opacity_state,
2025-01-14T13:16:42.7950860Z         macro_atom_state,
2025-01-14T13:16:42.7950910Z         plasma,
2025-01-14T13:16:42.7950960Z         no_of_packets,
2025-01-14T13:16:42.7951010Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7951060Z         iteration=0,
2025-01-14T13:16:42.7951100Z     ):
2025-01-14T13:16:42.7951200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7951270Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7951310Z         else:
2025-01-14T13:16:42.7951370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7951410Z     
2025-01-14T13:16:42.7951510Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7951580Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7951640Z         )
2025-01-14T13:16:42.7951680Z     
2025-01-14T13:16:42.7952130Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7952220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7952350Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7952400Z         else:
2025-01-14T13:16:42.7952450Z             continuum_state = None
2025-01-14T13:16:42.7952540Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7952620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7952690Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7952760Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7952840Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7952910Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7952980Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7953020Z         ).to_numba(
2025-01-14T13:16:42.7953080Z             macro_atom_state,
2025-01-14T13:16:42.7953290Z             self.line_interaction_type,
2025-01-14T13:16:42.7958350Z         )
2025-01-14T13:16:42.7958480Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7958860Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7958930Z         ]
2025-01-14T13:16:42.7959190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7959200Z 
2025-01-14T13:16:42.7959320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7959540Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data10] _
2025-01-14T13:16:42.7959540Z 
2025-01-14T13:16:42.7960100Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7960390Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7960670Z 
2025-01-14T13:16:42.7960730Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7960850Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7960900Z         """
2025-01-14T13:16:42.7961020Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7961060Z     
2025-01-14T13:16:42.7961110Z         Parameters
2025-01-14T13:16:42.7961160Z         ----------
2025-01-14T13:16:42.7961760Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7962410Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7962670Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7962830Z             Atomic data.
2025-01-14T13:16:42.7963000Z     
2025-01-14T13:16:42.7963150Z         Returns
2025-01-14T13:16:42.7963290Z         -------
2025-01-14T13:16:42.7963520Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7963700Z             Simulation object.
2025-01-14T13:16:42.7963850Z         """
2025-01-14T13:16:42.7964170Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7964570Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7964950Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7965050Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7965150Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7965300Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7965410Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7965490Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7965710Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7965770Z >       sim = run_tardis(
2025-01-14T13:16:42.7965840Z             config_verysimple,
2025-01-14T13:16:42.7965910Z             atom_data=atomic_data,
2025-01-14T13:16:42.7965970Z             show_convergence_plots=False,
2025-01-14T13:16:42.7966030Z             log_level="CRITICAl",
2025-01-14T13:16:42.7966070Z         )
2025-01-14T13:16:42.7966080Z 
2025-01-14T13:16:42.7966190Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7966280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7966340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7966410Z     simulation.run_convergence()
2025-01-14T13:16:42.7966490Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7966610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7966680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7966810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7966900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7966910Z 
2025-01-14T13:16:42.7967120Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7967280Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7967460Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7967680Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7967800Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7967910Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7967920Z 
2025-01-14T13:16:42.7967980Z     def initialize_transport_state(
2025-01-14T13:16:42.7968020Z         self,
2025-01-14T13:16:42.7968080Z         simulation_state,
2025-01-14T13:16:42.7968130Z         opacity_state,
2025-01-14T13:16:42.7968180Z         macro_atom_state,
2025-01-14T13:16:42.7968290Z         plasma,
2025-01-14T13:16:42.7968340Z         no_of_packets,
2025-01-14T13:16:42.7968400Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7968450Z         iteration=0,
2025-01-14T13:16:42.7968490Z     ):
2025-01-14T13:16:42.7968600Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7968670Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7968720Z         else:
2025-01-14T13:16:42.7968770Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7968820Z     
2025-01-14T13:16:42.7968920Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7968990Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7969040Z         )
2025-01-14T13:16:42.7969080Z     
2025-01-14T13:16:42.7969180Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7969270Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7969390Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7969440Z         else:
2025-01-14T13:16:42.7969500Z             continuum_state = None
2025-01-14T13:16:42.7969570Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7969660Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7969720Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7969800Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7969870Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7969950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7970010Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7970060Z         ).to_numba(
2025-01-14T13:16:42.7970110Z             macro_atom_state,
2025-01-14T13:16:42.7970170Z             self.line_interaction_type,
2025-01-14T13:16:42.7970270Z         )
2025-01-14T13:16:42.7970350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7970580Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7970630Z         ]
2025-01-14T13:16:42.7970900Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7970900Z 
2025-01-14T13:16:42.7971020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7971470Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data11] _
2025-01-14T13:16:42.7971480Z 
2025-01-14T13:16:42.7972020Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7972330Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7972350Z 
2025-01-14T13:16:42.7972430Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7972540Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7972580Z         """
2025-01-14T13:16:42.7972700Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7972750Z     
2025-01-14T13:16:42.7972790Z         Parameters
2025-01-14T13:16:42.7972850Z         ----------
2025-01-14T13:16:42.7972970Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7973070Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7973170Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7973230Z             Atomic data.
2025-01-14T13:16:42.7973270Z     
2025-01-14T13:16:42.7973310Z         Returns
2025-01-14T13:16:42.7973380Z         -------
2025-01-14T13:16:42.7973470Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7973520Z             Simulation object.
2025-01-14T13:16:42.7973770Z         """
2025-01-14T13:16:42.7973900Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7974030Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7974120Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7974210Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7974330Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7974460Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7974580Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7974660Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7974730Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7974780Z >       sim = run_tardis(
2025-01-14T13:16:42.7974840Z             config_verysimple,
2025-01-14T13:16:42.7974900Z             atom_data=atomic_data,
2025-01-14T13:16:42.7974960Z             show_convergence_plots=False,
2025-01-14T13:16:42.7975020Z             log_level="CRITICAl",
2025-01-14T13:16:42.7975060Z         )
2025-01-14T13:16:42.7975060Z 
2025-01-14T13:16:42.7975170Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7975270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7975340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7975400Z     simulation.run_convergence()
2025-01-14T13:16:42.7975490Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7975600Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7975660Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.7975790Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.7975960Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7975970Z 
2025-01-14T13:16:42.7976170Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.7976330Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.7979510Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.7980220Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.7980560Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.7980860Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.7980880Z 
2025-01-14T13:16:42.7981060Z     def initialize_transport_state(
2025-01-14T13:16:42.7981210Z         self,
2025-01-14T13:16:42.7981370Z         simulation_state,
2025-01-14T13:16:42.7981530Z         opacity_state,
2025-01-14T13:16:42.7981720Z         macro_atom_state,
2025-01-14T13:16:42.7981880Z         plasma,
2025-01-14T13:16:42.7982020Z         no_of_packets,
2025-01-14T13:16:42.7982210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.7982360Z         iteration=0,
2025-01-14T13:16:42.7982510Z     ):
2025-01-14T13:16:42.7982770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.7982980Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.7983120Z         else:
2025-01-14T13:16:42.7983290Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.7983420Z     
2025-01-14T13:16:42.7983710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.7983920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.7984060Z         )
2025-01-14T13:16:42.7984200Z     
2025-01-14T13:16:42.7984480Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.7984730Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.7985070Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.7985220Z         else:
2025-01-14T13:16:42.7986560Z             continuum_state = None
2025-01-14T13:16:42.7986780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.7987010Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.7987210Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.7987420Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.7987630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.7987830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.7988030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.7988180Z         ).to_numba(
2025-01-14T13:16:42.7988340Z             macro_atom_state,
2025-01-14T13:16:42.7988530Z             self.line_interaction_type,
2025-01-14T13:16:42.7988660Z         )
2025-01-14T13:16:42.7988890Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.7993150Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.7993420Z         ]
2025-01-14T13:16:42.7994180Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.7994190Z 
2025-01-14T13:16:42.7994520Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.7995160Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data12] _
2025-01-14T13:16:42.7995200Z 
2025-01-14T13:16:42.7995780Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.7996090Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.7996650Z 
2025-01-14T13:16:42.7996730Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.7996850Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.7996900Z         """
2025-01-14T13:16:42.7997020Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.7997070Z     
2025-01-14T13:16:42.7997120Z         Parameters
2025-01-14T13:16:42.7997170Z         ----------
2025-01-14T13:16:42.7997290Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.7997390Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.7997470Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.7997530Z             Atomic data.
2025-01-14T13:16:42.7997570Z     
2025-01-14T13:16:42.7997610Z         Returns
2025-01-14T13:16:42.7997660Z         -------
2025-01-14T13:16:42.7997740Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.7997800Z             Simulation object.
2025-01-14T13:16:42.7997850Z         """
2025-01-14T13:16:42.7997970Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.7998120Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.7998200Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.7998300Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.7998410Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.7998550Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.7998660Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.7998740Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.7998820Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.7998870Z >       sim = run_tardis(
2025-01-14T13:16:42.7998930Z             config_verysimple,
2025-01-14T13:16:42.7998990Z             atom_data=atomic_data,
2025-01-14T13:16:42.7999060Z             show_convergence_plots=False,
2025-01-14T13:16:42.7999250Z             log_level="CRITICAl",
2025-01-14T13:16:42.7999300Z         )
2025-01-14T13:16:42.7999300Z 
2025-01-14T13:16:42.7999410Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.7999510Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.7999570Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.7999630Z     simulation.run_convergence()
2025-01-14T13:16:42.7999720Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.7999830Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.7999910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8000210Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8000310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8000310Z 
2025-01-14T13:16:42.8000520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8000690Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8000870Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8001100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8001240Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8001340Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8001350Z 
2025-01-14T13:16:42.8001410Z     def initialize_transport_state(
2025-01-14T13:16:42.8001460Z         self,
2025-01-14T13:16:42.8001510Z         simulation_state,
2025-01-14T13:16:42.8001560Z         opacity_state,
2025-01-14T13:16:42.8001610Z         macro_atom_state,
2025-01-14T13:16:42.8001790Z         plasma,
2025-01-14T13:16:42.8001840Z         no_of_packets,
2025-01-14T13:16:42.8001900Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8001950Z         iteration=0,
2025-01-14T13:16:42.8001990Z     ):
2025-01-14T13:16:42.8002090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8002160Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8002210Z         else:
2025-01-14T13:16:42.8002270Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8002310Z     
2025-01-14T13:16:42.8002420Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8002490Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8002540Z         )
2025-01-14T13:16:42.8002580Z     
2025-01-14T13:16:42.8002680Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8002760Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8002890Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8002940Z         else:
2025-01-14T13:16:42.8003000Z             continuum_state = None
2025-01-14T13:16:42.8003080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8003170Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8003240Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8003320Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8003390Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8003460Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8003530Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8003570Z         ).to_numba(
2025-01-14T13:16:42.8003630Z             macro_atom_state,
2025-01-14T13:16:42.8003690Z             self.line_interaction_type,
2025-01-14T13:16:42.8003730Z         )
2025-01-14T13:16:42.8003810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8004030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8004080Z         ]
2025-01-14T13:16:42.8004410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8004420Z 
2025-01-14T13:16:42.8004530Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8004760Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data13] _
2025-01-14T13:16:42.8004760Z 
2025-01-14T13:16:42.8005320Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8005600Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8005610Z 
2025-01-14T13:16:42.8005680Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8005790Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8005840Z         """
2025-01-14T13:16:42.8005950Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8006000Z     
2025-01-14T13:16:42.8006050Z         Parameters
2025-01-14T13:16:42.8006100Z         ----------
2025-01-14T13:16:42.8006210Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8006450Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8006560Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8006610Z             Atomic data.
2025-01-14T13:16:42.8006650Z     
2025-01-14T13:16:42.8006690Z         Returns
2025-01-14T13:16:42.8006740Z         -------
2025-01-14T13:16:42.8006820Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8006890Z             Simulation object.
2025-01-14T13:16:42.8007080Z         """
2025-01-14T13:16:42.8007200Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8007340Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8007440Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8007530Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8007630Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8007780Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8007880Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8007950Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8008020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8008080Z >       sim = run_tardis(
2025-01-14T13:16:42.8008140Z             config_verysimple,
2025-01-14T13:16:42.8008190Z             atom_data=atomic_data,
2025-01-14T13:16:42.8008260Z             show_convergence_plots=False,
2025-01-14T13:16:42.8008320Z             log_level="CRITICAl",
2025-01-14T13:16:42.8008370Z         )
2025-01-14T13:16:42.8008370Z 
2025-01-14T13:16:42.8008500Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8008590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8008650Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8008720Z     simulation.run_convergence()
2025-01-14T13:16:42.8008800Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8008920Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8008980Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8009110Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8009200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8009210Z 
2025-01-14T13:16:42.8009440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8009600Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8009880Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8010100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8010220Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8010330Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8010330Z 
2025-01-14T13:16:42.8010390Z     def initialize_transport_state(
2025-01-14T13:16:42.8010440Z         self,
2025-01-14T13:16:42.8010490Z         simulation_state,
2025-01-14T13:16:42.8010540Z         opacity_state,
2025-01-14T13:16:42.8010590Z         macro_atom_state,
2025-01-14T13:16:42.8010640Z         plasma,
2025-01-14T13:16:42.8010690Z         no_of_packets,
2025-01-14T13:16:42.8010750Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8010800Z         iteration=0,
2025-01-14T13:16:42.8010840Z     ):
2025-01-14T13:16:42.8010930Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8011010Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8011060Z         else:
2025-01-14T13:16:42.8011110Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8011150Z     
2025-01-14T13:16:42.8011250Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8011330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8011370Z         )
2025-01-14T13:16:42.8011410Z     
2025-01-14T13:16:42.8011520Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8011610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8011730Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8011780Z         else:
2025-01-14T13:16:42.8011900Z             continuum_state = None
2025-01-14T13:16:42.8011980Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8012060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8012130Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8012210Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8012290Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8012350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8012420Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8012470Z         ).to_numba(
2025-01-14T13:16:42.8012520Z             macro_atom_state,
2025-01-14T13:16:42.8012580Z             self.line_interaction_type,
2025-01-14T13:16:42.8012630Z         )
2025-01-14T13:16:42.8012700Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8012920Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8012980Z         ]
2025-01-14T13:16:42.8013220Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8013230Z 
2025-01-14T13:16:42.8013350Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8013570Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data14] _
2025-01-14T13:16:42.8013860Z 
2025-01-14T13:16:42.8014430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8014750Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8014760Z 
2025-01-14T13:16:42.8014830Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8014950Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8014990Z         """
2025-01-14T13:16:42.8015500Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8015540Z     
2025-01-14T13:16:42.8015590Z         Parameters
2025-01-14T13:16:42.8015640Z         ----------
2025-01-14T13:16:42.8015750Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8015860Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8015950Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8016010Z             Atomic data.
2025-01-14T13:16:42.8016060Z     
2025-01-14T13:16:42.8016110Z         Returns
2025-01-14T13:16:42.8016150Z         -------
2025-01-14T13:16:42.8016240Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8016290Z             Simulation object.
2025-01-14T13:16:42.8016330Z         """
2025-01-14T13:16:42.8016450Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8016610Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8016700Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8016790Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8016900Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8017030Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8017150Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8017220Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8017290Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8017350Z >       sim = run_tardis(
2025-01-14T13:16:42.8017400Z             config_verysimple,
2025-01-14T13:16:42.8017460Z             atom_data=atomic_data,
2025-01-14T13:16:42.8017530Z             show_convergence_plots=False,
2025-01-14T13:16:42.8017900Z             log_level="CRITICAl",
2025-01-14T13:16:42.8017940Z         )
2025-01-14T13:16:42.8017950Z 
2025-01-14T13:16:42.8018060Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8018150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8018220Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8018280Z     simulation.run_convergence()
2025-01-14T13:16:42.8018360Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8018470Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8018540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8018670Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8018760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8018760Z 
2025-01-14T13:16:42.8018970Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8019150Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8019330Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8019550Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8019670Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8019780Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8019780Z 
2025-01-14T13:16:42.8019850Z     def initialize_transport_state(
2025-01-14T13:16:42.8019890Z         self,
2025-01-14T13:16:42.8019950Z         simulation_state,
2025-01-14T13:16:42.8020000Z         opacity_state,
2025-01-14T13:16:42.8020060Z         macro_atom_state,
2025-01-14T13:16:42.8020100Z         plasma,
2025-01-14T13:16:42.8020150Z         no_of_packets,
2025-01-14T13:16:42.8020210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8020260Z         iteration=0,
2025-01-14T13:16:42.8020300Z     ):
2025-01-14T13:16:42.8020400Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8020580Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8020620Z         else:
2025-01-14T13:16:42.8020680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8020710Z     
2025-01-14T13:16:42.8020820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8020890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8020940Z         )
2025-01-14T13:16:42.8020980Z     
2025-01-14T13:16:42.8021080Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8021170Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8021470Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8021520Z         else:
2025-01-14T13:16:42.8021580Z             continuum_state = None
2025-01-14T13:16:42.8021660Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8021750Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8021820Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8021900Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8021980Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8022040Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8022110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8022160Z         ).to_numba(
2025-01-14T13:16:42.8022220Z             macro_atom_state,
2025-01-14T13:16:42.8022280Z             self.line_interaction_type,
2025-01-14T13:16:42.8022320Z         )
2025-01-14T13:16:42.8022390Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8022620Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8022660Z         ]
2025-01-14T13:16:42.8023040Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8023050Z 
2025-01-14T13:16:42.8023160Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8023380Z _ ERROR at setup of TestSDECPlotter.test_calculate_plotting_data[plotter_calculate_plotting_data15] _
2025-01-14T13:16:42.8023380Z 
2025-01-14T13:16:42.8023920Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8024210Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8024210Z 
2025-01-14T13:16:42.8024280Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8024390Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8024440Z         """
2025-01-14T13:16:42.8024560Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8024610Z     
2025-01-14T13:16:42.8024660Z         Parameters
2025-01-14T13:16:42.8024710Z         ----------
2025-01-14T13:16:42.8024820Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8024910Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8025010Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8025060Z             Atomic data.
2025-01-14T13:16:42.8025100Z     
2025-01-14T13:16:42.8025150Z         Returns
2025-01-14T13:16:42.8025200Z         -------
2025-01-14T13:16:42.8025270Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8025330Z             Simulation object.
2025-01-14T13:16:42.8025370Z         """
2025-01-14T13:16:42.8025490Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8025640Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8025720Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8025890Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8026000Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8026140Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8026260Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8026330Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8026400Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8026450Z >       sim = run_tardis(
2025-01-14T13:16:42.8026500Z             config_verysimple,
2025-01-14T13:16:42.8026570Z             atom_data=atomic_data,
2025-01-14T13:16:42.8026630Z             show_convergence_plots=False,
2025-01-14T13:16:42.8026690Z             log_level="CRITICAl",
2025-01-14T13:16:42.8026730Z         )
2025-01-14T13:16:42.8026740Z 
2025-01-14T13:16:42.8026840Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8026940Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8027000Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8027060Z     simulation.run_convergence()
2025-01-14T13:16:42.8027150Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8027260Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8033150Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8033350Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8033450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8033450Z 
2025-01-14T13:16:42.8033670Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8033830Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8034250Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8034480Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8034600Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8034720Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8034720Z 
2025-01-14T13:16:42.8034780Z     def initialize_transport_state(
2025-01-14T13:16:42.8034830Z         self,
2025-01-14T13:16:42.8034880Z         simulation_state,
2025-01-14T13:16:42.8034930Z         opacity_state,
2025-01-14T13:16:42.8034980Z         macro_atom_state,
2025-01-14T13:16:42.8035030Z         plasma,
2025-01-14T13:16:42.8035070Z         no_of_packets,
2025-01-14T13:16:42.8035130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8035190Z         iteration=0,
2025-01-14T13:16:42.8035230Z     ):
2025-01-14T13:16:42.8035330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8035400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8035450Z         else:
2025-01-14T13:16:42.8035510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8035560Z     
2025-01-14T13:16:42.8035660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8035740Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8035780Z         )
2025-01-14T13:16:42.8035830Z     
2025-01-14T13:16:42.8036050Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8036150Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8036280Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8036320Z         else:
2025-01-14T13:16:42.8036380Z             continuum_state = None
2025-01-14T13:16:42.8036450Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8036550Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8036620Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8036820Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8036900Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8036970Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8037030Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8037090Z         ).to_numba(
2025-01-14T13:16:42.8037140Z             macro_atom_state,
2025-01-14T13:16:42.8037200Z             self.line_interaction_type,
2025-01-14T13:16:42.8037250Z         )
2025-01-14T13:16:42.8037320Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8038350Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8038710Z         ]
2025-01-14T13:16:42.8039410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8039460Z 
2025-01-14T13:16:42.8039810Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8040540Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply0] _
2025-01-14T13:16:42.8040570Z 
2025-01-14T13:16:42.8043040Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8044230Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8044240Z 
2025-01-14T13:16:42.8044450Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8044760Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8044920Z         """
2025-01-14T13:16:42.8045240Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8046140Z     
2025-01-14T13:16:42.8046290Z         Parameters
2025-01-14T13:16:42.8046470Z         ----------
2025-01-14T13:16:42.8046960Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8047350Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8047640Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8047810Z             Atomic data.
2025-01-14T13:16:42.8047940Z     
2025-01-14T13:16:42.8048090Z         Returns
2025-01-14T13:16:42.8048230Z         -------
2025-01-14T13:16:42.8048450Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8048620Z             Simulation object.
2025-01-14T13:16:42.8048770Z         """
2025-01-14T13:16:42.8049100Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8049490Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8049760Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8050020Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8050320Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8050690Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8051190Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8051460Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8051670Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8051830Z >       sim = run_tardis(
2025-01-14T13:16:42.8052000Z             config_verysimple,
2025-01-14T13:16:42.8052170Z             atom_data=atomic_data,
2025-01-14T13:16:42.8052380Z             show_convergence_plots=False,
2025-01-14T13:16:42.8052550Z             log_level="CRITICAl",
2025-01-14T13:16:42.8053300Z         )
2025-01-14T13:16:42.8053320Z 
2025-01-14T13:16:42.8053650Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8054200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8057340Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8057410Z     simulation.run_convergence()
2025-01-14T13:16:42.8057520Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8057630Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8057710Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8057830Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8057930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8057940Z 
2025-01-14T13:16:42.8058150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8058320Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8058500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8058740Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8058870Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8058980Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8058980Z 
2025-01-14T13:16:42.8059050Z     def initialize_transport_state(
2025-01-14T13:16:42.8059100Z         self,
2025-01-14T13:16:42.8059150Z         simulation_state,
2025-01-14T13:16:42.8059200Z         opacity_state,
2025-01-14T13:16:42.8059260Z         macro_atom_state,
2025-01-14T13:16:42.8059300Z         plasma,
2025-01-14T13:16:42.8059350Z         no_of_packets,
2025-01-14T13:16:42.8059410Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8059460Z         iteration=0,
2025-01-14T13:16:42.8059500Z     ):
2025-01-14T13:16:42.8059600Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8060070Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8060130Z         else:
2025-01-14T13:16:42.8060180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8060230Z     
2025-01-14T13:16:42.8060350Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8060420Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8060460Z         )
2025-01-14T13:16:42.8060500Z     
2025-01-14T13:16:42.8060620Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8060700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8060840Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8060890Z         else:
2025-01-14T13:16:42.8060950Z             continuum_state = None
2025-01-14T13:16:42.8061030Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8061110Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8061180Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8061260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8061350Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8061420Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8061490Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8061530Z         ).to_numba(
2025-01-14T13:16:42.8061590Z             macro_atom_state,
2025-01-14T13:16:42.8061660Z             self.line_interaction_type,
2025-01-14T13:16:42.8061700Z         )
2025-01-14T13:16:42.8061780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8062000Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8062050Z         ]
2025-01-14T13:16:42.8062300Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8062300Z 
2025-01-14T13:16:42.8062420Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8062600Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply1] _
2025-01-14T13:16:42.8062730Z 
2025-01-14T13:16:42.8063290Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8063570Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8063570Z 
2025-01-14T13:16:42.8063640Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8063760Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8063800Z         """
2025-01-14T13:16:42.8063920Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8063960Z     
2025-01-14T13:16:42.8064020Z         Parameters
2025-01-14T13:16:42.8064080Z         ----------
2025-01-14T13:16:42.8064190Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8064290Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8064380Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8064430Z             Atomic data.
2025-01-14T13:16:42.8064610Z     
2025-01-14T13:16:42.8064690Z         Returns
2025-01-14T13:16:42.8064750Z         -------
2025-01-14T13:16:42.8064830Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8064880Z             Simulation object.
2025-01-14T13:16:42.8064930Z         """
2025-01-14T13:16:42.8065050Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8065200Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8065290Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8065550Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8065660Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8065810Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8065910Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8066560Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8066660Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8066710Z >       sim = run_tardis(
2025-01-14T13:16:42.8066770Z             config_verysimple,
2025-01-14T13:16:42.8066830Z             atom_data=atomic_data,
2025-01-14T13:16:42.8067040Z             show_convergence_plots=False,
2025-01-14T13:16:42.8067100Z             log_level="CRITICAl",
2025-01-14T13:16:42.8067140Z         )
2025-01-14T13:16:42.8067150Z 
2025-01-14T13:16:42.8067250Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8067350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8067410Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8067480Z     simulation.run_convergence()
2025-01-14T13:16:42.8067560Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8067670Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8067740Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8067860Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8067950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8067950Z 
2025-01-14T13:16:42.8068160Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8068330Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8068510Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8068730Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8068850Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8069070Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8069080Z 
2025-01-14T13:16:42.8069310Z     def initialize_transport_state(
2025-01-14T13:16:42.8069370Z         self,
2025-01-14T13:16:42.8069430Z         simulation_state,
2025-01-14T13:16:42.8069480Z         opacity_state,
2025-01-14T13:16:42.8069530Z         macro_atom_state,
2025-01-14T13:16:42.8069580Z         plasma,
2025-01-14T13:16:42.8069630Z         no_of_packets,
2025-01-14T13:16:42.8069700Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8069760Z         iteration=0,
2025-01-14T13:16:42.8069800Z     ):
2025-01-14T13:16:42.8069910Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8069970Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8070030Z         else:
2025-01-14T13:16:42.8070090Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8070130Z     
2025-01-14T13:16:42.8070230Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8070310Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8070350Z         )
2025-01-14T13:16:42.8070400Z     
2025-01-14T13:16:42.8070500Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8070590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8070720Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8070770Z         else:
2025-01-14T13:16:42.8070830Z             continuum_state = None
2025-01-14T13:16:42.8070910Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8071000Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8071060Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8071150Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8071340Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8071420Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8071480Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8071530Z         ).to_numba(
2025-01-14T13:16:42.8071580Z             macro_atom_state,
2025-01-14T13:16:42.8071640Z             self.line_interaction_type,
2025-01-14T13:16:42.8071680Z         )
2025-01-14T13:16:42.8071760Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8071980Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8072030Z         ]
2025-01-14T13:16:42.8072280Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8072280Z 
2025-01-14T13:16:42.8072390Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8072580Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply2] _
2025-01-14T13:16:42.8072590Z 
2025-01-14T13:16:42.8073270Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8073780Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8073790Z 
2025-01-14T13:16:42.8073860Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8073960Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8074010Z         """
2025-01-14T13:16:42.8074120Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8074170Z     
2025-01-14T13:16:42.8074220Z         Parameters
2025-01-14T13:16:42.8074280Z         ----------
2025-01-14T13:16:42.8074400Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8074520Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8074820Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8074910Z             Atomic data.
2025-01-14T13:16:42.8074950Z     
2025-01-14T13:16:42.8075000Z         Returns
2025-01-14T13:16:42.8075050Z         -------
2025-01-14T13:16:42.8075130Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8075200Z             Simulation object.
2025-01-14T13:16:42.8075250Z         """
2025-01-14T13:16:42.8075380Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8075540Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8075650Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8075750Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8075860Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8076000Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8076120Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8076220Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8076290Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8076370Z >       sim = run_tardis(
2025-01-14T13:16:42.8076430Z             config_verysimple,
2025-01-14T13:16:42.8076490Z             atom_data=atomic_data,
2025-01-14T13:16:42.8076550Z             show_convergence_plots=False,
2025-01-14T13:16:42.8076610Z             log_level="CRITICAl",
2025-01-14T13:16:42.8076650Z         )
2025-01-14T13:16:42.8076650Z 
2025-01-14T13:16:42.8076760Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8076850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8076910Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8077080Z     simulation.run_convergence()
2025-01-14T13:16:42.8077170Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8077280Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8077350Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8077470Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8077560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8077560Z 
2025-01-14T13:16:42.8077770Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8077930Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8078110Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8078320Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8078450Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8078560Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8078560Z 
2025-01-14T13:16:42.8078620Z     def initialize_transport_state(
2025-01-14T13:16:42.8078670Z         self,
2025-01-14T13:16:42.8078720Z         simulation_state,
2025-01-14T13:16:42.8078770Z         opacity_state,
2025-01-14T13:16:42.8078820Z         macro_atom_state,
2025-01-14T13:16:42.8078870Z         plasma,
2025-01-14T13:16:42.8078920Z         no_of_packets,
2025-01-14T13:16:42.8078980Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8079020Z         iteration=0,
2025-01-14T13:16:42.8079070Z     ):
2025-01-14T13:16:42.8079160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8079230Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8079280Z         else:
2025-01-14T13:16:42.8079330Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8079370Z     
2025-01-14T13:16:42.8079480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8080040Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8080090Z         )
2025-01-14T13:16:42.8080130Z     
2025-01-14T13:16:42.8080240Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8080330Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8080450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8080500Z         else:
2025-01-14T13:16:42.8080550Z             continuum_state = None
2025-01-14T13:16:42.8080630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8080710Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8080780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8080860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8080940Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8081010Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8081080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8081130Z         ).to_numba(
2025-01-14T13:16:42.8081190Z             macro_atom_state,
2025-01-14T13:16:42.8081250Z             self.line_interaction_type,
2025-01-14T13:16:42.8081300Z         )
2025-01-14T13:16:42.8081370Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8081590Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8081640Z         ]
2025-01-14T13:16:42.8081880Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8081890Z 
2025-01-14T13:16:42.8082010Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8082190Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply3] _
2025-01-14T13:16:42.8082480Z 
2025-01-14T13:16:42.8083050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8083350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8083350Z 
2025-01-14T13:16:42.8083410Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8083530Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8083570Z         """
2025-01-14T13:16:42.8083690Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8083730Z     
2025-01-14T13:16:42.8083770Z         Parameters
2025-01-14T13:16:42.8083820Z         ----------
2025-01-14T13:16:42.8083940Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8084040Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8084140Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8084190Z             Atomic data.
2025-01-14T13:16:42.8084240Z     
2025-01-14T13:16:42.8084280Z         Returns
2025-01-14T13:16:42.8084330Z         -------
2025-01-14T13:16:42.8084410Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8084460Z             Simulation object.
2025-01-14T13:16:42.8084510Z         """
2025-01-14T13:16:42.8084620Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8084770Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8084850Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8084950Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8085050Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8085200Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8085300Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8085460Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8085540Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8085590Z >       sim = run_tardis(
2025-01-14T13:16:42.8085640Z             config_verysimple,
2025-01-14T13:16:42.8085700Z             atom_data=atomic_data,
2025-01-14T13:16:42.8085760Z             show_convergence_plots=False,
2025-01-14T13:16:42.8085810Z             log_level="CRITICAl",
2025-01-14T13:16:42.8085860Z         )
2025-01-14T13:16:42.8085860Z 
2025-01-14T13:16:42.8085960Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8086050Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8086110Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8086180Z     simulation.run_convergence()
2025-01-14T13:16:42.8086260Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8086370Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8086440Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8086560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8086660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8086660Z 
2025-01-14T13:16:42.8086870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8087030Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8087210Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8087430Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8087550Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8087720Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8087720Z 
2025-01-14T13:16:42.8087790Z     def initialize_transport_state(
2025-01-14T13:16:42.8087840Z         self,
2025-01-14T13:16:42.8087890Z         simulation_state,
2025-01-14T13:16:42.8087940Z         opacity_state,
2025-01-14T13:16:42.8087990Z         macro_atom_state,
2025-01-14T13:16:42.8088040Z         plasma,
2025-01-14T13:16:42.8088090Z         no_of_packets,
2025-01-14T13:16:42.8088150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8088200Z         iteration=0,
2025-01-14T13:16:42.8088240Z     ):
2025-01-14T13:16:42.8088340Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8088410Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8088450Z         else:
2025-01-14T13:16:42.8088510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8088550Z     
2025-01-14T13:16:42.8088650Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8088720Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8088770Z         )
2025-01-14T13:16:42.8088820Z     
2025-01-14T13:16:42.8088920Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8089010Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8089130Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8089170Z         else:
2025-01-14T13:16:42.8089230Z             continuum_state = None
2025-01-14T13:16:42.8089310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8089390Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8089460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8089540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8089600Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8089680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8089740Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8089790Z         ).to_numba(
2025-01-14T13:16:42.8089910Z             macro_atom_state,
2025-01-14T13:16:42.8089970Z             self.line_interaction_type,
2025-01-14T13:16:42.8090020Z         )
2025-01-14T13:16:42.8090090Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8090310Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8090350Z         ]
2025-01-14T13:16:42.8090600Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8090610Z 
2025-01-14T13:16:42.8091070Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8091270Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply4] _
2025-01-14T13:16:42.8091280Z 
2025-01-14T13:16:42.8091810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8092100Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8092110Z 
2025-01-14T13:16:42.8092170Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8092280Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8092330Z         """
2025-01-14T13:16:42.8092440Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8092490Z     
2025-01-14T13:16:42.8092530Z         Parameters
2025-01-14T13:16:42.8092620Z         ----------
2025-01-14T13:16:42.8092750Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8092860Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8093270Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8093320Z             Atomic data.
2025-01-14T13:16:42.8093380Z     
2025-01-14T13:16:42.8093420Z         Returns
2025-01-14T13:16:42.8093460Z         -------
2025-01-14T13:16:42.8093540Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8093600Z             Simulation object.
2025-01-14T13:16:42.8093640Z         """
2025-01-14T13:16:42.8093760Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8093890Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8093980Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8094210Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8094320Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8094460Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8094570Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8094640Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8094710Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8094770Z >       sim = run_tardis(
2025-01-14T13:16:42.8094830Z             config_verysimple,
2025-01-14T13:16:42.8094890Z             atom_data=atomic_data,
2025-01-14T13:16:42.8094950Z             show_convergence_plots=False,
2025-01-14T13:16:42.8095000Z             log_level="CRITICAl",
2025-01-14T13:16:42.8095050Z         )
2025-01-14T13:16:42.8095050Z 
2025-01-14T13:16:42.8095160Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8095240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8095310Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8095370Z     simulation.run_convergence()
2025-01-14T13:16:42.8095450Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8095570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8095630Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8095850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8095930Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8095940Z 
2025-01-14T13:16:42.8096150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8096310Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8096490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8096700Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8096830Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8096930Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8096940Z 
2025-01-14T13:16:42.8097000Z     def initialize_transport_state(
2025-01-14T13:16:42.8097050Z         self,
2025-01-14T13:16:42.8097100Z         simulation_state,
2025-01-14T13:16:42.8097160Z         opacity_state,
2025-01-14T13:16:42.8097210Z         macro_atom_state,
2025-01-14T13:16:42.8097260Z         plasma,
2025-01-14T13:16:42.8097300Z         no_of_packets,
2025-01-14T13:16:42.8097360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8097410Z         iteration=0,
2025-01-14T13:16:42.8097450Z     ):
2025-01-14T13:16:42.8097540Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8097610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8097650Z         else:
2025-01-14T13:16:42.8097710Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8097750Z     
2025-01-14T13:16:42.8097860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8097930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8098030Z         )
2025-01-14T13:16:42.8098080Z     
2025-01-14T13:16:42.8098180Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8098270Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8098390Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8098440Z         else:
2025-01-14T13:16:42.8098490Z             continuum_state = None
2025-01-14T13:16:42.8098910Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8099000Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8099200Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8099290Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8099360Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8099430Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8099490Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8099550Z         ).to_numba(
2025-01-14T13:16:42.8099600Z             macro_atom_state,
2025-01-14T13:16:42.8099660Z             self.line_interaction_type,
2025-01-14T13:16:42.8099710Z         )
2025-01-14T13:16:42.8099780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8100000Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8100050Z         ]
2025-01-14T13:16:42.8104850Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8104870Z 
2025-01-14T13:16:42.8105110Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8105300Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply5] _
2025-01-14T13:16:42.8105310Z 
2025-01-14T13:16:42.8105850Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8106460Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8106460Z 
2025-01-14T13:16:42.8106520Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8106630Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8106680Z         """
2025-01-14T13:16:42.8106790Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8106830Z     
2025-01-14T13:16:42.8106890Z         Parameters
2025-01-14T13:16:42.8106930Z         ----------
2025-01-14T13:16:42.8107040Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8107140Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8107220Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8107280Z             Atomic data.
2025-01-14T13:16:42.8107320Z     
2025-01-14T13:16:42.8107360Z         Returns
2025-01-14T13:16:42.8107410Z         -------
2025-01-14T13:16:42.8107480Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8107540Z             Simulation object.
2025-01-14T13:16:42.8107730Z         """
2025-01-14T13:16:42.8107850Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8107990Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8108080Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8108180Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8108280Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8108410Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8108530Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8108800Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8108870Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8108930Z >       sim = run_tardis(
2025-01-14T13:16:42.8108990Z             config_verysimple,
2025-01-14T13:16:42.8109050Z             atom_data=atomic_data,
2025-01-14T13:16:42.8109110Z             show_convergence_plots=False,
2025-01-14T13:16:42.8109170Z             log_level="CRITICAl",
2025-01-14T13:16:42.8109210Z         )
2025-01-14T13:16:42.8109210Z 
2025-01-14T13:16:42.8109320Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8109410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8109470Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8109530Z     simulation.run_convergence()
2025-01-14T13:16:42.8109770Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8109880Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8109960Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8110080Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8110170Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8110170Z 
2025-01-14T13:16:42.8110380Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8110540Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8110720Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8110940Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8111060Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8111160Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8111170Z 
2025-01-14T13:16:42.8111230Z     def initialize_transport_state(
2025-01-14T13:16:42.8111280Z         self,
2025-01-14T13:16:42.8111340Z         simulation_state,
2025-01-14T13:16:42.8111460Z         opacity_state,
2025-01-14T13:16:42.8111520Z         macro_atom_state,
2025-01-14T13:16:42.8111560Z         plasma,
2025-01-14T13:16:42.8111620Z         no_of_packets,
2025-01-14T13:16:42.8111670Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8111720Z         iteration=0,
2025-01-14T13:16:42.8111760Z     ):
2025-01-14T13:16:42.8111860Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8111920Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8111970Z         else:
2025-01-14T13:16:42.8112020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8112060Z     
2025-01-14T13:16:42.8112170Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8112230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8112280Z         )
2025-01-14T13:16:42.8112320Z     
2025-01-14T13:16:42.8112430Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8112510Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8112640Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8112810Z         else:
2025-01-14T13:16:42.8112870Z             continuum_state = None
2025-01-14T13:16:42.8112940Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8113040Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8113100Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8113180Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8113250Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8113320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8113390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8113430Z         ).to_numba(
2025-01-14T13:16:42.8113480Z             macro_atom_state,
2025-01-14T13:16:42.8113610Z             self.line_interaction_type,
2025-01-14T13:16:42.8113660Z         )
2025-01-14T13:16:42.8113730Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8113960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8114000Z         ]
2025-01-14T13:16:42.8114250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8114260Z 
2025-01-14T13:16:42.8114420Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8114660Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply6] _
2025-01-14T13:16:42.8114660Z 
2025-01-14T13:16:42.8115190Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8115480Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8115490Z 
2025-01-14T13:16:42.8115560Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8115670Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8115710Z         """
2025-01-14T13:16:42.8115820Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8115870Z     
2025-01-14T13:16:42.8115910Z         Parameters
2025-01-14T13:16:42.8115960Z         ----------
2025-01-14T13:16:42.8116070Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8116170Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8116260Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8116310Z             Atomic data.
2025-01-14T13:16:42.8116350Z     
2025-01-14T13:16:42.8116400Z         Returns
2025-01-14T13:16:42.8116450Z         -------
2025-01-14T13:16:42.8116520Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8116740Z             Simulation object.
2025-01-14T13:16:42.8116780Z         """
2025-01-14T13:16:42.8116900Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8117040Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8117120Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8117210Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8117310Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8117460Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8117560Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8117640Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8117710Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8117760Z >       sim = run_tardis(
2025-01-14T13:16:42.8118380Z             config_verysimple,
2025-01-14T13:16:42.8118850Z             atom_data=atomic_data,
2025-01-14T13:16:42.8119060Z             show_convergence_plots=False,
2025-01-14T13:16:42.8119230Z             log_level="CRITICAl",
2025-01-14T13:16:42.8119480Z         )
2025-01-14T13:16:42.8119490Z 
2025-01-14T13:16:42.8119840Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8119970Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8120040Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8120100Z     simulation.run_convergence()
2025-01-14T13:16:42.8120190Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8120310Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8120380Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8120730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8120820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8120830Z 
2025-01-14T13:16:42.8121040Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8121200Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8121380Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8121600Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8122280Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8122430Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8122430Z 
2025-01-14T13:16:42.8122500Z     def initialize_transport_state(
2025-01-14T13:16:42.8122550Z         self,
2025-01-14T13:16:42.8122610Z         simulation_state,
2025-01-14T13:16:42.8122660Z         opacity_state,
2025-01-14T13:16:42.8122710Z         macro_atom_state,
2025-01-14T13:16:42.8122760Z         plasma,
2025-01-14T13:16:42.8122810Z         no_of_packets,
2025-01-14T13:16:42.8122870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8122920Z         iteration=0,
2025-01-14T13:16:42.8122970Z     ):
2025-01-14T13:16:42.8123060Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8123240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8123290Z         else:
2025-01-14T13:16:42.8123340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8123380Z     
2025-01-14T13:16:42.8123490Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8123570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8123610Z         )
2025-01-14T13:16:42.8123650Z     
2025-01-14T13:16:42.8123750Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8123840Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8123960Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8124130Z         else:
2025-01-14T13:16:42.8124180Z             continuum_state = None
2025-01-14T13:16:42.8124260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8124340Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8124410Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8124500Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8124570Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8124640Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8124700Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8124760Z         ).to_numba(
2025-01-14T13:16:42.8124810Z             macro_atom_state,
2025-01-14T13:16:42.8124870Z             self.line_interaction_type,
2025-01-14T13:16:42.8124910Z         )
2025-01-14T13:16:42.8124990Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8125210Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8125260Z         ]
2025-01-14T13:16:42.8125510Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8125510Z 
2025-01-14T13:16:42.8125620Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8125810Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply7] _
2025-01-14T13:16:42.8125810Z 
2025-01-14T13:16:42.8127370Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8127690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8127860Z 
2025-01-14T13:16:42.8127930Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8128050Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8128090Z         """
2025-01-14T13:16:42.8128210Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8128260Z     
2025-01-14T13:16:42.8128310Z         Parameters
2025-01-14T13:16:42.8128360Z         ----------
2025-01-14T13:16:42.8128900Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8129010Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8129100Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8129150Z             Atomic data.
2025-01-14T13:16:42.8129200Z     
2025-01-14T13:16:42.8129240Z         Returns
2025-01-14T13:16:42.8129280Z         -------
2025-01-14T13:16:42.8129370Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8129430Z             Simulation object.
2025-01-14T13:16:42.8129480Z         """
2025-01-14T13:16:42.8129600Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8129740Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8129830Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8129930Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8130030Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8130170Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8130280Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8130350Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8130420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8130470Z >       sim = run_tardis(
2025-01-14T13:16:42.8130540Z             config_verysimple,
2025-01-14T13:16:42.8130590Z             atom_data=atomic_data,
2025-01-14T13:16:42.8130980Z             show_convergence_plots=False,
2025-01-14T13:16:42.8131040Z             log_level="CRITICAl",
2025-01-14T13:16:42.8131080Z         )
2025-01-14T13:16:42.8131090Z 
2025-01-14T13:16:42.8131190Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8131290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8131350Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8131420Z     simulation.run_convergence()
2025-01-14T13:16:42.8131500Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8131610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8131690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8131810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8131900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8131900Z 
2025-01-14T13:16:42.8132110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8132280Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8132600Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8132820Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8132940Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8133040Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8133050Z 
2025-01-14T13:16:42.8133120Z     def initialize_transport_state(
2025-01-14T13:16:42.8133170Z         self,
2025-01-14T13:16:42.8133220Z         simulation_state,
2025-01-14T13:16:42.8133270Z         opacity_state,
2025-01-14T13:16:42.8133700Z         macro_atom_state,
2025-01-14T13:16:42.8133750Z         plasma,
2025-01-14T13:16:42.8133800Z         no_of_packets,
2025-01-14T13:16:42.8133860Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8133910Z         iteration=0,
2025-01-14T13:16:42.8133950Z     ):
2025-01-14T13:16:42.8134050Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8134120Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8134310Z         else:
2025-01-14T13:16:42.8134370Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8134410Z     
2025-01-14T13:16:42.8134520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8134580Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8134630Z         )
2025-01-14T13:16:42.8134670Z     
2025-01-14T13:16:42.8134770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8134860Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8135000Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8135040Z         else:
2025-01-14T13:16:42.8135100Z             continuum_state = None
2025-01-14T13:16:42.8135170Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8135380Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8135460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8135540Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8135620Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8135680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8135750Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8135800Z         ).to_numba(
2025-01-14T13:16:42.8135850Z             macro_atom_state,
2025-01-14T13:16:42.8135910Z             self.line_interaction_type,
2025-01-14T13:16:42.8135960Z         )
2025-01-14T13:16:42.8136030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8136250Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8136400Z         ]
2025-01-14T13:16:42.8136650Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8136650Z 
2025-01-14T13:16:42.8136760Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8136950Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply8] _
2025-01-14T13:16:42.8136950Z 
2025-01-14T13:16:42.8137490Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8137780Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8137780Z 
2025-01-14T13:16:42.8137850Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8137960Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8138010Z         """
2025-01-14T13:16:42.8138120Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8138160Z     
2025-01-14T13:16:42.8138210Z         Parameters
2025-01-14T13:16:42.8138260Z         ----------
2025-01-14T13:16:42.8138370Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8138460Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8138560Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8138610Z             Atomic data.
2025-01-14T13:16:42.8138650Z     
2025-01-14T13:16:42.8138690Z         Returns
2025-01-14T13:16:42.8138740Z         -------
2025-01-14T13:16:42.8138820Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8138950Z             Simulation object.
2025-01-14T13:16:42.8139000Z         """
2025-01-14T13:16:42.8139120Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8139260Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8139350Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8139450Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8139580Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8139730Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8139830Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8139900Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8139970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8140030Z >       sim = run_tardis(
2025-01-14T13:16:42.8140080Z             config_verysimple,
2025-01-14T13:16:42.8140140Z             atom_data=atomic_data,
2025-01-14T13:16:42.8140200Z             show_convergence_plots=False,
2025-01-14T13:16:42.8140260Z             log_level="CRITICAl",
2025-01-14T13:16:42.8140300Z         )
2025-01-14T13:16:42.8140310Z 
2025-01-14T13:16:42.8140410Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8140500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8140560Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8140620Z     simulation.run_convergence()
2025-01-14T13:16:42.8140710Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8140820Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8140880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8141010Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8141090Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8141100Z 
2025-01-14T13:16:42.8141310Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8141540Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8141760Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8142000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8142120Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8142230Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8142240Z 
2025-01-14T13:16:42.8142300Z     def initialize_transport_state(
2025-01-14T13:16:42.8142350Z         self,
2025-01-14T13:16:42.8142400Z         simulation_state,
2025-01-14T13:16:42.8142450Z         opacity_state,
2025-01-14T13:16:42.8142500Z         macro_atom_state,
2025-01-14T13:16:42.8142540Z         plasma,
2025-01-14T13:16:42.8142590Z         no_of_packets,
2025-01-14T13:16:42.8142660Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8142710Z         iteration=0,
2025-01-14T13:16:42.8142750Z     ):
2025-01-14T13:16:42.8142850Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8143080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8143140Z         else:
2025-01-14T13:16:42.8143190Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8143240Z     
2025-01-14T13:16:42.8143340Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8143410Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8143450Z         )
2025-01-14T13:16:42.8143500Z     
2025-01-14T13:16:42.8143590Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8143690Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8143810Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8144020Z         else:
2025-01-14T13:16:42.8144080Z             continuum_state = None
2025-01-14T13:16:42.8144150Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8144240Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8144310Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8144390Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8144460Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8144530Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8144590Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8144630Z         ).to_numba(
2025-01-14T13:16:42.8144680Z             macro_atom_state,
2025-01-14T13:16:42.8144750Z             self.line_interaction_type,
2025-01-14T13:16:42.8144790Z         )
2025-01-14T13:16:42.8144870Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8145080Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8145130Z         ]
2025-01-14T13:16:42.8145380Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8145390Z 
2025-01-14T13:16:42.8145500Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8145680Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply9] _
2025-01-14T13:16:42.8145680Z 
2025-01-14T13:16:42.8147540Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8148530Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8148560Z 
2025-01-14T13:16:42.8148660Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8148770Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8149020Z         """
2025-01-14T13:16:42.8149130Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8149180Z     
2025-01-14T13:16:42.8149220Z         Parameters
2025-01-14T13:16:42.8149280Z         ----------
2025-01-14T13:16:42.8149390Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8149490Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8149590Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8149640Z             Atomic data.
2025-01-14T13:16:42.8149680Z     
2025-01-14T13:16:42.8149730Z         Returns
2025-01-14T13:16:42.8149780Z         -------
2025-01-14T13:16:42.8149860Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8149910Z             Simulation object.
2025-01-14T13:16:42.8149960Z         """
2025-01-14T13:16:42.8150080Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8150220Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8150310Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8150410Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8150520Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8150660Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8150770Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8150840Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8150910Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8150960Z >       sim = run_tardis(
2025-01-14T13:16:42.8151020Z             config_verysimple,
2025-01-14T13:16:42.8151070Z             atom_data=atomic_data,
2025-01-14T13:16:42.8151140Z             show_convergence_plots=False,
2025-01-14T13:16:42.8151400Z             log_level="CRITICAl",
2025-01-14T13:16:42.8151440Z         )
2025-01-14T13:16:42.8151450Z 
2025-01-14T13:16:42.8151560Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8151650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8151710Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8151770Z     simulation.run_convergence()
2025-01-14T13:16:42.8151860Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8151960Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8152030Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8152150Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8152240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8152240Z 
2025-01-14T13:16:42.8152450Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8152610Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8152790Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8153000Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8153130Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8153240Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8153240Z 
2025-01-14T13:16:42.8153300Z     def initialize_transport_state(
2025-01-14T13:16:42.8153340Z         self,
2025-01-14T13:16:42.8153400Z         simulation_state,
2025-01-14T13:16:42.8153440Z         opacity_state,
2025-01-14T13:16:42.8153490Z         macro_atom_state,
2025-01-14T13:16:42.8153540Z         plasma,
2025-01-14T13:16:42.8153590Z         no_of_packets,
2025-01-14T13:16:42.8153640Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8153690Z         iteration=0,
2025-01-14T13:16:42.8153740Z     ):
2025-01-14T13:16:42.8153840Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8154280Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8154330Z         else:
2025-01-14T13:16:42.8154380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8154420Z     
2025-01-14T13:16:42.8154530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8154600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8154660Z         )
2025-01-14T13:16:42.8154700Z     
2025-01-14T13:16:42.8154800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8154890Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8155010Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8155060Z         else:
2025-01-14T13:16:42.8155110Z             continuum_state = None
2025-01-14T13:16:42.8155200Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8155280Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8155350Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8155430Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8155510Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8155580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8155650Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8155690Z         ).to_numba(
2025-01-14T13:16:42.8155740Z             macro_atom_state,
2025-01-14T13:16:42.8155810Z             self.line_interaction_type,
2025-01-14T13:16:42.8155850Z         )
2025-01-14T13:16:42.8155930Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8156140Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8156460Z         ]
2025-01-14T13:16:42.8156700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8156710Z 
2025-01-14T13:16:42.8156830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8157020Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply10] _
2025-01-14T13:16:42.8157020Z 
2025-01-14T13:16:42.8157560Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8157840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8157850Z 
2025-01-14T13:16:42.8157910Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8158030Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8158070Z         """
2025-01-14T13:16:42.8158190Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8158230Z     
2025-01-14T13:16:42.8158280Z         Parameters
2025-01-14T13:16:42.8158330Z         ----------
2025-01-14T13:16:42.8158450Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8158550Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8158640Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8158690Z             Atomic data.
2025-01-14T13:16:42.8158730Z     
2025-01-14T13:16:42.8158780Z         Returns
2025-01-14T13:16:42.8158820Z         -------
2025-01-14T13:16:42.8158900Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8158950Z             Simulation object.
2025-01-14T13:16:42.8158990Z         """
2025-01-14T13:16:42.8159110Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8159310Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8159420Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8159670Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8159770Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8159910Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8160020Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8160100Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8160160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8160210Z >       sim = run_tardis(
2025-01-14T13:16:42.8160270Z             config_verysimple,
2025-01-14T13:16:42.8160320Z             atom_data=atomic_data,
2025-01-14T13:16:42.8160390Z             show_convergence_plots=False,
2025-01-14T13:16:42.8160440Z             log_level="CRITICAl",
2025-01-14T13:16:42.8160490Z         )
2025-01-14T13:16:42.8160500Z 
2025-01-14T13:16:42.8160600Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8160700Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8160750Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8160820Z     simulation.run_convergence()
2025-01-14T13:16:42.8160910Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8161020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8161080Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8161200Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8161280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8161290Z 
2025-01-14T13:16:42.8161500Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8168480Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8171260Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8171560Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8171690Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8171800Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8171800Z 
2025-01-14T13:16:42.8171860Z     def initialize_transport_state(
2025-01-14T13:16:42.8171910Z         self,
2025-01-14T13:16:42.8171960Z         simulation_state,
2025-01-14T13:16:42.8172010Z         opacity_state,
2025-01-14T13:16:42.8172060Z         macro_atom_state,
2025-01-14T13:16:42.8172110Z         plasma,
2025-01-14T13:16:42.8172160Z         no_of_packets,
2025-01-14T13:16:42.8172210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8172260Z         iteration=0,
2025-01-14T13:16:42.8172320Z     ):
2025-01-14T13:16:42.8172420Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8172490Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8172540Z         else:
2025-01-14T13:16:42.8172590Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8172640Z     
2025-01-14T13:16:42.8172740Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8172820Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8172860Z         )
2025-01-14T13:16:42.8172900Z     
2025-01-14T13:16:42.8173000Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8173090Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8173210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8173250Z         else:
2025-01-14T13:16:42.8173310Z             continuum_state = None
2025-01-14T13:16:42.8173390Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8173480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8173540Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8173870Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8173950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8174010Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8174080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8174120Z         ).to_numba(
2025-01-14T13:16:42.8174180Z             macro_atom_state,
2025-01-14T13:16:42.8174360Z             self.line_interaction_type,
2025-01-14T13:16:42.8174410Z         )
2025-01-14T13:16:42.8174490Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8174710Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8174760Z         ]
2025-01-14T13:16:42.8175010Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8175020Z 
2025-01-14T13:16:42.8175130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8175320Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply11] _
2025-01-14T13:16:42.8175330Z 
2025-01-14T13:16:42.8176010Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8176300Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8176310Z 
2025-01-14T13:16:42.8176380Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8176490Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8176540Z         """
2025-01-14T13:16:42.8176770Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8176820Z     
2025-01-14T13:16:42.8176870Z         Parameters
2025-01-14T13:16:42.8176920Z         ----------
2025-01-14T13:16:42.8177040Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8177130Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8177220Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8177270Z             Atomic data.
2025-01-14T13:16:42.8177310Z     
2025-01-14T13:16:42.8177360Z         Returns
2025-01-14T13:16:42.8177400Z         -------
2025-01-14T13:16:42.8177480Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8177540Z             Simulation object.
2025-01-14T13:16:42.8177580Z         """
2025-01-14T13:16:42.8177700Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8177830Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8177930Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8178020Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8178130Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8178270Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8178380Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8178450Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8178520Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8178580Z >       sim = run_tardis(
2025-01-14T13:16:42.8178630Z             config_verysimple,
2025-01-14T13:16:42.8178700Z             atom_data=atomic_data,
2025-01-14T13:16:42.8178760Z             show_convergence_plots=False,
2025-01-14T13:16:42.8178810Z             log_level="CRITICAl",
2025-01-14T13:16:42.8178860Z         )
2025-01-14T13:16:42.8178860Z 
2025-01-14T13:16:42.8178970Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8179060Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8179200Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8179260Z     simulation.run_convergence()
2025-01-14T13:16:42.8179360Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8179470Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8179540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8179660Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8179750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8179750Z 
2025-01-14T13:16:42.8179960Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8180120Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8180300Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8180690Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8180830Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8180930Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8180940Z 
2025-01-14T13:16:42.8181000Z     def initialize_transport_state(
2025-01-14T13:16:42.8181040Z         self,
2025-01-14T13:16:42.8181090Z         simulation_state,
2025-01-14T13:16:42.8181150Z         opacity_state,
2025-01-14T13:16:42.8181200Z         macro_atom_state,
2025-01-14T13:16:42.8181240Z         plasma,
2025-01-14T13:16:42.8181290Z         no_of_packets,
2025-01-14T13:16:42.8181340Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8181390Z         iteration=0,
2025-01-14T13:16:42.8181440Z     ):
2025-01-14T13:16:42.8181530Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8181680Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8181720Z         else:
2025-01-14T13:16:42.8181790Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8181830Z     
2025-01-14T13:16:42.8181930Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8182000Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8182050Z         )
2025-01-14T13:16:42.8182090Z     
2025-01-14T13:16:42.8182190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8182270Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8182400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8182440Z         else:
2025-01-14T13:16:42.8182500Z             continuum_state = None
2025-01-14T13:16:42.8182570Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8182660Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8182730Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8182810Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8182890Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8182950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8183020Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8183330Z         ).to_numba(
2025-01-14T13:16:42.8183400Z             macro_atom_state,
2025-01-14T13:16:42.8183460Z             self.line_interaction_type,
2025-01-14T13:16:42.8183510Z         )
2025-01-14T13:16:42.8183580Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8183800Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8183850Z         ]
2025-01-14T13:16:42.8184090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8184100Z 
2025-01-14T13:16:42.8184220Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8184400Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply12] _
2025-01-14T13:16:42.8184690Z 
2025-01-14T13:16:42.8185240Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8185520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8185520Z 
2025-01-14T13:16:42.8185580Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8185690Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8185730Z         """
2025-01-14T13:16:42.8185850Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8185890Z     
2025-01-14T13:16:42.8185950Z         Parameters
2025-01-14T13:16:42.8186000Z         ----------
2025-01-14T13:16:42.8186120Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8186210Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8186300Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8186350Z             Atomic data.
2025-01-14T13:16:42.8186390Z     
2025-01-14T13:16:42.8186430Z         Returns
2025-01-14T13:16:42.8186470Z         -------
2025-01-14T13:16:42.8186550Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8186600Z             Simulation object.
2025-01-14T13:16:42.8186650Z         """
2025-01-14T13:16:42.8186770Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8186900Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8186990Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8187270Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8187370Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8187520Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8187620Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8187700Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8187770Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8187820Z >       sim = run_tardis(
2025-01-14T13:16:42.8187880Z             config_verysimple,
2025-01-14T13:16:42.8187930Z             atom_data=atomic_data,
2025-01-14T13:16:42.8187990Z             show_convergence_plots=False,
2025-01-14T13:16:42.8188050Z             log_level="CRITICAl",
2025-01-14T13:16:42.8188090Z         )
2025-01-14T13:16:42.8188090Z 
2025-01-14T13:16:42.8188200Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8188290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8188350Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8188410Z     simulation.run_convergence()
2025-01-14T13:16:42.8188500Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8188610Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8188680Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8188790Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8188880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8188880Z 
2025-01-14T13:16:42.8189080Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8189240Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8189410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8189640Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8189800Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8189910Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8189910Z 
2025-01-14T13:16:42.8189980Z     def initialize_transport_state(
2025-01-14T13:16:42.8190020Z         self,
2025-01-14T13:16:42.8190070Z         simulation_state,
2025-01-14T13:16:42.8190120Z         opacity_state,
2025-01-14T13:16:42.8190170Z         macro_atom_state,
2025-01-14T13:16:42.8190220Z         plasma,
2025-01-14T13:16:42.8190270Z         no_of_packets,
2025-01-14T13:16:42.8190320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8190370Z         iteration=0,
2025-01-14T13:16:42.8190410Z     ):
2025-01-14T13:16:42.8190510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8190570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8190620Z         else:
2025-01-14T13:16:42.8190670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8190720Z     
2025-01-14T13:16:42.8190820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8190890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8190930Z         )
2025-01-14T13:16:42.8190970Z     
2025-01-14T13:16:42.8191080Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8191160Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8191280Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8191330Z         else:
2025-01-14T13:16:42.8191380Z             continuum_state = None
2025-01-14T13:16:42.8191460Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8191550Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8191610Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8191740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8191810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8191890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8191950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8192000Z         ).to_numba(
2025-01-14T13:16:42.8192050Z             macro_atom_state,
2025-01-14T13:16:42.8192110Z             self.line_interaction_type,
2025-01-14T13:16:42.8192160Z         )
2025-01-14T13:16:42.8192230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8192450Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8192490Z         ]
2025-01-14T13:16:42.8192740Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8192740Z 
2025-01-14T13:16:42.8192850Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8193040Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply13] _
2025-01-14T13:16:42.8193050Z 
2025-01-14T13:16:42.8193570Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8193860Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8193860Z 
2025-01-14T13:16:42.8193920Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8194030Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8194080Z         """
2025-01-14T13:16:42.8194190Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8194240Z     
2025-01-14T13:16:42.8194290Z         Parameters
2025-01-14T13:16:42.8194340Z         ----------
2025-01-14T13:16:42.8194450Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8194600Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8194690Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8194740Z             Atomic data.
2025-01-14T13:16:42.8194780Z     
2025-01-14T13:16:42.8194820Z         Returns
2025-01-14T13:16:42.8194870Z         -------
2025-01-14T13:16:42.8194940Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8195000Z             Simulation object.
2025-01-14T13:16:42.8195040Z         """
2025-01-14T13:16:42.8195160Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8195290Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8195380Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8195470Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8195570Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8195710Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8195820Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8195900Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8195960Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8196020Z >       sim = run_tardis(
2025-01-14T13:16:42.8196070Z             config_verysimple,
2025-01-14T13:16:42.8196130Z             atom_data=atomic_data,
2025-01-14T13:16:42.8196190Z             show_convergence_plots=False,
2025-01-14T13:16:42.8196250Z             log_level="CRITICAl",
2025-01-14T13:16:42.8196290Z         )
2025-01-14T13:16:42.8196290Z 
2025-01-14T13:16:42.8196400Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8196480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8196600Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8196660Z     simulation.run_convergence()
2025-01-14T13:16:42.8196750Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8196860Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8196920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8197040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8197130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8197130Z 
2025-01-14T13:16:42.8197340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8197500Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8197670Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8197890Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8198010Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8198130Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8198130Z 
2025-01-14T13:16:42.8198190Z     def initialize_transport_state(
2025-01-14T13:16:42.8198240Z         self,
2025-01-14T13:16:42.8198290Z         simulation_state,
2025-01-14T13:16:42.8198340Z         opacity_state,
2025-01-14T13:16:42.8198390Z         macro_atom_state,
2025-01-14T13:16:42.8198430Z         plasma,
2025-01-14T13:16:42.8198480Z         no_of_packets,
2025-01-14T13:16:42.8198540Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8198580Z         iteration=0,
2025-01-14T13:16:42.8198620Z     ):
2025-01-14T13:16:42.8198720Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8198790Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8198830Z         else:
2025-01-14T13:16:42.8198880Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8198930Z     
2025-01-14T13:16:42.8199030Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8199150Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8199190Z         )
2025-01-14T13:16:42.8199230Z     
2025-01-14T13:16:42.8199330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8199420Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8199540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8199590Z         else:
2025-01-14T13:16:42.8199650Z             continuum_state = None
2025-01-14T13:16:42.8199730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8199810Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8199880Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8199960Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8200030Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8200100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8200180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8200230Z         ).to_numba(
2025-01-14T13:16:42.8200280Z             macro_atom_state,
2025-01-14T13:16:42.8200340Z             self.line_interaction_type,
2025-01-14T13:16:42.8200380Z         )
2025-01-14T13:16:42.8200460Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8200750Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8200840Z         ]
2025-01-14T13:16:42.8201070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8201080Z 
2025-01-14T13:16:42.8201190Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8201370Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply14] _
2025-01-14T13:16:42.8201530Z 
2025-01-14T13:16:42.8202060Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8202350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8202350Z 
2025-01-14T13:16:42.8202410Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8202520Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8202560Z         """
2025-01-14T13:16:42.8202680Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8202720Z     
2025-01-14T13:16:42.8202770Z         Parameters
2025-01-14T13:16:42.8202820Z         ----------
2025-01-14T13:16:42.8202940Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8203040Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8203130Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8203180Z             Atomic data.
2025-01-14T13:16:42.8203220Z     
2025-01-14T13:16:42.8203260Z         Returns
2025-01-14T13:16:42.8203310Z         -------
2025-01-14T13:16:42.8203380Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8203440Z             Simulation object.
2025-01-14T13:16:42.8203480Z         """
2025-01-14T13:16:42.8203600Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8203740Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8203820Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8203910Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8204010Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8204160Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8204260Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8204610Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8204680Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8204880Z >       sim = run_tardis(
2025-01-14T13:16:42.8204940Z             config_verysimple,
2025-01-14T13:16:42.8205000Z             atom_data=atomic_data,
2025-01-14T13:16:42.8205060Z             show_convergence_plots=False,
2025-01-14T13:16:42.8205120Z             log_level="CRITICAl",
2025-01-14T13:16:42.8205160Z         )
2025-01-14T13:16:42.8205160Z 
2025-01-14T13:16:42.8205270Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8205360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8205410Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8205470Z     simulation.run_convergence()
2025-01-14T13:16:42.8205570Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8205800Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8205920Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8206050Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8206140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8206150Z 
2025-01-14T13:16:42.8206350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8206520Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8206690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8206910Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8207030Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8207550Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8207560Z 
2025-01-14T13:16:42.8207620Z     def initialize_transport_state(
2025-01-14T13:16:42.8207670Z         self,
2025-01-14T13:16:42.8207720Z         simulation_state,
2025-01-14T13:16:42.8207770Z         opacity_state,
2025-01-14T13:16:42.8207830Z         macro_atom_state,
2025-01-14T13:16:42.8207870Z         plasma,
2025-01-14T13:16:42.8207920Z         no_of_packets,
2025-01-14T13:16:42.8207970Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8208020Z         iteration=0,
2025-01-14T13:16:42.8208060Z     ):
2025-01-14T13:16:42.8208170Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8208240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8208300Z         else:
2025-01-14T13:16:42.8208350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8208400Z     
2025-01-14T13:16:42.8208510Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8208580Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8208640Z         )
2025-01-14T13:16:42.8209090Z     
2025-01-14T13:16:42.8209210Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8209300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8209430Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8209470Z         else:
2025-01-14T13:16:42.8209530Z             continuum_state = None
2025-01-14T13:16:42.8209600Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8209690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8209760Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8209840Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8209920Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8209980Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8210050Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8210090Z         ).to_numba(
2025-01-14T13:16:42.8210230Z             macro_atom_state,
2025-01-14T13:16:42.8210290Z             self.line_interaction_type,
2025-01-14T13:16:42.8210340Z         )
2025-01-14T13:16:42.8210410Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8210630Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8210670Z         ]
2025-01-14T13:16:42.8210920Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8210920Z 
2025-01-14T13:16:42.8211030Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8211220Z _ ERROR at setup of TestSDECPlotter.test_generate_plot_mpl[plotter_generate_plot_ply15] _
2025-01-14T13:16:42.8211220Z 
2025-01-14T13:16:42.8211920Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8212250Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8212260Z 
2025-01-14T13:16:42.8212330Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8212450Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8212500Z         """
2025-01-14T13:16:42.8212610Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8212660Z     
2025-01-14T13:16:42.8212710Z         Parameters
2025-01-14T13:16:42.8212770Z         ----------
2025-01-14T13:16:42.8212890Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8212980Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8213230Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8213290Z             Atomic data.
2025-01-14T13:16:42.8213340Z     
2025-01-14T13:16:42.8213380Z         Returns
2025-01-14T13:16:42.8213420Z         -------
2025-01-14T13:16:42.8213500Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8213570Z             Simulation object.
2025-01-14T13:16:42.8213610Z         """
2025-01-14T13:16:42.8213730Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8213870Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8213970Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8214060Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8214170Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8214310Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8214560Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8214640Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8214700Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8214760Z >       sim = run_tardis(
2025-01-14T13:16:42.8214810Z             config_verysimple,
2025-01-14T13:16:42.8214870Z             atom_data=atomic_data,
2025-01-14T13:16:42.8214930Z             show_convergence_plots=False,
2025-01-14T13:16:42.8214990Z             log_level="CRITICAl",
2025-01-14T13:16:42.8215030Z         )
2025-01-14T13:16:42.8215040Z 
2025-01-14T13:16:42.8215150Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8215240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8215300Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8215360Z     simulation.run_convergence()
2025-01-14T13:16:42.8215450Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8215570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8215630Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8215830Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8215920Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8215920Z 
2025-01-14T13:16:42.8216140Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8216290Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8216480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8216700Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8216820Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8216930Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8216930Z 
2025-01-14T13:16:42.8217000Z     def initialize_transport_state(
2025-01-14T13:16:42.8217050Z         self,
2025-01-14T13:16:42.8217100Z         simulation_state,
2025-01-14T13:16:42.8217150Z         opacity_state,
2025-01-14T13:16:42.8217200Z         macro_atom_state,
2025-01-14T13:16:42.8217240Z         plasma,
2025-01-14T13:16:42.8217290Z         no_of_packets,
2025-01-14T13:16:42.8217350Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8217400Z         iteration=0,
2025-01-14T13:16:42.8217440Z     ):
2025-01-14T13:16:42.8217530Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8217610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8217650Z         else:
2025-01-14T13:16:42.8217710Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8217750Z     
2025-01-14T13:16:42.8217850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8217920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8218020Z         )
2025-01-14T13:16:42.8218060Z     
2025-01-14T13:16:42.8218160Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8218260Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8218380Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8218430Z         else:
2025-01-14T13:16:42.8218480Z             continuum_state = None
2025-01-14T13:16:42.8218560Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8218640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8218700Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8218790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8218860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8218930Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8218990Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8219040Z         ).to_numba(
2025-01-14T13:16:42.8219100Z             macro_atom_state,
2025-01-14T13:16:42.8219160Z             self.line_interaction_type,
2025-01-14T13:16:42.8219200Z         )
2025-01-14T13:16:42.8219280Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8219500Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8219550Z         ]
2025-01-14T13:16:42.8219790Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8219790Z 
2025-01-14T13:16:42.8219910Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8220070Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl0] _
2025-01-14T13:16:42.8220070Z 
2025-01-14T13:16:42.8220610Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8225860Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8225890Z 
2025-01-14T13:16:42.8225980Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8226100Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8226140Z         """
2025-01-14T13:16:42.8226260Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8226310Z     
2025-01-14T13:16:42.8226350Z         Parameters
2025-01-14T13:16:42.8226400Z         ----------
2025-01-14T13:16:42.8226510Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8226610Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8226700Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8226770Z             Atomic data.
2025-01-14T13:16:42.8226820Z     
2025-01-14T13:16:42.8226870Z         Returns
2025-01-14T13:16:42.8226910Z         -------
2025-01-14T13:16:42.8227030Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8227100Z             Simulation object.
2025-01-14T13:16:42.8227150Z         """
2025-01-14T13:16:42.8227270Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8227420Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8227510Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8227600Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8227710Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8227850Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8227950Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8228260Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8228330Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8228380Z >       sim = run_tardis(
2025-01-14T13:16:42.8228440Z             config_verysimple,
2025-01-14T13:16:42.8228500Z             atom_data=atomic_data,
2025-01-14T13:16:42.8228570Z             show_convergence_plots=False,
2025-01-14T13:16:42.8228620Z             log_level="CRITICAl",
2025-01-14T13:16:42.8228660Z         )
2025-01-14T13:16:42.8228670Z 
2025-01-14T13:16:42.8228770Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8228880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8228940Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8229000Z     simulation.run_convergence()
2025-01-14T13:16:42.8229090Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8229190Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8229270Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8229390Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8229480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8229480Z 
2025-01-14T13:16:42.8229680Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8229850Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8230020Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8230230Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8230360Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8230460Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8230470Z 
2025-01-14T13:16:42.8230540Z     def initialize_transport_state(
2025-01-14T13:16:42.8230590Z         self,
2025-01-14T13:16:42.8230640Z         simulation_state,
2025-01-14T13:16:42.8231000Z         opacity_state,
2025-01-14T13:16:42.8231050Z         macro_atom_state,
2025-01-14T13:16:42.8231090Z         plasma,
2025-01-14T13:16:42.8231150Z         no_of_packets,
2025-01-14T13:16:42.8231210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8231250Z         iteration=0,
2025-01-14T13:16:42.8231300Z     ):
2025-01-14T13:16:42.8231390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8231470Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8231510Z         else:
2025-01-14T13:16:42.8231570Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8231610Z     
2025-01-14T13:16:42.8231710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8231780Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8231820Z         )
2025-01-14T13:16:42.8231870Z     
2025-01-14T13:16:42.8231970Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8232060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8232180Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8232220Z         else:
2025-01-14T13:16:42.8232280Z             continuum_state = None
2025-01-14T13:16:42.8232360Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8232440Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8232510Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8232590Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8232670Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8232730Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8232800Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8232840Z         ).to_numba(
2025-01-14T13:16:42.8232900Z             macro_atom_state,
2025-01-14T13:16:42.8233200Z             self.line_interaction_type,
2025-01-14T13:16:42.8233250Z         )
2025-01-14T13:16:42.8233330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8233550Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8233590Z         ]
2025-01-14T13:16:42.8233840Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8233840Z 
2025-01-14T13:16:42.8233950Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8234110Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl1] _
2025-01-14T13:16:42.8234120Z 
2025-01-14T13:16:42.8234650Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8234940Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8234940Z 
2025-01-14T13:16:42.8235010Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8235120Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8235170Z         """
2025-01-14T13:16:42.8235290Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8235330Z     
2025-01-14T13:16:42.8235380Z         Parameters
2025-01-14T13:16:42.8235420Z         ----------
2025-01-14T13:16:42.8235540Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8235640Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8235730Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8235770Z             Atomic data.
2025-01-14T13:16:42.8235830Z     
2025-01-14T13:16:42.8235870Z         Returns
2025-01-14T13:16:42.8235920Z         -------
2025-01-14T13:16:42.8235990Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8236110Z             Simulation object.
2025-01-14T13:16:42.8236160Z         """
2025-01-14T13:16:42.8236270Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8236560Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8236720Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8236830Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8236940Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8237090Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8237190Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8237270Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8237350Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8237410Z >       sim = run_tardis(
2025-01-14T13:16:42.8237470Z             config_verysimple,
2025-01-14T13:16:42.8237530Z             atom_data=atomic_data,
2025-01-14T13:16:42.8237590Z             show_convergence_plots=False,
2025-01-14T13:16:42.8237650Z             log_level="CRITICAl",
2025-01-14T13:16:42.8237690Z         )
2025-01-14T13:16:42.8237700Z 
2025-01-14T13:16:42.8237810Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8237910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8237970Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8238030Z     simulation.run_convergence()
2025-01-14T13:16:42.8238440Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8238570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8238640Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8238980Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8239080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8239080Z 
2025-01-14T13:16:42.8239300Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8239460Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8239630Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8239860Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8239980Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8240090Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8240090Z 
2025-01-14T13:16:42.8240150Z     def initialize_transport_state(
2025-01-14T13:16:42.8240200Z         self,
2025-01-14T13:16:42.8240260Z         simulation_state,
2025-01-14T13:16:42.8240310Z         opacity_state,
2025-01-14T13:16:42.8240360Z         macro_atom_state,
2025-01-14T13:16:42.8240410Z         plasma,
2025-01-14T13:16:42.8240460Z         no_of_packets,
2025-01-14T13:16:42.8240510Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8240560Z         iteration=0,
2025-01-14T13:16:42.8240600Z     ):
2025-01-14T13:16:42.8240700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8240770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8240820Z         else:
2025-01-14T13:16:42.8240870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8240920Z     
2025-01-14T13:16:42.8241020Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8241100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8241140Z         )
2025-01-14T13:16:42.8241180Z     
2025-01-14T13:16:42.8241280Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8241370Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8241490Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8241610Z         else:
2025-01-14T13:16:42.8241670Z             continuum_state = None
2025-01-14T13:16:42.8241750Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8241830Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8241900Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8241990Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8242060Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8242130Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8242190Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8242240Z         ).to_numba(
2025-01-14T13:16:42.8242290Z             macro_atom_state,
2025-01-14T13:16:42.8242350Z             self.line_interaction_type,
2025-01-14T13:16:42.8242390Z         )
2025-01-14T13:16:42.8242470Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8242700Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8242740Z         ]
2025-01-14T13:16:42.8242990Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8243000Z 
2025-01-14T13:16:42.8243110Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8243270Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl2] _
2025-01-14T13:16:42.8243270Z 
2025-01-14T13:16:42.8243810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8244090Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8244150Z 
2025-01-14T13:16:42.8244220Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8244330Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8244370Z         """
2025-01-14T13:16:42.8244490Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8244530Z     
2025-01-14T13:16:42.8244570Z         Parameters
2025-01-14T13:16:42.8244620Z         ----------
2025-01-14T13:16:42.8244740Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8244830Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8244920Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8244970Z             Atomic data.
2025-01-14T13:16:42.8245010Z     
2025-01-14T13:16:42.8245050Z         Returns
2025-01-14T13:16:42.8245100Z         -------
2025-01-14T13:16:42.8245180Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8245230Z             Simulation object.
2025-01-14T13:16:42.8245280Z         """
2025-01-14T13:16:42.8245400Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8245530Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8245620Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8245720Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8246860Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8247430Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8247880Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8248150Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8248370Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8248520Z >       sim = run_tardis(
2025-01-14T13:16:42.8248720Z             config_verysimple,
2025-01-14T13:16:42.8248890Z             atom_data=atomic_data,
2025-01-14T13:16:42.8249910Z             show_convergence_plots=False,
2025-01-14T13:16:42.8250090Z             log_level="CRITICAl",
2025-01-14T13:16:42.8250230Z         )
2025-01-14T13:16:42.8250240Z 
2025-01-14T13:16:42.8250560Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8250810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8250990Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8251170Z     simulation.run_convergence()
2025-01-14T13:16:42.8251510Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8251820Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8252020Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8252350Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8252600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8252610Z 
2025-01-14T13:16:42.8253180Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8253600Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8255480Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8256090Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8256420Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8256720Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8256730Z 
2025-01-14T13:16:42.8257410Z     def initialize_transport_state(
2025-01-14T13:16:42.8257690Z         self,
2025-01-14T13:16:42.8257830Z         simulation_state,
2025-01-14T13:16:42.8257890Z         opacity_state,
2025-01-14T13:16:42.8258180Z         macro_atom_state,
2025-01-14T13:16:42.8258240Z         plasma,
2025-01-14T13:16:42.8258290Z         no_of_packets,
2025-01-14T13:16:42.8258360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8258400Z         iteration=0,
2025-01-14T13:16:42.8258450Z     ):
2025-01-14T13:16:42.8258550Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8258620Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8258670Z         else:
2025-01-14T13:16:42.8258720Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8258760Z     
2025-01-14T13:16:42.8260800Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8260920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8260970Z         )
2025-01-14T13:16:42.8261010Z     
2025-01-14T13:16:42.8261110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8261200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8261330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8261370Z         else:
2025-01-14T13:16:42.8261430Z             continuum_state = None
2025-01-14T13:16:42.8261510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8261590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8261660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8261740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8261810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8261880Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8261950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8262000Z         ).to_numba(
2025-01-14T13:16:42.8262050Z             macro_atom_state,
2025-01-14T13:16:42.8262110Z             self.line_interaction_type,
2025-01-14T13:16:42.8262150Z         )
2025-01-14T13:16:42.8262230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8262450Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8262890Z         ]
2025-01-14T13:16:42.8263130Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8263130Z 
2025-01-14T13:16:42.8263250Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8263400Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl3] _
2025-01-14T13:16:42.8263410Z 
2025-01-14T13:16:42.8263950Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8264220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8264230Z 
2025-01-14T13:16:42.8264300Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8264410Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8264450Z         """
2025-01-14T13:16:42.8264570Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8264610Z     
2025-01-14T13:16:42.8264660Z         Parameters
2025-01-14T13:16:42.8264710Z         ----------
2025-01-14T13:16:42.8264820Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8264920Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8265010Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8265060Z             Atomic data.
2025-01-14T13:16:42.8265100Z     
2025-01-14T13:16:42.8265150Z         Returns
2025-01-14T13:16:42.8265190Z         -------
2025-01-14T13:16:42.8265270Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8265580Z             Simulation object.
2025-01-14T13:16:42.8265620Z         """
2025-01-14T13:16:42.8265740Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8265890Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8265970Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8266070Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8266180Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8266320Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8266420Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8266500Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8266570Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8266620Z >       sim = run_tardis(
2025-01-14T13:16:42.8266680Z             config_verysimple,
2025-01-14T13:16:42.8266740Z             atom_data=atomic_data,
2025-01-14T13:16:42.8266810Z             show_convergence_plots=False,
2025-01-14T13:16:42.8266870Z             log_level="CRITICAl",
2025-01-14T13:16:42.8266910Z         )
2025-01-14T13:16:42.8266920Z 
2025-01-14T13:16:42.8267020Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8267120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8267170Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8267240Z     simulation.run_convergence()
2025-01-14T13:16:42.8267320Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8267430Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8267500Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8267620Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8267700Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8267710Z 
2025-01-14T13:16:42.8267910Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8268150Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8268320Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8268540Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8268660Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8268770Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8268770Z 
2025-01-14T13:16:42.8268830Z     def initialize_transport_state(
2025-01-14T13:16:42.8268880Z         self,
2025-01-14T13:16:42.8268930Z         simulation_state,
2025-01-14T13:16:42.8268980Z         opacity_state,
2025-01-14T13:16:42.8269040Z         macro_atom_state,
2025-01-14T13:16:42.8269080Z         plasma,
2025-01-14T13:16:42.8269130Z         no_of_packets,
2025-01-14T13:16:42.8269190Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8269240Z         iteration=0,
2025-01-14T13:16:42.8269280Z     ):
2025-01-14T13:16:42.8269380Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8269450Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8269500Z         else:
2025-01-14T13:16:42.8269550Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8269590Z     
2025-01-14T13:16:42.8269700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8269760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8269810Z         )
2025-01-14T13:16:42.8269850Z     
2025-01-14T13:16:42.8269950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8270030Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8270160Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8270260Z         else:
2025-01-14T13:16:42.8270330Z             continuum_state = None
2025-01-14T13:16:42.8270400Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8270490Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8270550Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8270640Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8270710Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8270780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8270840Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8270890Z         ).to_numba(
2025-01-14T13:16:42.8270940Z             macro_atom_state,
2025-01-14T13:16:42.8271000Z             self.line_interaction_type,
2025-01-14T13:16:42.8271050Z         )
2025-01-14T13:16:42.8271120Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8271350Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8271390Z         ]
2025-01-14T13:16:42.8271650Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8271660Z 
2025-01-14T13:16:42.8271770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8271930Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl4] _
2025-01-14T13:16:42.8271940Z 
2025-01-14T13:16:42.8272470Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8272760Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8272790Z 
2025-01-14T13:16:42.8272860Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8272970Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8273080Z         """
2025-01-14T13:16:42.8273200Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8273240Z     
2025-01-14T13:16:42.8273290Z         Parameters
2025-01-14T13:16:42.8273340Z         ----------
2025-01-14T13:16:42.8273450Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8273550Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8273640Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8273690Z             Atomic data.
2025-01-14T13:16:42.8273730Z     
2025-01-14T13:16:42.8273780Z         Returns
2025-01-14T13:16:42.8273820Z         -------
2025-01-14T13:16:42.8273900Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8273950Z             Simulation object.
2025-01-14T13:16:42.8273990Z         """
2025-01-14T13:16:42.8274120Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8274260Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8274350Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8274450Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8274550Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8274680Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8274790Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8274860Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8274930Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8274980Z >       sim = run_tardis(
2025-01-14T13:16:42.8275040Z             config_verysimple,
2025-01-14T13:16:42.8275090Z             atom_data=atomic_data,
2025-01-14T13:16:42.8275150Z             show_convergence_plots=False,
2025-01-14T13:16:42.8275280Z             log_level="CRITICAl",
2025-01-14T13:16:42.8275320Z         )
2025-01-14T13:16:42.8275330Z 
2025-01-14T13:16:42.8275440Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8275530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8275590Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8275650Z     simulation.run_convergence()
2025-01-14T13:16:42.8275730Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8275840Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8275910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8276030Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8276110Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8276110Z 
2025-01-14T13:16:42.8276320Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8276490Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8276660Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8276880Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8277000Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8277100Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8277110Z 
2025-01-14T13:16:42.8277170Z     def initialize_transport_state(
2025-01-14T13:16:42.8277210Z         self,
2025-01-14T13:16:42.8277260Z         simulation_state,
2025-01-14T13:16:42.8277310Z         opacity_state,
2025-01-14T13:16:42.8277360Z         macro_atom_state,
2025-01-14T13:16:42.8277410Z         plasma,
2025-01-14T13:16:42.8277450Z         no_of_packets,
2025-01-14T13:16:42.8277510Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8277560Z         iteration=0,
2025-01-14T13:16:42.8277610Z     ):
2025-01-14T13:16:42.8277700Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8277830Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8277870Z         else:
2025-01-14T13:16:42.8277930Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8277970Z     
2025-01-14T13:16:42.8278070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8278140Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8278180Z         )
2025-01-14T13:16:42.8278220Z     
2025-01-14T13:16:42.8278320Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8278400Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8278520Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8278570Z         else:
2025-01-14T13:16:42.8278620Z             continuum_state = None
2025-01-14T13:16:42.8278700Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8278780Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8278850Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8278930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8279000Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8279070Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8279130Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8279180Z         ).to_numba(
2025-01-14T13:16:42.8279230Z             macro_atom_state,
2025-01-14T13:16:42.8279290Z             self.line_interaction_type,
2025-01-14T13:16:42.8279330Z         )
2025-01-14T13:16:42.8279410Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8279630Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8279670Z         ]
2025-01-14T13:16:42.8279970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8279970Z 
2025-01-14T13:16:42.8280090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8280250Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl5] _
2025-01-14T13:16:42.8280250Z 
2025-01-14T13:16:42.8280800Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8281080Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8281080Z 
2025-01-14T13:16:42.8281140Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8281260Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8281310Z         """
2025-01-14T13:16:42.8281420Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8281470Z     
2025-01-14T13:16:42.8281520Z         Parameters
2025-01-14T13:16:42.8281570Z         ----------
2025-01-14T13:16:42.8281690Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8281780Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8281880Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8281930Z             Atomic data.
2025-01-14T13:16:42.8281980Z     
2025-01-14T13:16:42.8282020Z         Returns
2025-01-14T13:16:42.8282060Z         -------
2025-01-14T13:16:42.8282150Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8282200Z             Simulation object.
2025-01-14T13:16:42.8282250Z         """
2025-01-14T13:16:42.8282370Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8282510Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8282600Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8283090Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8283200Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8283340Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8283440Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8283520Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8283580Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8283630Z >       sim = run_tardis(
2025-01-14T13:16:42.8283700Z             config_verysimple,
2025-01-14T13:16:42.8283750Z             atom_data=atomic_data,
2025-01-14T13:16:42.8283810Z             show_convergence_plots=False,
2025-01-14T13:16:42.8283870Z             log_level="CRITICAl",
2025-01-14T13:16:42.8283920Z         )
2025-01-14T13:16:42.8283930Z 
2025-01-14T13:16:42.8284030Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8284120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8284180Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8284250Z     simulation.run_convergence()
2025-01-14T13:16:42.8284330Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8284440Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8284500Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8284620Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8284700Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8284710Z 
2025-01-14T13:16:42.8284910Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8285070Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8285470Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8285690Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8285840Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8293110Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8293140Z 
2025-01-14T13:16:42.8293220Z     def initialize_transport_state(
2025-01-14T13:16:42.8293270Z         self,
2025-01-14T13:16:42.8293320Z         simulation_state,
2025-01-14T13:16:42.8293370Z         opacity_state,
2025-01-14T13:16:42.8293420Z         macro_atom_state,
2025-01-14T13:16:42.8293470Z         plasma,
2025-01-14T13:16:42.8293520Z         no_of_packets,
2025-01-14T13:16:42.8293580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8293630Z         iteration=0,
2025-01-14T13:16:42.8293670Z     ):
2025-01-14T13:16:42.8293790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8293860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8293910Z         else:
2025-01-14T13:16:42.8293970Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8294010Z     
2025-01-14T13:16:42.8294120Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8294190Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8294240Z         )
2025-01-14T13:16:42.8294280Z     
2025-01-14T13:16:42.8294380Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8294470Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8294600Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8294640Z         else:
2025-01-14T13:16:42.8294710Z             continuum_state = None
2025-01-14T13:16:42.8294780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8294880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8294940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8295580Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8295650Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8295730Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8295800Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8295840Z         ).to_numba(
2025-01-14T13:16:42.8295900Z             macro_atom_state,
2025-01-14T13:16:42.8295960Z             self.line_interaction_type,
2025-01-14T13:16:42.8296010Z         )
2025-01-14T13:16:42.8296080Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8296310Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8296360Z         ]
2025-01-14T13:16:42.8296610Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8296620Z 
2025-01-14T13:16:42.8296740Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8297130Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl6] _
2025-01-14T13:16:42.8297140Z 
2025-01-14T13:16:42.8297690Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8297980Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8297990Z 
2025-01-14T13:16:42.8298050Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8298170Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8298220Z         """
2025-01-14T13:16:42.8298330Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8298500Z     
2025-01-14T13:16:42.8298550Z         Parameters
2025-01-14T13:16:42.8298600Z         ----------
2025-01-14T13:16:42.8299910Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8300050Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8300150Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8300200Z             Atomic data.
2025-01-14T13:16:42.8300250Z     
2025-01-14T13:16:42.8300290Z         Returns
2025-01-14T13:16:42.8300340Z         -------
2025-01-14T13:16:42.8300410Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8300470Z             Simulation object.
2025-01-14T13:16:42.8300520Z         """
2025-01-14T13:16:42.8300640Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8300780Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8300880Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8300980Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8301410Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8301580Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8301690Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8301770Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8301840Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8301900Z >       sim = run_tardis(
2025-01-14T13:16:42.8301950Z             config_verysimple,
2025-01-14T13:16:42.8302010Z             atom_data=atomic_data,
2025-01-14T13:16:42.8302080Z             show_convergence_plots=False,
2025-01-14T13:16:42.8302130Z             log_level="CRITICAl",
2025-01-14T13:16:42.8302180Z         )
2025-01-14T13:16:42.8302180Z 
2025-01-14T13:16:42.8302290Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8302390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8302610Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8302670Z     simulation.run_convergence()
2025-01-14T13:16:42.8302760Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8302870Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8302940Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8303070Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8303150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8303160Z 
2025-01-14T13:16:42.8303370Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8303530Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8303710Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8303930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8304060Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8304160Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8304170Z 
2025-01-14T13:16:42.8304240Z     def initialize_transport_state(
2025-01-14T13:16:42.8304280Z         self,
2025-01-14T13:16:42.8304340Z         simulation_state,
2025-01-14T13:16:42.8304390Z         opacity_state,
2025-01-14T13:16:42.8304440Z         macro_atom_state,
2025-01-14T13:16:42.8304480Z         plasma,
2025-01-14T13:16:42.8304530Z         no_of_packets,
2025-01-14T13:16:42.8304590Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8304630Z         iteration=0,
2025-01-14T13:16:42.8304670Z     ):
2025-01-14T13:16:42.8304770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8304920Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8304960Z         else:
2025-01-14T13:16:42.8305020Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8305060Z     
2025-01-14T13:16:42.8305180Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8305250Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8305290Z         )
2025-01-14T13:16:42.8305330Z     
2025-01-14T13:16:42.8305430Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8305520Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8306080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8306810Z         else:
2025-01-14T13:16:42.8306910Z             continuum_state = None
2025-01-14T13:16:42.8306990Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8307070Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8307140Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8307230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8307320Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8307380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8307450Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8307500Z         ).to_numba(
2025-01-14T13:16:42.8307550Z             macro_atom_state,
2025-01-14T13:16:42.8307620Z             self.line_interaction_type,
2025-01-14T13:16:42.8307660Z         )
2025-01-14T13:16:42.8307740Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8307960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8308010Z         ]
2025-01-14T13:16:42.8308250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8308260Z 
2025-01-14T13:16:42.8308370Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8308540Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl7] _
2025-01-14T13:16:42.8308680Z 
2025-01-14T13:16:42.8309220Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8309500Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8309500Z 
2025-01-14T13:16:42.8309570Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8309680Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8309720Z         """
2025-01-14T13:16:42.8309840Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8309880Z     
2025-01-14T13:16:42.8309940Z         Parameters
2025-01-14T13:16:42.8309980Z         ----------
2025-01-14T13:16:42.8310090Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8310190Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8310280Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8310330Z             Atomic data.
2025-01-14T13:16:42.8310370Z     
2025-01-14T13:16:42.8310420Z         Returns
2025-01-14T13:16:42.8310460Z         -------
2025-01-14T13:16:42.8310540Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8310590Z             Simulation object.
2025-01-14T13:16:42.8310640Z         """
2025-01-14T13:16:42.8310750Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8310890Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8310970Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8311130Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8311230Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8311380Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8311490Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8311560Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8311630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8311680Z >       sim = run_tardis(
2025-01-14T13:16:42.8311730Z             config_verysimple,
2025-01-14T13:16:42.8312150Z             atom_data=atomic_data,
2025-01-14T13:16:42.8312490Z             show_convergence_plots=False,
2025-01-14T13:16:42.8312660Z             log_level="CRITICAl",
2025-01-14T13:16:42.8312890Z         )
2025-01-14T13:16:42.8312900Z 
2025-01-14T13:16:42.8313210Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8313540Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8313750Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8313930Z     simulation.run_convergence()
2025-01-14T13:16:42.8314200Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8314500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8314700Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8315030Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8315270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8315280Z 
2025-01-14T13:16:42.8316460Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8316940Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8317410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8317990Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8318590Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8319120Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8319120Z 
2025-01-14T13:16:42.8319190Z     def initialize_transport_state(
2025-01-14T13:16:42.8319230Z         self,
2025-01-14T13:16:42.8319290Z         simulation_state,
2025-01-14T13:16:42.8319340Z         opacity_state,
2025-01-14T13:16:42.8319390Z         macro_atom_state,
2025-01-14T13:16:42.8319430Z         plasma,
2025-01-14T13:16:42.8319480Z         no_of_packets,
2025-01-14T13:16:42.8319540Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8319590Z         iteration=0,
2025-01-14T13:16:42.8319630Z     ):
2025-01-14T13:16:42.8319730Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8319800Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8319850Z         else:
2025-01-14T13:16:42.8319920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8319960Z     
2025-01-14T13:16:42.8320070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8320150Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8320190Z         )
2025-01-14T13:16:42.8320240Z     
2025-01-14T13:16:42.8320340Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8320420Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8320550Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8320590Z         else:
2025-01-14T13:16:42.8320650Z             continuum_state = None
2025-01-14T13:16:42.8320730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8320810Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8320870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8320960Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8321240Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8321320Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8321390Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8321430Z         ).to_numba(
2025-01-14T13:16:42.8321490Z             macro_atom_state,
2025-01-14T13:16:42.8321560Z             self.line_interaction_type,
2025-01-14T13:16:42.8321600Z         )
2025-01-14T13:16:42.8321670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8321900Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8321940Z         ]
2025-01-14T13:16:42.8322190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8322200Z 
2025-01-14T13:16:42.8322310Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8322470Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl8] _
2025-01-14T13:16:42.8322480Z 
2025-01-14T13:16:42.8323020Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8323310Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8323310Z 
2025-01-14T13:16:42.8323380Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8323490Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8323530Z         """
2025-01-14T13:16:42.8323650Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8323690Z     
2025-01-14T13:16:42.8323740Z         Parameters
2025-01-14T13:16:42.8323790Z         ----------
2025-01-14T13:16:42.8323910Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8324010Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8324150Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8324200Z             Atomic data.
2025-01-14T13:16:42.8324250Z     
2025-01-14T13:16:42.8324290Z         Returns
2025-01-14T13:16:42.8324330Z         -------
2025-01-14T13:16:42.8324410Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8324470Z             Simulation object.
2025-01-14T13:16:42.8324520Z         """
2025-01-14T13:16:42.8324640Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8324770Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8324860Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8324960Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8325060Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8325220Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8325330Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8325400Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8325470Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8325530Z >       sim = run_tardis(
2025-01-14T13:16:42.8325580Z             config_verysimple,
2025-01-14T13:16:42.8325640Z             atom_data=atomic_data,
2025-01-14T13:16:42.8325700Z             show_convergence_plots=False,
2025-01-14T13:16:42.8326030Z             log_level="CRITICAl",
2025-01-14T13:16:42.8327800Z         )
2025-01-14T13:16:42.8327810Z 
2025-01-14T13:16:42.8327940Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8328030Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8328090Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8328320Z     simulation.run_convergence()
2025-01-14T13:16:42.8328410Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8328530Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8328600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8328730Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8328810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8328810Z 
2025-01-14T13:16:42.8329020Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8329180Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8329350Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8329570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8329700Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8329810Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8329820Z 
2025-01-14T13:16:42.8329880Z     def initialize_transport_state(
2025-01-14T13:16:42.8329930Z         self,
2025-01-14T13:16:42.8329980Z         simulation_state,
2025-01-14T13:16:42.8330030Z         opacity_state,
2025-01-14T13:16:42.8330080Z         macro_atom_state,
2025-01-14T13:16:42.8330120Z         plasma,
2025-01-14T13:16:42.8330170Z         no_of_packets,
2025-01-14T13:16:42.8330230Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8330270Z         iteration=0,
2025-01-14T13:16:42.8330320Z     ):
2025-01-14T13:16:42.8330410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8330480Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8330530Z         else:
2025-01-14T13:16:42.8330580Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8330620Z     
2025-01-14T13:16:42.8330730Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8330800Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8330930Z         )
2025-01-14T13:16:42.8330970Z     
2025-01-14T13:16:42.8331070Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8331160Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8331280Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8331330Z         else:
2025-01-14T13:16:42.8331380Z             continuum_state = None
2025-01-14T13:16:42.8331460Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8331790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8331890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8331970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8332040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8332120Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8332180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8332230Z         ).to_numba(
2025-01-14T13:16:42.8332280Z             macro_atom_state,
2025-01-14T13:16:42.8332350Z             self.line_interaction_type,
2025-01-14T13:16:42.8332390Z         )
2025-01-14T13:16:42.8332470Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8332690Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8332740Z         ]
2025-01-14T13:16:42.8332980Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8332990Z 
2025-01-14T13:16:42.8333110Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8333280Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl9] _
2025-01-14T13:16:42.8333400Z 
2025-01-14T13:16:42.8333950Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8334240Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8334240Z 
2025-01-14T13:16:42.8334310Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8334420Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8334470Z         """
2025-01-14T13:16:42.8334590Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8334630Z     
2025-01-14T13:16:42.8334680Z         Parameters
2025-01-14T13:16:42.8334720Z         ----------
2025-01-14T13:16:42.8334840Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8334940Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8335030Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8335090Z             Atomic data.
2025-01-14T13:16:42.8335260Z     
2025-01-14T13:16:42.8335310Z         Returns
2025-01-14T13:16:42.8335360Z         -------
2025-01-14T13:16:42.8335430Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8335490Z             Simulation object.
2025-01-14T13:16:42.8335530Z         """
2025-01-14T13:16:42.8335650Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8335790Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8335870Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8335970Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8336940Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8337450Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8337770Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8338650Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8338940Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8339010Z >       sim = run_tardis(
2025-01-14T13:16:42.8339070Z             config_verysimple,
2025-01-14T13:16:42.8339130Z             atom_data=atomic_data,
2025-01-14T13:16:42.8339190Z             show_convergence_plots=False,
2025-01-14T13:16:42.8339250Z             log_level="CRITICAl",
2025-01-14T13:16:42.8339290Z         )
2025-01-14T13:16:42.8339290Z 
2025-01-14T13:16:42.8339400Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8339500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8339560Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8339620Z     simulation.run_convergence()
2025-01-14T13:16:42.8339720Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8339830Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8339910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8340030Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8340120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8340120Z 
2025-01-14T13:16:42.8340320Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8340490Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8340840Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8341070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8341190Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8341430Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8341430Z 
2025-01-14T13:16:42.8341490Z     def initialize_transport_state(
2025-01-14T13:16:42.8341540Z         self,
2025-01-14T13:16:42.8341600Z         simulation_state,
2025-01-14T13:16:42.8341650Z         opacity_state,
2025-01-14T13:16:42.8341700Z         macro_atom_state,
2025-01-14T13:16:42.8341740Z         plasma,
2025-01-14T13:16:42.8341790Z         no_of_packets,
2025-01-14T13:16:42.8341850Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8341890Z         iteration=0,
2025-01-14T13:16:42.8341930Z     ):
2025-01-14T13:16:42.8342030Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8342100Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8342150Z         else:
2025-01-14T13:16:42.8342200Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8342240Z     
2025-01-14T13:16:42.8342340Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8342410Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8342460Z         )
2025-01-14T13:16:42.8342500Z     
2025-01-14T13:16:42.8342610Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8342700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8342820Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8342870Z         else:
2025-01-14T13:16:42.8342930Z             continuum_state = None
2025-01-14T13:16:42.8343000Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8343080Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8343150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8343230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8343310Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8343380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8343440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8343490Z         ).to_numba(
2025-01-14T13:16:42.8343540Z             macro_atom_state,
2025-01-14T13:16:42.8343880Z             self.line_interaction_type,
2025-01-14T13:16:42.8343930Z         )
2025-01-14T13:16:42.8344010Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8344230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8344270Z         ]
2025-01-14T13:16:42.8344520Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8344520Z 
2025-01-14T13:16:42.8344630Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8344790Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl10] _
2025-01-14T13:16:42.8344800Z 
2025-01-14T13:16:42.8345330Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8345620Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8345620Z 
2025-01-14T13:16:42.8345680Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8345790Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8345840Z         """
2025-01-14T13:16:42.8345950Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8345990Z     
2025-01-14T13:16:42.8346040Z         Parameters
2025-01-14T13:16:42.8346080Z         ----------
2025-01-14T13:16:42.8346200Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8346290Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8346580Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8346630Z             Atomic data.
2025-01-14T13:16:42.8346680Z     
2025-01-14T13:16:42.8346730Z         Returns
2025-01-14T13:16:42.8346770Z         -------
2025-01-14T13:16:42.8346850Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8346910Z             Simulation object.
2025-01-14T13:16:42.8346950Z         """
2025-01-14T13:16:42.8347070Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8347200Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8347290Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8347400Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8347500Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8347640Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8347740Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8347820Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8347890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8347940Z >       sim = run_tardis(
2025-01-14T13:16:42.8347990Z             config_verysimple,
2025-01-14T13:16:42.8348050Z             atom_data=atomic_data,
2025-01-14T13:16:42.8348110Z             show_convergence_plots=False,
2025-01-14T13:16:42.8348170Z             log_level="CRITICAl",
2025-01-14T13:16:42.8348210Z         )
2025-01-14T13:16:42.8348210Z 
2025-01-14T13:16:42.8348320Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8348410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8348470Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8348530Z     simulation.run_convergence()
2025-01-14T13:16:42.8348620Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8348730Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8348800Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8349370Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8349500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8349500Z 
2025-01-14T13:16:42.8349720Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8349880Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8350060Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8350280Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8350400Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8350520Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8350520Z 
2025-01-14T13:16:42.8350590Z     def initialize_transport_state(
2025-01-14T13:16:42.8350640Z         self,
2025-01-14T13:16:42.8350690Z         simulation_state,
2025-01-14T13:16:42.8350740Z         opacity_state,
2025-01-14T13:16:42.8350790Z         macro_atom_state,
2025-01-14T13:16:42.8350850Z         plasma,
2025-01-14T13:16:42.8350890Z         no_of_packets,
2025-01-14T13:16:42.8350950Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8351000Z         iteration=0,
2025-01-14T13:16:42.8351040Z     ):
2025-01-14T13:16:42.8351150Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8351220Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8351270Z         else:
2025-01-14T13:16:42.8351320Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8351370Z     
2025-01-14T13:16:42.8351480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8351550Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8351750Z         )
2025-01-14T13:16:42.8351790Z     
2025-01-14T13:16:42.8351890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8351990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8352110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8352150Z         else:
2025-01-14T13:16:42.8352210Z             continuum_state = None
2025-01-14T13:16:42.8352280Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8352370Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8352430Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8352520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8352590Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8352660Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8352720Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8352770Z         ).to_numba(
2025-01-14T13:16:42.8352820Z             macro_atom_state,
2025-01-14T13:16:42.8352890Z             self.line_interaction_type,
2025-01-14T13:16:42.8352930Z         )
2025-01-14T13:16:42.8353010Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8353230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8353270Z         ]
2025-01-14T13:16:42.8353520Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8353520Z 
2025-01-14T13:16:42.8353640Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8353800Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl11] _
2025-01-14T13:16:42.8353810Z 
2025-01-14T13:16:42.8354350Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8354640Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8354720Z 
2025-01-14T13:16:42.8354780Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8354900Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8359950Z         """
2025-01-14T13:16:42.8360120Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8360160Z     
2025-01-14T13:16:42.8360210Z         Parameters
2025-01-14T13:16:42.8360260Z         ----------
2025-01-14T13:16:42.8360370Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8360470Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8360550Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8360610Z             Atomic data.
2025-01-14T13:16:42.8360650Z     
2025-01-14T13:16:42.8360700Z         Returns
2025-01-14T13:16:42.8360750Z         -------
2025-01-14T13:16:42.8360830Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8360880Z             Simulation object.
2025-01-14T13:16:42.8360930Z         """
2025-01-14T13:16:42.8361040Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8361180Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8361270Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8361360Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8361470Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8361610Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8361720Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8361790Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8362020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8362070Z >       sim = run_tardis(
2025-01-14T13:16:42.8362130Z             config_verysimple,
2025-01-14T13:16:42.8362190Z             atom_data=atomic_data,
2025-01-14T13:16:42.8362250Z             show_convergence_plots=False,
2025-01-14T13:16:42.8362310Z             log_level="CRITICAl",
2025-01-14T13:16:42.8362350Z         )
2025-01-14T13:16:42.8362350Z 
2025-01-14T13:16:42.8362460Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8362550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8362610Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8362670Z     simulation.run_convergence()
2025-01-14T13:16:42.8362760Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8362860Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8362940Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8363060Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8363150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8363150Z 
2025-01-14T13:16:42.8363350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8363510Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8363690Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8363900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8364030Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8364140Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8364140Z 
2025-01-14T13:16:42.8364200Z     def initialize_transport_state(
2025-01-14T13:16:42.8364250Z         self,
2025-01-14T13:16:42.8364300Z         simulation_state,
2025-01-14T13:16:42.8364350Z         opacity_state,
2025-01-14T13:16:42.8364480Z         macro_atom_state,
2025-01-14T13:16:42.8364520Z         plasma,
2025-01-14T13:16:42.8364570Z         no_of_packets,
2025-01-14T13:16:42.8364630Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8364670Z         iteration=0,
2025-01-14T13:16:42.8364720Z     ):
2025-01-14T13:16:42.8364820Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8364890Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8364930Z         else:
2025-01-14T13:16:42.8364990Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8365030Z     
2025-01-14T13:16:42.8365130Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8365200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8365250Z         )
2025-01-14T13:16:42.8365290Z     
2025-01-14T13:16:42.8365390Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8365480Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8365600Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8365640Z         else:
2025-01-14T13:16:42.8365710Z             continuum_state = None
2025-01-14T13:16:42.8365780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8365860Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8365940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8366020Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8366090Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8366150Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8366220Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8366270Z         ).to_numba(
2025-01-14T13:16:42.8366330Z             macro_atom_state,
2025-01-14T13:16:42.8366380Z             self.line_interaction_type,
2025-01-14T13:16:42.8366480Z         )
2025-01-14T13:16:42.8366550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8366780Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8366820Z         ]
2025-01-14T13:16:42.8367070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8367070Z 
2025-01-14T13:16:42.8367190Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8367350Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl12] _
2025-01-14T13:16:42.8367360Z 
2025-01-14T13:16:42.8367900Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8368180Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8368190Z 
2025-01-14T13:16:42.8368250Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8368360Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8368400Z         """
2025-01-14T13:16:42.8368520Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8368560Z     
2025-01-14T13:16:42.8368600Z         Parameters
2025-01-14T13:16:42.8368650Z         ----------
2025-01-14T13:16:42.8368760Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8368860Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8368950Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8369000Z             Atomic data.
2025-01-14T13:16:42.8369040Z     
2025-01-14T13:16:42.8369080Z         Returns
2025-01-14T13:16:42.8369130Z         -------
2025-01-14T13:16:42.8369210Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8369510Z             Simulation object.
2025-01-14T13:16:42.8369550Z         """
2025-01-14T13:16:42.8369670Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8369810Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8369900Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8370000Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8370100Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8370240Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8370340Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8370410Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8370480Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8370530Z >       sim = run_tardis(
2025-01-14T13:16:42.8370590Z             config_verysimple,
2025-01-14T13:16:42.8370650Z             atom_data=atomic_data,
2025-01-14T13:16:42.8370710Z             show_convergence_plots=False,
2025-01-14T13:16:42.8370770Z             log_level="CRITICAl",
2025-01-14T13:16:42.8370810Z         )
2025-01-14T13:16:42.8370810Z 
2025-01-14T13:16:42.8370920Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8371010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8371060Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8371130Z     simulation.run_convergence()
2025-01-14T13:16:42.8371210Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8371320Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8371380Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8371500Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8371790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8371800Z 
2025-01-14T13:16:42.8372010Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8372170Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8372340Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8372560Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8372680Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8372790Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8372790Z 
2025-01-14T13:16:42.8372850Z     def initialize_transport_state(
2025-01-14T13:16:42.8372900Z         self,
2025-01-14T13:16:42.8372950Z         simulation_state,
2025-01-14T13:16:42.8373000Z         opacity_state,
2025-01-14T13:16:42.8373050Z         macro_atom_state,
2025-01-14T13:16:42.8373100Z         plasma,
2025-01-14T13:16:42.8373150Z         no_of_packets,
2025-01-14T13:16:42.8373200Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8373250Z         iteration=0,
2025-01-14T13:16:42.8373290Z     ):
2025-01-14T13:16:42.8373390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8373460Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8373500Z         else:
2025-01-14T13:16:42.8373560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8373600Z     
2025-01-14T13:16:42.8373700Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8373770Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8373810Z         )
2025-01-14T13:16:42.8373850Z     
2025-01-14T13:16:42.8373950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8374040Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8374160Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8374260Z         else:
2025-01-14T13:16:42.8374320Z             continuum_state = None
2025-01-14T13:16:42.8374400Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8374480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8374540Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8374620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8374690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8374760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8374830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8374870Z         ).to_numba(
2025-01-14T13:16:42.8374920Z             macro_atom_state,
2025-01-14T13:16:42.8374980Z             self.line_interaction_type,
2025-01-14T13:16:42.8375020Z         )
2025-01-14T13:16:42.8375100Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8375460Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8375510Z         ]
2025-01-14T13:16:42.8375750Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8375750Z 
2025-01-14T13:16:42.8375860Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8376030Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl13] _
2025-01-14T13:16:42.8376030Z 
2025-01-14T13:16:42.8376560Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8376840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8376910Z 
2025-01-14T13:16:42.8376980Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8377090Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8377140Z         """
2025-01-14T13:16:42.8377250Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8377290Z     
2025-01-14T13:16:42.8377340Z         Parameters
2025-01-14T13:16:42.8377380Z         ----------
2025-01-14T13:16:42.8377490Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8377590Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8377680Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8377730Z             Atomic data.
2025-01-14T13:16:42.8377770Z     
2025-01-14T13:16:42.8377820Z         Returns
2025-01-14T13:16:42.8377860Z         -------
2025-01-14T13:16:42.8377930Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8377990Z             Simulation object.
2025-01-14T13:16:42.8378040Z         """
2025-01-14T13:16:42.8378160Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8378290Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8378380Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8378480Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8378580Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8378720Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8378830Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8378900Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8378970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8379020Z >       sim = run_tardis(
2025-01-14T13:16:42.8379070Z             config_verysimple,
2025-01-14T13:16:42.8379130Z             atom_data=atomic_data,
2025-01-14T13:16:42.8379190Z             show_convergence_plots=False,
2025-01-14T13:16:42.8379300Z             log_level="CRITICAl",
2025-01-14T13:16:42.8379350Z         )
2025-01-14T13:16:42.8379350Z 
2025-01-14T13:16:42.8379460Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8379550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8379610Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8379670Z     simulation.run_convergence()
2025-01-14T13:16:42.8379750Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8379860Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8379930Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8380040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8380130Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8380140Z 
2025-01-14T13:16:42.8380350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8380500Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8380680Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8380890Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8381020Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8381120Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8381120Z 
2025-01-14T13:16:42.8381190Z     def initialize_transport_state(
2025-01-14T13:16:42.8381230Z         self,
2025-01-14T13:16:42.8381280Z         simulation_state,
2025-01-14T13:16:42.8381330Z         opacity_state,
2025-01-14T13:16:42.8381380Z         macro_atom_state,
2025-01-14T13:16:42.8381480Z         plasma,
2025-01-14T13:16:42.8381530Z         no_of_packets,
2025-01-14T13:16:42.8381580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8381630Z         iteration=0,
2025-01-14T13:16:42.8381680Z     ):
2025-01-14T13:16:42.8381770Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8381850Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8381890Z         else:
2025-01-14T13:16:42.8381940Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8381980Z     
2025-01-14T13:16:42.8382090Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8382160Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8382210Z         )
2025-01-14T13:16:42.8382250Z     
2025-01-14T13:16:42.8382350Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8382440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8382560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8382610Z         else:
2025-01-14T13:16:42.8382670Z             continuum_state = None
2025-01-14T13:16:42.8382750Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8382830Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8382900Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8382980Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8383050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8383120Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8383180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8383230Z         ).to_numba(
2025-01-14T13:16:42.8383280Z             macro_atom_state,
2025-01-14T13:16:42.8383340Z             self.line_interaction_type,
2025-01-14T13:16:42.8383380Z         )
2025-01-14T13:16:42.8383450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8383680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8383730Z         ]
2025-01-14T13:16:42.8384030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8384030Z 
2025-01-14T13:16:42.8384140Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8384310Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl14] _
2025-01-14T13:16:42.8384310Z 
2025-01-14T13:16:42.8384840Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8385120Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8385120Z 
2025-01-14T13:16:42.8385180Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8385300Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8385340Z         """
2025-01-14T13:16:42.8385460Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8385500Z     
2025-01-14T13:16:42.8385550Z         Parameters
2025-01-14T13:16:42.8385600Z         ----------
2025-01-14T13:16:42.8385710Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8385800Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8385890Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8385940Z             Atomic data.
2025-01-14T13:16:42.8385990Z     
2025-01-14T13:16:42.8386030Z         Returns
2025-01-14T13:16:42.8386070Z         -------
2025-01-14T13:16:42.8386150Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8386210Z             Simulation object.
2025-01-14T13:16:42.8386300Z         """
2025-01-14T13:16:42.8386420Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8386570Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8386650Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8386750Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8386850Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8386990Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8387100Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8387170Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8387240Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8387290Z >       sim = run_tardis(
2025-01-14T13:16:42.8387340Z             config_verysimple,
2025-01-14T13:16:42.8387400Z             atom_data=atomic_data,
2025-01-14T13:16:42.8387470Z             show_convergence_plots=False,
2025-01-14T13:16:42.8387530Z             log_level="CRITICAl",
2025-01-14T13:16:42.8387570Z         )
2025-01-14T13:16:42.8387580Z 
2025-01-14T13:16:42.8387680Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8387770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8387830Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8387890Z     simulation.run_convergence()
2025-01-14T13:16:42.8387970Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8388080Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8388140Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8388260Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8388350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8388350Z 
2025-01-14T13:16:42.8388550Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8388720Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8390310Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8391900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8392240Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8392530Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8392540Z 
2025-01-14T13:16:42.8392720Z     def initialize_transport_state(
2025-01-14T13:16:42.8392870Z         self,
2025-01-14T13:16:42.8393040Z         simulation_state,
2025-01-14T13:16:42.8393190Z         opacity_state,
2025-01-14T13:16:42.8393570Z         macro_atom_state,
2025-01-14T13:16:42.8393680Z         plasma,
2025-01-14T13:16:42.8393730Z         no_of_packets,
2025-01-14T13:16:42.8393810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8393860Z         iteration=0,
2025-01-14T13:16:42.8393900Z     ):
2025-01-14T13:16:42.8394010Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8394080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8394130Z         else:
2025-01-14T13:16:42.8394180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8394230Z     
2025-01-14T13:16:42.8394340Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8394410Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8394460Z         )
2025-01-14T13:16:42.8394500Z     
2025-01-14T13:16:42.8394600Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8394690Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8394820Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8394860Z         else:
2025-01-14T13:16:42.8395390Z             continuum_state = None
2025-01-14T13:16:42.8395460Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8395550Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8395620Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8395710Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8395780Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8395850Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8395910Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8395960Z         ).to_numba(
2025-01-14T13:16:42.8396010Z             macro_atom_state,
2025-01-14T13:16:42.8396080Z             self.line_interaction_type,
2025-01-14T13:16:42.8396120Z         )
2025-01-14T13:16:42.8396190Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8396420Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8396470Z         ]
2025-01-14T13:16:42.8396720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8396720Z 
2025-01-14T13:16:42.8396840Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8397010Z _ ERROR at setup of TestSDECPlotter.test_mpl_image[plotter_generate_plot_mpl15] _
2025-01-14T13:16:42.8397010Z 
2025-01-14T13:16:42.8397560Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8397850Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8397850Z 
2025-01-14T13:16:42.8397920Z     @pytest.fixture(scope="module")
2025-01-14T13:16:42.8398040Z     def simulation_simple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8398100Z         """
2025-01-14T13:16:42.8398210Z         Instantiate SDEC plotter using a simple simulation model.
2025-01-14T13:16:42.8398390Z     
2025-01-14T13:16:42.8398440Z         Parameters
2025-01-14T13:16:42.8398490Z         ----------
2025-01-14T13:16:42.8398600Z         config_verysimple : tardis.io.config_reader.Configuration
2025-01-14T13:16:42.8398700Z             Configuration object for a very simple simulation.
2025-01-14T13:16:42.8398790Z         atomic_dataset : str or tardis.atomic.AtomData
2025-01-14T13:16:42.8398840Z             Atomic data.
2025-01-14T13:16:42.8398880Z     
2025-01-14T13:16:42.8398920Z         Returns
2025-01-14T13:16:42.8398970Z         -------
2025-01-14T13:16:42.8399040Z         sim: tardis.simulation.base.Simulation
2025-01-14T13:16:42.8399100Z             Simulation object.
2025-01-14T13:16:42.8399140Z         """
2025-01-14T13:16:42.8399260Z         # Setup simulation configuration using config_verysimple and
2025-01-14T13:16:42.8399400Z         # override properties in such a way to make the simulation run faster
2025-01-14T13:16:42.8399500Z         config_verysimple.montecarlo.iterations = 3
2025-01-14T13:16:42.8399590Z         config_verysimple.montecarlo.no_of_packets = 4000
2025-01-14T13:16:42.8399700Z         config_verysimple.montecarlo.last_no_of_packets = -1
2025-01-14T13:16:42.8399850Z         config_verysimple.spectrum.virtual.virtual_packet_logging = True
2025-01-14T13:16:42.8399960Z         config_verysimple.montecarlo.no_of_virtual_packets = 1
2025-01-14T13:16:42.8400030Z         config_verysimple.spectrum.num = 2000
2025-01-14T13:16:42.8400100Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8400150Z >       sim = run_tardis(
2025-01-14T13:16:42.8400210Z             config_verysimple,
2025-01-14T13:16:42.8400260Z             atom_data=atomic_data,
2025-01-14T13:16:42.8400330Z             show_convergence_plots=False,
2025-01-14T13:16:42.8400380Z             log_level="CRITICAl",
2025-01-14T13:16:42.8400490Z         )
2025-01-14T13:16:42.8400490Z 
2025-01-14T13:16:42.8400610Z tardis/visualization/tools/tests/test_sdec_plot.py:73: 
2025-01-14T13:16:42.8400700Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8400760Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.8400820Z     simulation.run_convergence()
2025-01-14T13:16:42.8400910Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.8401010Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8401080Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8401200Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8401280Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8401290Z 
2025-01-14T13:16:42.8401500Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x31639e270>
2025-01-14T13:16:42.8401660Z simulation_state = <tardis.model.base.SimulationState object at 0x17491d910>
2025-01-14T13:16:42.8401840Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x310ae8860>
2025-01-14T13:16:42.8402050Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x310aeaea0>
2025-01-14T13:16:42.8402180Z plasma = <tardis.plasma.base.BasePlasma object at 0x3163add60>
2025-01-14T13:16:42.8402280Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.8402290Z 
2025-01-14T13:16:42.8402350Z     def initialize_transport_state(
2025-01-14T13:16:42.8402700Z         self,
2025-01-14T13:16:42.8402800Z         simulation_state,
2025-01-14T13:16:42.8402850Z         opacity_state,
2025-01-14T13:16:42.8402900Z         macro_atom_state,
2025-01-14T13:16:42.8402950Z         plasma,
2025-01-14T13:16:42.8403000Z         no_of_packets,
2025-01-14T13:16:42.8403060Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8403100Z         iteration=0,
2025-01-14T13:16:42.8403160Z     ):
2025-01-14T13:16:42.8403260Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8403500Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8403540Z         else:
2025-01-14T13:16:42.8403600Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8403640Z     
2025-01-14T13:16:42.8403750Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8403820Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8403870Z         )
2025-01-14T13:16:42.8403910Z     
2025-01-14T13:16:42.8404010Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8404110Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8404400Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8405570Z         else:
2025-01-14T13:16:42.8405770Z             continuum_state = None
2025-01-14T13:16:42.8405990Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8406250Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8406500Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8406740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8406970Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8407160Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8407360Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8407640Z         ).to_numba(
2025-01-14T13:16:42.8407860Z             macro_atom_state,
2025-01-14T13:16:42.8408150Z             self.line_interaction_type,
2025-01-14T13:16:42.8408290Z         )
2025-01-14T13:16:42.8408590Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8409190Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8409330Z         ]
2025-01-14T13:16:42.8409990Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8410540Z 
2025-01-14T13:16:42.8411020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8411310Z _ ERROR at setup of TestLineInfoWidgetData.test_get_species_interactions[wavelength_range0-packet_out_nu] _
2025-01-14T13:16:42.8411310Z 
2025-01-14T13:16:42.8411860Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8412150Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8412150Z 
2025-01-14T13:16:42.8412210Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8412340Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8412420Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8412580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8412660Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8412710Z >       sim.run_final()
2025-01-14T13:16:42.8412710Z 
2025-01-14T13:16:42.8412770Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8412860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8412930Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8413040Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8413110Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8413230Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8413330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8413330Z 
2025-01-14T13:16:42.8413540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8413700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8414030Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8414250Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8414370Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8414480Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8414480Z 
2025-01-14T13:16:42.8414550Z     def initialize_transport_state(
2025-01-14T13:16:42.8414590Z         self,
2025-01-14T13:16:42.8414650Z         simulation_state,
2025-01-14T13:16:42.8414690Z         opacity_state,
2025-01-14T13:16:42.8414750Z         macro_atom_state,
2025-01-14T13:16:42.8414790Z         plasma,
2025-01-14T13:16:42.8414840Z         no_of_packets,
2025-01-14T13:16:42.8414900Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8414950Z         iteration=0,
2025-01-14T13:16:42.8414990Z     ):
2025-01-14T13:16:42.8415090Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8415160Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8415210Z         else:
2025-01-14T13:16:42.8415260Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8415300Z     
2025-01-14T13:16:42.8415510Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8415960Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8416180Z         )
2025-01-14T13:16:42.8416230Z     
2025-01-14T13:16:42.8416350Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8416440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8416570Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8416610Z         else:
2025-01-14T13:16:42.8416680Z             continuum_state = None
2025-01-14T13:16:42.8416890Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8416980Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8417050Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8417130Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8417210Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8417270Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8424560Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8424650Z         ).to_numba(
2025-01-14T13:16:42.8424710Z             macro_atom_state,
2025-01-14T13:16:42.8424770Z             self.line_interaction_type,
2025-01-14T13:16:42.8424820Z         )
2025-01-14T13:16:42.8424890Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8425120Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8425170Z         ]
2025-01-14T13:16:42.8425420Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8425420Z 
2025-01-14T13:16:42.8425540Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8425770Z _ ERROR at setup of TestLineInfoWidgetData.test_get_species_interactions[wavelength_range1-packet_in_nu] _
2025-01-14T13:16:42.8425770Z 
2025-01-14T13:16:42.8426300Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8426690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8426700Z 
2025-01-14T13:16:42.8426780Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8426910Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8426990Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8427490Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8427540Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8427610Z >       sim.run_final()
2025-01-14T13:16:42.8427610Z 
2025-01-14T13:16:42.8427670Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8427760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8427820Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8427950Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8428020Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8428140Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8428230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8428230Z 
2025-01-14T13:16:42.8428440Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8428600Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8428770Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8428990Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8429110Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8429220Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8429220Z 
2025-01-14T13:16:42.8429280Z     def initialize_transport_state(
2025-01-14T13:16:42.8429330Z         self,
2025-01-14T13:16:42.8429380Z         simulation_state,
2025-01-14T13:16:42.8429430Z         opacity_state,
2025-01-14T13:16:42.8429480Z         macro_atom_state,
2025-01-14T13:16:42.8429530Z         plasma,
2025-01-14T13:16:42.8429800Z         no_of_packets,
2025-01-14T13:16:42.8429860Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8429910Z         iteration=0,
2025-01-14T13:16:42.8429960Z     ):
2025-01-14T13:16:42.8430050Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8430120Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8430170Z         else:
2025-01-14T13:16:42.8430220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8430260Z     
2025-01-14T13:16:42.8430370Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8430440Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8430490Z         )
2025-01-14T13:16:42.8430530Z     
2025-01-14T13:16:42.8430630Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8430720Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8430840Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8430880Z         else:
2025-01-14T13:16:42.8430940Z             continuum_state = None
2025-01-14T13:16:42.8431010Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8431100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8431170Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8431250Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8431320Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8431380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8431450Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8431490Z         ).to_numba(
2025-01-14T13:16:42.8431540Z             macro_atom_state,
2025-01-14T13:16:42.8431610Z             self.line_interaction_type,
2025-01-14T13:16:42.8431650Z         )
2025-01-14T13:16:42.8431720Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8432040Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8432120Z         ]
2025-01-14T13:16:42.8432370Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8432480Z 
2025-01-14T13:16:42.8432610Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8432850Z _ ERROR at setup of TestLineInfoWidgetData.test_get_species_interactions[wavelength_range2-packet_out_nu] _
2025-01-14T13:16:42.8432860Z 
2025-01-14T13:16:42.8433390Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8433700Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8433700Z 
2025-01-14T13:16:42.8433770Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8433900Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8433980Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8434120Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8434180Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8434230Z >       sim.run_final()
2025-01-14T13:16:42.8434230Z 
2025-01-14T13:16:42.8434290Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8434380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8434450Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8434560Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8434630Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8434750Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8434840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8434890Z 
2025-01-14T13:16:42.8435110Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8435270Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8435450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8435670Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8435790Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8435900Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8435900Z 
2025-01-14T13:16:42.8435970Z     def initialize_transport_state(
2025-01-14T13:16:42.8436010Z         self,
2025-01-14T13:16:42.8436070Z         simulation_state,
2025-01-14T13:16:42.8436120Z         opacity_state,
2025-01-14T13:16:42.8436160Z         macro_atom_state,
2025-01-14T13:16:42.8436210Z         plasma,
2025-01-14T13:16:42.8436260Z         no_of_packets,
2025-01-14T13:16:42.8436320Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8436370Z         iteration=0,
2025-01-14T13:16:42.8436420Z     ):
2025-01-14T13:16:42.8436520Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8436600Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8436640Z         else:
2025-01-14T13:16:42.8436700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8436740Z     
2025-01-14T13:16:42.8436840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8436910Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8436960Z         )
2025-01-14T13:16:42.8437000Z     
2025-01-14T13:16:42.8437100Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8437190Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8437310Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8437360Z         else:
2025-01-14T13:16:42.8437420Z             continuum_state = None
2025-01-14T13:16:42.8437550Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8437640Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8437710Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8437790Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8437860Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8437930Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8438000Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8438040Z         ).to_numba(
2025-01-14T13:16:42.8438100Z             macro_atom_state,
2025-01-14T13:16:42.8438160Z             self.line_interaction_type,
2025-01-14T13:16:42.8438210Z         )
2025-01-14T13:16:42.8438280Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8438510Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8438560Z         ]
2025-01-14T13:16:42.8438810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8438810Z 
2025-01-14T13:16:42.8438920Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8439120Z _ ERROR at setup of TestLineInfoWidgetData.test_get_species_interactions[None-packet_in_nu] _
2025-01-14T13:16:42.8439120Z 
2025-01-14T13:16:42.8439660Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8439940Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8439990Z 
2025-01-14T13:16:42.8440060Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8440180Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8440260Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8440400Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8440460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8440510Z >       sim.run_final()
2025-01-14T13:16:42.8440510Z 
2025-01-14T13:16:42.8440570Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8440660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8440730Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8440840Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8440910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8441040Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8441140Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8441140Z 
2025-01-14T13:16:42.8441350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8441510Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8441680Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8441900Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8442020Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8442130Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8442130Z 
2025-01-14T13:16:42.8442190Z     def initialize_transport_state(
2025-01-14T13:16:42.8442240Z         self,
2025-01-14T13:16:42.8442290Z         simulation_state,
2025-01-14T13:16:42.8442340Z         opacity_state,
2025-01-14T13:16:42.8442390Z         macro_atom_state,
2025-01-14T13:16:42.8442440Z         plasma,
2025-01-14T13:16:42.8442490Z         no_of_packets,
2025-01-14T13:16:42.8442600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8442650Z         iteration=0,
2025-01-14T13:16:42.8442690Z     ):
2025-01-14T13:16:42.8442790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8442850Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8442900Z         else:
2025-01-14T13:16:42.8442950Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8442990Z     
2025-01-14T13:16:42.8443100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8443160Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8443210Z         )
2025-01-14T13:16:42.8443250Z     
2025-01-14T13:16:42.8443350Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8443440Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8443560Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8443610Z         else:
2025-01-14T13:16:42.8443670Z             continuum_state = None
2025-01-14T13:16:42.8443740Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8443830Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8443890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8443970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8444040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8444110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8444180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8444220Z         ).to_numba(
2025-01-14T13:16:42.8444280Z             macro_atom_state,
2025-01-14T13:16:42.8444340Z             self.line_interaction_type,
2025-01-14T13:16:42.8444380Z         )
2025-01-14T13:16:42.8444450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8444720Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8444770Z         ]
2025-01-14T13:16:42.8445020Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8445020Z 
2025-01-14T13:16:42.8445130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8445370Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[exc-wavelength_range0-packet_out_nu] _
2025-01-14T13:16:42.8445370Z 
2025-01-14T13:16:42.8445900Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8446170Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8446180Z 
2025-01-14T13:16:42.8446250Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8446370Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8446450Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8446580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8446650Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8446700Z >       sim.run_final()
2025-01-14T13:16:42.8446700Z 
2025-01-14T13:16:42.8446760Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8446840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8446910Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8447020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8447090Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8447210Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8447290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8447550Z 
2025-01-14T13:16:42.8448220Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8448750Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8449230Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8449870Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8451750Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8451920Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8451920Z 
2025-01-14T13:16:42.8451990Z     def initialize_transport_state(
2025-01-14T13:16:42.8452040Z         self,
2025-01-14T13:16:42.8452090Z         simulation_state,
2025-01-14T13:16:42.8452150Z         opacity_state,
2025-01-14T13:16:42.8452200Z         macro_atom_state,
2025-01-14T13:16:42.8452260Z         plasma,
2025-01-14T13:16:42.8452310Z         no_of_packets,
2025-01-14T13:16:42.8452370Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8452420Z         iteration=0,
2025-01-14T13:16:42.8452460Z     ):
2025-01-14T13:16:42.8452560Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8452630Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8452680Z         else:
2025-01-14T13:16:42.8452740Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8452780Z     
2025-01-14T13:16:42.8452890Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8452970Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8453010Z         )
2025-01-14T13:16:42.8453050Z     
2025-01-14T13:16:42.8453150Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8453710Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8453840Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8453890Z         else:
2025-01-14T13:16:42.8453940Z             continuum_state = None
2025-01-14T13:16:42.8454020Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8454110Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8454170Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8454260Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8454330Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8454400Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8454460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8454510Z         ).to_numba(
2025-01-14T13:16:42.8454560Z             macro_atom_state,
2025-01-14T13:16:42.8454620Z             self.line_interaction_type,
2025-01-14T13:16:42.8454670Z         )
2025-01-14T13:16:42.8454750Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8454970Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8455020Z         ]
2025-01-14T13:16:42.8455270Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8455270Z 
2025-01-14T13:16:42.8455380Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8456130Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[exc-wavelength_range1-packet_in_nu] _
2025-01-14T13:16:42.8456150Z 
2025-01-14T13:16:42.8456720Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8457020Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8457160Z 
2025-01-14T13:16:42.8457230Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8457360Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8457450Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8457590Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8457660Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8457710Z >       sim.run_final()
2025-01-14T13:16:42.8457720Z 
2025-01-14T13:16:42.8457770Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8457870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8457940Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8458050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8458120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8458250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8458340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8458340Z 
2025-01-14T13:16:42.8458560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8458720Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8458900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8459120Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8459250Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8459350Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8459360Z 
2025-01-14T13:16:42.8459420Z     def initialize_transport_state(
2025-01-14T13:16:42.8459540Z         self,
2025-01-14T13:16:42.8459590Z         simulation_state,
2025-01-14T13:16:42.8459650Z         opacity_state,
2025-01-14T13:16:42.8459700Z         macro_atom_state,
2025-01-14T13:16:42.8459750Z         plasma,
2025-01-14T13:16:42.8459790Z         no_of_packets,
2025-01-14T13:16:42.8459890Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8459940Z         iteration=0,
2025-01-14T13:16:42.8459980Z     ):
2025-01-14T13:16:42.8460080Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8460150Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8460200Z         else:
2025-01-14T13:16:42.8460250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8460290Z     
2025-01-14T13:16:42.8460400Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8460470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8460520Z         )
2025-01-14T13:16:42.8460560Z     
2025-01-14T13:16:42.8460660Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8460750Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8460880Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8460930Z         else:
2025-01-14T13:16:42.8460980Z             continuum_state = None
2025-01-14T13:16:42.8461980Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8462280Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8462480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8462700Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8462910Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8463100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8463510Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8463620Z         ).to_numba(
2025-01-14T13:16:42.8463680Z             macro_atom_state,
2025-01-14T13:16:42.8463750Z             self.line_interaction_type,
2025-01-14T13:16:42.8463800Z         )
2025-01-14T13:16:42.8463870Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8464240Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8464280Z         ]
2025-01-14T13:16:42.8464530Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8464540Z 
2025-01-14T13:16:42.8464660Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8464890Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[exc-wavelength_range2-packet_out_nu] _
2025-01-14T13:16:42.8464890Z 
2025-01-14T13:16:42.8465430Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8465720Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8465730Z 
2025-01-14T13:16:42.8465790Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8465920Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8465990Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8466140Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8466470Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8466560Z >       sim.run_final()
2025-01-14T13:16:42.8466570Z 
2025-01-14T13:16:42.8466630Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8466730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8466800Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8466920Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8467120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8467250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8467340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8467350Z 
2025-01-14T13:16:42.8467560Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8467720Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8467890Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8468120Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8468240Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8468350Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8468360Z 
2025-01-14T13:16:42.8468420Z     def initialize_transport_state(
2025-01-14T13:16:42.8468470Z         self,
2025-01-14T13:16:42.8468530Z         simulation_state,
2025-01-14T13:16:42.8468580Z         opacity_state,
2025-01-14T13:16:42.8468640Z         macro_atom_state,
2025-01-14T13:16:42.8468690Z         plasma,
2025-01-14T13:16:42.8468740Z         no_of_packets,
2025-01-14T13:16:42.8468800Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8468840Z         iteration=0,
2025-01-14T13:16:42.8468890Z     ):
2025-01-14T13:16:42.8468990Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8469060Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8469110Z         else:
2025-01-14T13:16:42.8469170Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8469210Z     
2025-01-14T13:16:42.8469320Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8469400Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8469450Z         )
2025-01-14T13:16:42.8469490Z     
2025-01-14T13:16:42.8469600Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8469770Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8469900Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8469950Z         else:
2025-01-14T13:16:42.8470010Z             continuum_state = None
2025-01-14T13:16:42.8470080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8470170Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8470240Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8470330Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8470630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8470910Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8471110Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8471250Z         ).to_numba(
2025-01-14T13:16:42.8471720Z             macro_atom_state,
2025-01-14T13:16:42.8471900Z             self.line_interaction_type,
2025-01-14T13:16:42.8472050Z         )
2025-01-14T13:16:42.8472270Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8472960Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8473090Z         ]
2025-01-14T13:16:42.8473760Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8473770Z 
2025-01-14T13:16:42.8474090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8475860Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[exc-None-packet_in_nu] _
2025-01-14T13:16:42.8475880Z 
2025-01-14T13:16:42.8477950Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8478630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8478640Z 
2025-01-14T13:16:42.8478730Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8478900Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8479020Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8479200Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8479290Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8479340Z >       sim.run_final()
2025-01-14T13:16:42.8479350Z 
2025-01-14T13:16:42.8479410Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8479530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8479610Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8479730Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8479800Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8479930Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8480040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8480040Z 
2025-01-14T13:16:42.8480330Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8480540Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8480800Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8481190Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8481650Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8482250Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8482620Z 
2025-01-14T13:16:42.8482880Z     def initialize_transport_state(
2025-01-14T13:16:42.8485260Z         self,
2025-01-14T13:16:42.8485560Z         simulation_state,
2025-01-14T13:16:42.8487100Z         opacity_state,
2025-01-14T13:16:42.8487220Z         macro_atom_state,
2025-01-14T13:16:42.8487290Z         plasma,
2025-01-14T13:16:42.8487360Z         no_of_packets,
2025-01-14T13:16:42.8487440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8487490Z         iteration=0,
2025-01-14T13:16:42.8487540Z     ):
2025-01-14T13:16:42.8487640Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8487740Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8487810Z         else:
2025-01-14T13:16:42.8487900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8487970Z     
2025-01-14T13:16:42.8488130Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8488230Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8488320Z         )
2025-01-14T13:16:42.8488380Z     
2025-01-14T13:16:42.8488490Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8488590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8488730Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8488800Z         else:
2025-01-14T13:16:42.8488990Z             continuum_state = None
2025-01-14T13:16:42.8489960Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8490240Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8490320Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8490440Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8490520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8490620Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8490710Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8492390Z         ).to_numba(
2025-01-14T13:16:42.8492450Z             macro_atom_state,
2025-01-14T13:16:42.8492520Z             self.line_interaction_type,
2025-01-14T13:16:42.8492570Z         )
2025-01-14T13:16:42.8492670Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8492910Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8492960Z         ]
2025-01-14T13:16:42.8493230Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8493230Z 
2025-01-14T13:16:42.8493350Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8493650Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[de-exc-wavelength_range0-packet_out_nu] _
2025-01-14T13:16:42.8493660Z 
2025-01-14T13:16:42.8494280Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8494650Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8494660Z 
2025-01-14T13:16:42.8494750Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8494900Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8494970Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8495120Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8495190Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8495240Z >       sim.run_final()
2025-01-14T13:16:42.8495250Z 
2025-01-14T13:16:42.8495300Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8495400Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8495480Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8495730Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8495900Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8496050Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8496160Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8496170Z 
2025-01-14T13:16:42.8496400Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8496750Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8497520Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8498380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8498840Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8499250Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8499270Z 
2025-01-14T13:16:42.8499540Z     def initialize_transport_state(
2025-01-14T13:16:42.8499720Z         self,
2025-01-14T13:16:42.8499920Z         simulation_state,
2025-01-14T13:16:42.8500100Z         opacity_state,
2025-01-14T13:16:42.8501480Z         macro_atom_state,
2025-01-14T13:16:42.8501590Z         plasma,
2025-01-14T13:16:42.8501650Z         no_of_packets,
2025-01-14T13:16:42.8501720Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8501780Z         iteration=0,
2025-01-14T13:16:42.8501850Z     ):
2025-01-14T13:16:42.8501980Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8502090Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8502150Z         else:
2025-01-14T13:16:42.8502220Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8502260Z     
2025-01-14T13:16:42.8502410Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8502620Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8502670Z         )
2025-01-14T13:16:42.8502720Z     
2025-01-14T13:16:42.8502830Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8502920Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8503050Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8503110Z         else:
2025-01-14T13:16:42.8503180Z             continuum_state = None
2025-01-14T13:16:42.8503300Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8503400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8503470Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8503560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8503640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8503740Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8513210Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8513290Z         ).to_numba(
2025-01-14T13:16:42.8513590Z             macro_atom_state,
2025-01-14T13:16:42.8513980Z             self.line_interaction_type,
2025-01-14T13:16:42.8514060Z         )
2025-01-14T13:16:42.8514140Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8515160Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8515380Z         ]
2025-01-14T13:16:42.8516120Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8516140Z 
2025-01-14T13:16:42.8516580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8517250Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[de-exc-wavelength_range1-packet_in_nu] _
2025-01-14T13:16:42.8517280Z 
2025-01-14T13:16:42.8518880Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8520970Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8521020Z 
2025-01-14T13:16:42.8521240Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8522130Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8522250Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8522430Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8522520Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8522570Z >       sim.run_final()
2025-01-14T13:16:42.8522580Z 
2025-01-14T13:16:42.8522630Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8523300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8524010Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8524470Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8524740Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8525120Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8525380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8525390Z 
2025-01-14T13:16:42.8526190Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8526780Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8527330Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8528050Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8528800Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8529170Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8529200Z 
2025-01-14T13:16:42.8529430Z     def initialize_transport_state(
2025-01-14T13:16:42.8529910Z         self,
2025-01-14T13:16:42.8530020Z         simulation_state,
2025-01-14T13:16:42.8530070Z         opacity_state,
2025-01-14T13:16:42.8530530Z         macro_atom_state,
2025-01-14T13:16:42.8530620Z         plasma,
2025-01-14T13:16:42.8530670Z         no_of_packets,
2025-01-14T13:16:42.8530730Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8530780Z         iteration=0,
2025-01-14T13:16:42.8530830Z     ):
2025-01-14T13:16:42.8530940Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8531020Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8531090Z         else:
2025-01-14T13:16:42.8531180Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8531260Z     
2025-01-14T13:16:42.8531430Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8531520Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8531600Z         )
2025-01-14T13:16:42.8531650Z     
2025-01-14T13:16:42.8531770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8531880Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8532040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8532100Z         else:
2025-01-14T13:16:42.8532200Z             continuum_state = None
2025-01-14T13:16:42.8532310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8532420Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8532530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8533300Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8533630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8533950Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8534380Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8535100Z         ).to_numba(
2025-01-14T13:16:42.8535400Z             macro_atom_state,
2025-01-14T13:16:42.8536770Z             self.line_interaction_type,
2025-01-14T13:16:42.8537380Z         )
2025-01-14T13:16:42.8537780Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8539080Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8539400Z         ]
2025-01-14T13:16:42.8540850Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8540880Z 
2025-01-14T13:16:42.8541090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8542750Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[de-exc-wavelength_range2-packet_out_nu] _
2025-01-14T13:16:42.8542810Z 
2025-01-14T13:16:42.8543890Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8544350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8544370Z 
2025-01-14T13:16:42.8544490Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8544700Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8544850Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8545050Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8545120Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8546150Z >       sim.run_final()
2025-01-14T13:16:42.8546160Z 
2025-01-14T13:16:42.8546550Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8546650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8546750Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8546880Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8546950Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8547080Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8547550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8547560Z 
2025-01-14T13:16:42.8547840Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8548050Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8548280Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8548520Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8548670Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8548800Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8548800Z 
2025-01-14T13:16:42.8548870Z     def initialize_transport_state(
2025-01-14T13:16:42.8548920Z         self,
2025-01-14T13:16:42.8548970Z         simulation_state,
2025-01-14T13:16:42.8549020Z         opacity_state,
2025-01-14T13:16:42.8549080Z         macro_atom_state,
2025-01-14T13:16:42.8549120Z         plasma,
2025-01-14T13:16:42.8549180Z         no_of_packets,
2025-01-14T13:16:42.8549250Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8549290Z         iteration=0,
2025-01-14T13:16:42.8549340Z     ):
2025-01-14T13:16:42.8549850Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8551110Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8551180Z         else:
2025-01-14T13:16:42.8551250Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8551300Z     
2025-01-14T13:16:42.8551410Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8552640Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8552690Z         )
2025-01-14T13:16:42.8552740Z     
2025-01-14T13:16:42.8552840Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8552930Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8553040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8553100Z         else:
2025-01-14T13:16:42.8553150Z             continuum_state = None
2025-01-14T13:16:42.8553230Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8553310Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8553380Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8553460Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8553530Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8553610Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8553670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8553720Z         ).to_numba(
2025-01-14T13:16:42.8553770Z             macro_atom_state,
2025-01-14T13:16:42.8553840Z             self.line_interaction_type,
2025-01-14T13:16:42.8553890Z         )
2025-01-14T13:16:42.8553960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8554180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8554230Z         ]
2025-01-14T13:16:42.8554480Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8554480Z 
2025-01-14T13:16:42.8554590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8554800Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[de-exc-None-packet_in_nu] _
2025-01-14T13:16:42.8555360Z 
2025-01-14T13:16:42.8555900Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8556550Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8556610Z 
2025-01-14T13:16:42.8556860Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8557220Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8557430Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8557840Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8558040Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8558190Z >       sim.run_final()
2025-01-14T13:16:42.8558230Z 
2025-01-14T13:16:42.8558410Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8558660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8558900Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8559240Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8559460Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8559820Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8560100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8560120Z 
2025-01-14T13:16:42.8560900Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8561360Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8561930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8562520Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8563460Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8563750Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8563760Z 
2025-01-14T13:16:42.8563940Z     def initialize_transport_state(
2025-01-14T13:16:42.8564220Z         self,
2025-01-14T13:16:42.8564340Z         simulation_state,
2025-01-14T13:16:42.8564400Z         opacity_state,
2025-01-14T13:16:42.8564450Z         macro_atom_state,
2025-01-14T13:16:42.8564490Z         plasma,
2025-01-14T13:16:42.8564540Z         no_of_packets,
2025-01-14T13:16:42.8564600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8564650Z         iteration=0,
2025-01-14T13:16:42.8564700Z     ):
2025-01-14T13:16:42.8564790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8564860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8564920Z         else:
2025-01-14T13:16:42.8564980Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8565020Z     
2025-01-14T13:16:42.8565130Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8565200Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8565250Z         )
2025-01-14T13:16:42.8565290Z     
2025-01-14T13:16:42.8565390Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8565550Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8565710Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8565750Z         else:
2025-01-14T13:16:42.8565810Z             continuum_state = None
2025-01-14T13:16:42.8566820Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8566950Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8567070Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8567640Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8567730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8567860Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8567960Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8568010Z         ).to_numba(
2025-01-14T13:16:42.8568090Z             macro_atom_state,
2025-01-14T13:16:42.8568180Z             self.line_interaction_type,
2025-01-14T13:16:42.8568250Z         )
2025-01-14T13:16:42.8568330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8568580Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8568650Z         ]
2025-01-14T13:16:42.8568970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8568980Z 
2025-01-14T13:16:42.8569130Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8569450Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[both-wavelength_range0-packet_out_nu] _
2025-01-14T13:16:42.8569460Z 
2025-01-14T13:16:42.8570760Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8571160Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8571190Z 
2025-01-14T13:16:42.8571280Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8571440Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8571570Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8571750Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8571820Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8571880Z >       sim.run_final()
2025-01-14T13:16:42.8571880Z 
2025-01-14T13:16:42.8572090Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8572190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8572260Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8572370Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8572440Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8572560Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8572650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8572650Z 
2025-01-14T13:16:42.8572860Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8573030Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8573200Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8573430Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8573550Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8573670Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8573670Z 
2025-01-14T13:16:42.8573730Z     def initialize_transport_state(
2025-01-14T13:16:42.8573770Z         self,
2025-01-14T13:16:42.8573830Z         simulation_state,
2025-01-14T13:16:42.8573880Z         opacity_state,
2025-01-14T13:16:42.8573930Z         macro_atom_state,
2025-01-14T13:16:42.8573970Z         plasma,
2025-01-14T13:16:42.8574020Z         no_of_packets,
2025-01-14T13:16:42.8574080Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8574120Z         iteration=0,
2025-01-14T13:16:42.8574160Z     ):
2025-01-14T13:16:42.8574260Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8574400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8574440Z         else:
2025-01-14T13:16:42.8574500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8574550Z     
2025-01-14T13:16:42.8574660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8574730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8574770Z         )
2025-01-14T13:16:42.8574820Z     
2025-01-14T13:16:42.8574930Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8575020Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8575140Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8575180Z         else:
2025-01-14T13:16:42.8575250Z             continuum_state = None
2025-01-14T13:16:42.8575320Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8575410Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8575480Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8575560Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8575640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8575710Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8575900Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8575960Z         ).to_numba(
2025-01-14T13:16:42.8576010Z             macro_atom_state,
2025-01-14T13:16:42.8576070Z             self.line_interaction_type,
2025-01-14T13:16:42.8576120Z         )
2025-01-14T13:16:42.8576190Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8576410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8576460Z         ]
2025-01-14T13:16:42.8576710Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8576710Z 
2025-01-14T13:16:42.8576830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8577060Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[both-wavelength_range1-packet_in_nu] _
2025-01-14T13:16:42.8577130Z 
2025-01-14T13:16:42.8577810Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8578150Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8578160Z 
2025-01-14T13:16:42.8578220Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8578340Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8578410Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8578550Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8578620Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8578670Z >       sim.run_final()
2025-01-14T13:16:42.8578680Z 
2025-01-14T13:16:42.8578730Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8578820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8578890Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8579000Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8579070Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8579190Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8579270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8579270Z 
2025-01-14T13:16:42.8579480Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8579640Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8579910Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8580130Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8580260Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8580370Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8580370Z 
2025-01-14T13:16:42.8580430Z     def initialize_transport_state(
2025-01-14T13:16:42.8580480Z         self,
2025-01-14T13:16:42.8580530Z         simulation_state,
2025-01-14T13:16:42.8580580Z         opacity_state,
2025-01-14T13:16:42.8580620Z         macro_atom_state,
2025-01-14T13:16:42.8580670Z         plasma,
2025-01-14T13:16:42.8580710Z         no_of_packets,
2025-01-14T13:16:42.8580770Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8580820Z         iteration=0,
2025-01-14T13:16:42.8580860Z     ):
2025-01-14T13:16:42.8580960Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8581040Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8581080Z         else:
2025-01-14T13:16:42.8581140Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8581440Z     
2025-01-14T13:16:42.8581600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8581690Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8581760Z         )
2025-01-14T13:16:42.8581840Z     
2025-01-14T13:16:42.8581990Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8582130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8582310Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8582390Z         else:
2025-01-14T13:16:42.8582480Z             continuum_state = None
2025-01-14T13:16:42.8582570Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8582650Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8582750Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8585610Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8585690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8585760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8585820Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8585870Z         ).to_numba(
2025-01-14T13:16:42.8585920Z             macro_atom_state,
2025-01-14T13:16:42.8585990Z             self.line_interaction_type,
2025-01-14T13:16:42.8586030Z         )
2025-01-14T13:16:42.8586110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8586320Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8586370Z         ]
2025-01-14T13:16:42.8586610Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8586620Z 
2025-01-14T13:16:42.8586750Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8587000Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[both-wavelength_range2-packet_out_nu] _
2025-01-14T13:16:42.8587000Z 
2025-01-14T13:16:42.8587530Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8587840Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8587840Z 
2025-01-14T13:16:42.8587900Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8588150Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8588220Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8588620Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8588690Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8588740Z >       sim.run_final()
2025-01-14T13:16:42.8588740Z 
2025-01-14T13:16:42.8588790Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8588880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8588950Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8589050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8589130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8589250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8589330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8589330Z 
2025-01-14T13:16:42.8589540Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8589700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8589870Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8590090Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8590320Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8590450Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8590460Z 
2025-01-14T13:16:42.8590520Z     def initialize_transport_state(
2025-01-14T13:16:42.8590560Z         self,
2025-01-14T13:16:42.8590620Z         simulation_state,
2025-01-14T13:16:42.8590670Z         opacity_state,
2025-01-14T13:16:42.8590730Z         macro_atom_state,
2025-01-14T13:16:42.8590770Z         plasma,
2025-01-14T13:16:42.8590820Z         no_of_packets,
2025-01-14T13:16:42.8590870Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8590920Z         iteration=0,
2025-01-14T13:16:42.8590970Z     ):
2025-01-14T13:16:42.8591060Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8591240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8591290Z         else:
2025-01-14T13:16:42.8591340Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8591380Z     
2025-01-14T13:16:42.8591600Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8591670Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8591720Z         )
2025-01-14T13:16:42.8591760Z     
2025-01-14T13:16:42.8591860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8591940Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8592070Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8592110Z         else:
2025-01-14T13:16:42.8592170Z             continuum_state = None
2025-01-14T13:16:42.8592240Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8592330Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8592400Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8592480Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8592550Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8592620Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8592690Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8592730Z         ).to_numba(
2025-01-14T13:16:42.8592790Z             macro_atom_state,
2025-01-14T13:16:42.8592840Z             self.line_interaction_type,
2025-01-14T13:16:42.8592890Z         )
2025-01-14T13:16:42.8592960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8593180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8593220Z         ]
2025-01-14T13:16:42.8593470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8593540Z 
2025-01-14T13:16:42.8593670Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8593870Z _ ERROR at setup of TestLineInfoWidgetData.test_get_last_line_counts[both-None-packet_in_nu] _
2025-01-14T13:16:42.8593870Z 
2025-01-14T13:16:42.8594410Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8594690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8594690Z 
2025-01-14T13:16:42.8594760Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8594880Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8594960Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8595370Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8595460Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8595510Z >       sim.run_final()
2025-01-14T13:16:42.8595520Z 
2025-01-14T13:16:42.8595570Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8595660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8595730Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8595850Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8595910Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8596030Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8596120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8596130Z 
2025-01-14T13:16:42.8596330Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8596490Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8596820Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8598530Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8598730Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8598900Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8598910Z 
2025-01-14T13:16:42.8598990Z     def initialize_transport_state(
2025-01-14T13:16:42.8599050Z         self,
2025-01-14T13:16:42.8599120Z         simulation_state,
2025-01-14T13:16:42.8599170Z         opacity_state,
2025-01-14T13:16:42.8599230Z         macro_atom_state,
2025-01-14T13:16:42.8600610Z         plasma,
2025-01-14T13:16:42.8600670Z         no_of_packets,
2025-01-14T13:16:42.8600730Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8600780Z         iteration=0,
2025-01-14T13:16:42.8600820Z     ):
2025-01-14T13:16:42.8600920Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8600990Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8601040Z         else:
2025-01-14T13:16:42.8601100Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8601140Z     
2025-01-14T13:16:42.8601240Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8601320Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8601360Z         )
2025-01-14T13:16:42.8601400Z     
2025-01-14T13:16:42.8601500Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8601590Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8601710Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8601760Z         else:
2025-01-14T13:16:42.8601820Z             continuum_state = None
2025-01-14T13:16:42.8602000Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8602100Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8602180Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8602300Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8602400Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8602510Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8602610Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8602680Z         ).to_numba(
2025-01-14T13:16:42.8602780Z             macro_atom_state,
2025-01-14T13:16:42.8602880Z             self.line_interaction_type,
2025-01-14T13:16:42.8602940Z         )
2025-01-14T13:16:42.8603050Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8603340Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8603420Z         ]
2025-01-14T13:16:42.8603770Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8603780Z 
2025-01-14T13:16:42.8603930Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8604200Z _ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_plot[liw_with_selection0] _
2025-01-14T13:16:42.8604210Z 
2025-01-14T13:16:42.8604860Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8605220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8605230Z 
2025-01-14T13:16:42.8605350Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8605510Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8605640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8605880Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8606400Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8606820Z >       sim.run_final()
2025-01-14T13:16:42.8606840Z 
2025-01-14T13:16:42.8607140Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8607490Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8607840Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8608260Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8608540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8608960Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8609310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8609330Z 
2025-01-14T13:16:42.8610050Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8610650Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8611700Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8612370Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8612800Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8613200Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8613230Z 
2025-01-14T13:16:42.8613470Z     def initialize_transport_state(
2025-01-14T13:16:42.8613770Z         self,
2025-01-14T13:16:42.8613870Z         simulation_state,
2025-01-14T13:16:42.8613930Z         opacity_state,
2025-01-14T13:16:42.8613980Z         macro_atom_state,
2025-01-14T13:16:42.8614040Z         plasma,
2025-01-14T13:16:42.8614090Z         no_of_packets,
2025-01-14T13:16:42.8614390Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8614440Z         iteration=0,
2025-01-14T13:16:42.8614510Z     ):
2025-01-14T13:16:42.8614600Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8614680Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8614720Z         else:
2025-01-14T13:16:42.8614780Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8614820Z     
2025-01-14T13:16:42.8614930Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8615010Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8615050Z         )
2025-01-14T13:16:42.8615100Z     
2025-01-14T13:16:42.8615200Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8615300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8615420Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8615470Z         else:
2025-01-14T13:16:42.8615530Z             continuum_state = None
2025-01-14T13:16:42.8615620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8615710Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8615780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8615860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8616060Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8616140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8636370Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8636940Z         ).to_numba(
2025-01-14T13:16:42.8637130Z             macro_atom_state,
2025-01-14T13:16:42.8637340Z             self.line_interaction_type,
2025-01-14T13:16:42.8637510Z         )
2025-01-14T13:16:42.8637800Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8638500Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8638750Z         ]
2025-01-14T13:16:42.8639480Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8640800Z 
2025-01-14T13:16:42.8641200Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8641850Z _ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[liw_with_selection0-0] _
2025-01-14T13:16:42.8641890Z 
2025-01-14T13:16:42.8644280Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8644650Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8644660Z 
2025-01-14T13:16:42.8644730Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8648190Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8649370Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8649550Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8649610Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8649680Z >       sim.run_final()
2025-01-14T13:16:42.8649690Z 
2025-01-14T13:16:42.8649750Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8649840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8649920Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8650050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8650130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8650270Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8650380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8651050Z 
2025-01-14T13:16:42.8652960Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8653550Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8654080Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8654780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8655210Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8655560Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8655590Z 
2025-01-14T13:16:42.8655840Z     def initialize_transport_state(
2025-01-14T13:16:42.8656300Z         self,
2025-01-14T13:16:42.8656550Z         simulation_state,
2025-01-14T13:16:42.8656760Z         opacity_state,
2025-01-14T13:16:42.8656940Z         macro_atom_state,
2025-01-14T13:16:42.8657170Z         plasma,
2025-01-14T13:16:42.8657390Z         no_of_packets,
2025-01-14T13:16:42.8657580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8657800Z         iteration=0,
2025-01-14T13:16:42.8658000Z     ):
2025-01-14T13:16:42.8658310Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8658550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8658740Z         else:
2025-01-14T13:16:42.8658960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8659110Z     
2025-01-14T13:16:42.8659480Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8659750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8659970Z         )
2025-01-14T13:16:42.8660140Z     
2025-01-14T13:16:42.8660450Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8660710Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8661090Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8661290Z         else:
2025-01-14T13:16:42.8661520Z             continuum_state = None
2025-01-14T13:16:42.8662460Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8663270Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8663590Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8663910Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8664220Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8664560Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8664830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8665040Z         ).to_numba(
2025-01-14T13:16:42.8665290Z             macro_atom_state,
2025-01-14T13:16:42.8665480Z             self.line_interaction_type,
2025-01-14T13:16:42.8665630Z         )
2025-01-14T13:16:42.8665910Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8666620Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8666800Z         ]
2025-01-14T13:16:42.8667530Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8667550Z 
2025-01-14T13:16:42.8667870Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8668430Z _ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[liw_with_selection0-1] _
2025-01-14T13:16:42.8668440Z 
2025-01-14T13:16:42.8670030Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8670880Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8670900Z 
2025-01-14T13:16:42.8671650Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8672020Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8672280Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8672700Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8672880Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8673050Z >       sim.run_final()
2025-01-14T13:16:42.8673060Z 
2025-01-14T13:16:42.8673230Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8673490Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8673740Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8674120Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8674340Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8674700Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8674950Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8674980Z 
2025-01-14T13:16:42.8675620Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8676120Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8676640Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8677260Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8677660Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8678030Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8678050Z 
2025-01-14T13:16:42.8678260Z     def initialize_transport_state(
2025-01-14T13:16:42.8678410Z         self,
2025-01-14T13:16:42.8678570Z         simulation_state,
2025-01-14T13:16:42.8678730Z         opacity_state,
2025-01-14T13:16:42.8678890Z         macro_atom_state,
2025-01-14T13:16:42.8679050Z         plasma,
2025-01-14T13:16:42.8679210Z         no_of_packets,
2025-01-14T13:16:42.8679740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8679900Z         iteration=0,
2025-01-14T13:16:42.8680040Z     ):
2025-01-14T13:16:42.8680320Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8680510Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8680660Z         else:
2025-01-14T13:16:42.8680820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8680970Z     
2025-01-14T13:16:42.8681260Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8681470Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8681610Z         )
2025-01-14T13:16:42.8681760Z     
2025-01-14T13:16:42.8682040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8682290Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8682620Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8682780Z         else:
2025-01-14T13:16:42.8682970Z             continuum_state = None
2025-01-14T13:16:42.8683180Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8683420Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8683610Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8683850Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8684050Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8684270Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8684460Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8684620Z         ).to_numba(
2025-01-14T13:16:42.8684780Z             macro_atom_state,
2025-01-14T13:16:42.8684970Z             self.line_interaction_type,
2025-01-14T13:16:42.8685120Z         )
2025-01-14T13:16:42.8685350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8686440Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8686640Z         ]
2025-01-14T13:16:42.8687310Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8687330Z 
2025-01-14T13:16:42.8687650Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8688290Z _ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_species_intrctn_table[liw_with_selection0] _
2025-01-14T13:16:42.8688300Z 
2025-01-14T13:16:42.8689780Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8690560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8690570Z 
2025-01-14T13:16:42.8690760Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8691100Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8691310Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8691690Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8691880Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8692040Z >       sim.run_final()
2025-01-14T13:16:42.8692040Z 
2025-01-14T13:16:42.8692220Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8692550Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8692810Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8693120Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8693320Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8693660Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8693900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8694340Z 
2025-01-14T13:16:42.8694920Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8695340Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8697450Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8697740Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8697870Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8697970Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8697980Z 
2025-01-14T13:16:42.8698040Z     def initialize_transport_state(
2025-01-14T13:16:42.8698090Z         self,
2025-01-14T13:16:42.8698150Z         simulation_state,
2025-01-14T13:16:42.8698220Z         opacity_state,
2025-01-14T13:16:42.8698270Z         macro_atom_state,
2025-01-14T13:16:42.8698320Z         plasma,
2025-01-14T13:16:42.8698370Z         no_of_packets,
2025-01-14T13:16:42.8698430Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8698470Z         iteration=0,
2025-01-14T13:16:42.8698510Z     ):
2025-01-14T13:16:42.8698610Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8698690Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8698730Z         else:
2025-01-14T13:16:42.8698790Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8698830Z     
2025-01-14T13:16:42.8698930Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8699000Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8699050Z         )
2025-01-14T13:16:42.8699090Z     
2025-01-14T13:16:42.8699190Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8699280Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8699650Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8699690Z         else:
2025-01-14T13:16:42.8699750Z             continuum_state = None
2025-01-14T13:16:42.8699830Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8699910Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8699980Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8700060Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8700130Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8700200Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8700260Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8700310Z         ).to_numba(
2025-01-14T13:16:42.8700360Z             macro_atom_state,
2025-01-14T13:16:42.8700420Z             self.line_interaction_type,
2025-01-14T13:16:42.8700470Z         )
2025-01-14T13:16:42.8700550Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8700770Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8700820Z         ]
2025-01-14T13:16:42.8701070Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8701070Z 
2025-01-14T13:16:42.8701190Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8701390Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection0-0] _
2025-01-14T13:16:42.8701390Z 
2025-01-14T13:16:42.8701930Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8702220Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8702220Z 
2025-01-14T13:16:42.8702590Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8702720Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8702790Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8702930Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8703000Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8703050Z >       sim.run_final()
2025-01-14T13:16:42.8703050Z 
2025-01-14T13:16:42.8703110Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8703200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8703270Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8703380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8703450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8703570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8703670Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8703670Z 
2025-01-14T13:16:42.8703880Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8704050Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8704220Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8704450Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8704570Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8704680Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8704680Z 
2025-01-14T13:16:42.8704750Z     def initialize_transport_state(
2025-01-14T13:16:42.8704790Z         self,
2025-01-14T13:16:42.8705080Z         simulation_state,
2025-01-14T13:16:42.8705140Z         opacity_state,
2025-01-14T13:16:42.8705190Z         macro_atom_state,
2025-01-14T13:16:42.8705240Z         plasma,
2025-01-14T13:16:42.8705300Z         no_of_packets,
2025-01-14T13:16:42.8705360Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8705500Z         iteration=0,
2025-01-14T13:16:42.8705580Z     ):
2025-01-14T13:16:42.8705690Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8705770Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8705810Z         else:
2025-01-14T13:16:42.8705870Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8705910Z     
2025-01-14T13:16:42.8706030Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8706100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8706140Z         )
2025-01-14T13:16:42.8706180Z     
2025-01-14T13:16:42.8706290Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8706380Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8706510Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8706560Z         else:
2025-01-14T13:16:42.8706620Z             continuum_state = None
2025-01-14T13:16:42.8706690Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8706780Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8706840Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8706930Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8707000Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8707070Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8707140Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8707180Z         ).to_numba(
2025-01-14T13:16:42.8707240Z             macro_atom_state,
2025-01-14T13:16:42.8707300Z             self.line_interaction_type,
2025-01-14T13:16:42.8707350Z         )
2025-01-14T13:16:42.8707420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8707770Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8707910Z         ]
2025-01-14T13:16:42.8708200Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8708200Z 
2025-01-14T13:16:42.8708320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8708520Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection0-1] _
2025-01-14T13:16:42.8708530Z 
2025-01-14T13:16:42.8709080Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8709370Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8709370Z 
2025-01-14T13:16:42.8709440Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8709570Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8709640Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8710190Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8710270Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8710330Z >       sim.run_final()
2025-01-14T13:16:42.8710330Z 
2025-01-14T13:16:42.8710390Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8710480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8710550Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8710670Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8710820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8710950Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8711040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8711040Z 
2025-01-14T13:16:42.8711260Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8711420Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8711590Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8711810Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8711930Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8712040Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8712040Z 
2025-01-14T13:16:42.8712100Z     def initialize_transport_state(
2025-01-14T13:16:42.8712150Z         self,
2025-01-14T13:16:42.8712200Z         simulation_state,
2025-01-14T13:16:42.8712260Z         opacity_state,
2025-01-14T13:16:42.8712310Z         macro_atom_state,
2025-01-14T13:16:42.8712360Z         plasma,
2025-01-14T13:16:42.8712410Z         no_of_packets,
2025-01-14T13:16:42.8712470Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8712520Z         iteration=0,
2025-01-14T13:16:42.8712560Z     ):
2025-01-14T13:16:42.8712660Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8712730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8712780Z         else:
2025-01-14T13:16:42.8712830Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8712870Z     
2025-01-14T13:16:42.8712980Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8713050Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8713110Z         )
2025-01-14T13:16:42.8713150Z     
2025-01-14T13:16:42.8713260Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8713350Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8713530Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8713580Z         else:
2025-01-14T13:16:42.8713640Z             continuum_state = None
2025-01-14T13:16:42.8713720Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8713800Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8713870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8713950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8714020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8714100Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8714160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8714210Z         ).to_numba(
2025-01-14T13:16:42.8714260Z             macro_atom_state,
2025-01-14T13:16:42.8714330Z             self.line_interaction_type,
2025-01-14T13:16:42.8714380Z         )
2025-01-14T13:16:42.8714450Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8714680Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8714720Z         ]
2025-01-14T13:16:42.8714960Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8714970Z 
2025-01-14T13:16:42.8715080Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8715290Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection0-2] _
2025-01-14T13:16:42.8715290Z 
2025-01-14T13:16:42.8715830Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8716170Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8716180Z 
2025-01-14T13:16:42.8716250Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8716370Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8716440Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8716580Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8716650Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8716700Z >       sim.run_final()
2025-01-14T13:16:42.8716700Z 
2025-01-14T13:16:42.8716760Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8716850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8716920Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8717020Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8717100Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8717210Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8717310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8717310Z 
2025-01-14T13:16:42.8717520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8717670Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8717850Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8718070Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8718190Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8718290Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8718300Z 
2025-01-14T13:16:42.8718370Z     def initialize_transport_state(
2025-01-14T13:16:42.8718410Z         self,
2025-01-14T13:16:42.8718480Z         simulation_state,
2025-01-14T13:16:42.8718590Z         opacity_state,
2025-01-14T13:16:42.8718640Z         macro_atom_state,
2025-01-14T13:16:42.8718690Z         plasma,
2025-01-14T13:16:42.8718730Z         no_of_packets,
2025-01-14T13:16:42.8718790Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8718840Z         iteration=0,
2025-01-14T13:16:42.8718880Z     ):
2025-01-14T13:16:42.8718970Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8719040Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8719080Z         else:
2025-01-14T13:16:42.8719140Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8719180Z     
2025-01-14T13:16:42.8719280Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8719370Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8719490Z         )
2025-01-14T13:16:42.8719530Z     
2025-01-14T13:16:42.8719640Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8719730Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8719850Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8719900Z         else:
2025-01-14T13:16:42.8719950Z             continuum_state = None
2025-01-14T13:16:42.8720040Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8720120Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8720190Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8720270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8720350Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8720410Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8720480Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8720530Z         ).to_numba(
2025-01-14T13:16:42.8720690Z             macro_atom_state,
2025-01-14T13:16:42.8720750Z             self.line_interaction_type,
2025-01-14T13:16:42.8720800Z         )
2025-01-14T13:16:42.8720880Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8721090Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8721140Z         ]
2025-01-14T13:16:42.8721390Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8721390Z 
2025-01-14T13:16:42.8721510Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8721690Z _ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_plot[liw_with_selection1] _
2025-01-14T13:16:42.8721700Z 
2025-01-14T13:16:42.8722230Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8722520Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8722530Z 
2025-01-14T13:16:42.8722590Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8722710Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8722780Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8722920Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8722980Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8723030Z >       sim.run_final()
2025-01-14T13:16:42.8723040Z 
2025-01-14T13:16:42.8723090Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8723180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8723250Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8723360Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8723430Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8723910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8724000Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8724000Z 
2025-01-14T13:16:42.8724210Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8724380Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8724550Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8724770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8724880Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8724990Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8725000Z 
2025-01-14T13:16:42.8725060Z     def initialize_transport_state(
2025-01-14T13:16:42.8725110Z         self,
2025-01-14T13:16:42.8725170Z         simulation_state,
2025-01-14T13:16:42.8725210Z         opacity_state,
2025-01-14T13:16:42.8725260Z         macro_atom_state,
2025-01-14T13:16:42.8725310Z         plasma,
2025-01-14T13:16:42.8725350Z         no_of_packets,
2025-01-14T13:16:42.8725410Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8725460Z         iteration=0,
2025-01-14T13:16:42.8725500Z     ):
2025-01-14T13:16:42.8725590Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8725660Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8725710Z         else:
2025-01-14T13:16:42.8725760Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8725810Z     
2025-01-14T13:16:42.8725910Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8725980Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8726260Z         )
2025-01-14T13:16:42.8726300Z     
2025-01-14T13:16:42.8726400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8726490Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8726610Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8726660Z         else:
2025-01-14T13:16:42.8726720Z             continuum_state = None
2025-01-14T13:16:42.8726790Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8726870Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8726940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8727020Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8727090Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8727160Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8727230Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8727280Z         ).to_numba(
2025-01-14T13:16:42.8727340Z             macro_atom_state,
2025-01-14T13:16:42.8727400Z             self.line_interaction_type,
2025-01-14T13:16:42.8727450Z         )
2025-01-14T13:16:42.8727520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8727740Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8727790Z         ]
2025-01-14T13:16:42.8728030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8728030Z 
2025-01-14T13:16:42.8728140Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8728350Z _ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[liw_with_selection1-0] _
2025-01-14T13:16:42.8728360Z 
2025-01-14T13:16:42.8728880Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8729240Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8729240Z 
2025-01-14T13:16:42.8729300Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8729420Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8729500Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8729630Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8729690Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8729740Z >       sim.run_final()
2025-01-14T13:16:42.8729750Z 
2025-01-14T13:16:42.8729800Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8729890Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8729970Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8730080Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8730140Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8730270Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8730350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8730350Z 
2025-01-14T13:16:42.8730570Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8730730Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8730900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8731120Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8731250Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8731410Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8731410Z 
2025-01-14T13:16:42.8731470Z     def initialize_transport_state(
2025-01-14T13:16:42.8731520Z         self,
2025-01-14T13:16:42.8731580Z         simulation_state,
2025-01-14T13:16:42.8732070Z         opacity_state,
2025-01-14T13:16:42.8732190Z         macro_atom_state,
2025-01-14T13:16:42.8732240Z         plasma,
2025-01-14T13:16:42.8732290Z         no_of_packets,
2025-01-14T13:16:42.8732350Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8732390Z         iteration=0,
2025-01-14T13:16:42.8732440Z     ):
2025-01-14T13:16:42.8732540Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8732610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8732650Z         else:
2025-01-14T13:16:42.8732700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8732750Z     
2025-01-14T13:16:42.8732860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8732940Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8732980Z         )
2025-01-14T13:16:42.8733030Z     
2025-01-14T13:16:42.8733130Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8733230Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8733350Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8733390Z         else:
2025-01-14T13:16:42.8733450Z             continuum_state = None
2025-01-14T13:16:42.8733520Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8733600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8733670Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8733750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8733820Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8733890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8738970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8739050Z         ).to_numba(
2025-01-14T13:16:42.8739110Z             macro_atom_state,
2025-01-14T13:16:42.8739510Z             self.line_interaction_type,
2025-01-14T13:16:42.8739560Z         )
2025-01-14T13:16:42.8739640Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8739860Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8739910Z         ]
2025-01-14T13:16:42.8740150Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8740160Z 
2025-01-14T13:16:42.8740270Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8740480Z _ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[liw_with_selection1-1] _
2025-01-14T13:16:42.8740480Z 
2025-01-14T13:16:42.8741030Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8741320Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8741320Z 
2025-01-14T13:16:42.8741380Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8741510Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8741580Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8741720Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8741780Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8741830Z >       sim.run_final()
2025-01-14T13:16:42.8741840Z 
2025-01-14T13:16:42.8741890Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8741980Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8742170Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8742280Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8742360Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8742520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8742610Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8742620Z 
2025-01-14T13:16:42.8742820Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8742980Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8743160Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8743370Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8743500Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8743610Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8743610Z 
2025-01-14T13:16:42.8743680Z     def initialize_transport_state(
2025-01-14T13:16:42.8743720Z         self,
2025-01-14T13:16:42.8743780Z         simulation_state,
2025-01-14T13:16:42.8743830Z         opacity_state,
2025-01-14T13:16:42.8743880Z         macro_atom_state,
2025-01-14T13:16:42.8743920Z         plasma,
2025-01-14T13:16:42.8743970Z         no_of_packets,
2025-01-14T13:16:42.8744020Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8744070Z         iteration=0,
2025-01-14T13:16:42.8744110Z     ):
2025-01-14T13:16:42.8744200Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8744280Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8744320Z         else:
2025-01-14T13:16:42.8744380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8744420Z     
2025-01-14T13:16:42.8744520Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8744600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8744710Z         )
2025-01-14T13:16:42.8744750Z     
2025-01-14T13:16:42.8744860Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8744940Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8745060Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8745110Z         else:
2025-01-14T13:16:42.8745160Z             continuum_state = None
2025-01-14T13:16:42.8745240Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8745320Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8745390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8745470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8745540Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8745610Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8745680Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8745720Z         ).to_numba(
2025-01-14T13:16:42.8745780Z             macro_atom_state,
2025-01-14T13:16:42.8745840Z             self.line_interaction_type,
2025-01-14T13:16:42.8745890Z         )
2025-01-14T13:16:42.8745960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8746180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8746220Z         ]
2025-01-14T13:16:42.8746470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8746470Z 
2025-01-14T13:16:42.8746580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8746810Z _ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_species_intrctn_table[liw_with_selection1] _
2025-01-14T13:16:42.8746810Z 
2025-01-14T13:16:42.8747400Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8747690Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8747690Z 
2025-01-14T13:16:42.8747750Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8747880Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8747950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8748100Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8748150Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8748210Z >       sim.run_final()
2025-01-14T13:16:42.8748210Z 
2025-01-14T13:16:42.8748270Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8748360Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8748430Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8748540Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8748600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8748720Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8748810Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8748810Z 
2025-01-14T13:16:42.8749020Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8749180Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8749350Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8749570Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8749690Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8750050Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8750060Z 
2025-01-14T13:16:42.8750120Z     def initialize_transport_state(
2025-01-14T13:16:42.8750170Z         self,
2025-01-14T13:16:42.8750220Z         simulation_state,
2025-01-14T13:16:42.8750270Z         opacity_state,
2025-01-14T13:16:42.8750320Z         macro_atom_state,
2025-01-14T13:16:42.8750370Z         plasma,
2025-01-14T13:16:42.8750410Z         no_of_packets,
2025-01-14T13:16:42.8750470Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8750520Z         iteration=0,
2025-01-14T13:16:42.8750560Z     ):
2025-01-14T13:16:42.8750650Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8750720Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8750770Z         else:
2025-01-14T13:16:42.8750820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8750870Z     
2025-01-14T13:16:42.8750970Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8751040Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8751090Z         )
2025-01-14T13:16:42.8751130Z     
2025-01-14T13:16:42.8751230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8751320Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8751440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8751480Z         else:
2025-01-14T13:16:42.8751540Z             continuum_state = None
2025-01-14T13:16:42.8751610Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8751690Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8751760Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8751840Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8751910Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8752220Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8752290Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8752340Z         ).to_numba(
2025-01-14T13:16:42.8752390Z             macro_atom_state,
2025-01-14T13:16:42.8752450Z             self.line_interaction_type,
2025-01-14T13:16:42.8752500Z         )
2025-01-14T13:16:42.8752570Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8752790Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8752840Z         ]
2025-01-14T13:16:42.8753080Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8753090Z 
2025-01-14T13:16:42.8753610Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8753910Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection1-0] _
2025-01-14T13:16:42.8753930Z 
2025-01-14T13:16:42.8754480Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8754770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8754780Z 
2025-01-14T13:16:42.8754850Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8754980Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8755060Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8755200Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8755260Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8755310Z >       sim.run_final()
2025-01-14T13:16:42.8755320Z 
2025-01-14T13:16:42.8755380Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8755470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8755800Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8755910Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8755980Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8756110Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8756190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8756190Z 
2025-01-14T13:16:42.8756400Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8756560Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8756740Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8756950Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8757080Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8757190Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8757190Z 
2025-01-14T13:16:42.8757260Z     def initialize_transport_state(
2025-01-14T13:16:42.8757300Z         self,
2025-01-14T13:16:42.8757360Z         simulation_state,
2025-01-14T13:16:42.8757410Z         opacity_state,
2025-01-14T13:16:42.8757460Z         macro_atom_state,
2025-01-14T13:16:42.8757510Z         plasma,
2025-01-14T13:16:42.8757550Z         no_of_packets,
2025-01-14T13:16:42.8757620Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8757670Z         iteration=0,
2025-01-14T13:16:42.8757710Z     ):
2025-01-14T13:16:42.8757810Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8757890Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8757940Z         else:
2025-01-14T13:16:42.8758650Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8758740Z     
2025-01-14T13:16:42.8758850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8758930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8758980Z         )
2025-01-14T13:16:42.8759020Z     
2025-01-14T13:16:42.8759120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8759210Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8759330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8759380Z         else:
2025-01-14T13:16:42.8759430Z             continuum_state = None
2025-01-14T13:16:42.8759510Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8759590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8759660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8759740Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8759820Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8759890Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8759950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8760000Z         ).to_numba(
2025-01-14T13:16:42.8760060Z             macro_atom_state,
2025-01-14T13:16:42.8760120Z             self.line_interaction_type,
2025-01-14T13:16:42.8760170Z         )
2025-01-14T13:16:42.8760250Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8760470Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8760510Z         ]
2025-01-14T13:16:42.8760760Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8760760Z 
2025-01-14T13:16:42.8760880Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8761090Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection1-1] _
2025-01-14T13:16:42.8761100Z 
2025-01-14T13:16:42.8761740Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8762190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8762200Z 
2025-01-14T13:16:42.8762260Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8762390Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8788340Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8788500Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8788570Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8788630Z >       sim.run_final()
2025-01-14T13:16:42.8788630Z 
2025-01-14T13:16:42.8788690Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8788790Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8788870Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8788990Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8789060Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8789180Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8789270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8789270Z 
2025-01-14T13:16:42.8789480Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8789730Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8789910Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8790290Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8790420Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8790530Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8790530Z 
2025-01-14T13:16:42.8790600Z     def initialize_transport_state(
2025-01-14T13:16:42.8790640Z         self,
2025-01-14T13:16:42.8790700Z         simulation_state,
2025-01-14T13:16:42.8790840Z         opacity_state,
2025-01-14T13:16:42.8790930Z         macro_atom_state,
2025-01-14T13:16:42.8790980Z         plasma,
2025-01-14T13:16:42.8791030Z         no_of_packets,
2025-01-14T13:16:42.8791090Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8791140Z         iteration=0,
2025-01-14T13:16:42.8791180Z     ):
2025-01-14T13:16:42.8791290Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8791360Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8791400Z         else:
2025-01-14T13:16:42.8791460Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8791510Z     
2025-01-14T13:16:42.8791630Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8791700Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8791740Z         )
2025-01-14T13:16:42.8791790Z     
2025-01-14T13:16:42.8791890Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8791980Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8792110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8792160Z         else:
2025-01-14T13:16:42.8792210Z             continuum_state = None
2025-01-14T13:16:42.8792290Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8792380Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8792450Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8792530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8792610Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8792840Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8792910Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8792950Z         ).to_numba(
2025-01-14T13:16:42.8793000Z             macro_atom_state,
2025-01-14T13:16:42.8793060Z             self.line_interaction_type,
2025-01-14T13:16:42.8793210Z         )
2025-01-14T13:16:42.8793310Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8793530Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8793580Z         ]
2025-01-14T13:16:42.8794200Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8794210Z 
2025-01-14T13:16:42.8794320Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8794520Z _ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[liw_with_selection1-2] _
2025-01-14T13:16:42.8794530Z 
2025-01-14T13:16:42.8795070Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8795350Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8795350Z 
2025-01-14T13:16:42.8795410Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8795540Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8795700Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8795880Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8795940Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8796070Z >       sim.run_final()
2025-01-14T13:16:42.8796070Z 
2025-01-14T13:16:42.8796140Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8796230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8796300Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8796420Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8796480Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8796610Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8796700Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8796700Z 
2025-01-14T13:16:42.8796910Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8797080Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8797250Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8797480Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8797600Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8797710Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8797710Z 
2025-01-14T13:16:42.8797770Z     def initialize_transport_state(
2025-01-14T13:16:42.8797820Z         self,
2025-01-14T13:16:42.8797880Z         simulation_state,
2025-01-14T13:16:42.8797930Z         opacity_state,
2025-01-14T13:16:42.8797980Z         macro_atom_state,
2025-01-14T13:16:42.8798030Z         plasma,
2025-01-14T13:16:42.8798070Z         no_of_packets,
2025-01-14T13:16:42.8798130Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8798180Z         iteration=0,
2025-01-14T13:16:42.8798230Z     ):
2025-01-14T13:16:42.8798330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8798400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8798440Z         else:
2025-01-14T13:16:42.8798500Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8798770Z     
2025-01-14T13:16:42.8798870Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8798950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8798990Z         )
2025-01-14T13:16:42.8799030Z     
2025-01-14T13:16:42.8799130Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8799220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8799340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8799380Z         else:
2025-01-14T13:16:42.8799560Z             continuum_state = None
2025-01-14T13:16:42.8799630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8799720Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8799780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8799870Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8799940Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8800020Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8800080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8800130Z         ).to_numba(
2025-01-14T13:16:42.8800180Z             macro_atom_state,
2025-01-14T13:16:42.8800250Z             self.line_interaction_type,
2025-01-14T13:16:42.8800290Z         )
2025-01-14T13:16:42.8800360Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8800580Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8800630Z         ]
2025-01-14T13:16:42.8800880Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8800880Z 
2025-01-14T13:16:42.8801090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8801260Z ___ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_plot[None] ____
2025-01-14T13:16:42.8801270Z 
2025-01-14T13:16:42.8801800Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8802090Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8802090Z 
2025-01-14T13:16:42.8802160Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8802280Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8802350Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8802490Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8802560Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8802720Z >       sim.run_final()
2025-01-14T13:16:42.8802740Z 
2025-01-14T13:16:42.8802820Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8802910Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8802990Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8803100Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8803170Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8803290Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8803380Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8803380Z 
2025-01-14T13:16:42.8803590Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8803750Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8803930Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8804150Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8804430Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8804540Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8804540Z 
2025-01-14T13:16:42.8804600Z     def initialize_transport_state(
2025-01-14T13:16:42.8804650Z         self,
2025-01-14T13:16:42.8804700Z         simulation_state,
2025-01-14T13:16:42.8804750Z         opacity_state,
2025-01-14T13:16:42.8804800Z         macro_atom_state,
2025-01-14T13:16:42.8804850Z         plasma,
2025-01-14T13:16:42.8805150Z         no_of_packets,
2025-01-14T13:16:42.8805210Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8805260Z         iteration=0,
2025-01-14T13:16:42.8805300Z     ):
2025-01-14T13:16:42.8805390Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8805470Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8805510Z         else:
2025-01-14T13:16:42.8805570Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8805610Z     
2025-01-14T13:16:42.8805720Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8805790Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8805840Z         )
2025-01-14T13:16:42.8805880Z     
2025-01-14T13:16:42.8805980Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8806060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8806180Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8806230Z         else:
2025-01-14T13:16:42.8806290Z             continuum_state = None
2025-01-14T13:16:42.8806370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8806440Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8806560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8806640Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8806710Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8806780Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8806850Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8806890Z         ).to_numba(
2025-01-14T13:16:42.8806940Z             macro_atom_state,
2025-01-14T13:16:42.8807010Z             self.line_interaction_type,
2025-01-14T13:16:42.8807050Z         )
2025-01-14T13:16:42.8807130Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8808410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8808820Z         ]
2025-01-14T13:16:42.8809520Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8809540Z 
2025-01-14T13:16:42.8809870Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8810300Z __ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[None-0] __
2025-01-14T13:16:42.8810330Z 
2025-01-14T13:16:42.8811920Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8812480Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8812510Z 
2025-01-14T13:16:42.8812590Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8812720Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8812810Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8812960Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8813020Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8813240Z >       sim.run_final()
2025-01-14T13:16:42.8813240Z 
2025-01-14T13:16:42.8813290Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8813390Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8813460Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8813570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8813640Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8813760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8813850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8813960Z 
2025-01-14T13:16:42.8814170Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8814340Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8814510Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8814740Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8814860Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8814960Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8814970Z 
2025-01-14T13:16:42.8815030Z     def initialize_transport_state(
2025-01-14T13:16:42.8815080Z         self,
2025-01-14T13:16:42.8815130Z         simulation_state,
2025-01-14T13:16:42.8815180Z         opacity_state,
2025-01-14T13:16:42.8815240Z         macro_atom_state,
2025-01-14T13:16:42.8815280Z         plasma,
2025-01-14T13:16:42.8815340Z         no_of_packets,
2025-01-14T13:16:42.8815400Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8815450Z         iteration=0,
2025-01-14T13:16:42.8815490Z     ):
2025-01-14T13:16:42.8815640Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8815710Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8815760Z         else:
2025-01-14T13:16:42.8815820Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8815860Z     
2025-01-14T13:16:42.8815960Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8816030Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8816080Z         )
2025-01-14T13:16:42.8816120Z     
2025-01-14T13:16:42.8816220Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8816300Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8816430Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8816480Z         else:
2025-01-14T13:16:42.8816540Z             continuum_state = None
2025-01-14T13:16:42.8816620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8816700Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8816770Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8816860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8816930Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8817000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8817060Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8817100Z         ).to_numba(
2025-01-14T13:16:42.8817160Z             macro_atom_state,
2025-01-14T13:16:42.8817220Z             self.line_interaction_type,
2025-01-14T13:16:42.8817260Z         )
2025-01-14T13:16:42.8817330Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8820750Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8820840Z         ]
2025-01-14T13:16:42.8821090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8821100Z 
2025-01-14T13:16:42.8821210Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8821510Z __ ERROR at setup of TestLineInfoWidgetEvents.test_filter_mode_toggle[None-1] __
2025-01-14T13:16:42.8821510Z 
2025-01-14T13:16:42.8822050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8822330Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8822330Z 
2025-01-14T13:16:42.8822620Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8822750Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8822820Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8822960Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8823020Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8823080Z >       sim.run_final()
2025-01-14T13:16:42.8823080Z 
2025-01-14T13:16:42.8823140Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8823230Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8823300Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8823410Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8823480Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8823600Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8823680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8823690Z 
2025-01-14T13:16:42.8823900Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8824220Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8824410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8824640Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8824760Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8824870Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8824870Z 
2025-01-14T13:16:42.8824930Z     def initialize_transport_state(
2025-01-14T13:16:42.8824980Z         self,
2025-01-14T13:16:42.8825030Z         simulation_state,
2025-01-14T13:16:42.8825090Z         opacity_state,
2025-01-14T13:16:42.8825140Z         macro_atom_state,
2025-01-14T13:16:42.8825180Z         plasma,
2025-01-14T13:16:42.8825230Z         no_of_packets,
2025-01-14T13:16:42.8825290Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8825340Z         iteration=0,
2025-01-14T13:16:42.8825380Z     ):
2025-01-14T13:16:42.8825480Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8825560Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8825610Z         else:
2025-01-14T13:16:42.8825670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8825730Z     
2025-01-14T13:16:42.8825850Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8825920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8825970Z         )
2025-01-14T13:16:42.8826010Z     
2025-01-14T13:16:42.8826110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8826200Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8826320Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8826370Z         else:
2025-01-14T13:16:42.8826420Z             continuum_state = None
2025-01-14T13:16:42.8826500Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8826590Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8826660Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8827110Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8832310Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8832410Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8832470Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8832520Z         ).to_numba(
2025-01-14T13:16:42.8832570Z             macro_atom_state,
2025-01-14T13:16:42.8832630Z             self.line_interaction_type,
2025-01-14T13:16:42.8832670Z         )
2025-01-14T13:16:42.8832750Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8833160Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8833210Z         ]
2025-01-14T13:16:42.8833450Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8833460Z 
2025-01-14T13:16:42.8833580Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8833780Z _ ERROR at setup of TestLineInfoWidgetEvents.test_selection_on_species_intrctn_table[None] _
2025-01-14T13:16:42.8833790Z 
2025-01-14T13:16:42.8834340Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8834630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8834630Z 
2025-01-14T13:16:42.8834700Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8834820Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8834890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8835170Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8835240Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8835290Z >       sim.run_final()
2025-01-14T13:16:42.8835290Z 
2025-01-14T13:16:42.8835360Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8835650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8835920Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8836050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8836120Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8836240Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8836330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8836340Z 
2025-01-14T13:16:42.8836550Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8836710Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8836900Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8837130Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8837260Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8837370Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8837370Z 
2025-01-14T13:16:42.8837440Z     def initialize_transport_state(
2025-01-14T13:16:42.8837480Z         self,
2025-01-14T13:16:42.8837540Z         simulation_state,
2025-01-14T13:16:42.8837600Z         opacity_state,
2025-01-14T13:16:42.8837650Z         macro_atom_state,
2025-01-14T13:16:42.8837700Z         plasma,
2025-01-14T13:16:42.8837750Z         no_of_packets,
2025-01-14T13:16:42.8837810Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8837860Z         iteration=0,
2025-01-14T13:16:42.8837910Z     ):
2025-01-14T13:16:42.8838010Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8838240Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8838290Z         else:
2025-01-14T13:16:42.8838350Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8838390Z     
2025-01-14T13:16:42.8838500Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8838570Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8838610Z         )
2025-01-14T13:16:42.8838650Z     
2025-01-14T13:16:42.8838760Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8838850Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8839080Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8839130Z         else:
2025-01-14T13:16:42.8839190Z             continuum_state = None
2025-01-14T13:16:42.8839270Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8839350Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8839430Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8839520Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8839590Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8839660Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8839720Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8839770Z         ).to_numba(
2025-01-14T13:16:42.8839820Z             macro_atom_state,
2025-01-14T13:16:42.8839880Z             self.line_interaction_type,
2025-01-14T13:16:42.8839930Z         )
2025-01-14T13:16:42.8840010Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8840230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8840270Z         ]
2025-01-14T13:16:42.8840560Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8840560Z 
2025-01-14T13:16:42.8840680Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8840840Z __ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[None-0] ___
2025-01-14T13:16:42.8840850Z 
2025-01-14T13:16:42.8841400Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8841680Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8841680Z 
2025-01-14T13:16:42.8841750Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8841870Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8841940Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8842090Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8842150Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8842200Z >       sim.run_final()
2025-01-14T13:16:42.8842210Z 
2025-01-14T13:16:42.8842260Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8842350Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8842420Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8842530Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8842600Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8842720Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8842800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8842810Z 
2025-01-14T13:16:42.8843020Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8843180Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8843420Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8843630Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8843750Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8843860Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8843860Z 
2025-01-14T13:16:42.8844110Z     def initialize_transport_state(
2025-01-14T13:16:42.8844170Z         self,
2025-01-14T13:16:42.8844220Z         simulation_state,
2025-01-14T13:16:42.8844390Z         opacity_state,
2025-01-14T13:16:42.8844450Z         macro_atom_state,
2025-01-14T13:16:42.8844490Z         plasma,
2025-01-14T13:16:42.8844540Z         no_of_packets,
2025-01-14T13:16:42.8844600Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8844650Z         iteration=0,
2025-01-14T13:16:42.8844690Z     ):
2025-01-14T13:16:42.8844790Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8844860Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8844910Z         else:
2025-01-14T13:16:42.8844960Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8845000Z     
2025-01-14T13:16:42.8845110Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8845180Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8845220Z         )
2025-01-14T13:16:42.8845260Z     
2025-01-14T13:16:42.8845360Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8845450Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8845580Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8845620Z         else:
2025-01-14T13:16:42.8845680Z             continuum_state = None
2025-01-14T13:16:42.8845800Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8846020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8846150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8846230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8846310Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8846380Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8846440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8846490Z         ).to_numba(
2025-01-14T13:16:42.8846540Z             macro_atom_state,
2025-01-14T13:16:42.8846600Z             self.line_interaction_type,
2025-01-14T13:16:42.8846650Z         )
2025-01-14T13:16:42.8846730Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8846950Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8847000Z         ]
2025-01-14T13:16:42.8847250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8847260Z 
2025-01-14T13:16:42.8847370Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8847540Z __ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[None-1] ___
2025-01-14T13:16:42.8847540Z 
2025-01-14T13:16:42.8848080Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8848360Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8848360Z 
2025-01-14T13:16:42.8848430Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8848550Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8848630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8848910Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8848980Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8849020Z >       sim.run_final()
2025-01-14T13:16:42.8849030Z 
2025-01-14T13:16:42.8849080Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8849180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8849250Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8849360Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8849420Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8849760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8849840Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8849840Z 
2025-01-14T13:16:42.8850060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8850220Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8850390Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8850610Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8850730Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8850840Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8850840Z 
2025-01-14T13:16:42.8850910Z     def initialize_transport_state(
2025-01-14T13:16:42.8850960Z         self,
2025-01-14T13:16:42.8851010Z         simulation_state,
2025-01-14T13:16:42.8851060Z         opacity_state,
2025-01-14T13:16:42.8851110Z         macro_atom_state,
2025-01-14T13:16:42.8851160Z         plasma,
2025-01-14T13:16:42.8851240Z         no_of_packets,
2025-01-14T13:16:42.8851300Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8851350Z         iteration=0,
2025-01-14T13:16:42.8851390Z     ):
2025-01-14T13:16:42.8851490Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8851560Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8851610Z         else:
2025-01-14T13:16:42.8851660Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8851700Z     
2025-01-14T13:16:42.8851810Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8851880Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8851920Z         )
2025-01-14T13:16:42.8851970Z     
2025-01-14T13:16:42.8852060Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8852150Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8852270Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8852320Z         else:
2025-01-14T13:16:42.8852380Z             continuum_state = None
2025-01-14T13:16:42.8852460Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8852540Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8852610Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8852690Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8852760Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8852830Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8852890Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8852940Z         ).to_numba(
2025-01-14T13:16:42.8852990Z             macro_atom_state,
2025-01-14T13:16:42.8853050Z             self.line_interaction_type,
2025-01-14T13:16:42.8853090Z         )
2025-01-14T13:16:42.8853170Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8853390Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8853430Z         ]
2025-01-14T13:16:42.8853680Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8853890Z 
2025-01-14T13:16:42.8854010Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8854170Z __ ERROR at setup of TestLineInfoWidgetEvents.test_group_mode_change[None-2] ___
2025-01-14T13:16:42.8854170Z 
2025-01-14T13:16:42.8854710Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8855060Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8855070Z 
2025-01-14T13:16:42.8855130Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8855260Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8855330Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8855470Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8855540Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8855590Z >       sim.run_final()
2025-01-14T13:16:42.8855590Z 
2025-01-14T13:16:42.8855650Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8855730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8855810Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8855910Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8855990Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8856110Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8856200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8856410Z 
2025-01-14T13:16:42.8856630Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8856790Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8856970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8857180Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8857310Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8857420Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8857420Z 
2025-01-14T13:16:42.8857640Z     def initialize_transport_state(
2025-01-14T13:16:42.8857690Z         self,
2025-01-14T13:16:42.8857740Z         simulation_state,
2025-01-14T13:16:42.8857820Z         opacity_state,
2025-01-14T13:16:42.8857870Z         macro_atom_state,
2025-01-14T13:16:42.8857920Z         plasma,
2025-01-14T13:16:42.8857970Z         no_of_packets,
2025-01-14T13:16:42.8858020Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8858070Z         iteration=0,
2025-01-14T13:16:42.8858120Z     ):
2025-01-14T13:16:42.8858210Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8858280Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8858330Z         else:
2025-01-14T13:16:42.8858380Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8858420Z     
2025-01-14T13:16:42.8858530Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8858600Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8858640Z         )
2025-01-14T13:16:42.8858680Z     
2025-01-14T13:16:42.8858780Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8858870Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8858990Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8859040Z         else:
2025-01-14T13:16:42.8859090Z             continuum_state = None
2025-01-14T13:16:42.8859240Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8859320Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8859390Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8859470Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8859550Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8859610Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8859680Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8859720Z         ).to_numba(
2025-01-14T13:16:42.8859780Z             macro_atom_state,
2025-01-14T13:16:42.8859910Z             self.line_interaction_type,
2025-01-14T13:16:42.8859950Z         )
2025-01-14T13:16:42.8860030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8860240Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8860290Z         ]
2025-01-14T13:16:42.8860530Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8860540Z 
2025-01-14T13:16:42.8860650Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8860790Z _____________ ERROR at setup of TestBaseShellInfo.test_shells_data _____________
2025-01-14T13:16:42.8860790Z 
2025-01-14T13:16:42.8861320Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8861600Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8861600Z 
2025-01-14T13:16:42.8861690Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8861820Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8861890Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8862030Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8862090Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8862150Z >       sim.run_final()
2025-01-14T13:16:42.8862150Z 
2025-01-14T13:16:42.8862200Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8862300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8862370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8862480Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8862550Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8862670Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8862750Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8862760Z 
2025-01-14T13:16:42.8862960Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8863120Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8863290Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8863510Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8863630Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8863740Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8863740Z 
2025-01-14T13:16:42.8863810Z     def initialize_transport_state(
2025-01-14T13:16:42.8863850Z         self,
2025-01-14T13:16:42.8863900Z         simulation_state,
2025-01-14T13:16:42.8863950Z         opacity_state,
2025-01-14T13:16:42.8864000Z         macro_atom_state,
2025-01-14T13:16:42.8864050Z         plasma,
2025-01-14T13:16:42.8864100Z         no_of_packets,
2025-01-14T13:16:42.8864160Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8864260Z         iteration=0,
2025-01-14T13:16:42.8864300Z     ):
2025-01-14T13:16:42.8864400Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8864470Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8864510Z         else:
2025-01-14T13:16:42.8864560Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8864610Z     
2025-01-14T13:16:42.8864710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8864790Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8864830Z         )
2025-01-14T13:16:42.8864930Z     
2025-01-14T13:16:42.8865030Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8865110Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8865240Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8865280Z         else:
2025-01-14T13:16:42.8865340Z             continuum_state = None
2025-01-14T13:16:42.8865420Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8865510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8865580Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8865660Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8865730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8865800Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8865870Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8865910Z         ).to_numba(
2025-01-14T13:16:42.8865970Z             macro_atom_state,
2025-01-14T13:16:42.8866030Z             self.line_interaction_type,
2025-01-14T13:16:42.8866070Z         )
2025-01-14T13:16:42.8866150Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8866400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8866440Z         ]
2025-01-14T13:16:42.8866690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8866690Z 
2025-01-14T13:16:42.8866800Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8866950Z ________ ERROR at setup of TestBaseShellInfo.test_element_count_data[1] ________
2025-01-14T13:16:42.8866950Z 
2025-01-14T13:16:42.8867480Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8867770Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8867770Z 
2025-01-14T13:16:42.8867840Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8867960Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8868030Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8868170Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8868230Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8868280Z >       sim.run_final()
2025-01-14T13:16:42.8868290Z 
2025-01-14T13:16:42.8868350Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8868430Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8868510Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8868620Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8868690Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8868810Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8868900Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8868900Z 
2025-01-14T13:16:42.8869170Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8869330Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8869510Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8869720Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8869850Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8869960Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8870110Z 
2025-01-14T13:16:42.8870190Z     def initialize_transport_state(
2025-01-14T13:16:42.8870240Z         self,
2025-01-14T13:16:42.8870290Z         simulation_state,
2025-01-14T13:16:42.8870340Z         opacity_state,
2025-01-14T13:16:42.8870390Z         macro_atom_state,
2025-01-14T13:16:42.8870440Z         plasma,
2025-01-14T13:16:42.8870490Z         no_of_packets,
2025-01-14T13:16:42.8870550Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8870600Z         iteration=0,
2025-01-14T13:16:42.8870640Z     ):
2025-01-14T13:16:42.8870730Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8870810Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8870850Z         else:
2025-01-14T13:16:42.8870900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8870950Z     
2025-01-14T13:16:42.8871050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8871120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8871160Z         )
2025-01-14T13:16:42.8871210Z     
2025-01-14T13:16:42.8871300Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8871390Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8871540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8871590Z         else:
2025-01-14T13:16:42.8871650Z             continuum_state = None
2025-01-14T13:16:42.8871720Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8871800Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8871870Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8871950Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8872020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8872090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8872160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8872210Z         ).to_numba(
2025-01-14T13:16:42.8872260Z             macro_atom_state,
2025-01-14T13:16:42.8872320Z             self.line_interaction_type,
2025-01-14T13:16:42.8872360Z         )
2025-01-14T13:16:42.8872440Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8872660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8872700Z         ]
2025-01-14T13:16:42.8872940Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8872950Z 
2025-01-14T13:16:42.8873060Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8873200Z _______ ERROR at setup of TestBaseShellInfo.test_element_count_data[20] ________
2025-01-14T13:16:42.8873210Z 
2025-01-14T13:16:42.8873730Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8874020Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8874020Z 
2025-01-14T13:16:42.8874080Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8874830Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8874910Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8875050Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8875110Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8875160Z >       sim.run_final()
2025-01-14T13:16:42.8875160Z 
2025-01-14T13:16:42.8875220Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8875300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8875370Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8875570Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8875650Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8875760Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8875850Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8875860Z 
2025-01-14T13:16:42.8876060Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8876220Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8876390Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8876600Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8876720Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8876820Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8876830Z 
2025-01-14T13:16:42.8876890Z     def initialize_transport_state(
2025-01-14T13:16:42.8876940Z         self,
2025-01-14T13:16:42.8876990Z         simulation_state,
2025-01-14T13:16:42.8877180Z         opacity_state,
2025-01-14T13:16:42.8877230Z         macro_atom_state,
2025-01-14T13:16:42.8877270Z         plasma,
2025-01-14T13:16:42.8877330Z         no_of_packets,
2025-01-14T13:16:42.8877380Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8877430Z         iteration=0,
2025-01-14T13:16:42.8877470Z     ):
2025-01-14T13:16:42.8877560Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8877640Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8877680Z         else:
2025-01-14T13:16:42.8877740Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8877780Z     
2025-01-14T13:16:42.8877880Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8877950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8878000Z         )
2025-01-14T13:16:42.8878040Z     
2025-01-14T13:16:42.8878140Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8878220Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8878350Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8878390Z         else:
2025-01-14T13:16:42.8878450Z             continuum_state = None
2025-01-14T13:16:42.8878530Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8878610Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8878680Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8878750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8878830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8878900Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8878970Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8879010Z         ).to_numba(
2025-01-14T13:16:42.8879070Z             macro_atom_state,
2025-01-14T13:16:42.8879130Z             self.line_interaction_type,
2025-01-14T13:16:42.8879170Z         )
2025-01-14T13:16:42.8879250Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8879470Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8879560Z         ]
2025-01-14T13:16:42.8879810Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8879810Z 
2025-01-14T13:16:42.8879920Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8880060Z ________ ERROR at setup of TestBaseShellInfo.test_ion_count_data[12-1] _________
2025-01-14T13:16:42.8880070Z 
2025-01-14T13:16:42.8881230Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8883060Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8883090Z 
2025-01-14T13:16:42.8883190Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8883320Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8883390Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8883540Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8883600Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8883650Z >       sim.run_final()
2025-01-14T13:16:42.8883660Z 
2025-01-14T13:16:42.8883710Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8883800Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8883880Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8884210Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8884470Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8884770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8884870Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8884880Z 
2025-01-14T13:16:42.8885080Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8885240Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8885410Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8885630Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8885750Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8885870Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8885870Z 
2025-01-14T13:16:42.8885930Z     def initialize_transport_state(
2025-01-14T13:16:42.8885970Z         self,
2025-01-14T13:16:42.8886020Z         simulation_state,
2025-01-14T13:16:42.8886080Z         opacity_state,
2025-01-14T13:16:42.8886130Z         macro_atom_state,
2025-01-14T13:16:42.8886170Z         plasma,
2025-01-14T13:16:42.8886220Z         no_of_packets,
2025-01-14T13:16:42.8886280Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8886330Z         iteration=0,
2025-01-14T13:16:42.8886370Z     ):
2025-01-14T13:16:42.8886470Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8886530Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8886580Z         else:
2025-01-14T13:16:42.8886630Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8886680Z     
2025-01-14T13:16:42.8886780Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8886850Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8886890Z         )
2025-01-14T13:16:42.8886940Z     
2025-01-14T13:16:42.8887040Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8887130Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8887250Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8887360Z         else:
2025-01-14T13:16:42.8887420Z             continuum_state = None
2025-01-14T13:16:42.8887490Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8887580Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8887640Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8887730Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8892990Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8893090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8893310Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8893360Z         ).to_numba(
2025-01-14T13:16:42.8893410Z             macro_atom_state,
2025-01-14T13:16:42.8893480Z             self.line_interaction_type,
2025-01-14T13:16:42.8893520Z         )
2025-01-14T13:16:42.8893610Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8893840Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8894130Z         ]
2025-01-14T13:16:42.8895970Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8895980Z 
2025-01-14T13:16:42.8896090Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8896240Z ________ ERROR at setup of TestBaseShellInfo.test_ion_count_data[20-20] ________
2025-01-14T13:16:42.8896240Z 
2025-01-14T13:16:42.8896770Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8897050Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8897130Z 
2025-01-14T13:16:42.8897400Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8897530Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8897690Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8897830Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8897890Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8897940Z >       sim.run_final()
2025-01-14T13:16:42.8897940Z 
2025-01-14T13:16:42.8898000Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8898100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8900330Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8900450Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8900520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8900910Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8901010Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8901010Z 
2025-01-14T13:16:42.8901230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8901390Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8901570Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8901780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8901910Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8902020Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8902030Z 
2025-01-14T13:16:42.8902090Z     def initialize_transport_state(
2025-01-14T13:16:42.8902140Z         self,
2025-01-14T13:16:42.8902200Z         simulation_state,
2025-01-14T13:16:42.8902250Z         opacity_state,
2025-01-14T13:16:42.8902400Z         macro_atom_state,
2025-01-14T13:16:42.8902450Z         plasma,
2025-01-14T13:16:42.8902490Z         no_of_packets,
2025-01-14T13:16:42.8902550Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8902600Z         iteration=0,
2025-01-14T13:16:42.8902640Z     ):
2025-01-14T13:16:42.8902740Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8902820Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8902860Z         else:
2025-01-14T13:16:42.8902920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8902960Z     
2025-01-14T13:16:42.8903080Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8903330Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8903380Z         )
2025-01-14T13:16:42.8903430Z     
2025-01-14T13:16:42.8903530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8903620Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8903740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8903790Z         else:
2025-01-14T13:16:42.8903850Z             continuum_state = None
2025-01-14T13:16:42.8903930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8904010Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8904080Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8904150Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8904230Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8904290Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8904360Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8904410Z         ).to_numba(
2025-01-14T13:16:42.8904460Z             macro_atom_state,
2025-01-14T13:16:42.8904560Z             self.line_interaction_type,
2025-01-14T13:16:42.8904610Z         )
2025-01-14T13:16:42.8904680Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8904900Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8904950Z         ]
2025-01-14T13:16:42.8905190Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8905190Z 
2025-01-14T13:16:42.8905310Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8905460Z ______ ERROR at setup of TestBaseShellInfo.test_level_count_data[2-12-1] _______
2025-01-14T13:16:42.8905460Z 
2025-01-14T13:16:42.8906010Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8906290Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8906300Z 
2025-01-14T13:16:42.8906360Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8906490Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8906560Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8906700Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8906760Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8906810Z >       sim.run_final()
2025-01-14T13:16:42.8906810Z 
2025-01-14T13:16:42.8906870Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8906960Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8907030Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8907140Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8907210Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8907340Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8907640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8907640Z 
2025-01-14T13:16:42.8907850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8908010Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8908190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8908410Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8908610Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8908720Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8908730Z 
2025-01-14T13:16:42.8908790Z     def initialize_transport_state(
2025-01-14T13:16:42.8908830Z         self,
2025-01-14T13:16:42.8908890Z         simulation_state,
2025-01-14T13:16:42.8908940Z         opacity_state,
2025-01-14T13:16:42.8908990Z         macro_atom_state,
2025-01-14T13:16:42.8909040Z         plasma,
2025-01-14T13:16:42.8909090Z         no_of_packets,
2025-01-14T13:16:42.8909150Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8909200Z         iteration=0,
2025-01-14T13:16:42.8909240Z     ):
2025-01-14T13:16:42.8909330Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8909410Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8909450Z         else:
2025-01-14T13:16:42.8910140Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8910220Z     
2025-01-14T13:16:42.8910330Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8910400Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8910450Z         )
2025-01-14T13:16:42.8910490Z     
2025-01-14T13:16:42.8910790Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8910890Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8911020Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8911060Z         else:
2025-01-14T13:16:42.8911130Z             continuum_state = None
2025-01-14T13:16:42.8911200Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8911290Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8911360Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8911450Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8911520Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8911600Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8911670Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8911710Z         ).to_numba(
2025-01-14T13:16:42.8911770Z             macro_atom_state,
2025-01-14T13:16:42.8911830Z             self.line_interaction_type,
2025-01-14T13:16:42.8911880Z         )
2025-01-14T13:16:42.8911960Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8912190Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8912240Z         ]
2025-01-14T13:16:42.8912490Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8912500Z 
2025-01-14T13:16:42.8912620Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8912770Z ______ ERROR at setup of TestBaseShellInfo.test_level_count_data[3-20-20] ______
2025-01-14T13:16:42.8912770Z 
2025-01-14T13:16:42.8913320Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8913610Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8913680Z 
2025-01-14T13:16:42.8913760Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8913880Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8913950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8914100Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8914170Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8914220Z >       sim.run_final()
2025-01-14T13:16:42.8914220Z 
2025-01-14T13:16:42.8914280Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8914470Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8914550Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8914660Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8914720Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8914850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8914940Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8914940Z 
2025-01-14T13:16:42.8915150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8915320Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8915610Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8915840Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8915970Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8916080Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8916150Z 
2025-01-14T13:16:42.8916220Z     def initialize_transport_state(
2025-01-14T13:16:42.8916260Z         self,
2025-01-14T13:16:42.8916320Z         simulation_state,
2025-01-14T13:16:42.8916370Z         opacity_state,
2025-01-14T13:16:42.8916420Z         macro_atom_state,
2025-01-14T13:16:42.8916460Z         plasma,
2025-01-14T13:16:42.8916510Z         no_of_packets,
2025-01-14T13:16:42.8916560Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8916610Z         iteration=0,
2025-01-14T13:16:42.8916650Z     ):
2025-01-14T13:16:42.8916750Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8916820Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8916870Z         else:
2025-01-14T13:16:42.8916920Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8916970Z     
2025-01-14T13:16:42.8917070Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8917150Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8917190Z         )
2025-01-14T13:16:42.8917230Z     
2025-01-14T13:16:42.8917330Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8917430Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8917550Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8917600Z         else:
2025-01-14T13:16:42.8917660Z             continuum_state = None
2025-01-14T13:16:42.8917730Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8917820Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8917890Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8917970Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8918040Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8918110Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8918180Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8918220Z         ).to_numba(
2025-01-14T13:16:42.8918270Z             macro_atom_state,
2025-01-14T13:16:42.8918340Z             self.line_interaction_type,
2025-01-14T13:16:42.8918440Z         )
2025-01-14T13:16:42.8918520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8918740Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8918790Z         ]
2025-01-14T13:16:42.8919030Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8919030Z 
2025-01-14T13:16:42.8919220Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8919410Z __________ ERROR at setup of TestSimulationShellInfo.test_shells_data __________
2025-01-14T13:16:42.8919690Z 
2025-01-14T13:16:42.8920250Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8920550Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8920560Z 
2025-01-14T13:16:42.8920630Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8920750Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8920830Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8920970Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8921030Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8921080Z >       sim.run_final()
2025-01-14T13:16:42.8921090Z 
2025-01-14T13:16:42.8921150Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8921240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8921310Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8921460Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8921540Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8921670Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8921760Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8921760Z 
2025-01-14T13:16:42.8921980Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8922130Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8922310Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8922530Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8922650Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8922750Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8922760Z 
2025-01-14T13:16:42.8922830Z     def initialize_transport_state(
2025-01-14T13:16:42.8922870Z         self,
2025-01-14T13:16:42.8922930Z         simulation_state,
2025-01-14T13:16:42.8922980Z         opacity_state,
2025-01-14T13:16:42.8923030Z         macro_atom_state,
2025-01-14T13:16:42.8923070Z         plasma,
2025-01-14T13:16:42.8923120Z         no_of_packets,
2025-01-14T13:16:42.8923180Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8923230Z         iteration=0,
2025-01-14T13:16:42.8923270Z     ):
2025-01-14T13:16:42.8923370Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8923440Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8923480Z         else:
2025-01-14T13:16:42.8923540Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8923580Z     
2025-01-14T13:16:42.8923690Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8923760Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8923810Z         )
2025-01-14T13:16:42.8923850Z     
2025-01-14T13:16:42.8923950Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8924090Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8924210Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8924260Z         else:
2025-01-14T13:16:42.8924320Z             continuum_state = None
2025-01-14T13:16:42.8924390Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8924480Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8924550Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8925390Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8926640Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8926720Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8926780Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8926830Z         ).to_numba(
2025-01-14T13:16:42.8926890Z             macro_atom_state,
2025-01-14T13:16:42.8926950Z             self.line_interaction_type,
2025-01-14T13:16:42.8927000Z         )
2025-01-14T13:16:42.8927080Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8927300Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8927350Z         ]
2025-01-14T13:16:42.8927590Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8927590Z 
2025-01-14T13:16:42.8927710Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8927860Z _____ ERROR at setup of TestSimulationShellInfo.test_element_count_data[1] _____
2025-01-14T13:16:42.8927870Z 
2025-01-14T13:16:42.8931310Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8933030Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8933050Z 
2025-01-14T13:16:42.8933140Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8933270Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8933330Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8933480Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8933540Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8933590Z >       sim.run_final()
2025-01-14T13:16:42.8933600Z 
2025-01-14T13:16:42.8933650Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8933740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8933810Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8933920Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8934010Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8934120Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8934210Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8934210Z 
2025-01-14T13:16:42.8937510Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8937700Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8937880Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8938100Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8938220Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8938330Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8938340Z 
2025-01-14T13:16:42.8938400Z     def initialize_transport_state(
2025-01-14T13:16:42.8938740Z         self,
2025-01-14T13:16:42.8938790Z         simulation_state,
2025-01-14T13:16:42.8938840Z         opacity_state,
2025-01-14T13:16:42.8938890Z         macro_atom_state,
2025-01-14T13:16:42.8938940Z         plasma,
2025-01-14T13:16:42.8938990Z         no_of_packets,
2025-01-14T13:16:42.8939040Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8939090Z         iteration=0,
2025-01-14T13:16:42.8939130Z     ):
2025-01-14T13:16:42.8939230Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8939300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8939450Z         else:
2025-01-14T13:16:42.8939510Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8939550Z     
2025-01-14T13:16:42.8939660Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8939730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8939780Z         )
2025-01-14T13:16:42.8939820Z     
2025-01-14T13:16:42.8939920Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8940010Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8940130Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8940170Z         else:
2025-01-14T13:16:42.8940230Z             continuum_state = None
2025-01-14T13:16:42.8940310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8940600Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8940690Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8940780Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8940850Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8940920Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8940990Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8941250Z         ).to_numba(
2025-01-14T13:16:42.8941310Z             macro_atom_state,
2025-01-14T13:16:42.8941370Z             self.line_interaction_type,
2025-01-14T13:16:42.8941420Z         )
2025-01-14T13:16:42.8941490Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8941720Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8941970Z         ]
2025-01-14T13:16:42.8942250Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8942250Z 
2025-01-14T13:16:42.8942370Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8942530Z ____ ERROR at setup of TestSimulationShellInfo.test_element_count_data[20] _____
2025-01-14T13:16:42.8942530Z 
2025-01-14T13:16:42.8943070Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8943360Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8943370Z 
2025-01-14T13:16:42.8943430Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8943550Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8943630Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8943760Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8943830Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8943880Z >       sim.run_final()
2025-01-14T13:16:42.8943880Z 
2025-01-14T13:16:42.8943930Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8944040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8944110Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8944230Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8944390Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8944520Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8944600Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8944610Z 
2025-01-14T13:16:42.8944810Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8944970Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8945140Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8945440Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8945570Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8945680Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8945680Z 
2025-01-14T13:16:42.8945750Z     def initialize_transport_state(
2025-01-14T13:16:42.8945800Z         self,
2025-01-14T13:16:42.8945850Z         simulation_state,
2025-01-14T13:16:42.8945900Z         opacity_state,
2025-01-14T13:16:42.8945950Z         macro_atom_state,
2025-01-14T13:16:42.8945990Z         plasma,
2025-01-14T13:16:42.8946040Z         no_of_packets,
2025-01-14T13:16:42.8946100Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8946140Z         iteration=0,
2025-01-14T13:16:42.8946190Z     ):
2025-01-14T13:16:42.8946290Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8946360Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8946410Z         else:
2025-01-14T13:16:42.8946470Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8946510Z     
2025-01-14T13:16:42.8946620Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8946730Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8946770Z         )
2025-01-14T13:16:42.8946820Z     
2025-01-14T13:16:42.8946920Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8947000Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8947120Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8947180Z         else:
2025-01-14T13:16:42.8947230Z             continuum_state = None
2025-01-14T13:16:42.8947310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8947390Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8947460Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8947550Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8947620Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8947680Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8947750Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8947800Z         ).to_numba(
2025-01-14T13:16:42.8947860Z             macro_atom_state,
2025-01-14T13:16:42.8947920Z             self.line_interaction_type,
2025-01-14T13:16:42.8947970Z         )
2025-01-14T13:16:42.8948040Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8948260Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8948310Z         ]
2025-01-14T13:16:42.8955320Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8955320Z 
2025-01-14T13:16:42.8955450Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8955630Z _____ ERROR at setup of TestSimulationShellInfo.test_ion_count_data[12-1] ______
2025-01-14T13:16:42.8955630Z 
2025-01-14T13:16:42.8956170Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8956560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8956570Z 
2025-01-14T13:16:42.8956630Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8956750Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8956860Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8957000Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8957170Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8957710Z >       sim.run_final()
2025-01-14T13:16:42.8958090Z 
2025-01-14T13:16:42.8958170Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8958260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8958340Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8958460Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8958530Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8958650Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8958740Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8958740Z 
2025-01-14T13:16:42.8958940Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8959100Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8959590Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8960010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8960150Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8960350Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8960350Z 
2025-01-14T13:16:42.8960420Z     def initialize_transport_state(
2025-01-14T13:16:42.8960460Z         self,
2025-01-14T13:16:42.8960510Z         simulation_state,
2025-01-14T13:16:42.8960560Z         opacity_state,
2025-01-14T13:16:42.8960620Z         macro_atom_state,
2025-01-14T13:16:42.8960660Z         plasma,
2025-01-14T13:16:42.8960710Z         no_of_packets,
2025-01-14T13:16:42.8960770Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8960820Z         iteration=0,
2025-01-14T13:16:42.8960860Z     ):
2025-01-14T13:16:42.8960950Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8961030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8961080Z         else:
2025-01-14T13:16:42.8961130Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8961170Z     
2025-01-14T13:16:42.8961280Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8961350Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8961390Z         )
2025-01-14T13:16:42.8961440Z     
2025-01-14T13:16:42.8961540Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8961620Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8961740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8961780Z         else:
2025-01-14T13:16:42.8961840Z             continuum_state = None
2025-01-14T13:16:42.8962160Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8962240Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8962310Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8962390Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8962470Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8962540Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8962600Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8962680Z         ).to_numba(
2025-01-14T13:16:42.8962730Z             macro_atom_state,
2025-01-14T13:16:42.8962790Z             self.line_interaction_type,
2025-01-14T13:16:42.8962840Z         )
2025-01-14T13:16:42.8962910Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8963130Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8963170Z         ]
2025-01-14T13:16:42.8963420Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8963560Z 
2025-01-14T13:16:42.8963770Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8963940Z _____ ERROR at setup of TestSimulationShellInfo.test_ion_count_data[20-20] _____
2025-01-14T13:16:42.8963940Z 
2025-01-14T13:16:42.8964490Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8964780Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8964780Z 
2025-01-14T13:16:42.8964850Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8964970Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8965050Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8965190Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8965250Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8965300Z >       sim.run_final()
2025-01-14T13:16:42.8965300Z 
2025-01-14T13:16:42.8965360Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8965530Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8965600Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8965710Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8965780Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8965900Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8965990Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8965990Z 
2025-01-14T13:16:42.8966200Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8966360Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8966540Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8966770Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8966890Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8967010Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8967010Z 
2025-01-14T13:16:42.8967070Z     def initialize_transport_state(
2025-01-14T13:16:42.8967120Z         self,
2025-01-14T13:16:42.8967170Z         simulation_state,
2025-01-14T13:16:42.8967220Z         opacity_state,
2025-01-14T13:16:42.8967270Z         macro_atom_state,
2025-01-14T13:16:42.8967320Z         plasma,
2025-01-14T13:16:42.8967370Z         no_of_packets,
2025-01-14T13:16:42.8967540Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8967590Z         iteration=0,
2025-01-14T13:16:42.8967630Z     ):
2025-01-14T13:16:42.8967730Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8967800Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8967850Z         else:
2025-01-14T13:16:42.8967900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8967950Z     
2025-01-14T13:16:42.8968050Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8968120Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8968300Z         )
2025-01-14T13:16:42.8968350Z     
2025-01-14T13:16:42.8968440Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8968540Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8968660Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8968700Z         else:
2025-01-14T13:16:42.8968770Z             continuum_state = None
2025-01-14T13:16:42.8968940Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8969040Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8974150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8974270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8974340Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8974420Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8974480Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8974530Z         ).to_numba(
2025-01-14T13:16:42.8974590Z             macro_atom_state,
2025-01-14T13:16:42.8974650Z             self.line_interaction_type,
2025-01-14T13:16:42.8974690Z         )
2025-01-14T13:16:42.8974770Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8974990Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8975040Z         ]
2025-01-14T13:16:42.8975290Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8975290Z 
2025-01-14T13:16:42.8975410Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8975570Z ___ ERROR at setup of TestSimulationShellInfo.test_level_count_data[2-12-1] ____
2025-01-14T13:16:42.8975710Z 
2025-01-14T13:16:42.8976250Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8976540Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8976540Z 
2025-01-14T13:16:42.8976600Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8976720Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8976800Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8976940Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8977000Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8977050Z >       sim.run_final()
2025-01-14T13:16:42.8977050Z 
2025-01-14T13:16:42.8977110Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8977200Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8977270Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8977380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8977450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8977570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8977660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8977770Z 
2025-01-14T13:16:42.8977980Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8978140Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8978320Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8978530Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8978660Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8978810Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8978810Z 
2025-01-14T13:16:42.8978880Z     def initialize_transport_state(
2025-01-14T13:16:42.8978920Z         self,
2025-01-14T13:16:42.8978970Z         simulation_state,
2025-01-14T13:16:42.8979020Z         opacity_state,
2025-01-14T13:16:42.8979070Z         macro_atom_state,
2025-01-14T13:16:42.8979120Z         plasma,
2025-01-14T13:16:42.8979170Z         no_of_packets,
2025-01-14T13:16:42.8979230Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8979280Z         iteration=0,
2025-01-14T13:16:42.8979390Z     ):
2025-01-14T13:16:42.8979490Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8979570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8979610Z         else:
2025-01-14T13:16:42.8979670Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8979710Z     
2025-01-14T13:16:42.8979820Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8979890Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8979940Z         )
2025-01-14T13:16:42.8979980Z     
2025-01-14T13:16:42.8980080Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8980170Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8980290Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8980340Z         else:
2025-01-14T13:16:42.8980400Z             continuum_state = None
2025-01-14T13:16:42.8980480Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8980560Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8980630Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8980710Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8980810Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8980880Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8980950Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8980990Z         ).to_numba(
2025-01-14T13:16:42.8981050Z             macro_atom_state,
2025-01-14T13:16:42.8981110Z             self.line_interaction_type,
2025-01-14T13:16:42.8981150Z         )
2025-01-14T13:16:42.8981230Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8981440Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8981490Z         ]
2025-01-14T13:16:42.8981740Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8981740Z 
2025-01-14T13:16:42.8981850Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8982010Z ___ ERROR at setup of TestSimulationShellInfo.test_level_count_data[3-20-20] ___
2025-01-14T13:16:42.8982010Z 
2025-01-14T13:16:42.8982540Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8982830Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8982840Z 
2025-01-14T13:16:42.8982900Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8983090Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8983160Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8983310Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8983370Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8983420Z >       sim.run_final()
2025-01-14T13:16:42.8983430Z 
2025-01-14T13:16:42.8983480Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8983570Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8983670Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8983780Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8983850Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8984220Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8984310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8984320Z 
2025-01-14T13:16:42.8984520Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8984770Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8984950Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8985170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8985290Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8985400Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8985400Z 
2025-01-14T13:16:42.8985460Z     def initialize_transport_state(
2025-01-14T13:16:42.8985510Z         self,
2025-01-14T13:16:42.8985560Z         simulation_state,
2025-01-14T13:16:42.8985610Z         opacity_state,
2025-01-14T13:16:42.8985670Z         macro_atom_state,
2025-01-14T13:16:42.8985720Z         plasma,
2025-01-14T13:16:42.8985770Z         no_of_packets,
2025-01-14T13:16:42.8985820Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8985870Z         iteration=0,
2025-01-14T13:16:42.8985910Z     ):
2025-01-14T13:16:42.8986010Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8986080Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8986120Z         else:
2025-01-14T13:16:42.8986210Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8986250Z     
2025-01-14T13:16:42.8986360Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8986430Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8986480Z         )
2025-01-14T13:16:42.8986520Z     
2025-01-14T13:16:42.8986620Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8986700Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8986820Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8986870Z         else:
2025-01-14T13:16:42.8986930Z             continuum_state = None
2025-01-14T13:16:42.8987000Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8987090Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8987150Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8987230Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8987300Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.8987370Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.8987440Z             continuum_state=continuum_state,
2025-01-14T13:16:42.8987490Z         ).to_numba(
2025-01-14T13:16:42.8987540Z             macro_atom_state,
2025-01-14T13:16:42.8987600Z             self.line_interaction_type,
2025-01-14T13:16:42.8987650Z         )
2025-01-14T13:16:42.8987720Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.8987940Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.8988120Z         ]
2025-01-14T13:16:42.8988820Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.8988930Z 
2025-01-14T13:16:42.8989340Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.8989730Z _____________ ERROR at setup of TestHDFShellInfo.test_shells_data ______________
2025-01-14T13:16:42.8989740Z 
2025-01-14T13:16:42.8991050Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.8991380Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.8991390Z 
2025-01-14T13:16:42.8991460Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.8991580Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.8991950Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.8992090Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.8992150Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.8992210Z >       sim.run_final()
2025-01-14T13:16:42.8992210Z 
2025-01-14T13:16:42.8992270Z tardis/conftest.py:233: 
2025-01-14T13:16:42.8992370Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8992430Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.8992550Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.8992610Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.8992740Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.8992820Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.8992830Z 
2025-01-14T13:16:42.8993230Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.8993390Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.8993570Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.8993850Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.8993970Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.8994080Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.8994080Z 
2025-01-14T13:16:42.8994170Z     def initialize_transport_state(
2025-01-14T13:16:42.8995080Z         self,
2025-01-14T13:16:42.8995310Z         simulation_state,
2025-01-14T13:16:42.8995470Z         opacity_state,
2025-01-14T13:16:42.8995640Z         macro_atom_state,
2025-01-14T13:16:42.8995780Z         plasma,
2025-01-14T13:16:42.8995930Z         no_of_packets,
2025-01-14T13:16:42.8997110Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.8997320Z         iteration=0,
2025-01-14T13:16:42.8998390Z     ):
2025-01-14T13:16:42.8998530Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.8998600Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.8998650Z         else:
2025-01-14T13:16:42.8998700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.8998760Z     
2025-01-14T13:16:42.8998860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.8998930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.8998980Z         )
2025-01-14T13:16:42.8999020Z     
2025-01-14T13:16:42.8999120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.8999210Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.8999470Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.8999520Z         else:
2025-01-14T13:16:42.8999580Z             continuum_state = None
2025-01-14T13:16:42.8999670Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.8999750Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.8999810Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.8999900Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.8999970Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9000170Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9000240Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9000280Z         ).to_numba(
2025-01-14T13:16:42.9000330Z             macro_atom_state,
2025-01-14T13:16:42.9000400Z             self.line_interaction_type,
2025-01-14T13:16:42.9000440Z         )
2025-01-14T13:16:42.9000520Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9000740Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9000780Z         ]
2025-01-14T13:16:42.9001090Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9001100Z 
2025-01-14T13:16:42.9001210Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9001360Z ________ ERROR at setup of TestHDFShellInfo.test_element_count_data[1] _________
2025-01-14T13:16:42.9001370Z 
2025-01-14T13:16:42.9001910Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9002190Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9002190Z 
2025-01-14T13:16:42.9002260Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9002380Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9002460Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9003660Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9003940Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9004670Z >       sim.run_final()
2025-01-14T13:16:42.9004680Z 
2025-01-14T13:16:42.9004860Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9005240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9005520Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9005660Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9005730Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9005850Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9005940Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9005950Z 
2025-01-14T13:16:42.9006150Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9006320Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9006500Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9006720Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9006850Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9006960Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9006960Z 
2025-01-14T13:16:42.9007030Z     def initialize_transport_state(
2025-01-14T13:16:42.9007070Z         self,
2025-01-14T13:16:42.9007130Z         simulation_state,
2025-01-14T13:16:42.9007360Z         opacity_state,
2025-01-14T13:16:42.9007410Z         macro_atom_state,
2025-01-14T13:16:42.9007460Z         plasma,
2025-01-14T13:16:42.9007510Z         no_of_packets,
2025-01-14T13:16:42.9007570Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9007610Z         iteration=0,
2025-01-14T13:16:42.9007660Z     ):
2025-01-14T13:16:42.9007760Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9007840Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9007880Z         else:
2025-01-14T13:16:42.9007940Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9008020Z     
2025-01-14T13:16:42.9008140Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9008210Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9008250Z         )
2025-01-14T13:16:42.9008290Z     
2025-01-14T13:16:42.9008400Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9008480Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9008610Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9008660Z         else:
2025-01-14T13:16:42.9008780Z             continuum_state = None
2025-01-14T13:16:42.9008860Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9008940Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9009020Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9009100Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9009180Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9009250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9009320Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9009370Z         ).to_numba(
2025-01-14T13:16:42.9009420Z             macro_atom_state,
2025-01-14T13:16:42.9009480Z             self.line_interaction_type,
2025-01-14T13:16:42.9009520Z         )
2025-01-14T13:16:42.9009600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9009980Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9010200Z         ]
2025-01-14T13:16:42.9010470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9010480Z 
2025-01-14T13:16:42.9010660Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9010800Z ________ ERROR at setup of TestHDFShellInfo.test_element_count_data[20] ________
2025-01-14T13:16:42.9010810Z 
2025-01-14T13:16:42.9011350Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9011640Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9011650Z 
2025-01-14T13:16:42.9011710Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9011840Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9011910Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9012050Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9012110Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9012170Z >       sim.run_final()
2025-01-14T13:16:42.9012170Z 
2025-01-14T13:16:42.9012230Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9012310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9012390Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9012500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9012570Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9012690Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9012990Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9012990Z 
2025-01-14T13:16:42.9013200Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9013370Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9013550Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9013780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9013960Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9014070Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9014070Z 
2025-01-14T13:16:42.9014140Z     def initialize_transport_state(
2025-01-14T13:16:42.9014190Z         self,
2025-01-14T13:16:42.9014240Z         simulation_state,
2025-01-14T13:16:42.9014290Z         opacity_state,
2025-01-14T13:16:42.9014350Z         macro_atom_state,
2025-01-14T13:16:42.9014400Z         plasma,
2025-01-14T13:16:42.9014520Z         no_of_packets,
2025-01-14T13:16:42.9014580Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9014630Z         iteration=0,
2025-01-14T13:16:42.9014670Z     ):
2025-01-14T13:16:42.9014780Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9014850Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9014900Z         else:
2025-01-14T13:16:42.9014950Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9015000Z     
2025-01-14T13:16:42.9015100Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9015170Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9015210Z         )
2025-01-14T13:16:42.9015250Z     
2025-01-14T13:16:42.9015360Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9015450Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9015580Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9015620Z         else:
2025-01-14T13:16:42.9015690Z             continuum_state = None
2025-01-14T13:16:42.9015760Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9015840Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9015940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9016420Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9016510Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9016580Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9016640Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9016690Z         ).to_numba(
2025-01-14T13:16:42.9016750Z             macro_atom_state,
2025-01-14T13:16:42.9016800Z             self.line_interaction_type,
2025-01-14T13:16:42.9016850Z         )
2025-01-14T13:16:42.9016920Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9017150Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9017190Z         ]
2025-01-14T13:16:42.9017440Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9017440Z 
2025-01-14T13:16:42.9017550Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9017700Z _________ ERROR at setup of TestHDFShellInfo.test_ion_count_data[12-1] _________
2025-01-14T13:16:42.9017710Z 
2025-01-14T13:16:42.9018270Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9018560Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9018700Z 
2025-01-14T13:16:42.9018780Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9018910Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9018980Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9019120Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9019190Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9019260Z >       sim.run_final()
2025-01-14T13:16:42.9019270Z 
2025-01-14T13:16:42.9019330Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9019420Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9019490Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9019600Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9019670Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9019790Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9019880Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9020010Z 
2025-01-14T13:16:42.9020220Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9020380Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9020560Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9020780Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9020910Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9021020Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9021020Z 
2025-01-14T13:16:42.9021080Z     def initialize_transport_state(
2025-01-14T13:16:42.9021130Z         self,
2025-01-14T13:16:42.9021180Z         simulation_state,
2025-01-14T13:16:42.9021240Z         opacity_state,
2025-01-14T13:16:42.9021290Z         macro_atom_state,
2025-01-14T13:16:42.9021340Z         plasma,
2025-01-14T13:16:42.9021390Z         no_of_packets,
2025-01-14T13:16:42.9021440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9021490Z         iteration=0,
2025-01-14T13:16:42.9021540Z     ):
2025-01-14T13:16:42.9021650Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9021730Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9021770Z         else:
2025-01-14T13:16:42.9021830Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9021870Z     
2025-01-14T13:16:42.9021970Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9022050Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9022090Z         )
2025-01-14T13:16:42.9022140Z     
2025-01-14T13:16:42.9022230Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9022330Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9022440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9022500Z         else:
2025-01-14T13:16:42.9022550Z             continuum_state = None
2025-01-14T13:16:42.9022630Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9022710Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9022780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9022870Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9022950Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9023020Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9023080Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9023140Z         ).to_numba(
2025-01-14T13:16:42.9023540Z             macro_atom_state,
2025-01-14T13:16:42.9023850Z             self.line_interaction_type,
2025-01-14T13:16:42.9024580Z         )
2025-01-14T13:16:42.9024810Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9025410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9025760Z         ]
2025-01-14T13:16:42.9026470Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9026490Z 
2025-01-14T13:16:42.9026830Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9028070Z ________ ERROR at setup of TestHDFShellInfo.test_ion_count_data[20-20] _________
2025-01-14T13:16:42.9028090Z 
2025-01-14T13:16:42.9029490Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9029830Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9029840Z 
2025-01-14T13:16:42.9030100Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9030230Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9030310Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9030460Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9030520Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9030580Z >       sim.run_final()
2025-01-14T13:16:42.9030580Z 
2025-01-14T13:16:42.9030640Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9030720Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9030800Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9030910Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9030980Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9031100Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9031180Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9031190Z 
2025-01-14T13:16:42.9031400Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9031690Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9031870Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9032090Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9032210Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9032320Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9032320Z 
2025-01-14T13:16:42.9032390Z     def initialize_transport_state(
2025-01-14T13:16:42.9032430Z         self,
2025-01-14T13:16:42.9032490Z         simulation_state,
2025-01-14T13:16:42.9032530Z         opacity_state,
2025-01-14T13:16:42.9032590Z         macro_atom_state,
2025-01-14T13:16:42.9032630Z         plasma,
2025-01-14T13:16:42.9032680Z         no_of_packets,
2025-01-14T13:16:42.9032740Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9032780Z         iteration=0,
2025-01-14T13:16:42.9032830Z     ):
2025-01-14T13:16:42.9032920Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9033000Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9033040Z         else:
2025-01-14T13:16:42.9033100Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9033140Z     
2025-01-14T13:16:42.9033250Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9033310Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9033360Z         )
2025-01-14T13:16:42.9033400Z     
2025-01-14T13:16:42.9033590Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9033680Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9033800Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9033840Z         else:
2025-01-14T13:16:42.9033900Z             continuum_state = None
2025-01-14T13:16:42.9033980Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9034060Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9034140Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9034270Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9034340Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9034410Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9034480Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9034520Z         ).to_numba(
2025-01-14T13:16:42.9034580Z             macro_atom_state,
2025-01-14T13:16:42.9034640Z             self.line_interaction_type,
2025-01-14T13:16:42.9034690Z         )
2025-01-14T13:16:42.9034760Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9035050Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9035090Z         ]
2025-01-14T13:16:42.9035350Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9035350Z 
2025-01-14T13:16:42.9035470Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9035620Z _______ ERROR at setup of TestHDFShellInfo.test_level_count_data[2-12-1] _______
2025-01-14T13:16:42.9035630Z 
2025-01-14T13:16:42.9036180Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9036470Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9036480Z 
2025-01-14T13:16:42.9036540Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9036670Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9036740Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9036920Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9036980Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9037040Z >       sim.run_final()
2025-01-14T13:16:42.9037040Z 
2025-01-14T13:16:42.9037090Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9037190Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9037260Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9037380Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9037450Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9037570Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9037660Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9037660Z 
2025-01-14T13:16:42.9037870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9038030Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9038290Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9038520Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9038640Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9038750Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9038760Z 
2025-01-14T13:16:42.9038890Z     def initialize_transport_state(
2025-01-14T13:16:42.9038940Z         self,
2025-01-14T13:16:42.9039000Z         simulation_state,
2025-01-14T13:16:42.9039050Z         opacity_state,
2025-01-14T13:16:42.9039110Z         macro_atom_state,
2025-01-14T13:16:42.9039150Z         plasma,
2025-01-14T13:16:42.9039200Z         no_of_packets,
2025-01-14T13:16:42.9039250Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9039300Z         iteration=0,
2025-01-14T13:16:42.9039340Z     ):
2025-01-14T13:16:42.9039440Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9039540Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9039590Z         else:
2025-01-14T13:16:42.9039640Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9039680Z     
2025-01-14T13:16:42.9039790Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9039860Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9039910Z         )
2025-01-14T13:16:42.9039950Z     
2025-01-14T13:16:42.9040050Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9040140Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9040330Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9040380Z         else:
2025-01-14T13:16:42.9040440Z             continuum_state = None
2025-01-14T13:16:42.9040520Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9040620Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9045630Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9045750Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9045830Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9045900Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9045960Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9046020Z         ).to_numba(
2025-01-14T13:16:42.9046070Z             macro_atom_state,
2025-01-14T13:16:42.9046130Z             self.line_interaction_type,
2025-01-14T13:16:42.9046180Z         )
2025-01-14T13:16:42.9046250Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9046470Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9046520Z         ]
2025-01-14T13:16:42.9046870Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9046880Z 
2025-01-14T13:16:42.9046990Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9047140Z ______ ERROR at setup of TestHDFShellInfo.test_level_count_data[3-20-20] _______
2025-01-14T13:16:42.9047150Z 
2025-01-14T13:16:42.9047680Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9047970Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9047980Z 
2025-01-14T13:16:42.9048050Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9048170Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9048240Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9048380Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9048450Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9048500Z >       sim.run_final()
2025-01-14T13:16:42.9048500Z 
2025-01-14T13:16:42.9048560Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9048640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9048720Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9049010Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9049090Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9049220Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9049300Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9049310Z 
2025-01-14T13:16:42.9049530Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9049690Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9049940Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9050170Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9050300Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9050410Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9050420Z 
2025-01-14T13:16:42.9050480Z     def initialize_transport_state(
2025-01-14T13:16:42.9050530Z         self,
2025-01-14T13:16:42.9050580Z         simulation_state,
2025-01-14T13:16:42.9050840Z         opacity_state,
2025-01-14T13:16:42.9050900Z         macro_atom_state,
2025-01-14T13:16:42.9050950Z         plasma,
2025-01-14T13:16:42.9050990Z         no_of_packets,
2025-01-14T13:16:42.9051060Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9051110Z         iteration=0,
2025-01-14T13:16:42.9051150Z     ):
2025-01-14T13:16:42.9051250Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9051320Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9051370Z         else:
2025-01-14T13:16:42.9051420Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9051460Z     
2025-01-14T13:16:42.9051570Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9051640Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9051690Z         )
2025-01-14T13:16:42.9051730Z     
2025-01-14T13:16:42.9051830Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9051920Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9052040Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9052090Z         else:
2025-01-14T13:16:42.9052150Z             continuum_state = None
2025-01-14T13:16:42.9052260Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9052350Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9052420Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9052500Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9052580Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9052650Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9052710Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9052760Z         ).to_numba(
2025-01-14T13:16:42.9052820Z             macro_atom_state,
2025-01-14T13:16:42.9052880Z             self.line_interaction_type,
2025-01-14T13:16:42.9052930Z         )
2025-01-14T13:16:42.9053000Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9053230Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9053290Z         ]
2025-01-14T13:16:42.9053530Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9053540Z 
2025-01-14T13:16:42.9053660Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9053820Z _____ ERROR at setup of TestShellInfoWidget.test_selection_on_shells_table _____
2025-01-14T13:16:42.9053820Z 
2025-01-14T13:16:42.9054360Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9054730Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9054740Z 
2025-01-14T13:16:42.9054800Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9054930Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9055010Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9055290Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9055350Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9055400Z >       sim.run_final()
2025-01-14T13:16:42.9055410Z 
2025-01-14T13:16:42.9055470Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9055560Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9055630Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9055750Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9055820Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9056020Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9056120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9056120Z 
2025-01-14T13:16:42.9056340Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9056500Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9056680Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9056910Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9057030Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9057140Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9057140Z 
2025-01-14T13:16:42.9057210Z     def initialize_transport_state(
2025-01-14T13:16:42.9057250Z         self,
2025-01-14T13:16:42.9057310Z         simulation_state,
2025-01-14T13:16:42.9057350Z         opacity_state,
2025-01-14T13:16:42.9057410Z         macro_atom_state,
2025-01-14T13:16:42.9057450Z         plasma,
2025-01-14T13:16:42.9057500Z         no_of_packets,
2025-01-14T13:16:42.9057730Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9057800Z         iteration=0,
2025-01-14T13:16:42.9057850Z     ):
2025-01-14T13:16:42.9057950Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9058030Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9058070Z         else:
2025-01-14T13:16:42.9058130Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9058180Z     
2025-01-14T13:16:42.9058290Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9058360Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9058410Z         )
2025-01-14T13:16:42.9058450Z     
2025-01-14T13:16:42.9058550Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9058640Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9058770Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9058810Z         else:
2025-01-14T13:16:42.9058890Z             continuum_state = None
2025-01-14T13:16:42.9058970Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9059050Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9059120Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9059200Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9059280Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9059350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9059420Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9059630Z         ).to_numba(
2025-01-14T13:16:42.9059690Z             macro_atom_state,
2025-01-14T13:16:42.9059760Z             self.line_interaction_type,
2025-01-14T13:16:42.9059800Z         )
2025-01-14T13:16:42.9059880Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9060100Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9060150Z         ]
2025-01-14T13:16:42.9060410Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9060450Z 
2025-01-14T13:16:42.9060570Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9060750Z _ ERROR at setup of TestShellInfoWidget.test_selection_on_element_count_table __
2025-01-14T13:16:42.9060750Z 
2025-01-14T13:16:42.9061800Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9062340Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9062350Z 
2025-01-14T13:16:42.9062420Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9062550Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9062620Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9062770Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9062830Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9062890Z >       sim.run_final()
2025-01-14T13:16:42.9062890Z 
2025-01-14T13:16:42.9062950Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9063040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9063120Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9063230Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9063300Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9063430Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9063520Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9063560Z 
2025-01-14T13:16:42.9063770Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9063940Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9064140Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9064380Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9064500Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9064620Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9064620Z 
2025-01-14T13:16:42.9064680Z     def initialize_transport_state(
2025-01-14T13:16:42.9064730Z         self,
2025-01-14T13:16:42.9064780Z         simulation_state,
2025-01-14T13:16:42.9064840Z         opacity_state,
2025-01-14T13:16:42.9064890Z         macro_atom_state,
2025-01-14T13:16:42.9064930Z         plasma,
2025-01-14T13:16:42.9064990Z         no_of_packets,
2025-01-14T13:16:42.9065040Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9065100Z         iteration=0,
2025-01-14T13:16:42.9065140Z     ):
2025-01-14T13:16:42.9065230Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9065300Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9065350Z         else:
2025-01-14T13:16:42.9065400Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9065450Z     
2025-01-14T13:16:42.9065550Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9065750Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9065790Z         )
2025-01-14T13:16:42.9065840Z     
2025-01-14T13:16:42.9065940Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9066030Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9066150Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9066200Z         else:
2025-01-14T13:16:42.9066260Z             continuum_state = None
2025-01-14T13:16:42.9066330Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9066460Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9066530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9066620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9066690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9066760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9066830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9066880Z         ).to_numba(
2025-01-14T13:16:42.9066940Z             macro_atom_state,
2025-01-14T13:16:42.9067060Z             self.line_interaction_type,
2025-01-14T13:16:42.9067110Z         )
2025-01-14T13:16:42.9067180Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9067410Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9067460Z         ]
2025-01-14T13:16:42.9067720Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9067720Z 
2025-01-14T13:16:42.9067840Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9068010Z ___ ERROR at setup of TestShellInfoWidget.test_selection_on_ion_count_table ____
2025-01-14T13:16:42.9068010Z 
2025-01-14T13:16:42.9068560Z config_verysimple = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...}, 'config_dirname': 'tardis/io/configuration/tests/data', 'debug': {'log_level': 'INFO', 'specific_log_level': False}}
2025-01-14T13:16:42.9068850Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=271741 Levels=24806>
2025-01-14T13:16:42.9068860Z 
2025-01-14T13:16:42.9068920Z     @pytest.fixture(scope="session")
2025-01-14T13:16:42.9069090Z     def simulation_verysimple(config_verysimple, atomic_dataset):
2025-01-14T13:16:42.9069170Z         atomic_data = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9069310Z         sim = Simulation.from_config(config_verysimple, atom_data=atomic_data)
2025-01-14T13:16:42.9069370Z         sim.last_no_of_packets = 4000
2025-01-14T13:16:42.9069420Z >       sim.run_final()
2025-01-14T13:16:42.9069430Z 
2025-01-14T13:16:42.9069490Z tardis/conftest.py:233: 
2025-01-14T13:16:42.9069580Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9069650Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9069760Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9069830Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9069960Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9070040Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9070050Z 
2025-01-14T13:16:42.9070260Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x11c2cee70>
2025-01-14T13:16:42.9070420Z simulation_state = <tardis.model.base.SimulationState object at 0x146bd9250>
2025-01-14T13:16:42.9070600Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x146353650>
2025-01-14T13:16:42.9070820Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x146353b60>
2025-01-14T13:16:42.9070950Z plasma = <tardis.plasma.base.BasePlasma object at 0x146bba6f0>
2025-01-14T13:16:42.9072010Z no_of_packets = 4000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9072010Z 
2025-01-14T13:16:42.9072080Z     def initialize_transport_state(
2025-01-14T13:16:42.9072130Z         self,
2025-01-14T13:16:42.9072180Z         simulation_state,
2025-01-14T13:16:42.9072240Z         opacity_state,
2025-01-14T13:16:42.9072290Z         macro_atom_state,
2025-01-14T13:16:42.9072340Z         plasma,
2025-01-14T13:16:42.9072390Z         no_of_packets,
2025-01-14T13:16:42.9072450Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9072570Z         iteration=0,
2025-01-14T13:16:42.9072610Z     ):
2025-01-14T13:16:42.9072710Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9072780Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9072900Z         else:
2025-01-14T13:16:42.9072980Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9073050Z     
2025-01-14T13:16:42.9073160Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9073950Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9074050Z         )
2025-01-14T13:16:42.9074410Z     
2025-01-14T13:16:42.9074530Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9074630Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9074750Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9074810Z         else:
2025-01-14T13:16:42.9074860Z             continuum_state = None
2025-01-14T13:16:42.9074950Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9075200Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9075280Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9075360Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9075440Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9075510Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9075590Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9075640Z         ).to_numba(
2025-01-14T13:16:42.9075700Z             macro_atom_state,
2025-01-14T13:16:42.9075770Z             self.line_interaction_type,
2025-01-14T13:16:42.9075810Z         )
2025-01-14T13:16:42.9075890Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9076180Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9076230Z         ]
2025-01-14T13:16:42.9076480Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9076480Z 
2025-01-14T13:16:42.9076590Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9076680Z =================================== FAILURES ===================================
2025-01-14T13:16:42.9076810Z _______________________ test_run_tardis_from_config_obj ________________________
2025-01-14T13:16:42.9076810Z 
2025-01-14T13:16:42.9077120Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.9077280Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.9077280Z 
2025-01-14T13:16:42.9077340Z     def test_run_tardis_from_config_obj(
2025-01-14T13:16:42.9077440Z         atomic_data_fname, example_configuration_dir: Path
2025-01-14T13:16:42.9077490Z     ):
2025-01-14T13:16:42.9077530Z         """
2025-01-14T13:16:42.9077680Z         Tests whether the run_tardis function can take in the Configuration object
2025-01-14T13:16:42.9077730Z         as arguments
2025-01-14T13:16:42.9077780Z         """
2025-01-14T13:16:42.9077850Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.9077980Z             example_configuration_dir / "tardis_configv1_verysimple.yml"
2025-01-14T13:16:42.9078020Z         )
2025-01-14T13:16:42.9078190Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.9078230Z     
2025-01-14T13:16:42.9078280Z         try:
2025-01-14T13:16:42.9078340Z >           sim = run_tardis(config)
2025-01-14T13:16:42.9078340Z 
2025-01-14T13:16:42.9078400Z tardis/tests/test_tardis_full.py:28: 
2025-01-14T13:16:42.9078500Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9078560Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:42.9078630Z     simulation.run_convergence()
2025-01-14T13:16:42.9078710Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:42.9079060Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9079130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9079250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9079340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9079340Z 
2025-01-14T13:16:42.9079550Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x30d305d00>
2025-01-14T13:16:42.9079710Z simulation_state = <tardis.model.base.SimulationState object at 0x305b11430>
2025-01-14T13:16:42.9079980Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x30523ab10>
2025-01-14T13:16:42.9080200Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x321de5af0>
2025-01-14T13:16:42.9080480Z plasma = <tardis.plasma.base.BasePlasma object at 0x321de6300>
2025-01-14T13:16:42.9080610Z no_of_packets = 200000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.9080620Z 
2025-01-14T13:16:42.9080680Z     def initialize_transport_state(
2025-01-14T13:16:42.9080730Z         self,
2025-01-14T13:16:42.9080780Z         simulation_state,
2025-01-14T13:16:42.9080830Z         opacity_state,
2025-01-14T13:16:42.9080890Z         macro_atom_state,
2025-01-14T13:16:42.9080930Z         plasma,
2025-01-14T13:16:42.9080980Z         no_of_packets,
2025-01-14T13:16:42.9081030Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9081080Z         iteration=0,
2025-01-14T13:16:42.9081120Z     ):
2025-01-14T13:16:42.9081220Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9081290Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9081340Z         else:
2025-01-14T13:16:42.9081390Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9081600Z     
2025-01-14T13:16:42.9081710Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9081780Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9081820Z         )
2025-01-14T13:16:42.9081870Z     
2025-01-14T13:16:42.9081970Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9082060Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9082190Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9082230Z         else:
2025-01-14T13:16:42.9082300Z             continuum_state = None
2025-01-14T13:16:42.9082370Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9082470Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9082530Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9082620Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9082690Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9082760Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9082830Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9082880Z         ).to_numba(
2025-01-14T13:16:42.9082930Z             macro_atom_state,
2025-01-14T13:16:42.9082990Z             self.line_interaction_type,
2025-01-14T13:16:42.9083030Z         )
2025-01-14T13:16:42.9083110Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9083320Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9083450Z         ]
2025-01-14T13:16:42.9083700Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9083710Z 
2025-01-14T13:16:42.9083820Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9083830Z 
2025-01-14T13:16:42.9083960Z During handling of the above exception, another exception occurred:
2025-01-14T13:16:42.9083970Z 
2025-01-14T13:16:42.9084260Z atomic_data_fname = PosixPath('/Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5')
2025-01-14T13:16:42.9084590Z example_configuration_dir = PosixPath('tardis/io/configuration/tests/data')
2025-01-14T13:16:42.9084600Z 
2025-01-14T13:16:42.9084670Z     def test_run_tardis_from_config_obj(
2025-01-14T13:16:42.9084760Z         atomic_data_fname, example_configuration_dir: Path
2025-01-14T13:16:42.9084810Z     ):
2025-01-14T13:16:42.9084850Z         """
2025-01-14T13:16:42.9085010Z         Tests whether the run_tardis function can take in the Configuration object
2025-01-14T13:16:42.9085050Z         as arguments
2025-01-14T13:16:42.9085180Z         """
2025-01-14T13:16:42.9085260Z         config = Configuration.from_yaml(
2025-01-14T13:16:42.9085380Z             example_configuration_dir / "tardis_configv1_verysimple.yml"
2025-01-14T13:16:42.9085420Z         )
2025-01-14T13:16:42.9085500Z         config["atom_data"] = atomic_data_fname
2025-01-14T13:16:42.9085540Z     
2025-01-14T13:16:42.9085590Z         try:
2025-01-14T13:16:42.9085650Z             sim = run_tardis(config)
2025-01-14T13:16:42.9085700Z         except Exception as e:
2025-01-14T13:16:42.9085760Z >           pytest.fail(str(e.args[0]))
2025-01-14T13:16:42.9085980Z E           Failed: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9085980Z 
2025-01-14T13:16:42.9086060Z tardis/tests/test_tardis_full.py:30: Failed
2025-01-14T13:16:42.9086180Z ----------------------------- Captured stdout call -----------------------------
2025-01-14T13:16:42.9086540Z [[1mtardis.io.model.parse_atom_data[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9086590Z 	
2025-01-14T13:16:42.9087030Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5 ([1mparse_atom_data.py[0m:40)
2025-01-14T13:16:42.9087160Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9087540Z 	Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace  ([1mbase.py[0m:258)
2025-01-14T13:16:42.9087660Z [[1mtardis.io.atom_data.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9088030Z 	Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules ([1mbase.py[0m:262)
2025-01-14T13:16:42.9088230Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.9088570Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.9088710Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9088870Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.9088990Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9089040Z 	
2025-01-14T13:16:42.9089150Z 	Starting iteration 1 of 5 ([1mbase.py[0m:444)
2025-01-14T13:16:42.9089420Z ------------------------------ Captured log call -------------------------------
2025-01-14T13:16:42.9089560Z INFO     tardis.io.model.parse_atom_data:parse_atom_data.py:40 
2025-01-14T13:16:42.9089840Z 	Reading Atomic Data from /Users/runner/work/tardis/tardis/tardis-regression-data/atom_data/kurucz_cd23_chianti_H_He.h5
2025-01-14T13:16:42.9090150Z INFO     tardis.io.atom_data.base:base.py:258 Reading Atom Data with: UUID = 6f7b09e887a311e7a06b246e96350010 MD5  = 864f1753714343c41f99cb065710cace 
2025-01-14T13:16:42.9090640Z INFO     tardis.io.atom_data.base:base.py:262 Non provided Atomic Data: synpp_refs, photoionization_data, yg_data, two_photon_data, linelist_atoms, linelist_molecules
2025-01-14T13:16:42.9091050Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.9091230Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.9091310Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.9091410Z 	Starting iteration 1 of 5
2025-01-14T13:16:42.9091530Z __________________________ test_montecarlo_main_loop ___________________________
2025-01-14T13:16:42.9091540Z 
2025-01-14T13:16:42.9092070Z montecarlo_main_loop_config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...able_biasing': False}, 'method': 'virtual', 'integrated': {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}}
2025-01-14T13:16:42.9092290Z regression_data = <tardis.tests.fixtures.regression_data.RegressionData object at 0x303061f70>
2025-01-14T13:16:42.9092630Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=29224 Levels=24806>
2025-01-14T13:16:42.9092630Z 
2025-01-14T13:16:42.9092700Z     def test_montecarlo_main_loop(
2025-01-14T13:16:42.9092760Z         montecarlo_main_loop_config,
2025-01-14T13:16:42.9092810Z         regression_data,
2025-01-14T13:16:42.9092860Z         atomic_dataset,
2025-01-14T13:16:42.9092910Z     ):
2025-01-14T13:16:42.9092980Z         atomic_dataset = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9093100Z         montecarlo_main_loop_simulation = Simulation.from_config(
2025-01-14T13:16:42.9093170Z             montecarlo_main_loop_config,
2025-01-14T13:16:42.9093230Z             atom_data=atomic_dataset,
2025-01-14T13:16:42.9093290Z             virtual_packet_logging=False,
2025-01-14T13:16:42.9093350Z             legacy_mode_enabled=True,
2025-01-14T13:16:42.9093400Z         )
2025-01-14T13:16:42.9093500Z         montecarlo_main_loop_simulation.run_convergence()
2025-01-14T13:16:42.9093580Z >       montecarlo_main_loop_simulation.run_final()
2025-01-14T13:16:42.9093580Z 
2025-01-14T13:16:42.9093730Z tardis/transport/montecarlo/tests/test_montecarlo_main_loop.py:27: 
2025-01-14T13:16:42.9093860Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9093940Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9094050Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9094130Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9094250Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9094340Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9094340Z 
2025-01-14T13:16:42.9094550Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x17848a210>
2025-01-14T13:16:42.9094800Z simulation_state = <tardis.model.base.SimulationState object at 0x30e82eb10>
2025-01-14T13:16:42.9095010Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x178592ba0>
2025-01-14T13:16:42.9095240Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1785920f0>
2025-01-14T13:16:42.9095360Z plasma = <tardis.plasma.base.BasePlasma object at 0x1730f1af0>
2025-01-14T13:16:42.9095480Z no_of_packets = 100000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.9095490Z 
2025-01-14T13:16:42.9095550Z     def initialize_transport_state(
2025-01-14T13:16:42.9095600Z         self,
2025-01-14T13:16:42.9095650Z         simulation_state,
2025-01-14T13:16:42.9095700Z         opacity_state,
2025-01-14T13:16:42.9095750Z         macro_atom_state,
2025-01-14T13:16:42.9095800Z         plasma,
2025-01-14T13:16:42.9095860Z         no_of_packets,
2025-01-14T13:16:42.9098440Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9098650Z         iteration=0,
2025-01-14T13:16:42.9098810Z     ):
2025-01-14T13:16:42.9099160Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9099400Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9099600Z         else:
2025-01-14T13:16:42.9099790Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9099980Z     
2025-01-14T13:16:42.9100310Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9101150Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9101350Z         )
2025-01-14T13:16:42.9101510Z     
2025-01-14T13:16:42.9101800Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9102080Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9102450Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9102610Z         else:
2025-01-14T13:16:42.9102800Z             continuum_state = None
2025-01-14T13:16:42.9103050Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9103340Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9105200Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9105530Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9105730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9105960Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9106160Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9106310Z         ).to_numba(
2025-01-14T13:16:42.9106480Z             macro_atom_state,
2025-01-14T13:16:42.9106660Z             self.line_interaction_type,
2025-01-14T13:16:42.9106810Z         )
2025-01-14T13:16:42.9107030Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9108200Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9108390Z         ]
2025-01-14T13:16:42.9109450Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9109480Z 
2025-01-14T13:16:42.9110020Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9112060Z ----------------------------- Captured stdout call -----------------------------
2025-01-14T13:16:42.9113430Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.9114470Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.9114710Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9114880Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.9115000Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9115050Z 	
2025-01-14T13:16:42.9115120Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:42.9115200Z 	Simulation took 0.00 s
2025-01-14T13:16:42.9115310Z  ([1mbase.py[0m:542)
2025-01-14T13:16:42.9115470Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9115520Z 	
2025-01-14T13:16:42.9115670Z 	Starting iteration 1 of 1 ([1mbase.py[0m:444)
2025-01-14T13:16:42.9115800Z ------------------------------ Captured log call -------------------------------
2025-01-14T13:16:42.9117180Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.9120420Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.9120550Z INFO     tardis.simulation.base:base.py:542 
2025-01-14T13:16:42.9120630Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:42.9120690Z 	Simulation took 0.00 s
2025-01-14T13:16:42.9120690Z 
2025-01-14T13:16:42.9122830Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.9122970Z 	Starting iteration 1 of 1
2025-01-14T13:16:42.9123560Z ____________________ test_montecarlo_main_loop_vpacket_log _____________________
2025-01-14T13:16:42.9123580Z 
2025-01-14T13:16:42.9126740Z montecarlo_main_loop_config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...able_biasing': False}, 'method': 'virtual', 'integrated': {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}}
2025-01-14T13:16:42.9128340Z regression_data = <tardis.tests.fixtures.regression_data.RegressionData object at 0x3030f6600>
2025-01-14T13:16:42.9129390Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=29224 Levels=24806>
2025-01-14T13:16:42.9129420Z 
2025-01-14T13:16:42.9129700Z     def test_montecarlo_main_loop_vpacket_log(
2025-01-14T13:16:42.9129940Z         montecarlo_main_loop_config,
2025-01-14T13:16:42.9130350Z         regression_data,
2025-01-14T13:16:42.9130570Z         atomic_dataset,
2025-01-14T13:16:42.9130750Z     ):
2025-01-14T13:16:42.9131180Z         atomic_dataset = deepcopy(atomic_dataset)
2025-01-14T13:16:42.9132210Z         montecarlo_main_loop_config.montecarlo.no_of_virtual_packets = 5
2025-01-14T13:16:42.9132490Z     
2025-01-14T13:16:42.9132810Z         montecarlo_main_loop_simulation = Simulation.from_config(
2025-01-14T13:16:42.9133000Z             montecarlo_main_loop_config,
2025-01-14T13:16:42.9133170Z             atom_data=atomic_dataset,
2025-01-14T13:16:42.9133390Z             virtual_packet_logging=True,
2025-01-14T13:16:42.9133620Z             legacy_mode_enabled=True,
2025-01-14T13:16:42.9133830Z         )
2025-01-14T13:16:42.9134180Z         montecarlo_main_loop_simulation.run_convergence()
2025-01-14T13:16:42.9134520Z >       montecarlo_main_loop_simulation.run_final()
2025-01-14T13:16:42.9134540Z 
2025-01-14T13:16:42.9135000Z tardis/transport/montecarlo/tests/test_montecarlo_main_loop.py:80: 
2025-01-14T13:16:42.9135320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9135550Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:42.9135940Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:42.9152880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9153140Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9153680Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9153700Z 
2025-01-14T13:16:42.9153920Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x125c3fef0>
2025-01-14T13:16:42.9154090Z simulation_state = <tardis.model.base.SimulationState object at 0x1784888c0>
2025-01-14T13:16:42.9154270Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x1718e6f60>
2025-01-14T13:16:42.9154580Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x1718e6990>
2025-01-14T13:16:42.9154730Z plasma = <tardis.plasma.base.BasePlasma object at 0x155fd1250>
2025-01-14T13:16:42.9154850Z no_of_packets = 100000, no_of_virtual_packets = 5, iteration = 0
2025-01-14T13:16:42.9154860Z 
2025-01-14T13:16:42.9154930Z     def initialize_transport_state(
2025-01-14T13:16:42.9154980Z         self,
2025-01-14T13:16:42.9155040Z         simulation_state,
2025-01-14T13:16:42.9155090Z         opacity_state,
2025-01-14T13:16:42.9155150Z         macro_atom_state,
2025-01-14T13:16:42.9155190Z         plasma,
2025-01-14T13:16:42.9155250Z         no_of_packets,
2025-01-14T13:16:42.9155300Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9155350Z         iteration=0,
2025-01-14T13:16:42.9155390Z     ):
2025-01-14T13:16:42.9155500Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9155570Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9155620Z         else:
2025-01-14T13:16:42.9155680Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9155980Z     
2025-01-14T13:16:42.9156090Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9156520Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9156610Z         )
2025-01-14T13:16:42.9156660Z     
2025-01-14T13:16:42.9156770Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9156860Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9156990Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9157160Z         else:
2025-01-14T13:16:42.9157230Z             continuum_state = None
2025-01-14T13:16:42.9157310Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9157400Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9157470Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9157550Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9157630Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9157700Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9157760Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9157920Z         ).to_numba(
2025-01-14T13:16:42.9157980Z             macro_atom_state,
2025-01-14T13:16:42.9158050Z             self.line_interaction_type,
2025-01-14T13:16:42.9158090Z         )
2025-01-14T13:16:42.9158160Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9158400Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9158440Z         ]
2025-01-14T13:16:42.9158690Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9158700Z 
2025-01-14T13:16:42.9158820Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9158950Z ----------------------------- Captured stdout call -----------------------------
2025-01-14T13:16:42.9159460Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:42.9159820Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:42.9159960Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9160130Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:42.9160360Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9160410Z 	
2025-01-14T13:16:42.9160480Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:42.9160530Z 	Simulation took 0.00 s
2025-01-14T13:16:42.9160610Z  ([1mbase.py[0m:542)
2025-01-14T13:16:42.9160730Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:42.9160870Z 	
2025-01-14T13:16:42.9160980Z 	Starting iteration 1 of 1 ([1mbase.py[0m:444)
2025-01-14T13:16:42.9161110Z ------------------------------ Captured log call -------------------------------
2025-01-14T13:16:42.9161510Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:42.9161700Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:42.9161770Z INFO     tardis.simulation.base:base.py:542 
2025-01-14T13:16:42.9161840Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:42.9161890Z 	Simulation took 0.00 s
2025-01-14T13:16:42.9161900Z 
2025-01-14T13:16:42.9161970Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:42.9162030Z 	Starting iteration 1 of 1
2025-01-14T13:16:42.9162220Z _ test_last_interaction_properties[interaction_type_in_use-interaction_type_to_check] _
2025-01-14T13:16:42.9162220Z 
2025-01-14T13:16:42.9162370Z expected = 'interaction_type_in_use', obtained = 'interaction_type_to_check'
2025-01-14T13:16:42.9162660Z request = <FixtureRequest for <Function test_last_interaction_properties[interaction_type_in_use-interaction_type_to_check]>>
2025-01-14T13:16:42.9162750Z 
2025-01-14T13:16:42.9162820Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.9162880Z         "expected,obtained",
2025-01-14T13:16:42.9162920Z         [
2025-01-14T13:16:42.9162970Z             (
2025-01-14T13:16:42.9163040Z                 "interaction_type_in_use",
2025-01-14T13:16:42.9163260Z                 "interaction_type_to_check",
2025-01-14T13:16:42.9163310Z             ),
2025-01-14T13:16:42.9163360Z             (
2025-01-14T13:16:42.9163460Z                 "shell_id_in_use",
2025-01-14T13:16:42.9163520Z                 "shell_id_to_check",
2025-01-14T13:16:42.9163560Z             ),
2025-01-14T13:16:42.9163610Z             (
2025-01-14T13:16:42.9163650Z                 "r_in_use",
2025-01-14T13:16:42.9163710Z                 "r_to_check",
2025-01-14T13:16:42.9163750Z             ),
2025-01-14T13:16:42.9163830Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.9163870Z         ],
2025-01-14T13:16:42.9163920Z     )
2025-01-14T13:16:42.9164050Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.9164200Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.9164210Z 
2025-01-14T13:16:42.9164390Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.9164480Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9164710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9164800Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9165040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9165120Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9165320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9165420Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9165650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9165730Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9165920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9166010Z     raise exc
2025-01-14T13:16:42.9166210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9166270Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9166470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9166600Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9166790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9166950Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9167150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9167280Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9167560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9167650Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9167970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9168020Z     yield
2025-01-14T13:16:42.9168400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9168480Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9168870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9168910Z     yield
2025-01-14T13:16:42.9169150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9169200Z     return (yield)
2025-01-14T13:16:42.9169450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9169530Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9169840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9169890Z     yield
2025-01-14T13:16:42.9170110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9170180Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9170370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9170420Z     raise exc
2025-01-14T13:16:42.9170610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9170800Z     col.setup()
2025-01-14T13:16:42.9170990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9171050Z     self._request._fillfixtures()
2025-01-14T13:16:42.9171270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9171380Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9171600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9171700Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9171940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9172020Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9172220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9172320Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9172560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9172680Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9172880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9172940Z     raise exc
2025-01-14T13:16:42.9173140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9173210Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9173540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9173680Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9173880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9174050Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9174260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9174410Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9174700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9174800Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9175130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9175170Z     yield
2025-01-14T13:16:42.9175430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9175610Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9175840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9175890Z     yield
2025-01-14T13:16:42.9176130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9176180Z     return (yield)
2025-01-14T13:16:42.9176440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9176820Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9177120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9177170Z     yield
2025-01-14T13:16:42.9177390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9177470Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9177670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9177830Z     raise exc
2025-01-14T13:16:42.9178010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9178070Z     col.setup()
2025-01-14T13:16:42.9178270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9178330Z     self._request._fillfixtures()
2025-01-14T13:16:42.9178560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9178660Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9178890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9178980Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9179370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9179450Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9179650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9179750Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9180120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9180190Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9180380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9180430Z     raise exc
2025-01-14T13:16:42.9180630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9180700Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9180890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9181020Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9181200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9181360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9181560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9181690Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9182080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9182170Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9182470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9182620Z     yield
2025-01-14T13:16:42.9182860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9182940Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9183150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9183200Z     yield
2025-01-14T13:16:42.9183420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9183500Z     return (yield)
2025-01-14T13:16:42.9183760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9183840Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9184120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9184170Z     yield
2025-01-14T13:16:42.9184390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9184530Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9184710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9184760Z     raise exc
2025-01-14T13:16:42.9184950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9185000Z     col.setup()
2025-01-14T13:16:42.9185190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9185260Z     self._request._fillfixtures()
2025-01-14T13:16:42.9185470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9185570Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9185800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9185880Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9186120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9186190Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9186420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9186520Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9186760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9186830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9187030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9187090Z     raise exc
2025-01-14T13:16:42.9187280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9187350Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9187550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9187690Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9187880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9188040Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9188240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9188520Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9188800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9188970Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9189280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9189320Z     yield
2025-01-14T13:16:42.9189550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9189630Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9189830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9189920Z     yield
2025-01-14T13:16:42.9190140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9190190Z     return (yield)
2025-01-14T13:16:42.9190440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9190520Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9190910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9191030Z     yield
2025-01-14T13:16:42.9191260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9191330Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9191520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9191560Z     raise exc
2025-01-14T13:16:42.9191750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9191790Z     col.setup()
2025-01-14T13:16:42.9191990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9192040Z     self._request._fillfixtures()
2025-01-14T13:16:42.9192270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9192380Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9192600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9192690Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9192920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9193030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9193230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9193330Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9193560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9193640Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9193990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9194040Z     raise exc
2025-01-14T13:16:42.9194230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9194300Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9194620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9194760Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9194960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9195110Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9195310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9195450Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9195920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9196010Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9196330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9196370Z     yield
2025-01-14T13:16:42.9196600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9196710Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9196910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9196960Z     yield
2025-01-14T13:16:42.9197180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9197240Z     return (yield)
2025-01-14T13:16:42.9197490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9197730Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9198020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9198080Z     yield
2025-01-14T13:16:42.9198320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9198400Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9198870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9198920Z     raise exc
2025-01-14T13:16:42.9199120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9199170Z     col.setup()
2025-01-14T13:16:42.9199370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9199440Z     self._request._fillfixtures()
2025-01-14T13:16:42.9199680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9199910Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9200140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9200290Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9200540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9200610Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9200810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9200910Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9201140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9201220Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9201420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9201470Z     raise exc
2025-01-14T13:16:42.9201660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9201740Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9201930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9202060Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9202260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9202410Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9202700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9202840Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9203110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9203200Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9203500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9203660Z     yield
2025-01-14T13:16:42.9203900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9203980Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9204190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9204230Z     yield
2025-01-14T13:16:42.9204470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9204530Z     return (yield)
2025-01-14T13:16:42.9204850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9204930Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9205230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9205280Z     yield
2025-01-14T13:16:42.9205520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9205590Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9205780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9205820Z     raise exc
2025-01-14T13:16:42.9206020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9206070Z     col.setup()
2025-01-14T13:16:42.9206270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9206330Z     self._request._fillfixtures()
2025-01-14T13:16:42.9206540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9206760Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9207130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9207240Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9207480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9207550Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9207760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9207860Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9208100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9208180Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9208380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9208430Z     raise exc
2025-01-14T13:16:42.9208630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9208690Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9208890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9209010Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9209210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9209480Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9209690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9209820Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9210100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9210190Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9210540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9210590Z     yield
2025-01-14T13:16:42.9210820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9210900Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9211120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9211170Z     yield
2025-01-14T13:16:42.9211470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9211520Z     return (yield)
2025-01-14T13:16:42.9212830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9213490Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9214410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9214690Z     yield
2025-01-14T13:16:42.9215330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9215540Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9216070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9216210Z     raise exc
2025-01-14T13:16:42.9216740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9216900Z     col.setup()
2025-01-14T13:16:42.9217430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9218280Z     self._request._fillfixtures()
2025-01-14T13:16:42.9218890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9219070Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9219310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9219410Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9219660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9219740Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9219940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9220050Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9220290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9220390Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9220590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9220630Z     raise exc
2025-01-14T13:16:42.9220840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9220910Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9221110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9221600Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9221800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9221970Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9222170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9222310Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9222850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9222940Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9223250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9223300Z     yield
2025-01-14T13:16:42.9223530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9223620Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9223910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9223960Z     yield
2025-01-14T13:16:42.9224180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9224240Z     return (yield)
2025-01-14T13:16:42.9224490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9224580Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9224870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9224910Z     yield
2025-01-14T13:16:42.9225140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9225220Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9225410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9225460Z     raise exc
2025-01-14T13:16:42.9225650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9225750Z     col.setup()
2025-01-14T13:16:42.9225950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9226010Z     self._request._fillfixtures()
2025-01-14T13:16:42.9226230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9226330Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9226810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9226910Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9227150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9227230Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9227430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9227540Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9227770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9227850Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9228050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9228100Z     raise exc
2025-01-14T13:16:42.9228300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9228570Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9228890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9229020Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9229210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9229360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9229550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9229720Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9229990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9230080Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9230380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9230430Z     yield
2025-01-14T13:16:42.9230650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9230880Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9231080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9231130Z     yield
2025-01-14T13:16:42.9231360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9231420Z     return (yield)
2025-01-14T13:16:42.9231670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9231750Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9232030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9232080Z     yield
2025-01-14T13:16:42.9232310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9232380Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9232570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9232650Z     raise exc
2025-01-14T13:16:42.9232840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9232880Z     col.setup()
2025-01-14T13:16:42.9233080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9233140Z     self._request._fillfixtures()
2025-01-14T13:16:42.9233350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9233460Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9234240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9234350Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9234720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9234800Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9235000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9235100Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9235490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9235620Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9235840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9236120Z     raise exc
2025-01-14T13:16:42.9236580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9237100Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9237730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9238090Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9238650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9239850Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9240900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9241080Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9241360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9241450Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9241770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9248140Z     yield
2025-01-14T13:16:42.9248420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9248510Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9248710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9248770Z     yield
2025-01-14T13:16:42.9248990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9249040Z     return (yield)
2025-01-14T13:16:42.9249300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9249370Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9249660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9249700Z     yield
2025-01-14T13:16:42.9249930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9250200Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9250390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9250440Z     raise exc
2025-01-14T13:16:42.9250660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9250710Z     col.setup()
2025-01-14T13:16:42.9250900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9250960Z     self._request._fillfixtures()
2025-01-14T13:16:42.9251270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9251400Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9251630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9251720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9251960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9252040Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9252240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9252350Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9252590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9252660Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9253040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9253090Z     raise exc
2025-01-14T13:16:42.9253290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9253350Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9253550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9253680Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9253960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9254110Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9254400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9254570Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9254840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9255060Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9255360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9255420Z     yield
2025-01-14T13:16:42.9255650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9255730Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9255930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9255980Z     yield
2025-01-14T13:16:42.9256210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9256270Z     return (yield)
2025-01-14T13:16:42.9256520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9256590Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9256880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9256960Z     yield
2025-01-14T13:16:42.9257190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9257260Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9257540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9257590Z     raise exc
2025-01-14T13:16:42.9257780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9257820Z     col.setup()
2025-01-14T13:16:42.9258000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9258070Z     self._request._fillfixtures()
2025-01-14T13:16:42.9258280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9258390Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9258610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9258700Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9258930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9259010Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9259200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9259300Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9259650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9259720Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9259920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9259960Z     raise exc
2025-01-14T13:16:42.9260160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9260220Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9260460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9260590Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9260870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9261040Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9261250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9261380Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9261770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9261860Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9262170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9262220Z     yield
2025-01-14T13:16:42.9262450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9262530Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9262740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9262790Z     yield
2025-01-14T13:16:42.9263020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9263070Z     return (yield)
2025-01-14T13:16:42.9263320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9263400Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9264470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9264780Z     yield
2025-01-14T13:16:42.9265470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9265680Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9266200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9266350Z     raise exc
2025-01-14T13:16:42.9266910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9267010Z     col.setup()
2025-01-14T13:16:42.9267220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9267290Z     self._request._fillfixtures()
2025-01-14T13:16:42.9267520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9268050Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9268500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9268620Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9268870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9268940Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9269140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9269600Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9269840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9269910Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9270110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9270160Z     raise exc
2025-01-14T13:16:42.9270360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9270470Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9270670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9270800Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9270990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9271150Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9271570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9271720Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9271980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9272080Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9272390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9272440Z     yield
2025-01-14T13:16:42.9272670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9272760Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9272970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9273020Z     yield
2025-01-14T13:16:42.9273250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9273300Z     return (yield)
2025-01-14T13:16:42.9273560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9273680Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9273970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9274020Z     yield
2025-01-14T13:16:42.9274250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9274320Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9274510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9274560Z     raise exc
2025-01-14T13:16:42.9274890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9274940Z     col.setup()
2025-01-14T13:16:42.9275120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9275190Z     self._request._fillfixtures()
2025-01-14T13:16:42.9275400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9275520Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9275730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9275830Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9276060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9276220Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9276420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9276520Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9276760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9276830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9277030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9277190Z     raise exc
2025-01-14T13:16:42.9277390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9277450Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9277640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9277770Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9277960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9278190Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9278380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9278930Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9279240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9279330Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9279630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9279680Z     yield
2025-01-14T13:16:42.9279910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9279990Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9280210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9280250Z     yield
2025-01-14T13:16:42.9280480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9280720Z     return (yield)
2025-01-14T13:16:42.9280970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9281050Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9281330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9281370Z     yield
2025-01-14T13:16:42.9281600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9281660Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9281850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9281900Z     raise exc
2025-01-14T13:16:42.9282080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9282140Z     col.setup()
2025-01-14T13:16:42.9282320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9282380Z     self._request._fillfixtures()
2025-01-14T13:16:42.9282590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9282700Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9282910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9283110Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9283340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9283420Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9283620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9284340Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9285150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9285340Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9285550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9285610Z     raise exc
2025-01-14T13:16:42.9285820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9285890Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9286090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9286330Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9286510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9286670Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9286870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9287000Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9287270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9287360Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9287650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9287700Z     yield
2025-01-14T13:16:42.9287930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9288010Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9288220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9288300Z     yield
2025-01-14T13:16:42.9288530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9288580Z     return (yield)
2025-01-14T13:16:42.9288830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9288900Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9289180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9289230Z     yield
2025-01-14T13:16:42.9289450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9289530Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9289710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9289760Z     raise exc
2025-01-14T13:16:42.9290290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9290750Z     col.setup()
2025-01-14T13:16:42.9290950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9291020Z     self._request._fillfixtures()
2025-01-14T13:16:42.9291230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9291340Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9291650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9292220Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9292980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9293190Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9293760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9294550Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9295120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9295230Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9295860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9296070Z     raise exc
2025-01-14T13:16:42.9296650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9297240Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9297790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9298150Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9298750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9299190Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9299740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9300110Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9300850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9301160Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9302010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9302160Z     yield
2025-01-14T13:16:42.9302990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9303460Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9304040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9304480Z     yield
2025-01-14T13:16:42.9304790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9304840Z     return (yield)
2025-01-14T13:16:42.9305100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9305190Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9305470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9305520Z     yield
2025-01-14T13:16:42.9305740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9305820Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9306000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9306050Z     raise exc
2025-01-14T13:16:42.9306230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9306280Z     col.setup()
2025-01-14T13:16:42.9307120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9307380Z     self._request._fillfixtures()
2025-01-14T13:16:42.9309030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9309170Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9309400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9309500Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9309740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9310030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9310230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9310280Z     raise exc
2025-01-14T13:16:42.9310480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9310540Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9310740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9310870Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9311340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9311500Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9311710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9311850Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9312110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9312210Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9312520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9312570Z     yield
2025-01-14T13:16:42.9313440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9313790Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9314380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9314740Z     yield
2025-01-14T13:16:42.9315320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9315400Z     return (yield)
2025-01-14T13:16:42.9315660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9315730Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9316020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9316070Z     yield
2025-01-14T13:16:42.9316300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9316380Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9316570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9316620Z     raise exc
2025-01-14T13:16:42.9316810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9316860Z     col.setup()
2025-01-14T13:16:42.9317050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9317110Z     self._request._fillfixtures()
2025-01-14T13:16:42.9317320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9317420Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9317630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9317890Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9318130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9318210Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9318410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9318450Z     raise exc
2025-01-14T13:16:42.9319040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9319120Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9319320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9319450Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9319650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9319810Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9320100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9320240Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9320520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9320610Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9320910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9320960Z     yield
2025-01-14T13:16:42.9321190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9321270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9321480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9321520Z     yield
2025-01-14T13:16:42.9321750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9321800Z     return (yield)
2025-01-14T13:16:42.9322050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9322630Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9323460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9323610Z     yield
2025-01-14T13:16:42.9324200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9324310Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9324500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9324550Z     raise exc
2025-01-14T13:16:42.9324740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9324790Z     col.setup()
2025-01-14T13:16:42.9324970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9325040Z     self._request._fillfixtures()
2025-01-14T13:16:42.9325250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9325820Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9326520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9326780Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9327440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9328230Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9329130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9329320Z     raise exc
2025-01-14T13:16:42.9329820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9329920Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9330110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9330390Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9330590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9330740Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9330940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9331080Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9331460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9331550Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9331850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9331900Z     yield
2025-01-14T13:16:42.9332120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9332200Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9332410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9332460Z     yield
2025-01-14T13:16:42.9332680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9332740Z     return (yield)
2025-01-14T13:16:42.9332990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9333070Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9333350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9333450Z     yield
2025-01-14T13:16:42.9333690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9333760Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9333950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9333990Z     raise exc
2025-01-14T13:16:42.9334180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9334230Z     col.setup()
2025-01-14T13:16:42.9334440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9334510Z     self._request._fillfixtures()
2025-01-14T13:16:42.9334730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9334840Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9335050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9335150Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9335380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9335830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9337850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9338440Z     raise exc
2025-01-14T13:16:42.9339000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9339210Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9339730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9340240Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9340820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9341430Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9342090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9342450Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9343790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9344070Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9344830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9345620Z     yield
2025-01-14T13:16:42.9346540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9346820Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9347400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9347550Z     yield
2025-01-14T13:16:42.9348090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9348200Z     return (yield)
2025-01-14T13:16:42.9348550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9348650Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9349240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9349460Z     yield
2025-01-14T13:16:42.9350210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9350660Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9351180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9351440Z     raise exc
2025-01-14T13:16:42.9351960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9352100Z     col.setup()
2025-01-14T13:16:42.9352620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9352800Z     self._request._fillfixtures()
2025-01-14T13:16:42.9353390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9353670Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9354270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9354720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9355160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9355250Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9355450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9355500Z     raise exc
2025-01-14T13:16:42.9355700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9355770Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9356350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9358170Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9358910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9360660Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9362400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9363150Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9364470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9364620Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9364930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9364990Z     yield
2025-01-14T13:16:42.9365210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9365580Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9365790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9365840Z     yield
2025-01-14T13:16:42.9366070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9366120Z     return (yield)
2025-01-14T13:16:42.9366370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9366450Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9366730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9366780Z     yield
2025-01-14T13:16:42.9367000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9367080Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9367260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9367310Z     raise exc
2025-01-14T13:16:42.9367560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9367620Z     col.setup()
2025-01-14T13:16:42.9367810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9367870Z     self._request._fillfixtures()
2025-01-14T13:16:42.9368080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9368190Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9368410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9368500Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9368730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9368800Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9369010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9369100Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9369340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9369420Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9369610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9369660Z     raise exc
2025-01-14T13:16:42.9371010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9371960Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9372160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9372290Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9372480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9372630Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9373020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9373150Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9373420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9373500Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9373800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9373940Z     yield
2025-01-14T13:16:42.9374170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9374250Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9374460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9374500Z     yield
2025-01-14T13:16:42.9374730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9374780Z     return (yield)
2025-01-14T13:16:42.9375030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9375120Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9375400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9380980Z     yield
2025-01-14T13:16:42.9381240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9381310Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9381650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9381710Z     raise exc
2025-01-14T13:16:42.9381900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9381950Z     col.setup()
2025-01-14T13:16:42.9382140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9382200Z     self._request._fillfixtures()
2025-01-14T13:16:42.9382420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9382530Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9382750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9382840Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9383080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9383160Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9383360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9383460Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9383680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9383760Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9384070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9384130Z     raise exc
2025-01-14T13:16:42.9384320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9384390Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9384580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9384710Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9384950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9385110Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9386010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9386530Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9387420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9387800Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9388290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9388340Z     yield
2025-01-14T13:16:42.9388570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9388650Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9388850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9388900Z     yield
2025-01-14T13:16:42.9389130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9389180Z     return (yield)
2025-01-14T13:16:42.9389440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9389510Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9389790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9389840Z     yield
2025-01-14T13:16:42.9390060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9390180Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9390370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9390420Z     raise exc
2025-01-14T13:16:42.9390630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9390680Z     col.setup()
2025-01-14T13:16:42.9390880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9390940Z     self._request._fillfixtures()
2025-01-14T13:16:42.9391170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9391280Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9391500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9391600Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9391840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9391910Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9392110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9392210Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9392830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9393890Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9394100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9394150Z     raise exc
2025-01-14T13:16:42.9394340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9394420Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9394600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9394800Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9394990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9395280Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9395480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9395620Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9395950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9396400Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9396760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9396810Z     yield
2025-01-14T13:16:42.9397050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9397130Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9397340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9397390Z     yield
2025-01-14T13:16:42.9397620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9397670Z     return (yield)
2025-01-14T13:16:42.9397920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9398020Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9398300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9398490Z     yield
2025-01-14T13:16:42.9398720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9398800Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9399090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9399150Z     raise exc
2025-01-14T13:16:42.9399340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9399390Z     col.setup()
2025-01-14T13:16:42.9399580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9399650Z     self._request._fillfixtures()
2025-01-14T13:16:42.9399860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9399970Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9400190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9400280Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9400530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9401150Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9401890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9402820Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9403060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9403150Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9403350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9403400Z     raise exc
2025-01-14T13:16:42.9403590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9403730Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9403920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9404060Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9404250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9404410Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9404610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9405260Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9406100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9406220Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9406540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9406580Z     yield
2025-01-14T13:16:42.9406810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9406890Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9407100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9407150Z     yield
2025-01-14T13:16:42.9407400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9407460Z     return (yield)
2025-01-14T13:16:42.9407700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9407860Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9408140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9408190Z     yield
2025-01-14T13:16:42.9408410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9408490Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9408690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9408740Z     raise exc
2025-01-14T13:16:42.9408930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9408980Z     col.setup()
2025-01-14T13:16:42.9409170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9409240Z     self._request._fillfixtures()
2025-01-14T13:16:42.9409450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9409550Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9409770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9409870Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9410100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9410280Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9410480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9410580Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9410820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9410890Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9411090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9411300Z     raise exc
2025-01-14T13:16:42.9411500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9411570Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9411770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9411890Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9412100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9412330Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9412530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9412670Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9412950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9413040Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9413350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9413400Z     yield
2025-01-14T13:16:42.9413630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9413710Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9413930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9413980Z     yield
2025-01-14T13:16:42.9414210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9414380Z     return (yield)
2025-01-14T13:16:42.9415120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9415250Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9415540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9415590Z     yield
2025-01-14T13:16:42.9415830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9415900Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9416090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9416140Z     raise exc
2025-01-14T13:16:42.9416330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9416380Z     col.setup()
2025-01-14T13:16:42.9416570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9416630Z     self._request._fillfixtures()
2025-01-14T13:16:42.9416850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9416950Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9417170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9417270Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9417650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9417720Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9417920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9418020Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9418260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9418370Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9418570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9418620Z     raise exc
2025-01-14T13:16:42.9418800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9418870Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9419070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9419200Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9419460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9419620Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9419820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9419950Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9420220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9420310Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9420770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9420910Z     yield
2025-01-14T13:16:42.9421160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9421240Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9421600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9422600Z     yield
2025-01-14T13:16:42.9423280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9423440Z     return (yield)
2025-01-14T13:16:42.9424670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9424790Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9425080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9425130Z     yield
2025-01-14T13:16:42.9425360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9425440Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9425630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9425670Z     raise exc
2025-01-14T13:16:42.9425880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9425930Z     col.setup()
2025-01-14T13:16:42.9426130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9426190Z     self._request._fillfixtures()
2025-01-14T13:16:42.9426400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9426510Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9426930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9427030Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9427270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9427350Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9427550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9427660Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9427980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9428060Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9428250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9428300Z     raise exc
2025-01-14T13:16:42.9428500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9428560Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9429030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9429510Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9430150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9430360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9430560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9430700Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9430970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9431060Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9431370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9431420Z     yield
2025-01-14T13:16:42.9431660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9431820Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9432030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9432080Z     yield
2025-01-14T13:16:42.9432310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9432370Z     return (yield)
2025-01-14T13:16:42.9432820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9433190Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9434030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9434180Z     yield
2025-01-14T13:16:42.9435010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9435520Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9436080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9436470Z     raise exc
2025-01-14T13:16:42.9437040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9437300Z     col.setup()
2025-01-14T13:16:42.9437850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9438030Z     self._request._fillfixtures()
2025-01-14T13:16:42.9438620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9439860Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9441240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9441430Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9441680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9441760Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9442170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9442270Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9442510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9442590Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9442800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9442850Z     raise exc
2025-01-14T13:16:42.9443050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9443370Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9443570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9443700Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9443890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9444050Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9444250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9444380Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9445920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9446240Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9447360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9448350Z     yield
2025-01-14T13:16:42.9448590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9448670Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9448880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9448930Z     yield
2025-01-14T13:16:42.9449160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9449210Z     return (yield)
2025-01-14T13:16:42.9449460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9449540Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9449830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9449870Z     yield
2025-01-14T13:16:42.9450100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9450170Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9450360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9450410Z     raise exc
2025-01-14T13:16:42.9450600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9450640Z     col.setup()
2025-01-14T13:16:42.9450840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9451990Z     self._request._fillfixtures()
2025-01-14T13:16:42.9452760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9453080Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9453600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9453750Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9454100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9454400Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9454600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9454700Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9454930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9455020Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9455340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9455390Z     raise exc
2025-01-14T13:16:42.9455580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9456340Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9456990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9457370Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9457810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9457990Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9458190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9458340Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9458610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9458710Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9459220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9459270Z     yield
2025-01-14T13:16:42.9459510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9459590Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9459800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9459850Z     yield
2025-01-14T13:16:42.9460090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9460140Z     return (yield)
2025-01-14T13:16:42.9460400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9460470Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9460770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9460810Z     yield
2025-01-14T13:16:42.9461050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9461120Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9461330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9461380Z     raise exc
2025-01-14T13:16:42.9461570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9461730Z     col.setup()
2025-01-14T13:16:42.9461920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9462460Z     self._request._fillfixtures()
2025-01-14T13:16:42.9463150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9463460Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9464060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9464720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9465370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9465580Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9466650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9466960Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9467630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9468370Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9468590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9468640Z     raise exc
2025-01-14T13:16:42.9468840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9468910Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9469100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9469230Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9469420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9469590Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9469790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9469930Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9470200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9470600Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9470920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9470970Z     yield
2025-01-14T13:16:42.9471200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9471270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9471480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9471530Z     yield
2025-01-14T13:16:42.9471760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9471810Z     return (yield)
2025-01-14T13:16:42.9472060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9472140Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9472430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9472480Z     yield
2025-01-14T13:16:42.9472710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9472780Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9472970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9473120Z     raise exc
2025-01-14T13:16:42.9473310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9473370Z     col.setup()
2025-01-14T13:16:42.9473550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9473620Z     self._request._fillfixtures()
2025-01-14T13:16:42.9473830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9473990Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9474200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9474300Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9474530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9474610Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9474800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9474980Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9475220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9475290Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9475650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:42.9475790Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:42.9476470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9477210Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9477810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9478180Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9479020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:42.9479230Z     return (yield)
2025-01-14T13:16:42.9480110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:42.9481200Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:42.9481490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:42.9481570Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:42.9481750Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:42.9481810Z     sim.iterate(10)
2025-01-14T13:16:42.9481880Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9482020Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9482120Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9482130Z 
2025-01-14T13:16:42.9482350Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.9482520Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.9482700Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.9482930Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.9483050Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.9483160Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.9483170Z 
2025-01-14T13:16:42.9483230Z     def initialize_transport_state(
2025-01-14T13:16:42.9483280Z         self,
2025-01-14T13:16:42.9483710Z         simulation_state,
2025-01-14T13:16:42.9483770Z         opacity_state,
2025-01-14T13:16:42.9483820Z         macro_atom_state,
2025-01-14T13:16:42.9483860Z         plasma,
2025-01-14T13:16:42.9483920Z         no_of_packets,
2025-01-14T13:16:42.9484270Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9484320Z         iteration=0,
2025-01-14T13:16:42.9484360Z     ):
2025-01-14T13:16:42.9484470Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9484550Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9484650Z         else:
2025-01-14T13:16:42.9484700Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9484750Z     
2025-01-14T13:16:42.9484860Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9484930Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9484980Z         )
2025-01-14T13:16:42.9485020Z     
2025-01-14T13:16:42.9485120Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9485210Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9485340Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9485560Z         else:
2025-01-14T13:16:42.9485630Z             continuum_state = None
2025-01-14T13:16:42.9485700Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9485790Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9485860Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9485940Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9486020Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9486090Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9486150Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9486200Z         ).to_numba(
2025-01-14T13:16:42.9486250Z             macro_atom_state,
2025-01-14T13:16:42.9486320Z             self.line_interaction_type,
2025-01-14T13:16:42.9486360Z         )
2025-01-14T13:16:42.9486440Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9486660Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9486700Z         ]
2025-01-14T13:16:42.9486960Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9487000Z 
2025-01-14T13:16:42.9487120Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9487280Z _____ test_last_interaction_properties[shell_id_in_use-shell_id_to_check] ______
2025-01-14T13:16:42.9487280Z 
2025-01-14T13:16:42.9487390Z expected = 'shell_id_in_use', obtained = 'shell_id_to_check'
2025-01-14T13:16:42.9487630Z request = <FixtureRequest for <Function test_last_interaction_properties[shell_id_in_use-shell_id_to_check]>>
2025-01-14T13:16:42.9487630Z 
2025-01-14T13:16:42.9487860Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.9488170Z         "expected,obtained",
2025-01-14T13:16:42.9488220Z         [
2025-01-14T13:16:42.9488270Z             (
2025-01-14T13:16:42.9488340Z                 "interaction_type_in_use",
2025-01-14T13:16:42.9488410Z                 "interaction_type_to_check",
2025-01-14T13:16:42.9488450Z             ),
2025-01-14T13:16:42.9488500Z             (
2025-01-14T13:16:42.9488550Z                 "shell_id_in_use",
2025-01-14T13:16:42.9488610Z                 "shell_id_to_check",
2025-01-14T13:16:42.9488660Z             ),
2025-01-14T13:16:42.9488700Z             (
2025-01-14T13:16:42.9488750Z                 "r_in_use",
2025-01-14T13:16:42.9488800Z                 "r_to_check",
2025-01-14T13:16:42.9488850Z             ),
2025-01-14T13:16:42.9488930Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.9488980Z         ],
2025-01-14T13:16:42.9489020Z     )
2025-01-14T13:16:42.9489150Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.9489390Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.9489390Z 
2025-01-14T13:16:42.9489570Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.9489670Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9489890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9489980Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9490220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9490440Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9490650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9490750Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9490990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9491070Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9491340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9491400Z     raise exc
2025-01-14T13:16:42.9501050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9501220Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9501440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9501570Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9501770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9501930Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9502130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9502270Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9502520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.9502760Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9505040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9505110Z     yield
2025-01-14T13:16:42.9505380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.9505480Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9505890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9505950Z     yield
2025-01-14T13:16:42.9506450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.9507250Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.9507910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9508050Z     yield
2025-01-14T13:16:42.9511140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.9511490Z     return (yield)
2025-01-14T13:16:42.9512260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.9512350Z     return (yield)
2025-01-14T13:16:42.9512580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.9512620Z     raise e
2025-01-14T13:16:42.9512850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.9513360Z     item.runtest()
2025-01-14T13:16:42.9513550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.9513660Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.9513860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9514030Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9514230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9514470Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9514700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.9514770Z     result = testfunction(**testargs)
2025-01-14T13:16:42.9515050Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.9515150Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.9515490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9515840Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9516090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9516170Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9516380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9516480Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9516720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9516800Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9517010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9517170Z     raise exc
2025-01-14T13:16:42.9517390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9517460Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9517650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9517890Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9518080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9518240Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9518440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9518580Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9518850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9518930Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9519240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9519290Z     yield
2025-01-14T13:16:42.9519530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9519600Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9519810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9519860Z     yield
2025-01-14T13:16:42.9520190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9520260Z     return (yield)
2025-01-14T13:16:42.9520670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9520750Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9521030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9521080Z     yield
2025-01-14T13:16:42.9521310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9521440Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9521630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9521680Z     raise exc
2025-01-14T13:16:42.9521870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9521920Z     col.setup()
2025-01-14T13:16:42.9522110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9522170Z     self._request._fillfixtures()
2025-01-14T13:16:42.9522400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9522580Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9522800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9522890Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9523130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9523200Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9523400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9523500Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9523730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9523800Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9524000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9524050Z     raise exc
2025-01-14T13:16:42.9524240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9524360Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9524550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9524690Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9524870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9525040Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9526090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9526610Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9527380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9527620Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9529550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9529660Z     yield
2025-01-14T13:16:42.9529910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9529980Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9530200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9530240Z     yield
2025-01-14T13:16:42.9530800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9530850Z     return (yield)
2025-01-14T13:16:42.9531110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9531200Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9531480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9531710Z     yield
2025-01-14T13:16:42.9532030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9532110Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9532300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9532350Z     raise exc
2025-01-14T13:16:42.9532540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9532590Z     col.setup()
2025-01-14T13:16:42.9532780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9533020Z     self._request._fillfixtures()
2025-01-14T13:16:42.9533230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9533340Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9533560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9533650Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9533890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9533960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9534160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9534260Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9534490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9534570Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9534770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9534870Z     raise exc
2025-01-14T13:16:42.9535060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9535130Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9535320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9535450Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9535640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9535800Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9536000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9536130Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9536410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9536500Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9536810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9536850Z     yield
2025-01-14T13:16:42.9537080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9537150Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9537450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9537490Z     yield
2025-01-14T13:16:42.9537730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9537780Z     return (yield)
2025-01-14T13:16:42.9538040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9538120Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9538530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9538580Z     yield
2025-01-14T13:16:42.9538810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9538880Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9539070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9539120Z     raise exc
2025-01-14T13:16:42.9539410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9539660Z     col.setup()
2025-01-14T13:16:42.9539860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9539920Z     self._request._fillfixtures()
2025-01-14T13:16:42.9541600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9541720Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9541940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9542030Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9542280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9542350Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9542560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9542660Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9542890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9543110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9543310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9543360Z     raise exc
2025-01-14T13:16:42.9544080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9544380Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9544920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9545370Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9546090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9546280Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9546480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9546610Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9546980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9547090Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9547400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9547440Z     yield
2025-01-14T13:16:42.9547680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9547900Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9548110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9548160Z     yield
2025-01-14T13:16:42.9548390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9548860Z     return (yield)
2025-01-14T13:16:42.9549120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9549280Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9549570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9549620Z     yield
2025-01-14T13:16:42.9549850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9549920Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9550100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9550330Z     raise exc
2025-01-14T13:16:42.9550530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9550580Z     col.setup()
2025-01-14T13:16:42.9550780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9550840Z     self._request._fillfixtures()
2025-01-14T13:16:42.9551050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9551160Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9551380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9551470Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9551710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9551780Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9552070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9552180Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9552500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9552580Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9552780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9552820Z     raise exc
2025-01-14T13:16:42.9553010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9553070Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9553260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9553390Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9553580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9553730Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9553930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9554070Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9554330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9554420Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9554720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9554850Z     yield
2025-01-14T13:16:42.9555080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9555160Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9555370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9555420Z     yield
2025-01-14T13:16:42.9555790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9555890Z     return (yield)
2025-01-14T13:16:42.9556150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9556230Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9556510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9556560Z     yield
2025-01-14T13:16:42.9556790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9556920Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9557350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9557960Z     raise exc
2025-01-14T13:16:42.9558530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9558690Z     col.setup()
2025-01-14T13:16:42.9559220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9559400Z     self._request._fillfixtures()
2025-01-14T13:16:42.9559990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9560280Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9560890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9561130Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9561590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9561690Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9562720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9563040Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9563700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9563910Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9564310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9564390Z     raise exc
2025-01-14T13:16:42.9564600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9564670Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9564870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9565000Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9565200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9565360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9565570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9565700Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9565970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9566300Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9566610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9566660Z     yield
2025-01-14T13:16:42.9566890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9566970Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9567180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9567280Z     yield
2025-01-14T13:16:42.9567510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9567560Z     return (yield)
2025-01-14T13:16:42.9568650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9569020Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9569810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9570120Z     yield
2025-01-14T13:16:42.9570350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9570430Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9570630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9570680Z     raise exc
2025-01-14T13:16:42.9570870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9570920Z     col.setup()
2025-01-14T13:16:42.9571110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9571170Z     self._request._fillfixtures()
2025-01-14T13:16:42.9571390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9571490Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9571710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9571800Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9572040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9572160Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9572360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9572470Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9572700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9572770Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9572970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9573020Z     raise exc
2025-01-14T13:16:42.9573210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9573280Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9573460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9573600Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9573790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9574420Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9574640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9574770Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9575170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9575260Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9575560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9575600Z     yield
2025-01-14T13:16:42.9575830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9576030Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9576240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9576280Z     yield
2025-01-14T13:16:42.9576510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9576560Z     return (yield)
2025-01-14T13:16:42.9576820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9576960Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9577270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9577320Z     yield
2025-01-14T13:16:42.9577540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9577620Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9577810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9577850Z     raise exc
2025-01-14T13:16:42.9578040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9578090Z     col.setup()
2025-01-14T13:16:42.9578280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9578340Z     self._request._fillfixtures()
2025-01-14T13:16:42.9578560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9578670Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9578890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9579100Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9579340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9579420Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9579620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9579720Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9579950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9580030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9580230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9580280Z     raise exc
2025-01-14T13:16:42.9580470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9580540Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9580740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9580870Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9581070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9581220Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9581490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9581620Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9581890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9581970Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9582280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9582360Z     yield
2025-01-14T13:16:42.9582590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9582930Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9583140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9583190Z     yield
2025-01-14T13:16:42.9583410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9583460Z     return (yield)
2025-01-14T13:16:42.9583790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9583870Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9584140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9584190Z     yield
2025-01-14T13:16:42.9584430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9584500Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9584690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9584730Z     raise exc
2025-01-14T13:16:42.9584920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9584970Z     col.setup()
2025-01-14T13:16:42.9585160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9585220Z     self._request._fillfixtures()
2025-01-14T13:16:42.9585440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9585570Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9585790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9586010Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9586300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9586380Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9586570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9586680Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9586910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9586990Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9587180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9587220Z     raise exc
2025-01-14T13:16:42.9587700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9588190Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9588760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9589110Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9589660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9590920Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9591170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9591300Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9591580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9591670Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9592250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9592330Z     yield
2025-01-14T13:16:42.9592560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9592640Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9592850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9592900Z     yield
2025-01-14T13:16:42.9593270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9593320Z     return (yield)
2025-01-14T13:16:42.9593570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9593660Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9594160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9594220Z     yield
2025-01-14T13:16:42.9594450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9594520Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9594710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9594760Z     raise exc
2025-01-14T13:16:42.9594950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9594990Z     col.setup()
2025-01-14T13:16:42.9595190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9595330Z     self._request._fillfixtures()
2025-01-14T13:16:42.9595550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9595660Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9596040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9596140Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9596380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9596460Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9596660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9596770Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9597000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9597080Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9597280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9597320Z     raise exc
2025-01-14T13:16:42.9597520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9597580Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9597770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9598830Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9599520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9599970Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9600530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9600890Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9602040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9602500Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9606260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9606340Z     yield
2025-01-14T13:16:42.9606580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9606670Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9607230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9607280Z     yield
2025-01-14T13:16:42.9607510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9607580Z     return (yield)
2025-01-14T13:16:42.9607830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9607920Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9608220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9608270Z     yield
2025-01-14T13:16:42.9608500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9608570Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9608760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9608810Z     raise exc
2025-01-14T13:16:42.9609000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9609120Z     col.setup()
2025-01-14T13:16:42.9609310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9609380Z     self._request._fillfixtures()
2025-01-14T13:16:42.9609600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9609720Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9609940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9610040Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9610280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9610350Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9610550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9610660Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9610900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9610970Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9611170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9611220Z     raise exc
2025-01-14T13:16:42.9611410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9611560Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9611750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9611890Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9612080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9612230Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9612440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9612700Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9612970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9613060Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9613360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9613420Z     yield
2025-01-14T13:16:42.9613640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9614870Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9615470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9615640Z     yield
2025-01-14T13:16:42.9616270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9616440Z     return (yield)
2025-01-14T13:16:42.9617130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9617360Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9618400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9618550Z     yield
2025-01-14T13:16:42.9618790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9618870Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9619070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9619360Z     raise exc
2025-01-14T13:16:42.9624550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9624620Z     col.setup()
2025-01-14T13:16:42.9624810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9624880Z     self._request._fillfixtures()
2025-01-14T13:16:42.9625090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9625200Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9625420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9625520Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9625760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9625840Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9626030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9626130Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9626360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9626430Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9626640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9626850Z     raise exc
2025-01-14T13:16:42.9627050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9627110Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9627300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9627430Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9627620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9627830Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9628030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9628160Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9629660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9630170Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9630530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9630720Z     yield
2025-01-14T13:16:42.9630950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9631030Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9631230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9631280Z     yield
2025-01-14T13:16:42.9631510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9631560Z     return (yield)
2025-01-14T13:16:42.9631820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9631900Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9632180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9632230Z     yield
2025-01-14T13:16:42.9632460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9632590Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9632780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9632830Z     raise exc
2025-01-14T13:16:42.9633010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9633050Z     col.setup()
2025-01-14T13:16:42.9633250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9633310Z     self._request._fillfixtures()
2025-01-14T13:16:42.9633530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9633640Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9633850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9633950Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9634180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9634260Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9634460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9634560Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9634790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9634870Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9635150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9635190Z     raise exc
2025-01-14T13:16:42.9635400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9635460Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9635660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9635790Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9636790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9637340Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9637910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9638290Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9638860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9639170Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9639490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9639550Z     yield
2025-01-14T13:16:42.9639780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9639870Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9640150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9640220Z     yield
2025-01-14T13:16:42.9640450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9640510Z     return (yield)
2025-01-14T13:16:42.9640760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9640840Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9641120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9641240Z     yield
2025-01-14T13:16:42.9641470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9641540Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9641730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9641770Z     raise exc
2025-01-14T13:16:42.9641970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9642020Z     col.setup()
2025-01-14T13:16:42.9642210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9642280Z     self._request._fillfixtures()
2025-01-14T13:16:42.9642500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9642610Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9642830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9642930Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9643160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9643250Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9643450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9643550Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9644000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9644080Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9644280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9644330Z     raise exc
2025-01-14T13:16:42.9644530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9644600Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9645090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9645220Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9645420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9645570Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9645770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9645910Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9646360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9646450Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9646760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9646810Z     yield
2025-01-14T13:16:42.9647040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9647120Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9647320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9647370Z     yield
2025-01-14T13:16:42.9647600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9647650Z     return (yield)
2025-01-14T13:16:42.9647910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9647980Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9650200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9650520Z     yield
2025-01-14T13:16:42.9651180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9651380Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9651990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9652100Z     raise exc
2025-01-14T13:16:42.9652290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9652350Z     col.setup()
2025-01-14T13:16:42.9652540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9652610Z     self._request._fillfixtures()
2025-01-14T13:16:42.9652820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9652940Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9653150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9653250Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9653490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9653560Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9653750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9654110Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9654350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9654420Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9654630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9654680Z     raise exc
2025-01-14T13:16:42.9654870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9655100Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9655290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9655420Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9655620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9655780Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9656060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9656200Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9656470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9656560Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9656870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9656920Z     yield
2025-01-14T13:16:42.9657590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9657710Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9657930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9657970Z     yield
2025-01-14T13:16:42.9658210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9658250Z     return (yield)
2025-01-14T13:16:42.9658520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9658920Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9659210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9659250Z     yield
2025-01-14T13:16:42.9659590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9659670Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9659860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9659910Z     raise exc
2025-01-14T13:16:42.9660090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9660150Z     col.setup()
2025-01-14T13:16:42.9660330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9660410Z     self._request._fillfixtures()
2025-01-14T13:16:42.9660620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9660730Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9660940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9661030Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9661260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9661460Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9661660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9661750Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9662000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9662070Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9662280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9662380Z     raise exc
2025-01-14T13:16:42.9662580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9662640Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9662850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9662990Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9663190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9663420Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9663620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9663760Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9664020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9664110Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9664420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9664470Z     yield
2025-01-14T13:16:42.9664700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9664780Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9664990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9665030Z     yield
2025-01-14T13:16:42.9665260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9665350Z     return (yield)
2025-01-14T13:16:42.9665610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9665680Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9665960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9666000Z     yield
2025-01-14T13:16:42.9666230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9666300Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9666490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9666540Z     raise exc
2025-01-14T13:16:42.9666730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9666780Z     col.setup()
2025-01-14T13:16:42.9666970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9667040Z     self._request._fillfixtures()
2025-01-14T13:16:42.9667250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9667360Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9668650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9669870Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9670550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9670780Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9671650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9671810Z     raise exc
2025-01-14T13:16:42.9672690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9673320Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9673870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9675060Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9675740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9675960Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9676310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9676650Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9676920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9677010Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9677330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9677380Z     yield
2025-01-14T13:16:42.9679990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9680270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9680930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9681090Z     yield
2025-01-14T13:16:42.9681720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9681890Z     return (yield)
2025-01-14T13:16:42.9682590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9683330Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9684130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9684280Z     yield
2025-01-14T13:16:42.9685420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9685580Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9685790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9685850Z     raise exc
2025-01-14T13:16:42.9686040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9686100Z     col.setup()
2025-01-14T13:16:42.9686300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9686360Z     self._request._fillfixtures()
2025-01-14T13:16:42.9686690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9686820Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9687050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9687140Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9687380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9687450Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9688050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9688100Z     raise exc
2025-01-14T13:16:42.9688300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9688370Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9688570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9688710Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9688970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9689130Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9689330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9689460Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9689730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9689960Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9690380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9690640Z     yield
2025-01-14T13:16:42.9691560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9691810Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9692380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9692530Z     yield
2025-01-14T13:16:42.9693160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9693330Z     return (yield)
2025-01-14T13:16:42.9694060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9694180Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9694470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9694620Z     yield
2025-01-14T13:16:42.9694850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9694930Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9695120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9695160Z     raise exc
2025-01-14T13:16:42.9695350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9695400Z     col.setup()
2025-01-14T13:16:42.9698110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9698380Z     self._request._fillfixtures()
2025-01-14T13:16:42.9698990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9699300Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9699960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9700220Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9702050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9702180Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9702390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9702440Z     raise exc
2025-01-14T13:16:42.9702640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9702970Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9703160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9703300Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9703500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9703660Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9704040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9704170Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9704450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9704540Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9706120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9707030Z     yield
2025-01-14T13:16:42.9707810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9708040Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9708610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9708770Z     yield
2025-01-14T13:16:42.9709390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9709550Z     return (yield)
2025-01-14T13:16:42.9710300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9710440Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9710750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9710800Z     yield
2025-01-14T13:16:42.9711020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9711100Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9711520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9711570Z     raise exc
2025-01-14T13:16:42.9711770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9711810Z     col.setup()
2025-01-14T13:16:42.9712010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9712070Z     self._request._fillfixtures()
2025-01-14T13:16:42.9712300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9712420Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9712640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9712740Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9712970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9713060Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9713260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9713480Z     raise exc
2025-01-14T13:16:42.9714390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9714510Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9714700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9715660Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9715900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9716080Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9716420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9716560Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9716910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9716990Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9717300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9717340Z     yield
2025-01-14T13:16:42.9717580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9717660Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9717970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9718040Z     yield
2025-01-14T13:16:42.9718760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9719820Z     return (yield)
2025-01-14T13:16:42.9720140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9720220Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9721520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9722220Z     yield
2025-01-14T13:16:42.9723230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9723350Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9723590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9723640Z     raise exc
2025-01-14T13:16:42.9723830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9724220Z     col.setup()
2025-01-14T13:16:42.9725260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9725650Z     self._request._fillfixtures()
2025-01-14T13:16:42.9726280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9726420Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9726640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9726740Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9726980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9727060Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9727270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9727340Z     raise exc
2025-01-14T13:16:42.9727530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9727610Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9727810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9727940Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9728120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9728420Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9728620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9728760Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9729020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9729120Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9730730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9730890Z     yield
2025-01-14T13:16:42.9731770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9732050Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9732800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9732910Z     yield
2025-01-14T13:16:42.9733640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9733850Z     return (yield)
2025-01-14T13:16:42.9734120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9734210Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9734500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9734550Z     yield
2025-01-14T13:16:42.9736480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9736770Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9737180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9737240Z     raise exc
2025-01-14T13:16:42.9737430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9737480Z     col.setup()
2025-01-14T13:16:42.9737670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9737740Z     self._request._fillfixtures()
2025-01-14T13:16:42.9738100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9738210Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9738430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9738520Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9738780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9738870Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9739070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9739940Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9740210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9740900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9741570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9741880Z     raise exc
2025-01-14T13:16:42.9742120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9742190Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9743560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9743730Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9745880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9746120Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9746490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9746690Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9747010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9747260Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9747640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9747720Z     yield
2025-01-14T13:16:42.9748010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9748130Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9748370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9750180Z     yield
2025-01-14T13:16:42.9751150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9751240Z     return (yield)
2025-01-14T13:16:42.9752380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9752800Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9753130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9753180Z     yield
2025-01-14T13:16:42.9753410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9753910Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9754280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9754350Z     raise exc
2025-01-14T13:16:42.9754530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9754590Z     col.setup()
2025-01-14T13:16:42.9755330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9756120Z     self._request._fillfixtures()
2025-01-14T13:16:42.9757250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9757750Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9758230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9758560Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9759460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9759700Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9760280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9760550Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9761800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9762050Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9762640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9762800Z     raise exc
2025-01-14T13:16:42.9763350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9763540Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9765010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9765180Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9765940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9766660Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9766910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9767380Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9767650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9767740Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9768100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9768150Z     yield
2025-01-14T13:16:42.9768430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9768680Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9768890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9768940Z     yield
2025-01-14T13:16:42.9769180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9769230Z     return (yield)
2025-01-14T13:16:42.9769500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9769910Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9770670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9770760Z     yield
2025-01-14T13:16:42.9770990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9771080Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9771290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9771350Z     raise exc
2025-01-14T13:16:42.9771960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9772020Z     col.setup()
2025-01-14T13:16:42.9772210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9772710Z     self._request._fillfixtures()
2025-01-14T13:16:42.9773520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9773830Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9774580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9774850Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9775830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9776070Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9793140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9793300Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9793560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9793640Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9793840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9793890Z     raise exc
2025-01-14T13:16:42.9794590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9794660Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9794870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9795350Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9795560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9795760Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9797040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9797630Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9798620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9799000Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9799400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9799630Z     yield
2025-01-14T13:16:42.9799870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9799950Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9800470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9800720Z     yield
2025-01-14T13:16:42.9801390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9801550Z     return (yield)
2025-01-14T13:16:42.9802380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9802740Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9804480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9804570Z     yield
2025-01-14T13:16:42.9805340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9805620Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9806990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9807170Z     raise exc
2025-01-14T13:16:42.9809430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9809540Z     col.setup()
2025-01-14T13:16:42.9809770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9809860Z     self._request._fillfixtures()
2025-01-14T13:16:42.9810100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9810250Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9810520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9810640Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9810890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9810970Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9811200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9811300Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9811550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9811640Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9812040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9812100Z     raise exc
2025-01-14T13:16:42.9812290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9812380Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9812580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9812720Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9813000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9813180Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9813420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9813560Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9813840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9813930Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9814340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9814390Z     yield
2025-01-14T13:16:42.9816780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9817260Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9818340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9818540Z     yield
2025-01-14T13:16:42.9820100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9820210Z     return (yield)
2025-01-14T13:16:42.9820530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9820620Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9821000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9821090Z     yield
2025-01-14T13:16:42.9821360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9821610Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9822350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9822670Z     raise exc
2025-01-14T13:16:42.9822920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9822990Z     col.setup()
2025-01-14T13:16:42.9823200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9823260Z     self._request._fillfixtures()
2025-01-14T13:16:42.9824110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9824500Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9825210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9825340Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9825600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9825700Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9825920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9826040Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9826290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9831650Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9831890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9831950Z     raise exc
2025-01-14T13:16:42.9832150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9832220Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9832400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9832630Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9833530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9833720Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9833970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9834630Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9837840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9838150Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9838840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9838930Z     yield
2025-01-14T13:16:42.9839200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9839290Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9839530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9839590Z     yield
2025-01-14T13:16:42.9839830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9839900Z     return (yield)
2025-01-14T13:16:42.9840750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9840860Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9841350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9841520Z     yield
2025-01-14T13:16:42.9841770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9841870Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9842090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9842150Z     raise exc
2025-01-14T13:16:42.9843320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9843400Z     col.setup()
2025-01-14T13:16:42.9843590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9843670Z     self._request._fillfixtures()
2025-01-14T13:16:42.9843890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9844000Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9844230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9844320Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9844560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9844640Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9844830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9845080Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9845340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9845430Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9845640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9845710Z     raise exc
2025-01-14T13:16:42.9845930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9856990Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9858190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9858700Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9859090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9859270Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9859480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9859780Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9860060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9860150Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9860460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9860500Z     yield
2025-01-14T13:16:42.9860730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9860810Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9861220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9861300Z     yield
2025-01-14T13:16:42.9861530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9861580Z     return (yield)
2025-01-14T13:16:42.9861840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9865340Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9865640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9865690Z     yield
2025-01-14T13:16:42.9865910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9865990Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9866180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9866220Z     raise exc
2025-01-14T13:16:42.9866410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9866460Z     col.setup()
2025-01-14T13:16:42.9866650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9866710Z     self._request._fillfixtures()
2025-01-14T13:16:42.9866930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9867040Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9867260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9867350Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9867590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9867790Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9868010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9868320Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9868580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9868660Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9869820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9869990Z     raise exc
2025-01-14T13:16:42.9870210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9870280Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9870480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9870610Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9871070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9871360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9871580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9871710Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9872000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9872090Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9873940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9874140Z     yield
2025-01-14T13:16:42.9874910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9875440Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9875770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9875820Z     yield
2025-01-14T13:16:42.9876050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9876200Z     return (yield)
2025-01-14T13:16:42.9876460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9876550Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9876870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9876920Z     yield
2025-01-14T13:16:42.9877270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9877350Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9877530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9877580Z     raise exc
2025-01-14T13:16:42.9877770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9877820Z     col.setup()
2025-01-14T13:16:42.9878020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9878080Z     self._request._fillfixtures()
2025-01-14T13:16:42.9878300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9878400Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9878620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9878710Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9879050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9879130Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9879330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9879430Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9879660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9879780Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9879980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9880030Z     raise exc
2025-01-14T13:16:42.9880220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9880290Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9880490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9880610Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9880870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9881020Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9881220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9881350Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9881630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9881710Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9882460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9882530Z     yield
2025-01-14T13:16:42.9882760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9882840Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9883050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9883170Z     yield
2025-01-14T13:16:42.9883570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9883630Z     return (yield)
2025-01-14T13:16:42.9883880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9883960Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9884240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9884290Z     yield
2025-01-14T13:16:42.9884510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9884580Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9884770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9884820Z     raise exc
2025-01-14T13:16:42.9885010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9885060Z     col.setup()
2025-01-14T13:16:42.9885250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9885490Z     self._request._fillfixtures()
2025-01-14T13:16:42.9885720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9885830Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9893690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9893830Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9894090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9894160Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9894360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9894460Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9894760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9894830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9895030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9895080Z     raise exc
2025-01-14T13:16:42.9895280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9895340Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9901860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9902000Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9902200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9902360Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9902570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9902710Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9903000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9903100Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9903420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9903470Z     yield
2025-01-14T13:16:42.9904740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9904970Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9905200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9905260Z     yield
2025-01-14T13:16:42.9905500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9905550Z     return (yield)
2025-01-14T13:16:42.9905810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9905900Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9906190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9906240Z     yield
2025-01-14T13:16:42.9906470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9906540Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9906730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9906780Z     raise exc
2025-01-14T13:16:42.9907960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9908210Z     col.setup()
2025-01-14T13:16:42.9908820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9909000Z     self._request._fillfixtures()
2025-01-14T13:16:42.9909760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9911520Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9911750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9911850Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9912090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9912170Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9912880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9912990Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9913360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9913450Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9913650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9913700Z     raise exc
2025-01-14T13:16:42.9914260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9914340Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9914530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9914660Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9914880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9915030Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9916030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9916470Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9917020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:42.9918050Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9918400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9925900Z     yield
2025-01-14T13:16:42.9926620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:42.9926900Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:42.9927420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9927500Z     yield
2025-01-14T13:16:42.9927730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:42.9927780Z     return (yield)
2025-01-14T13:16:42.9928030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:42.9928120Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9929200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9929400Z     yield
2025-01-14T13:16:42.9930060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:42.9930260Z     item.session._setupstate.setup(item)
2025-01-14T13:16:42.9930790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:42.9930930Z     raise exc
2025-01-14T13:16:42.9931450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:42.9931600Z     col.setup()
2025-01-14T13:16:42.9932040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:42.9932290Z     self._request._fillfixtures()
2025-01-14T13:16:42.9932500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:42.9932620Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:42.9932840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9932940Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9933180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9933320Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9933510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9933610Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9933840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9933920Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9934190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:42.9934360Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:42.9934550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9934700Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9934900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9935040Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9935270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:42.9935320Z     return (yield)
2025-01-14T13:16:42.9935720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:42.9935830Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:42.9936050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:42.9936120Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:42.9936340Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:42.9936390Z     sim.iterate(10)
2025-01-14T13:16:42.9936460Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:42.9936580Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:42.9936670Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9936670Z 
2025-01-14T13:16:42.9936890Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:42.9937050Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:42.9937220Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:42.9937460Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:42.9937590Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:42.9937700Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:42.9937700Z 
2025-01-14T13:16:42.9937770Z     def initialize_transport_state(
2025-01-14T13:16:42.9937810Z         self,
2025-01-14T13:16:42.9937870Z         simulation_state,
2025-01-14T13:16:42.9937920Z         opacity_state,
2025-01-14T13:16:42.9937980Z         macro_atom_state,
2025-01-14T13:16:42.9938320Z         plasma,
2025-01-14T13:16:42.9938580Z         no_of_packets,
2025-01-14T13:16:42.9938840Z         no_of_virtual_packets=0,
2025-01-14T13:16:42.9939090Z         iteration=0,
2025-01-14T13:16:42.9939150Z     ):
2025-01-14T13:16:42.9939710Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:42.9939790Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:42.9939850Z         else:
2025-01-14T13:16:42.9939900Z             gamma_shape = (0, 0)
2025-01-14T13:16:42.9939950Z     
2025-01-14T13:16:42.9940060Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:42.9940140Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:42.9940180Z         )
2025-01-14T13:16:42.9940280Z     
2025-01-14T13:16:42.9940380Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:42.9940470Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:42.9940600Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:42.9940650Z         else:
2025-01-14T13:16:42.9940700Z             continuum_state = None
2025-01-14T13:16:42.9940780Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:42.9940870Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:42.9940940Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:42.9941100Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:42.9941190Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:42.9941250Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:42.9941320Z             continuum_state=continuum_state,
2025-01-14T13:16:42.9941370Z         ).to_numba(
2025-01-14T13:16:42.9941430Z             macro_atom_state,
2025-01-14T13:16:42.9941490Z             self.line_interaction_type,
2025-01-14T13:16:42.9941540Z         )
2025-01-14T13:16:42.9941610Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:42.9941830Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:42.9941870Z         ]
2025-01-14T13:16:42.9942120Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:42.9942130Z 
2025-01-14T13:16:42.9942250Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:42.9943500Z ____________ test_last_interaction_properties[r_in_use-r_to_check] _____________
2025-01-14T13:16:42.9943530Z 
2025-01-14T13:16:42.9943760Z expected = 'r_in_use', obtained = 'r_to_check'
2025-01-14T13:16:42.9944960Z request = <FixtureRequest for <Function test_last_interaction_properties[r_in_use-r_to_check]>>
2025-01-14T13:16:42.9944990Z 
2025-01-14T13:16:42.9945180Z     @pytest.mark.parametrize(
2025-01-14T13:16:42.9945360Z         "expected,obtained",
2025-01-14T13:16:42.9945500Z         [
2025-01-14T13:16:42.9945640Z             (
2025-01-14T13:16:42.9946160Z                 "interaction_type_in_use",
2025-01-14T13:16:42.9946270Z                 "interaction_type_to_check",
2025-01-14T13:16:42.9946330Z             ),
2025-01-14T13:16:42.9946370Z             (
2025-01-14T13:16:42.9946440Z                 "shell_id_in_use",
2025-01-14T13:16:42.9946500Z                 "shell_id_to_check",
2025-01-14T13:16:42.9946540Z             ),
2025-01-14T13:16:42.9946590Z             (
2025-01-14T13:16:42.9946640Z                 "r_in_use",
2025-01-14T13:16:42.9946690Z                 "r_to_check",
2025-01-14T13:16:42.9946740Z             ),
2025-01-14T13:16:42.9946820Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:42.9946880Z         ],
2025-01-14T13:16:42.9946920Z     )
2025-01-14T13:16:42.9947060Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:42.9947160Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.9947160Z 
2025-01-14T13:16:42.9947350Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:42.9947440Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:42.9947650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9955720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9955960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9956040Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9956240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9956340Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9956820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9956900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9957110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9957160Z     raise exc
2025-01-14T13:16:42.9957370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9957440Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9957640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9958320Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9958520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9958680Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9958880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9959020Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9959270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.9959350Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9959630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9959680Z     yield
2025-01-14T13:16:42.9959940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.9960030Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9960560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9960620Z     yield
2025-01-14T13:16:42.9960850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:42.9960930Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:42.9961130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:42.9961180Z     yield
2025-01-14T13:16:42.9961410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:42.9961460Z     return (yield)
2025-01-14T13:16:42.9961700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:42.9961740Z     return (yield)
2025-01-14T13:16:42.9961970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:42.9962020Z     raise e
2025-01-14T13:16:42.9962240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:42.9962290Z     item.runtest()
2025-01-14T13:16:42.9962490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:42.9962580Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:42.9962770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9963020Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9963220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9963360Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9963580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:42.9963660Z     result = testfunction(**testargs)
2025-01-14T13:16:42.9967470Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:42.9967730Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:42.9968330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:42.9968600Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:42.9969280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9969490Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9970350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:42.9970460Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:42.9970710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:42.9970790Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:42.9970980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:42.9971030Z     raise exc
2025-01-14T13:16:42.9971230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:42.9971290Z     result: Optional[TResult] = func()
2025-01-14T13:16:42.9971480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:42.9971620Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:42.9971820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:42.9971980Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:42.9972450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:42.9972600Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:42.9995270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:42.9995430Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:42.9995710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:42.9996330Z     yield
2025-01-14T13:16:42.9997130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:42.9997380Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:42.9998480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:42.9998630Z     yield
2025-01-14T13:16:42.9999950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0000220Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0000820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0000960Z     yield
2025-01-14T13:16:43.0002510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0003800Z     return (yield)
2025-01-14T13:16:43.0004460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0004630Z     return (yield)
2025-01-14T13:16:43.0005720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0005840Z     raise e
2025-01-14T13:16:43.0006070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0006140Z     item.runtest()
2025-01-14T13:16:43.0007760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0008410Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0009170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0009810Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0010060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0010210Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0010880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0010980Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0011280Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:43.0011390Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0011640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0011740Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0012000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0012170Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0012380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0012480Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0012740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0012990Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0013210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0013270Z     raise exc
2025-01-14T13:16:43.0013480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0013700Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0013940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0014080Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0014280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0014440Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0015010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0015530Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0017010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0017460Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0018390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0019050Z     yield
2025-01-14T13:16:43.0020980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0021270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0021480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0021540Z     yield
2025-01-14T13:16:43.0021770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0021830Z     return (yield)
2025-01-14T13:16:43.0022080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0022300Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0022590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0022640Z     yield
2025-01-14T13:16:43.0022870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0022950Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0023170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0023530Z     raise exc
2025-01-14T13:16:43.0023730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0023780Z     col.setup()
2025-01-14T13:16:43.0023990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0024060Z     self._request._fillfixtures()
2025-01-14T13:16:43.0024290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0024400Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0024630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0024900Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0025970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0026080Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0026290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0026400Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0026740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0026830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0027030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0027080Z     raise exc
2025-01-14T13:16:43.0027430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0027510Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0027700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0027830Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0028020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0028180Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0028380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0028510Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0028780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0028870Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0029180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0037640Z     yield
2025-01-14T13:16:43.0038980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0039350Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0039970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0040140Z     yield
2025-01-14T13:16:43.0040800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0041410Z     return (yield)
2025-01-14T13:16:43.0043280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0043550Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0044570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0044770Z     yield
2025-01-14T13:16:43.0045410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0046860Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0047390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0047540Z     raise exc
2025-01-14T13:16:43.0048070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0048230Z     col.setup()
2025-01-14T13:16:43.0048760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0048930Z     self._request._fillfixtures()
2025-01-14T13:16:43.0049520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0049810Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0051260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0051470Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0051780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0051870Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0053780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0053910Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0054160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0054230Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0054430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0054480Z     raise exc
2025-01-14T13:16:43.0054680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0054750Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0054950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0055100Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0055300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0055460Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0055670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0055800Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0056070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0056360Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0056680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0056730Z     yield
2025-01-14T13:16:43.0057110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0057240Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0057470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0059650Z     yield
2025-01-14T13:16:43.0061350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0061420Z     return (yield)
2025-01-14T13:16:43.0061670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0061760Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0062050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0062530Z     yield
2025-01-14T13:16:43.0062770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0062860Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0063070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0063140Z     raise exc
2025-01-14T13:16:43.0063350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0063420Z     col.setup()
2025-01-14T13:16:43.0063670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0063760Z     self._request._fillfixtures()
2025-01-14T13:16:43.0064020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0064140Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0064400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0064500Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0064740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0067580Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0068360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0068670Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0069350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0069630Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0070210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0070370Z     raise exc
2025-01-14T13:16:43.0071320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0072420Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0072660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0072800Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0073020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0073190Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0073410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0073560Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0074730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0074820Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0075800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0076180Z     yield
2025-01-14T13:16:43.0076900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0077760Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0079010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0079200Z     yield
2025-01-14T13:16:43.0079970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0080140Z     return (yield)
2025-01-14T13:16:43.0080880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0081130Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0082370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0082530Z     yield
2025-01-14T13:16:43.0083200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0083410Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0083940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0084090Z     raise exc
2025-01-14T13:16:43.0084610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0084750Z     col.setup()
2025-01-14T13:16:43.0085310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0085540Z     self._request._fillfixtures()
2025-01-14T13:16:43.0086500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0087500Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0090210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0090860Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0091150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0091240Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0091470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0091580Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0091830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0091930Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0092170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0092230Z     raise exc
2025-01-14T13:16:43.0092730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0092820Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0093060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0093200Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0093400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0093850Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0094590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0096960Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0097240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0097330Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0097640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0098040Z     yield
2025-01-14T13:16:43.0098280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0098360Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0098570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0098610Z     yield
2025-01-14T13:16:43.0099420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0099650Z     return (yield)
2025-01-14T13:16:43.0100590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0100680Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0100970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0101020Z     yield
2025-01-14T13:16:43.0101250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0101320Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0101510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0101550Z     raise exc
2025-01-14T13:16:43.0102420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0102500Z     col.setup()
2025-01-14T13:16:43.0102700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0102760Z     self._request._fillfixtures()
2025-01-14T13:16:43.0102990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0103180Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0103400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0103700Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0103960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0104040Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0104230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0104340Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0104570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0104650Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0104840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0104890Z     raise exc
2025-01-14T13:16:43.0105090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0105160Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0105350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0105480Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0105690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0107460Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0108540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0109160Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0110120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0110270Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0111670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0111860Z     yield
2025-01-14T13:16:43.0112520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0112780Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0113510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0113670Z     yield
2025-01-14T13:16:43.0114330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0115960Z     return (yield)
2025-01-14T13:16:43.0116910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0117230Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0119030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0119570Z     yield
2025-01-14T13:16:43.0119880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0119960Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0120440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0122210Z     raise exc
2025-01-14T13:16:43.0122790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0122980Z     col.setup()
2025-01-14T13:16:43.0123860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0124050Z     self._request._fillfixtures()
2025-01-14T13:16:43.0124640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0124770Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0124990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0125090Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0125330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0125410Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0126860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0127000Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0127240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0127310Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0127510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0127560Z     raise exc
2025-01-14T13:16:43.0127760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0128720Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0129610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0130020Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0131670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0132140Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0132740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0133160Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0133910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0145530Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0146390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0146540Z     yield
2025-01-14T13:16:43.0147200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0147430Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0148030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0148600Z     yield
2025-01-14T13:16:43.0149270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0149460Z     return (yield)
2025-01-14T13:16:43.0150500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0150660Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0150950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0151000Z     yield
2025-01-14T13:16:43.0151230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0151300Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0151500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0151550Z     raise exc
2025-01-14T13:16:43.0151740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0151790Z     col.setup()
2025-01-14T13:16:43.0160970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0161530Z     self._request._fillfixtures()
2025-01-14T13:16:43.0162770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0163150Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0164160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0164540Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0165310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0165440Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0165650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0165770Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0166020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0166100Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0166300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0166340Z     raise exc
2025-01-14T13:16:43.0166770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0166850Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0167340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0167480Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0167680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0167860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0168080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0168350Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0168620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0168710Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0169030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0169080Z     yield
2025-01-14T13:16:43.0169330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0169530Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0169750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0169800Z     yield
2025-01-14T13:16:43.0170040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0170090Z     return (yield)
2025-01-14T13:16:43.0170810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0170910Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0171200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0171240Z     yield
2025-01-14T13:16:43.0172030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0173050Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0173430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0173490Z     raise exc
2025-01-14T13:16:43.0173750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0173800Z     col.setup()
2025-01-14T13:16:43.0174010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0174080Z     self._request._fillfixtures()
2025-01-14T13:16:43.0174290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0174400Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0174620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0174710Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0174960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0175040Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0175260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0175360Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0175610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0175680Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0176660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0176860Z     raise exc
2025-01-14T13:16:43.0178300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0179500Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0180540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0181200Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0181830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0183000Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0183350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0183490Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0183760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0183850Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0184160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0184300Z     yield
2025-01-14T13:16:43.0184540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0184630Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0186540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0186790Z     yield
2025-01-14T13:16:43.0188630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0188730Z     return (yield)
2025-01-14T13:16:43.0189010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0189100Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0189730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0189790Z     yield
2025-01-14T13:16:43.0190040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0190120Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0190430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0190490Z     raise exc
2025-01-14T13:16:43.0190690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0190760Z     col.setup()
2025-01-14T13:16:43.0190960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0191040Z     self._request._fillfixtures()
2025-01-14T13:16:43.0191250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0191370Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0192690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0193010Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0193720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0193840Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0194060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0194170Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0194410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0194490Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0195930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0196010Z     raise exc
2025-01-14T13:16:43.0197400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0197620Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0198180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0198770Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0199900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0200340Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0200890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0201260Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0202030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0210920Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0212180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0212870Z     yield
2025-01-14T13:16:43.0213170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0213270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0213490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0213560Z     yield
2025-01-14T13:16:43.0213880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0215950Z     return (yield)
2025-01-14T13:16:43.0222260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0222370Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0222660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0222700Z     yield
2025-01-14T13:16:43.0223090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0223170Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0224340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0224410Z     raise exc
2025-01-14T13:16:43.0224590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0224650Z     col.setup()
2025-01-14T13:16:43.0225140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0225620Z     self._request._fillfixtures()
2025-01-14T13:16:43.0225890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0227190Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0227460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0227570Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0228920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0229030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0229250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0229350Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0229600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0229930Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0230130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0230180Z     raise exc
2025-01-14T13:16:43.0230370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0230440Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0231770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0233010Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0233230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0233730Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0234620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0234770Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0236040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0236420Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0237360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0237790Z     yield
2025-01-14T13:16:43.0238080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0238180Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0238400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0238450Z     yield
2025-01-14T13:16:43.0238970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0239030Z     return (yield)
2025-01-14T13:16:43.0239310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0239390Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0239680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0241480Z     yield
2025-01-14T13:16:43.0241740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0241820Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0242020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0242070Z     raise exc
2025-01-14T13:16:43.0243320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0243400Z     col.setup()
2025-01-14T13:16:43.0243590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0243650Z     self._request._fillfixtures()
2025-01-14T13:16:43.0243860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0243970Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0244190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0244290Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0254610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0254720Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0254930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0256130Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0256820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0258510Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0258770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0258820Z     raise exc
2025-01-14T13:16:43.0259020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0259180Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0259390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0259550Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0259760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0259930Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0260140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0260670Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0260960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0261080Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0261410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0261460Z     yield
2025-01-14T13:16:43.0261690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0261790Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0262030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0262070Z     yield
2025-01-14T13:16:43.0262340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0262400Z     return (yield)
2025-01-14T13:16:43.0262680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0262870Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0263200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0263250Z     yield
2025-01-14T13:16:43.0263520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0263640Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0263900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0263960Z     raise exc
2025-01-14T13:16:43.0264150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0264200Z     col.setup()
2025-01-14T13:16:43.0264400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0264460Z     self._request._fillfixtures()
2025-01-14T13:16:43.0264670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0264780Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0265100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0265210Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0265460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0265650Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0265850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0265950Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0266180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0266260Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0266470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0266620Z     raise exc
2025-01-14T13:16:43.0266830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0266920Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0267140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0267300Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0267490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0267750Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0267950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0268090Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0268370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0268470Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0268760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0268810Z     yield
2025-01-14T13:16:43.0269040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0269110Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0269330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0269370Z     yield
2025-01-14T13:16:43.0269600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0269720Z     return (yield)
2025-01-14T13:16:43.0269970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0270040Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0270340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0270380Z     yield
2025-01-14T13:16:43.0270610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0270690Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0270880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0270930Z     raise exc
2025-01-14T13:16:43.0272580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0272700Z     col.setup()
2025-01-14T13:16:43.0272930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0273010Z     self._request._fillfixtures()
2025-01-14T13:16:43.0273260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0273400Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0273640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0273740Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0274330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0274410Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0274630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0274750Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0275000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0275110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0275330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0275380Z     raise exc
2025-01-14T13:16:43.0275610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0275680Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0275870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0276010Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0277320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0277480Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0277690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0277840Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0278100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0278190Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0278890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0280480Z     yield
2025-01-14T13:16:43.0280770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0280860Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0281080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0281480Z     yield
2025-01-14T13:16:43.0282090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0282180Z     return (yield)
2025-01-14T13:16:43.0282440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0282520Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0282830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0282890Z     yield
2025-01-14T13:16:43.0283130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0283210Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0283400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0283460Z     raise exc
2025-01-14T13:16:43.0283660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0283720Z     col.setup()
2025-01-14T13:16:43.0283910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0283970Z     self._request._fillfixtures()
2025-01-14T13:16:43.0284180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0284280Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0284630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0284730Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0284970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0285040Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0285240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0285510Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0285740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0285810Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0286010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0286050Z     raise exc
2025-01-14T13:16:43.0286910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0286990Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0287290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0287420Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0287610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0287780Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0287980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0291250Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0294840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0295190Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0296110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0296400Z     yield
2025-01-14T13:16:43.0297070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0298230Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0299020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0299170Z     yield
2025-01-14T13:16:43.0299890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0299990Z     return (yield)
2025-01-14T13:16:43.0300600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0300820Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0302360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0302440Z     yield
2025-01-14T13:16:43.0302770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0302860Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0303060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0303120Z     raise exc
2025-01-14T13:16:43.0304220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0304310Z     col.setup()
2025-01-14T13:16:43.0304510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0304570Z     self._request._fillfixtures()
2025-01-14T13:16:43.0305400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0308300Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0309320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0309590Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0310280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0310510Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0311900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0314850Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0315610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0316110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0317970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0318060Z     raise exc
2025-01-14T13:16:43.0318460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0318530Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0318730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0318880Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0319070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0321880Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0322460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0324790Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0325160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0329370Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0329730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0330310Z     yield
2025-01-14T13:16:43.0330550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0330640Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0339170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0339230Z     yield
2025-01-14T13:16:43.0339470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0339520Z     return (yield)
2025-01-14T13:16:43.0339780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0339870Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0340150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0340200Z     yield
2025-01-14T13:16:43.0340430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0340500Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0341500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0344060Z     raise exc
2025-01-14T13:16:43.0344300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0344350Z     col.setup()
2025-01-14T13:16:43.0344550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0344870Z     self._request._fillfixtures()
2025-01-14T13:16:43.0345090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0345190Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0345420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0345520Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0345860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0345940Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0346920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0347020Z     raise exc
2025-01-14T13:16:43.0347230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0347300Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0347510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0347760Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0347950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0348120Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0348330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0348470Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0348740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0349040Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0349390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0349440Z     yield
2025-01-14T13:16:43.0349690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0349770Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0350090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0350140Z     yield
2025-01-14T13:16:43.0350380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0350430Z     return (yield)
2025-01-14T13:16:43.0350690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0350760Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0351050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0351090Z     yield
2025-01-14T13:16:43.0351320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0351400Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0351580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0351630Z     raise exc
2025-01-14T13:16:43.0351820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0351870Z     col.setup()
2025-01-14T13:16:43.0352230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0352300Z     self._request._fillfixtures()
2025-01-14T13:16:43.0352520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0352950Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0353170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0353280Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0353540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0353620Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0353830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0353940Z     raise exc
2025-01-14T13:16:43.0354140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0354210Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0354420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0354710Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0355820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0357080Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0359360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0361180Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0362400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0362510Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0364990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0365060Z     yield
2025-01-14T13:16:43.0365300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0365390Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0365600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0365650Z     yield
2025-01-14T13:16:43.0365890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0366060Z     return (yield)
2025-01-14T13:16:43.0366330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0366420Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0369550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0369810Z     yield
2025-01-14T13:16:43.0370550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0370780Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0371430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0371610Z     raise exc
2025-01-14T13:16:43.0372130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0372300Z     col.setup()
2025-01-14T13:16:43.0372830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0373020Z     self._request._fillfixtures()
2025-01-14T13:16:43.0373660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0373960Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0374630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0378510Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0379390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0379630Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0380190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0380340Z     raise exc
2025-01-14T13:16:43.0380890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0381890Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0382430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0382780Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0383310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0383740Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0384300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0385190Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0386000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0386270Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0388470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0388700Z     yield
2025-01-14T13:16:43.0389670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0389850Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0390060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0390120Z     yield
2025-01-14T13:16:43.0390340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0390400Z     return (yield)
2025-01-14T13:16:43.0390650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0391090Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0391370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0391430Z     yield
2025-01-14T13:16:43.0391660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0391730Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0391940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0391980Z     raise exc
2025-01-14T13:16:43.0392170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0392220Z     col.setup()
2025-01-14T13:16:43.0392420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0392480Z     self._request._fillfixtures()
2025-01-14T13:16:43.0392690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0392800Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0393010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0393110Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0393350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0393430Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0393820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0393870Z     raise exc
2025-01-14T13:16:43.0394070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0394140Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0394330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0394460Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0394780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0394970Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0395190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0395330Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0395670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0395900Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0396240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0396300Z     yield
2025-01-14T13:16:43.0396530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0396610Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0398470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0398710Z     yield
2025-01-14T13:16:43.0399530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0399620Z     return (yield)
2025-01-14T13:16:43.0399880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0399970Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0400250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0400440Z     yield
2025-01-14T13:16:43.0400680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0400760Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0400950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0401310Z     raise exc
2025-01-14T13:16:43.0401520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0401570Z     col.setup()
2025-01-14T13:16:43.0401760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0401830Z     self._request._fillfixtures()
2025-01-14T13:16:43.0402040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0402150Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0402360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0402460Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0402720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0402810Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0403020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0403060Z     raise exc
2025-01-14T13:16:43.0403400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0403620Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0403800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0403940Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0404140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0404310Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0404560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0404690Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0404970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0405050Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0405370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0405490Z     yield
2025-01-14T13:16:43.0405730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0406300Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0407180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0407340Z     yield
2025-01-14T13:16:43.0408620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0408810Z     return (yield)
2025-01-14T13:16:43.0409350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0409460Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0409740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0409790Z     yield
2025-01-14T13:16:43.0410010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0410090Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0410280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0410670Z     raise exc
2025-01-14T13:16:43.0410870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0410930Z     col.setup()
2025-01-14T13:16:43.0411120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0411180Z     self._request._fillfixtures()
2025-01-14T13:16:43.0411400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0411510Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0411730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0411820Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0412060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0412140Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0412340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0412450Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0412690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0412770Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0412960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0413370Z     raise exc
2025-01-14T13:16:43.0413560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0413640Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0413830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0413970Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0414160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0414370Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0414570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0414700Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0414970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0415060Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0415700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0415750Z     yield
2025-01-14T13:16:43.0415980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0416060Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0416270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0416320Z     yield
2025-01-14T13:16:43.0416550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0416600Z     return (yield)
2025-01-14T13:16:43.0417000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0417090Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0417370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0417410Z     yield
2025-01-14T13:16:43.0417640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0417780Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0417970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0418010Z     raise exc
2025-01-14T13:16:43.0418200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0418240Z     col.setup()
2025-01-14T13:16:43.0418430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0418490Z     self._request._fillfixtures()
2025-01-14T13:16:43.0418710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0418810Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0419450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0419590Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0419840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0419910Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0420110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0420210Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0420440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0420680Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0420870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0420920Z     raise exc
2025-01-14T13:16:43.0421120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0421190Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0421380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0421700Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0421900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0422050Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0422260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0422390Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0422670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0422850Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0423670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0424060Z     yield
2025-01-14T13:16:43.0425010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0425250Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0425880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0426030Z     yield
2025-01-14T13:16:43.0426930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0427180Z     return (yield)
2025-01-14T13:16:43.0428010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0428130Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0428420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0428720Z     yield
2025-01-14T13:16:43.0428950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0429030Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0429810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0429870Z     raise exc
2025-01-14T13:16:43.0430060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0430120Z     col.setup()
2025-01-14T13:16:43.0430310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0430370Z     self._request._fillfixtures()
2025-01-14T13:16:43.0430580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0430680Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0430900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0431000Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0431230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0431310Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0431500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0431740Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0431970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0432050Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0432240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0432300Z     raise exc
2025-01-14T13:16:43.0432490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0432600Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0438300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0438460Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0438650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0438810Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0439010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0439290Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0439560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0439650Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0439960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0440010Z     yield
2025-01-14T13:16:43.0440230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0440310Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0440510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0440560Z     yield
2025-01-14T13:16:43.0440790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0440840Z     return (yield)
2025-01-14T13:16:43.0441080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0441210Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0441490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0441550Z     yield
2025-01-14T13:16:43.0441780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0441850Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0442030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0442080Z     raise exc
2025-01-14T13:16:43.0442270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0442320Z     col.setup()
2025-01-14T13:16:43.0442510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0442570Z     self._request._fillfixtures()
2025-01-14T13:16:43.0442790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0442900Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0443110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0443210Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0443440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0443520Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0443810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0443910Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0444150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0444230Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0444600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0444720Z     raise exc
2025-01-14T13:16:43.0444910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0444980Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0445170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0445300Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0445490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0445650Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0445910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0446050Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0446320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0446400Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0446710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0446750Z     yield
2025-01-14T13:16:43.0446980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0447060Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0447260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0447310Z     yield
2025-01-14T13:16:43.0447660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0447770Z     return (yield)
2025-01-14T13:16:43.0448020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0448100Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0448380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0448420Z     yield
2025-01-14T13:16:43.0448650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0448720Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0448900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0448950Z     raise exc
2025-01-14T13:16:43.0449150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0449190Z     col.setup()
2025-01-14T13:16:43.0449400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0449460Z     self._request._fillfixtures()
2025-01-14T13:16:43.0449680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0449790Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0450000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0450100Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0450740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0450820Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0451020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0451120Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0451360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0451500Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0451940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0451990Z     raise exc
2025-01-14T13:16:43.0452190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0452250Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0452440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0452570Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0453290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0453450Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0453660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0453790Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0454060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0454140Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0454440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0454490Z     yield
2025-01-14T13:16:43.0454720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0454800Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0455000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0455120Z     yield
2025-01-14T13:16:43.0455350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0455410Z     return (yield)
2025-01-14T13:16:43.0455660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0455730Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0456010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0456050Z     yield
2025-01-14T13:16:43.0456280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0456360Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0456550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0456600Z     raise exc
2025-01-14T13:16:43.0456780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0456830Z     col.setup()
2025-01-14T13:16:43.0457020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0457090Z     self._request._fillfixtures()
2025-01-14T13:16:43.0457310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0457410Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0457630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0457820Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0458060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0458130Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0458330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0458430Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0458940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0459010Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0459210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0459250Z     raise exc
2025-01-14T13:16:43.0459530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0459600Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0459790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0460020Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0460220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0460370Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0460570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0460700Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0460960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0461050Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0461360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0461410Z     yield
2025-01-14T13:16:43.0461630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0461700Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0462120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0462170Z     yield
2025-01-14T13:16:43.0462390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0462440Z     return (yield)
2025-01-14T13:16:43.0462690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0462760Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0463050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0463090Z     yield
2025-01-14T13:16:43.0463310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0463380Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0463570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0463620Z     raise exc
2025-01-14T13:16:43.0464420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0464520Z     col.setup()
2025-01-14T13:16:43.0464710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0464780Z     self._request._fillfixtures()
2025-01-14T13:16:43.0464990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0465280Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0465490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0465590Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0465820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0465900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0466130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0466230Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0466460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0466530Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0466750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0466790Z     raise exc
2025-01-14T13:16:43.0466990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0467120Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0467310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0467440Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0467630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0467780Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0467980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0468110Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0468370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0468460Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0468770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0468820Z     yield
2025-01-14T13:16:43.0469090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0469170Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0469370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0469420Z     yield
2025-01-14T13:16:43.0469650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0469700Z     return (yield)
2025-01-14T13:16:43.0469960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0470040Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0470320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0470370Z     yield
2025-01-14T13:16:43.0470600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0470670Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0470860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0470900Z     raise exc
2025-01-14T13:16:43.0471090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0471140Z     col.setup()
2025-01-14T13:16:43.0471330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0471460Z     self._request._fillfixtures()
2025-01-14T13:16:43.0471670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0471780Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0472130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0472240Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0472470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0472600Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0472790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0472890Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0473130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0473200Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0473400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0473500Z     raise exc
2025-01-14T13:16:43.0473700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0473760Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0473950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0474090Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0474280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0474430Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0474620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0474760Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0475030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0475120Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0475430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0475510Z     yield
2025-01-14T13:16:43.0475870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0475950Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0476160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0476200Z     yield
2025-01-14T13:16:43.0476430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0476480Z     return (yield)
2025-01-14T13:16:43.0476730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0476810Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0477220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0477280Z     yield
2025-01-14T13:16:43.0477510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0477580Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0477770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0477810Z     raise exc
2025-01-14T13:16:43.0477990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0478410Z     col.setup()
2025-01-14T13:16:43.0478600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0478670Z     self._request._fillfixtures()
2025-01-14T13:16:43.0478880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0478980Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0479200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0479360Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0479590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0479670Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0479860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0479970Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0480210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0480580Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0480790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0480830Z     raise exc
2025-01-14T13:16:43.0481030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0481100Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0481290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0481420Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0483020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0483220Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0483430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0483560Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0483820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0484040Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0484340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0484390Z     yield
2025-01-14T13:16:43.0484620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0484700Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0484900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0484950Z     yield
2025-01-14T13:16:43.0485180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0485230Z     return (yield)
2025-01-14T13:16:43.0485490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0485560Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0485850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0485900Z     yield
2025-01-14T13:16:43.0486120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0486180Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0486380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0486550Z     raise exc
2025-01-14T13:16:43.0486740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0486790Z     col.setup()
2025-01-14T13:16:43.0486970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0487040Z     self._request._fillfixtures()
2025-01-14T13:16:43.0487250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0487600Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0487900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0488000Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0488230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0488310Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0488510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0488710Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0488950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0489020Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0489250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0489310Z     raise exc
2025-01-14T13:16:43.0489500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0489570Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0489770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0489900Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0490090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0490250Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0490440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0490760Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0491030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0491120Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0491420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0491470Z     yield
2025-01-14T13:16:43.0491690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0491770Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0491980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0492020Z     yield
2025-01-14T13:16:43.0492250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0492300Z     return (yield)
2025-01-14T13:16:43.0492550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0492630Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0492910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0492950Z     yield
2025-01-14T13:16:43.0493180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0493330Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0493530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0493580Z     raise exc
2025-01-14T13:16:43.0493760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0493810Z     col.setup()
2025-01-14T13:16:43.0494000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0494070Z     self._request._fillfixtures()
2025-01-14T13:16:43.0494310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0494410Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0494630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0494720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0494950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0495030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0495290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0495390Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0495630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0495710Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0495900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:43.0496040Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:43.0496230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0496380Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0496580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0496720Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0498760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:43.0499800Z     return (yield)
2025-01-14T13:16:43.0500480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:43.0500790Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:43.0501400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:43.0501600Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:43.0502060Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:43.0502230Z     sim.iterate(10)
2025-01-14T13:16:43.0502430Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0502770Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0503020Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0503030Z 
2025-01-14T13:16:43.0503590Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:43.0504020Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:43.0504490Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:43.0505080Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:43.0505400Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:43.0505690Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0506160Z 
2025-01-14T13:16:43.0506380Z     def initialize_transport_state(
2025-01-14T13:16:43.0506510Z         self,
2025-01-14T13:16:43.0507850Z         simulation_state,
2025-01-14T13:16:43.0507960Z         opacity_state,
2025-01-14T13:16:43.0508020Z         macro_atom_state,
2025-01-14T13:16:43.0508070Z         plasma,
2025-01-14T13:16:43.0508120Z         no_of_packets,
2025-01-14T13:16:43.0508180Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0508230Z         iteration=0,
2025-01-14T13:16:43.0508270Z     ):
2025-01-14T13:16:43.0508510Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0508590Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0508630Z         else:
2025-01-14T13:16:43.0508690Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0508730Z     
2025-01-14T13:16:43.0508840Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0508920Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0508960Z         )
2025-01-14T13:16:43.0509010Z     
2025-01-14T13:16:43.0509110Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0509310Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0509440Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0509480Z         else:
2025-01-14T13:16:43.0509540Z             continuum_state = None
2025-01-14T13:16:43.0509620Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0509710Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0509780Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0509860Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0509930Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0510000Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0510070Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0510120Z         ).to_numba(
2025-01-14T13:16:43.0510170Z             macro_atom_state,
2025-01-14T13:16:43.0510240Z             self.line_interaction_type,
2025-01-14T13:16:43.0510280Z         )
2025-01-14T13:16:43.0510350Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0510570Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0510670Z         ]
2025-01-14T13:16:43.0510920Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0510930Z 
2025-01-14T13:16:43.0511180Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0511350Z ______ test_last_interaction_properties[nu_packet_collection-nu_to_check] ______
2025-01-14T13:16:43.0511350Z 
2025-01-14T13:16:43.0511460Z expected = 'nu_packet_collection', obtained = 'nu_to_check'
2025-01-14T13:16:43.0511690Z request = <FixtureRequest for <Function test_last_interaction_properties[nu_packet_collection-nu_to_check]>>
2025-01-14T13:16:43.0511690Z 
2025-01-14T13:16:43.0511760Z     @pytest.mark.parametrize(
2025-01-14T13:16:43.0511820Z         "expected,obtained",
2025-01-14T13:16:43.0511860Z         [
2025-01-14T13:16:43.0511900Z             (
2025-01-14T13:16:43.0511970Z                 "interaction_type_in_use",
2025-01-14T13:16:43.0512030Z                 "interaction_type_to_check",
2025-01-14T13:16:43.0512080Z             ),
2025-01-14T13:16:43.0512120Z             (
2025-01-14T13:16:43.0512180Z                 "shell_id_in_use",
2025-01-14T13:16:43.0512230Z                 "shell_id_to_check",
2025-01-14T13:16:43.0512280Z             ),
2025-01-14T13:16:43.0512320Z             (
2025-01-14T13:16:43.0512370Z                 "r_in_use",
2025-01-14T13:16:43.0512420Z                 "r_to_check",
2025-01-14T13:16:43.0512460Z             ),
2025-01-14T13:16:43.0512540Z             ("nu_packet_collection", "nu_to_check"),
2025-01-14T13:16:43.0512590Z         ],
2025-01-14T13:16:43.0512950Z     )
2025-01-14T13:16:43.0513080Z     def test_last_interaction_properties(expected, obtained, request):
2025-01-14T13:16:43.0513170Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0513180Z 
2025-01-14T13:16:43.0513360Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: 
2025-01-14T13:16:43.0513450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0513670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0513810Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0514050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0514120Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0514330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0514420Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0514660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0514960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0515170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0515210Z     raise exc
2025-01-14T13:16:43.0515410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0515470Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0515670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0515800Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0515990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0516140Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0516340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0516480Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0516720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0516850Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0517130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0517170Z     yield
2025-01-14T13:16:43.0517430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0517520Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0517820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0517860Z     yield
2025-01-14T13:16:43.0518090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0518160Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0518370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0518410Z     yield
2025-01-14T13:16:43.0518630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0518680Z     return (yield)
2025-01-14T13:16:43.0518910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0518960Z     return (yield)
2025-01-14T13:16:43.0519180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0519300Z     raise e
2025-01-14T13:16:43.0519820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0519880Z     item.runtest()
2025-01-14T13:16:43.0520080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0520170Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0520360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0520700Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0520890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0521030Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0521240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0521310Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0521580Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:43.0521740Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0521960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0522050Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0522290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0522360Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0522560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0522650Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0522880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0522960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0523150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0523210Z     raise exc
2025-01-14T13:16:43.0523530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0523790Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0523990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0524120Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0524310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0524460Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0524660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0524800Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0525050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0525120Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0525400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0525440Z     yield
2025-01-14T13:16:43.0525710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0525790Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0526100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0526140Z     yield
2025-01-14T13:16:43.0531710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0531830Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0532050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0532090Z     yield
2025-01-14T13:16:43.0532310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0532370Z     return (yield)
2025-01-14T13:16:43.0532710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0532910Z     return (yield)
2025-01-14T13:16:43.0533130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0533180Z     raise e
2025-01-14T13:16:43.0533400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0533450Z     item.runtest()
2025-01-14T13:16:43.0533650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0533830Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0534020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0534180Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0534380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0534510Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0534730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0534800Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0535070Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:43.0535160Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0535370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0535460Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0535690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0535810Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0536010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0536110Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0536340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0536420Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0536610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0536660Z     raise exc
2025-01-14T13:16:43.0536850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0536910Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0537100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0537230Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0537420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0537570Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0537770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0537900Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0538230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0538310Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0538580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0538630Z     yield
2025-01-14T13:16:43.0538890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0539000Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0539300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0539350Z     yield
2025-01-14T13:16:43.0539570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0539720Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0539930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0540040Z     yield
2025-01-14T13:16:43.0540270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0540310Z     return (yield)
2025-01-14T13:16:43.0540540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0540590Z     return (yield)
2025-01-14T13:16:43.0540820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0540860Z     raise e
2025-01-14T13:16:43.0541080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0541130Z     item.runtest()
2025-01-14T13:16:43.0541320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0541400Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0541590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0541750Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0541940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0542110Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0542330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0542390Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0542660Z tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py:170: in test_last_interaction_properties
2025-01-14T13:16:43.0542750Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0542960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0543060Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0543290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0543360Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0543570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0543660Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0543890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0543960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0544160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0544210Z     raise exc
2025-01-14T13:16:43.0544660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0544730Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0544920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0545050Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0545240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0545400Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0545650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0545780Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0546040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0546130Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0546430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0546760Z     yield
2025-01-14T13:16:43.0547000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0547080Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0547280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0547330Z     yield
2025-01-14T13:16:43.0547930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0548010Z     return (yield)
2025-01-14T13:16:43.0548270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0548350Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0548640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0549060Z     yield
2025-01-14T13:16:43.0549910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0550120Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0551100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0551260Z     raise exc
2025-01-14T13:16:43.0551770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0551930Z     col.setup()
2025-01-14T13:16:43.0552450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0552630Z     self._request._fillfixtures()
2025-01-14T13:16:43.0553220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0553520Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0554120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0554380Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0555040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0555250Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0555800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0556060Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0556720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0556920Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0558030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0558180Z     raise exc
2025-01-14T13:16:43.0558720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0558920Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0559430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0560090Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0562480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0562940Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0564060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0564440Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0565460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0566690Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0567570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0567720Z     yield
2025-01-14T13:16:43.0568630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0568980Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0569580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0569690Z     yield
2025-01-14T13:16:43.0569930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0569980Z     return (yield)
2025-01-14T13:16:43.0570270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0570360Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0570790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0570840Z     yield
2025-01-14T13:16:43.0571420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0571500Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0571690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0571740Z     raise exc
2025-01-14T13:16:43.0571930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0571980Z     col.setup()
2025-01-14T13:16:43.0572170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0572230Z     self._request._fillfixtures()
2025-01-14T13:16:43.0572440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0572550Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0572770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0572860Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0573110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0573180Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0573380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0573480Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0573720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0573950Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0574160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0574210Z     raise exc
2025-01-14T13:16:43.0574400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0574470Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0574650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0574860Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0575050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0575210Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0575410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0575540Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0575890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0575980Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0576290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0576340Z     yield
2025-01-14T13:16:43.0576570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0576650Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0576860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0576900Z     yield
2025-01-14T13:16:43.0577130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0577180Z     return (yield)
2025-01-14T13:16:43.0577430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0577510Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0577780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0577860Z     yield
2025-01-14T13:16:43.0578080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0578160Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0578340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0578390Z     raise exc
2025-01-14T13:16:43.0578570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0578620Z     col.setup()
2025-01-14T13:16:43.0578810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0578870Z     self._request._fillfixtures()
2025-01-14T13:16:43.0579080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0579190Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0579410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0579500Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0579840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0579920Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0580120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0580280Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0580520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0580590Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0580780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0580830Z     raise exc
2025-01-14T13:16:43.0581020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0581120Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0581310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0581440Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0581630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0581790Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0581990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0582180Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0582450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0582540Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0583050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0583100Z     yield
2025-01-14T13:16:43.0583330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0583400Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0583620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0583660Z     yield
2025-01-14T13:16:43.0583900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0583940Z     return (yield)
2025-01-14T13:16:43.0584240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0584440Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0584720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0584770Z     yield
2025-01-14T13:16:43.0584990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0585440Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0586510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0586720Z     raise exc
2025-01-14T13:16:43.0587240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0587400Z     col.setup()
2025-01-14T13:16:43.0588040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0588440Z     self._request._fillfixtures()
2025-01-14T13:16:43.0589200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0589500Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0590100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0590350Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0591010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0592990Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0593720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0594000Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0594570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0594690Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0594890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0595070Z     raise exc
2025-01-14T13:16:43.0595260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0595330Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0595520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0595650Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0595840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0596300Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0596500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0596630Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0596900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0596980Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0597280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0597330Z     yield
2025-01-14T13:16:43.0597560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0597630Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0597840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0597880Z     yield
2025-01-14T13:16:43.0598110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0598220Z     return (yield)
2025-01-14T13:16:43.0598460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0598540Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0598820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0598870Z     yield
2025-01-14T13:16:43.0599190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0599330Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0599540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0599600Z     raise exc
2025-01-14T13:16:43.0599790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0599840Z     col.setup()
2025-01-14T13:16:43.0600040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0600100Z     self._request._fillfixtures()
2025-01-14T13:16:43.0600320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0600430Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0600650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0600740Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0601170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0601250Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0601450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0601540Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0601790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0602080Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0602280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0602330Z     raise exc
2025-01-14T13:16:43.0602520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0602590Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0602780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0602920Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0603210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0603540Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0603750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0603890Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0604170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0604250Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0604570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0604620Z     yield
2025-01-14T13:16:43.0604850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0604930Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0605140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0605380Z     yield
2025-01-14T13:16:43.0605620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0605670Z     return (yield)
2025-01-14T13:16:43.0605920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0606000Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0606270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0606320Z     yield
2025-01-14T13:16:43.0606540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0606620Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0606810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0606860Z     raise exc
2025-01-14T13:16:43.0607040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0607090Z     col.setup()
2025-01-14T13:16:43.0607420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0607490Z     self._request._fillfixtures()
2025-01-14T13:16:43.0607700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0607810Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0608140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0608230Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0608470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0608550Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0608750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0608890Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0609120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0609200Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0609390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0609440Z     raise exc
2025-01-14T13:16:43.0609630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0609700Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0609950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0610090Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0610280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0610430Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0610630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0610770Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0611040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0611120Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0611430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0611470Z     yield
2025-01-14T13:16:43.0611730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0611840Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0612050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0612100Z     yield
2025-01-14T13:16:43.0612320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0613180Z     return (yield)
2025-01-14T13:16:43.0614230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0614530Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0615340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0615490Z     yield
2025-01-14T13:16:43.0616220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0616430Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0616950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0617110Z     raise exc
2025-01-14T13:16:43.0617630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0617780Z     col.setup()
2025-01-14T13:16:43.0618310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0618490Z     self._request._fillfixtures()
2025-01-14T13:16:43.0619190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0620460Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0621070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0621320Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0621970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0622180Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0622970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0623250Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0623900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0624110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0624650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0624810Z     raise exc
2025-01-14T13:16:43.0625610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0626140Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0626840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0627350Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0628180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0628850Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0629670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0629840Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0630120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0630200Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0630530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0630800Z     yield
2025-01-14T13:16:43.0631040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0631120Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0631330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0631380Z     yield
2025-01-14T13:16:43.0631600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0631660Z     return (yield)
2025-01-14T13:16:43.0631900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0631990Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0632260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0632310Z     yield
2025-01-14T13:16:43.0632530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0632610Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0632790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0632840Z     raise exc
2025-01-14T13:16:43.0633180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0633230Z     col.setup()
2025-01-14T13:16:43.0633420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0633830Z     self._request._fillfixtures()
2025-01-14T13:16:43.0634050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0634160Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0634380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0634470Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0634770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0634850Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0635050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0635150Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0635390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0635470Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0635900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0635950Z     raise exc
2025-01-14T13:16:43.0636150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0636220Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0636420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0636550Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0636740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0636900Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0637110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0637240Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0637520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0637600Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0637950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0637990Z     yield
2025-01-14T13:16:43.0638220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0638290Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0638500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0638540Z     yield
2025-01-14T13:16:43.0638770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0638960Z     return (yield)
2025-01-14T13:16:43.0639220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0639300Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0639580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0639630Z     yield
2025-01-14T13:16:43.0639860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0639930Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0640110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0640150Z     raise exc
2025-01-14T13:16:43.0640340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0640480Z     col.setup()
2025-01-14T13:16:43.0640670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0640730Z     self._request._fillfixtures()
2025-01-14T13:16:43.0640950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0641050Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0641270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0641590Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0641830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0641900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0642090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0642200Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0642430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0642590Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0642790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0642840Z     raise exc
2025-01-14T13:16:43.0643030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0643110Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0643290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0643420Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0643610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0643760Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0643960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0644090Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0644370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0644670Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0645040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0645110Z     yield
2025-01-14T13:16:43.0645350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0645440Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0645640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0645700Z     yield
2025-01-14T13:16:43.0645920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0645970Z     return (yield)
2025-01-14T13:16:43.0646220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0646300Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0646590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0646630Z     yield
2025-01-14T13:16:43.0646860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0646930Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0647300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0647550Z     raise exc
2025-01-14T13:16:43.0647750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0647810Z     col.setup()
2025-01-14T13:16:43.0648020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0648080Z     self._request._fillfixtures()
2025-01-14T13:16:43.0648320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0648500Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0648730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0648820Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0649060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0649150Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0661340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0662720Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0662980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0663070Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0663260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0663320Z     raise exc
2025-01-14T13:16:43.0663510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0663570Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0663770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0663900Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0664090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0664260Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0664460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0664730Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0665010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0665100Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0665400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0665450Z     yield
2025-01-14T13:16:43.0665670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0665750Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0665960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0666010Z     yield
2025-01-14T13:16:43.0666230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0666290Z     return (yield)
2025-01-14T13:16:43.0666540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0666620Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0666890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0666940Z     yield
2025-01-14T13:16:43.0667170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0667540Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0667740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0667790Z     raise exc
2025-01-14T13:16:43.0667980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0668030Z     col.setup()
2025-01-14T13:16:43.0668220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0668370Z     self._request._fillfixtures()
2025-01-14T13:16:43.0668590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0668690Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0668910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0669010Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0669250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0669400Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0669590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0669700Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0669930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0670000Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0670350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0670410Z     raise exc
2025-01-14T13:16:43.0670600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0670660Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0670860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0670990Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0671220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0671390Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0671710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0671850Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0672120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0672210Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0672510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0672550Z     yield
2025-01-14T13:16:43.0672790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0672900Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0673120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0673160Z     yield
2025-01-14T13:16:43.0673390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0673440Z     return (yield)
2025-01-14T13:16:43.0673690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0673770Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0674080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0674370Z     yield
2025-01-14T13:16:43.0674600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0674690Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0674880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0675050Z     raise exc
2025-01-14T13:16:43.0675290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0675430Z     col.setup()
2025-01-14T13:16:43.0675620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0675680Z     self._request._fillfixtures()
2025-01-14T13:16:43.0675890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0676000Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0676210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0676310Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0677040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0677110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0677310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0677410Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0677640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0677730Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0677930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0677970Z     raise exc
2025-01-14T13:16:43.0678170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0678240Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0678460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0678590Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0678840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0678990Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0679200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0679350Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0679630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0679720Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0680040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0680090Z     yield
2025-01-14T13:16:43.0680320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0680400Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0680600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0680660Z     yield
2025-01-14T13:16:43.0680920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0680980Z     return (yield)
2025-01-14T13:16:43.0681250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0681450Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0681730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0681770Z     yield
2025-01-14T13:16:43.0682000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0682080Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0682290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0682570Z     raise exc
2025-01-14T13:16:43.0682760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0682810Z     col.setup()
2025-01-14T13:16:43.0683030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0683110Z     self._request._fillfixtures()
2025-01-14T13:16:43.0683350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0683460Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0683820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0683920Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0684170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0684260Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0684450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0684550Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0684790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0684900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0685120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0685170Z     raise exc
2025-01-14T13:16:43.0685360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0685420Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0685630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0685990Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0686190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0686340Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0686540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0686670Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0686940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0687040Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0687350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0687420Z     yield
2025-01-14T13:16:43.0687650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0687740Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0687940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0687980Z     yield
2025-01-14T13:16:43.0688210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0688410Z     return (yield)
2025-01-14T13:16:43.0688680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0688770Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0689070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0689130Z     yield
2025-01-14T13:16:43.0689360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0689480Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0689670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0689720Z     raise exc
2025-01-14T13:16:43.0689910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0690400Z     col.setup()
2025-01-14T13:16:43.0690630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0690700Z     self._request._fillfixtures()
2025-01-14T13:16:43.0690910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0691270Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0691480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0691580Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0691820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0691900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0692100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0692200Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0692440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0692520Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0692720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0692760Z     raise exc
2025-01-14T13:16:43.0692960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0693060Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0693260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0693390Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0693600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0693770Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0693970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0694110Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0694380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0694480Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0694880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0694950Z     yield
2025-01-14T13:16:43.0695180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0695260Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0695480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0695650Z     yield
2025-01-14T13:16:43.0695880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0695950Z     return (yield)
2025-01-14T13:16:43.0696240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0696320Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0696610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0696710Z     yield
2025-01-14T13:16:43.0696940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0697000Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0697190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0697230Z     raise exc
2025-01-14T13:16:43.0697550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0697630Z     col.setup()
2025-01-14T13:16:43.0697830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0698030Z     self._request._fillfixtures()
2025-01-14T13:16:43.0698250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0698360Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0698580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0698680Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0698920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0699000Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0699220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0699320Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0699560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0699640Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0699840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0699950Z     raise exc
2025-01-14T13:16:43.0700150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0700230Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0700580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0700720Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0700920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0701080Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0701290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0701430Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0701700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0701800Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0702110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0702160Z     yield
2025-01-14T13:16:43.0702410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0702490Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0702910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0703240Z     yield
2025-01-14T13:16:43.0703490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0703540Z     return (yield)
2025-01-14T13:16:43.0703790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0703880Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0704220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0704270Z     yield
2025-01-14T13:16:43.0704500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0704580Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0704770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0704810Z     raise exc
2025-01-14T13:16:43.0704990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0705280Z     col.setup()
2025-01-14T13:16:43.0705470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0705530Z     self._request._fillfixtures()
2025-01-14T13:16:43.0705740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0705840Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0706050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0706150Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0706380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0706450Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0706650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0706690Z     raise exc
2025-01-14T13:16:43.0707480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0708870Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0709680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0710180Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0711950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0712160Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0712360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0712500Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0712770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0712870Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0713190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0713240Z     yield
2025-01-14T13:16:43.0713490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0713580Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0713780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0713830Z     yield
2025-01-14T13:16:43.0714060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0714280Z     return (yield)
2025-01-14T13:16:43.0714530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0714610Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0714890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0714940Z     yield
2025-01-14T13:16:43.0715160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0715470Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0715670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0715710Z     raise exc
2025-01-14T13:16:43.0715900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0715950Z     col.setup()
2025-01-14T13:16:43.0716140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0716290Z     self._request._fillfixtures()
2025-01-14T13:16:43.0716900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0717030Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0717260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0717360Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0717600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0717670Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0717870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0717920Z     raise exc
2025-01-14T13:16:43.0718100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0718180Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0718370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0718500Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0718910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0719070Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0719270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0719400Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0719670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0719760Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0720060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0720110Z     yield
2025-01-14T13:16:43.0720340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0720420Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0720620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0720680Z     yield
2025-01-14T13:16:43.0720910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0720970Z     return (yield)
2025-01-14T13:16:43.0721310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0721520Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0721800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0721850Z     yield
2025-01-14T13:16:43.0722070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0722150Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0722340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0722420Z     raise exc
2025-01-14T13:16:43.0722610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0722660Z     col.setup()
2025-01-14T13:16:43.0722850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0722910Z     self._request._fillfixtures()
2025-01-14T13:16:43.0723140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0723250Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0723540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0723630Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0723880Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0723960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0724160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0724220Z     raise exc
2025-01-14T13:16:43.0724420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0724490Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0724690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0724820Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0725020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0725260Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0725590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0725740Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0726010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0726100Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0726420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0726470Z     yield
2025-01-14T13:16:43.0726710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0726790Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0727000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0727050Z     yield
2025-01-14T13:16:43.0727290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0727350Z     return (yield)
2025-01-14T13:16:43.0727600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0727690Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0727970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0728120Z     yield
2025-01-14T13:16:43.0728350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0728420Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0728610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0728660Z     raise exc
2025-01-14T13:16:43.0728860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0728910Z     col.setup()
2025-01-14T13:16:43.0729140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0729200Z     self._request._fillfixtures()
2025-01-14T13:16:43.0729410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0729520Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0729900Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0730000Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0730320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0730400Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0732740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0733560Z     raise exc
2025-01-14T13:16:43.0734320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0734530Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0735070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0735420Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0735940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0736140Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0736340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0736480Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0738530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0738660Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0738970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0739020Z     yield
2025-01-14T13:16:43.0739250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0739330Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0739540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0739580Z     yield
2025-01-14T13:16:43.0739810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0739860Z     return (yield)
2025-01-14T13:16:43.0740120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0740200Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0740660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0740710Z     yield
2025-01-14T13:16:43.0740930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0741000Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0742380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0742590Z     raise exc
2025-01-14T13:16:43.0743110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0743290Z     col.setup()
2025-01-14T13:16:43.0743810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0744000Z     self._request._fillfixtures()
2025-01-14T13:16:43.0744580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0745540Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0746330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0746600Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0747250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0747460Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0748070Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0748550Z     raise exc
2025-01-14T13:16:43.0748760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0748820Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0749020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0749160Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0749340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0749500Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0749700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0749980Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0750250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0750340Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0750640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0750770Z     yield
2025-01-14T13:16:43.0751000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0751080Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0751290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0751330Z     yield
2025-01-14T13:16:43.0751570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0751620Z     return (yield)
2025-01-14T13:16:43.0751910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0752030Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0752340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0752390Z     yield
2025-01-14T13:16:43.0752630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0752710Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0752910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0752970Z     raise exc
2025-01-14T13:16:43.0753150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0753320Z     col.setup()
2025-01-14T13:16:43.0753510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0753600Z     self._request._fillfixtures()
2025-01-14T13:16:43.0753810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0753920Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0754140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0754580Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0754860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0754930Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0755140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0755240Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0755480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0755670Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0755870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0755920Z     raise exc
2025-01-14T13:16:43.0756110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0756180Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0756370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0756510Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0756700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0756860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0757050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0757190Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0757600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0757870Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0758190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0758230Z     yield
2025-01-14T13:16:43.0758460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0758540Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0758740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0758790Z     yield
2025-01-14T13:16:43.0759020Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0759070Z     return (yield)
2025-01-14T13:16:43.0759320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0759390Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0759680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0759720Z     yield
2025-01-14T13:16:43.0759940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0760020Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0760210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0760340Z     raise exc
2025-01-14T13:16:43.0760530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0760580Z     col.setup()
2025-01-14T13:16:43.0760760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0760830Z     self._request._fillfixtures()
2025-01-14T13:16:43.0761040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0761180Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0761530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0761630Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0761860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0761940Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0762140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0762310Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0762540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0762620Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0762820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0762860Z     raise exc
2025-01-14T13:16:43.0763060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0763130Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0763310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0763450Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0769080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0769290Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0769480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0769620Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0769980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0770070Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0770370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0770420Z     yield
2025-01-14T13:16:43.0770650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0770730Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0770940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0771070Z     yield
2025-01-14T13:16:43.0771340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0771400Z     return (yield)
2025-01-14T13:16:43.0771650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0771730Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0772010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0772060Z     yield
2025-01-14T13:16:43.0772280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0772480Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0772680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0772730Z     raise exc
2025-01-14T13:16:43.0772910Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0772960Z     col.setup()
2025-01-14T13:16:43.0773150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0773210Z     self._request._fillfixtures()
2025-01-14T13:16:43.0774330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0774790Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0775620Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0775940Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0776650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0776860Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0778280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0778550Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0779220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0780320Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0780840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0780910Z     raise exc
2025-01-14T13:16:43.0781110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0781180Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0781380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0781510Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0781700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0781860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0782160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0782310Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0782590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0782670Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0782980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0783030Z     yield
2025-01-14T13:16:43.0783260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0783330Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0783540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0783590Z     yield
2025-01-14T13:16:43.0783820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0783860Z     return (yield)
2025-01-14T13:16:43.0784120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0784200Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0784470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0785840Z     yield
2025-01-14T13:16:43.0786080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0786150Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0786340Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0786390Z     raise exc
2025-01-14T13:16:43.0786570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0786620Z     col.setup()
2025-01-14T13:16:43.0786890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0786960Z     self._request._fillfixtures()
2025-01-14T13:16:43.0787170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0787280Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0787600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0787710Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0788270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0788350Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0788550Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0788640Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0788890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0788960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0789150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0789190Z     raise exc
2025-01-14T13:16:43.0789380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0789450Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0789640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0789770Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0789960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0790160Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0790360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0790490Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0790760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0790850Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0791150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0791200Z     yield
2025-01-14T13:16:43.0791430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0791510Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0791710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0791760Z     yield
2025-01-14T13:16:43.0791990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0792040Z     return (yield)
2025-01-14T13:16:43.0792290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0792360Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0792720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0792770Z     yield
2025-01-14T13:16:43.0792990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0793060Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0793250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0793300Z     raise exc
2025-01-14T13:16:43.0793590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0793640Z     col.setup()
2025-01-14T13:16:43.0793830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0793900Z     self._request._fillfixtures()
2025-01-14T13:16:43.0794120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0794220Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0794440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0794590Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0794830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0794900Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0795100Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0795200Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0795430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0795500Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0795690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0795740Z     raise exc
2025-01-14T13:16:43.0795920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0795990Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0796180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0796510Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0796710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0796860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0797060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0797190Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0797460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0797540Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0797840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0797890Z     yield
2025-01-14T13:16:43.0798120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0798190Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0798400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0798440Z     yield
2025-01-14T13:16:43.0798670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0798720Z     return (yield)
2025-01-14T13:16:43.0799060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0799140Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0799410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0799460Z     yield
2025-01-14T13:16:43.0799680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0799760Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0799970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0800020Z     raise exc
2025-01-14T13:16:43.0800200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0800250Z     col.setup()
2025-01-14T13:16:43.0800440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0800500Z     self._request._fillfixtures()
2025-01-14T13:16:43.0800710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0800870Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0801090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0801180Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0801410Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0801480Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0801680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0801780Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0802010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0802080Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0802280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0802320Z     raise exc
2025-01-14T13:16:43.0802510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0802610Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0802790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0802920Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0803110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0803260Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0803450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0803590Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0803850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0803940Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0804240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0804290Z     yield
2025-01-14T13:16:43.0804520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0804590Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0804800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0804840Z     yield
2025-01-14T13:16:43.0805060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0805170Z     return (yield)
2025-01-14T13:16:43.0805420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0805500Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0805770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0805820Z     yield
2025-01-14T13:16:43.0806260Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0807310Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0807520Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0807570Z     raise exc
2025-01-14T13:16:43.0807760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0807810Z     col.setup()
2025-01-14T13:16:43.0808000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0808180Z     self._request._fillfixtures()
2025-01-14T13:16:43.0808400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0808500Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0808720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0808810Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0809040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0809110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0809330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0809430Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0809670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0809750Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0809940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0810030Z     raise exc
2025-01-14T13:16:43.0810220Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0810280Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0810470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0810600Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0810790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0810940Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0811140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0811270Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0811540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0811620Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0811920Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0811970Z     yield
2025-01-14T13:16:43.0812200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0812270Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0812470Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0812850Z     yield
2025-01-14T13:16:43.0813080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0813130Z     return (yield)
2025-01-14T13:16:43.0813380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0813450Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0813730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0813820Z     yield
2025-01-14T13:16:43.0814040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0814110Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0814300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0814340Z     raise exc
2025-01-14T13:16:43.0814530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0814860Z     col.setup()
2025-01-14T13:16:43.0815050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0815110Z     self._request._fillfixtures()
2025-01-14T13:16:43.0815320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0815420Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0815640Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0815720Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0815960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0816030Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0816230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0816330Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0816560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0816670Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0816870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0816920Z     raise exc
2025-01-14T13:16:43.0817110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0817180Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0817360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0817490Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0817680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0817840Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0818430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0818590Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0818860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0818940Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0819250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0819300Z     yield
2025-01-14T13:16:43.0819530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0819760Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0819970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0820020Z     yield
2025-01-14T13:16:43.0820240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0820290Z     return (yield)
2025-01-14T13:16:43.0820540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0820990Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0821270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0821320Z     yield
2025-01-14T13:16:43.0821540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0821610Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0821800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0821930Z     raise exc
2025-01-14T13:16:43.0822110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0822160Z     col.setup()
2025-01-14T13:16:43.0822350Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0822410Z     self._request._fillfixtures()
2025-01-14T13:16:43.0822660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0822760Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0822980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0823070Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0823310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0823390Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0823590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0823690Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0824030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0824100Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0824290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0824340Z     raise exc
2025-01-14T13:16:43.0824530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0824600Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0824790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0824920Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0825110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0825260Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0825460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0825600Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0825870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0825950Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0827290Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0827460Z     yield
2025-01-14T13:16:43.0827680Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0827760Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0828530Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0828620Z     yield
2025-01-14T13:16:43.0828850Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0828980Z     return (yield)
2025-01-14T13:16:43.0829230Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0829300Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0829580Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0829630Z     yield
2025-01-14T13:16:43.0829860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0830000Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0830190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0830240Z     raise exc
2025-01-14T13:16:43.0830420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0830470Z     col.setup()
2025-01-14T13:16:43.0830660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0830720Z     self._request._fillfixtures()
2025-01-14T13:16:43.0830930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0831030Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0831250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0831470Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0831740Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0831830Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0832110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0832220Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0832460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0832540Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0832750Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0832790Z     raise exc
2025-01-14T13:16:43.0832990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0833060Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0833250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0833380Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0833670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0833840Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0834040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0834170Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0834440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:85: in pytest_runtest_setup
2025-01-14T13:16:43.0834630Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0834930Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0834980Z     yield
2025-01-14T13:16:43.0835210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:844: in pytest_runtest_setup
2025-01-14T13:16:43.0835290Z     yield from self._runtest_for(item, "setup")
2025-01-14T13:16:43.0835490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0835570Z     yield
2025-01-14T13:16:43.0835800Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:873: in pytest_runtest_setup
2025-01-14T13:16:43.0835850Z     return (yield)
2025-01-14T13:16:43.0837890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:82: in pytest_runtest_setup
2025-01-14T13:16:43.0838320Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0839130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0839870Z     yield
2025-01-14T13:16:43.0840660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:159: in pytest_runtest_setup
2025-01-14T13:16:43.0840760Z     item.session._setupstate.setup(item)
2025-01-14T13:16:43.0840960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:517: in setup
2025-01-14T13:16:43.0841010Z     raise exc
2025-01-14T13:16:43.0841190Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:514: in setup
2025-01-14T13:16:43.0841250Z     col.setup()
2025-01-14T13:16:43.0841440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1635: in setup
2025-01-14T13:16:43.0841500Z     self._request._fillfixtures()
2025-01-14T13:16:43.0841710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:686: in _fillfixtures
2025-01-14T13:16:43.0841820Z     item.funcargs[argname] = self.getfixturevalue(argname)
2025-01-14T13:16:43.0842030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0842130Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0842370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0842530Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0842730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0842830Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0843060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0843130Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0843320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:43.0843460Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:43.0843650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0843800Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0844010Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0844140Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0844370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:43.0844420Z     return (yield)
2025-01-14T13:16:43.0844660Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:43.0844940Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:43.0845160Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:43.0845230Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:43.0845400Z tardis/transport/montecarlo/tests/conftest.py:43: in nb_simulation_verysimple
2025-01-14T13:16:43.0845450Z     sim.iterate(10)
2025-01-14T13:16:43.0845520Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0845640Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0845770Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0845770Z 
2025-01-14T13:16:43.0845990Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x3030effe0>
2025-01-14T13:16:43.0846300Z simulation_state = <tardis.model.base.SimulationState object at 0x30e5bd100>
2025-01-14T13:16:43.0847190Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x3030efce0>
2025-01-14T13:16:43.0847840Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x3030ecc80>
2025-01-14T13:16:43.0849300Z plasma = <tardis.plasma.base.BasePlasma object at 0x30e82cfe0>
2025-01-14T13:16:43.0849630Z no_of_packets = 10, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0849650Z 
2025-01-14T13:16:43.0850260Z     def initialize_transport_state(
2025-01-14T13:16:43.0850380Z         self,
2025-01-14T13:16:43.0850430Z         simulation_state,
2025-01-14T13:16:43.0850490Z         opacity_state,
2025-01-14T13:16:43.0850540Z         macro_atom_state,
2025-01-14T13:16:43.0850580Z         plasma,
2025-01-14T13:16:43.0850630Z         no_of_packets,
2025-01-14T13:16:43.0850690Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0850740Z         iteration=0,
2025-01-14T13:16:43.0850780Z     ):
2025-01-14T13:16:43.0850880Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0850960Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0851000Z         else:
2025-01-14T13:16:43.0851060Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0851100Z     
2025-01-14T13:16:43.0851210Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0851290Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0851330Z         )
2025-01-14T13:16:43.0851370Z     
2025-01-14T13:16:43.0851550Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0851640Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0851760Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0851800Z         else:
2025-01-14T13:16:43.0851860Z             continuum_state = None
2025-01-14T13:16:43.0851940Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0852020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0852090Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0852170Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0852240Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0852310Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0852370Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0852420Z         ).to_numba(
2025-01-14T13:16:43.0852470Z             macro_atom_state,
2025-01-14T13:16:43.0852530Z             self.line_interaction_type,
2025-01-14T13:16:43.0852570Z         )
2025-01-14T13:16:43.0852650Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0852870Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0852920Z         ]
2025-01-14T13:16:43.0853160Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0853170Z 
2025-01-14T13:16:43.0853290Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0853640Z _ test_rpacket_tracker_properties[interaction_type_last_interaction_class-last_interaction_type_rpacket_tracker] _
2025-01-14T13:16:43.0853650Z 
2025-01-14T13:16:43.0854240Z expected = 'interaction_type_last_interaction_class'
2025-01-14T13:16:43.0854370Z obtained = 'last_interaction_type_rpacket_tracker'
2025-01-14T13:16:43.0854740Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[interaction_type_last_interaction_class-last_interaction_type_rpacket_tracker]>>
2025-01-14T13:16:43.0855010Z 
2025-01-14T13:16:43.0855090Z     @pytest.mark.parametrize(
2025-01-14T13:16:43.0855150Z         "expected,obtained",
2025-01-14T13:16:43.0855200Z         [
2025-01-14T13:16:43.0855240Z             (
2025-01-14T13:16:43.0855330Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:43.0855410Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:43.0855460Z             ),
2025-01-14T13:16:43.0855590Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:43.0855680Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:43.0855830Z         ],
2025-01-14T13:16:43.0855870Z     )
2025-01-14T13:16:43.0856000Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:43.0856090Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0856100Z 
2025-01-14T13:16:43.0856240Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:43.0856330Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0856560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0856650Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0856890Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0856960Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0857170Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0857270Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0857500Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0858050Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0858270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:43.0858410Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:43.0858600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0858760Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0858960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0859090Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0859330Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:43.0859370Z     return (yield)
2025-01-14T13:16:43.0859610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:43.0859720Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:43.0859940Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:43.0860010Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:43.0860120Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:43.0860170Z     sim = run_tardis(
2025-01-14T13:16:43.0860230Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:43.0860490Z     simulation.run_convergence()
2025-01-14T13:16:43.0860580Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:43.0860700Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:43.0860770Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0861010Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0861100Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0861110Z 
2025-01-14T13:16:43.0861320Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:43.0861520Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:43.0862330Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:43.0863030Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:43.0863390Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:43.0863690Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0863700Z 
2025-01-14T13:16:43.0864410Z     def initialize_transport_state(
2025-01-14T13:16:43.0864470Z         self,
2025-01-14T13:16:43.0864520Z         simulation_state,
2025-01-14T13:16:43.0864570Z         opacity_state,
2025-01-14T13:16:43.0864620Z         macro_atom_state,
2025-01-14T13:16:43.0870940Z         plasma,
2025-01-14T13:16:43.0871030Z         no_of_packets,
2025-01-14T13:16:43.0871100Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0871150Z         iteration=0,
2025-01-14T13:16:43.0871190Z     ):
2025-01-14T13:16:43.0871290Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0871360Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0871400Z         else:
2025-01-14T13:16:43.0871460Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0871500Z     
2025-01-14T13:16:43.0871610Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0871690Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0871730Z         )
2025-01-14T13:16:43.0871800Z     
2025-01-14T13:16:43.0871900Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0871990Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0872110Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0872280Z         else:
2025-01-14T13:16:43.0872340Z             continuum_state = None
2025-01-14T13:16:43.0872420Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0872510Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0872570Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0872650Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0872730Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0872800Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0872860Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0872910Z         ).to_numba(
2025-01-14T13:16:43.0872960Z             macro_atom_state,
2025-01-14T13:16:43.0873030Z             self.line_interaction_type,
2025-01-14T13:16:43.0873070Z         )
2025-01-14T13:16:43.0873140Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0873360Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0873410Z         ]
2025-01-14T13:16:43.0873660Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0873660Z 
2025-01-14T13:16:43.0873780Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0873910Z ----------------------------- Captured stdout call -----------------------------
2025-01-14T13:16:43.0875660Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:43.0877140Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:43.0877510Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:43.0878050Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:43.0878280Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:43.0878330Z 	
2025-01-14T13:16:43.0878450Z 	Starting iteration 1 of 3 ([1mbase.py[0m:444)
2025-01-14T13:16:43.0878720Z ------------------------------ Captured log call -------------------------------
2025-01-14T13:16:43.0879120Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:43.0879300Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:43.0879390Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:43.0879450Z 	Starting iteration 1 of 3
2025-01-14T13:16:43.0879640Z _ test_rpacket_tracker_properties[shell_id_last_interaction_class-shell_id_rpacket_tracker] _
2025-01-14T13:16:43.0879780Z 
2025-01-14T13:16:43.0879860Z expected = 'shell_id_last_interaction_class'
2025-01-14T13:16:43.0879930Z obtained = 'shell_id_rpacket_tracker'
2025-01-14T13:16:43.0880220Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[shell_id_last_interaction_class-shell_id_rpacket_tracker]>>
2025-01-14T13:16:43.0880230Z 
2025-01-14T13:16:43.0880290Z     @pytest.mark.parametrize(
2025-01-14T13:16:43.0880350Z         "expected,obtained",
2025-01-14T13:16:43.0880400Z         [
2025-01-14T13:16:43.0880440Z             (
2025-01-14T13:16:43.0880520Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:43.0880600Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:43.0880640Z             ),
2025-01-14T13:16:43.0880770Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:43.0880860Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:43.0880910Z         ],
2025-01-14T13:16:43.0880950Z     )
2025-01-14T13:16:43.0881080Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:43.0881170Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0881210Z 
2025-01-14T13:16:43.0881350Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:43.0881450Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0881670Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0881760Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0881990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0882070Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0882270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0882370Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0882600Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0882670Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0882870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0882920Z     raise exc
2025-01-14T13:16:43.0883110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0883170Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0883360Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0883750Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0883950Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0884100Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0884300Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0884430Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0884730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0884810Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0885080Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0885130Z     yield
2025-01-14T13:16:43.0885390Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0885480Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0886030Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0886090Z     yield
2025-01-14T13:16:43.0886310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0886390Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0886590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0886640Z     yield
2025-01-14T13:16:43.0886860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0886910Z     return (yield)
2025-01-14T13:16:43.0887140Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0887190Z     return (yield)
2025-01-14T13:16:43.0887400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0887450Z     raise e
2025-01-14T13:16:43.0887790Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0887950Z     item.runtest()
2025-01-14T13:16:43.0888150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0888230Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0888430Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0888580Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0888780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0888910Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0889130Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0889200Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0889410Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:43.0889500Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0889710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0889810Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0890040Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0890110Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0890310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0890480Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0890720Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0890790Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0890990Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:43.0891120Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:43.0891440Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0891590Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0891780Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0891910Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0892150Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:43.0892260Z     return (yield)
2025-01-14T13:16:43.0892490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:43.0892600Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:43.0892820Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:43.0892890Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:43.0893000Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:43.0893050Z     sim = run_tardis(
2025-01-14T13:16:43.0893110Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:43.0893170Z     simulation.run_convergence()
2025-01-14T13:16:43.0893260Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:43.0893360Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:43.0893430Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0893550Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0893650Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0893650Z 
2025-01-14T13:16:43.0893850Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:43.0894190Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:43.0894370Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:43.0894580Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:43.0894700Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:43.0894810Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0894810Z 
2025-01-14T13:16:43.0894880Z     def initialize_transport_state(
2025-01-14T13:16:43.0894920Z         self,
2025-01-14T13:16:43.0894980Z         simulation_state,
2025-01-14T13:16:43.0895030Z         opacity_state,
2025-01-14T13:16:43.0895080Z         macro_atom_state,
2025-01-14T13:16:43.0895120Z         plasma,
2025-01-14T13:16:43.0895170Z         no_of_packets,
2025-01-14T13:16:43.0895220Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0895270Z         iteration=0,
2025-01-14T13:16:43.0895310Z     ):
2025-01-14T13:16:43.0895410Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0895480Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0895530Z         else:
2025-01-14T13:16:43.0895590Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0895630Z     
2025-01-14T13:16:43.0895740Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0895810Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0896370Z         )
2025-01-14T13:16:43.0896410Z     
2025-01-14T13:16:43.0896520Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0896610Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0896740Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0896780Z         else:
2025-01-14T13:16:43.0896850Z             continuum_state = None
2025-01-14T13:16:43.0896930Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0897020Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0897130Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0897210Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0897290Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0897350Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0897420Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0897460Z         ).to_numba(
2025-01-14T13:16:43.0897520Z             macro_atom_state,
2025-01-14T13:16:43.0897580Z             self.line_interaction_type,
2025-01-14T13:16:43.0897620Z         )
2025-01-14T13:16:43.0897760Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0897990Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0898030Z         ]
2025-01-14T13:16:43.0898280Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0898290Z 
2025-01-14T13:16:43.0898400Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0898570Z _ test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker] _
2025-01-14T13:16:43.0898570Z 
2025-01-14T13:16:43.0898700Z expected = 'nu_from_packet_collection', obtained = 'nu_rpacket_tracker'
2025-01-14T13:16:43.0898960Z request = <FixtureRequest for <Function test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker]>>
2025-01-14T13:16:43.0898960Z 
2025-01-14T13:16:43.0899030Z     @pytest.mark.parametrize(
2025-01-14T13:16:43.0899090Z         "expected,obtained",
2025-01-14T13:16:43.0899130Z         [
2025-01-14T13:16:43.0899170Z             (
2025-01-14T13:16:43.0899250Z                 "interaction_type_last_interaction_class",
2025-01-14T13:16:43.0899330Z                 "last_interaction_type_rpacket_tracker",
2025-01-14T13:16:43.0899400Z             ),
2025-01-14T13:16:43.0899530Z             ("shell_id_last_interaction_class", "shell_id_rpacket_tracker"),
2025-01-14T13:16:43.0899620Z             ("nu_from_packet_collection", "nu_rpacket_tracker"),
2025-01-14T13:16:43.0899670Z         ],
2025-01-14T13:16:43.0899710Z     )
2025-01-14T13:16:43.0899830Z     def test_rpacket_tracker_properties(expected, obtained, request):
2025-01-14T13:16:43.0899920Z >       expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0899920Z 
2025-01-14T13:16:43.0900060Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: 
2025-01-14T13:16:43.0900150Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0900370Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0900460Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0900700Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0900770Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0901090Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0901190Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0901420Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0901500Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0901760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0901800Z     raise exc
2025-01-14T13:16:43.0902000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0902060Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0902250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0902460Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0902710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0902860Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0903060Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0903190Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0903450Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0903580Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0903870Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0903920Z     yield
2025-01-14T13:16:43.0904180Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0904260Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0904560Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0904610Z     yield
2025-01-14T13:16:43.0904830Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0904910Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0905110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0905160Z     yield
2025-01-14T13:16:43.0905380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0905430Z     return (yield)
2025-01-14T13:16:43.0905690Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0905740Z     return (yield)
2025-01-14T13:16:43.0905960Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0906010Z     raise e
2025-01-14T13:16:43.0906240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0906290Z     item.runtest()
2025-01-14T13:16:43.0906480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0906560Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0906760Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0906910Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0907110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0907240Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0907460Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0907530Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0907740Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:43.0907830Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0908970Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0909070Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0909310Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0909390Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0909590Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0909750Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0909980Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0910050Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0910250Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1056: in execute
2025-01-14T13:16:43.0910290Z     raise exc
2025-01-14T13:16:43.0910490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:341: in from_call
2025-01-14T13:16:43.0910560Z     result: Optional[TResult] = func()
2025-01-14T13:16:43.0911320Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:241: in <lambda>
2025-01-14T13:16:43.0911460Z     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
2025-01-14T13:16:43.0911650Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0911800Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0912000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0912130Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0912380Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:87: in pytest_runtest_call
2025-01-14T13:16:43.0912450Z     yield from thread_exception_runtest_hook()
2025-01-14T13:16:43.0912730Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/threadexception.py:63: in thread_exception_runtest_hook
2025-01-14T13:16:43.0912780Z     yield
2025-01-14T13:16:43.0913710Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:90: in pytest_runtest_call
2025-01-14T13:16:43.0913900Z     yield from unraisable_exception_runtest_hook()
2025-01-14T13:16:43.0914210Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/unraisableexception.py:65: in unraisable_exception_runtest_hook
2025-01-14T13:16:43.0914260Z     yield
2025-01-14T13:16:43.0914480Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:850: in pytest_runtest_call
2025-01-14T13:16:43.0914790Z     yield from self._runtest_for(item, "call")
2025-01-14T13:16:43.0916200Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/logging.py:833: in _runtest_for
2025-01-14T13:16:43.0916290Z     yield
2025-01-14T13:16:43.0916570Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/capture.py:878: in pytest_runtest_call
2025-01-14T13:16:43.0916640Z     return (yield)
2025-01-14T13:16:43.0917280Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/skipping.py:257: in pytest_runtest_call
2025-01-14T13:16:43.0917530Z     return (yield)
2025-01-14T13:16:43.0918490Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:183: in pytest_runtest_call
2025-01-14T13:16:43.0918580Z     raise e
2025-01-14T13:16:43.0918840Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/runner.py:173: in pytest_runtest_call
2025-01-14T13:16:43.0918890Z     item.runtest()
2025-01-14T13:16:43.0919110Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:1632: in runtest
2025-01-14T13:16:43.0919210Z     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
2025-01-14T13:16:43.0919540Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0919730Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0920510Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0921530Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0921810Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/python.py:162: in pytest_pyfunc_call
2025-01-14T13:16:43.0925680Z     result = testfunction(**testargs)
2025-01-14T13:16:43.0926750Z tardis/transport/montecarlo/tests/test_rpacket_tracker.py:130: in test_rpacket_tracker_properties
2025-01-14T13:16:43.0927050Z     expected = request.getfixturevalue(expected)
2025-01-14T13:16:43.0927860Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:521: in getfixturevalue
2025-01-14T13:16:43.0927980Z     fixturedef = self._get_active_fixturedef(argname)
2025-01-14T13:16:43.0928240Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0931180Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0931400Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1038: in execute
2025-01-14T13:16:43.0931520Z     fixturedef = request._get_active_fixturedef(argname)
2025-01-14T13:16:43.0931770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:606: in _get_active_fixturedef
2025-01-14T13:16:43.0931840Z     fixturedef.execute(request=subrequest)
2025-01-14T13:16:43.0932770Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1076: in execute
2025-01-14T13:16:43.0932930Z     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
2025-01-14T13:16:43.0933120Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_hooks.py:513: in __call__
2025-01-14T13:16:43.0933430Z     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
2025-01-14T13:16:43.0933630Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/pluggy/_manager.py:120: in _hookexec
2025-01-14T13:16:43.0933770Z     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
2025-01-14T13:16:43.0934000Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/setuponly.py:36: in pytest_fixture_setup
2025-01-14T13:16:43.0935030Z     return (yield)
2025-01-14T13:16:43.0935270Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:1125: in pytest_fixture_setup
2025-01-14T13:16:43.0935380Z     result = call_fixture_func(fixturefunc, request, kwargs)
2025-01-14T13:16:43.0935610Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/_pytest/fixtures.py:887: in call_fixture_func
2025-01-14T13:16:43.0935690Z     fixture_result = fixturefunc(**kwargs)
2025-01-14T13:16:43.0935800Z tardis/conftest.py:269: in simulation_rpacket_tracking
2025-01-14T13:16:43.0935850Z     sim = run_tardis(
2025-01-14T13:16:43.0935910Z tardis/base.py:114: in run_tardis
2025-01-14T13:16:43.0936130Z     simulation.run_convergence()
2025-01-14T13:16:43.0936230Z tardis/simulation/base.py:531: in run_convergence
2025-01-14T13:16:43.0936330Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:43.0937370Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0937540Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0937640Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0937650Z 
2025-01-14T13:16:43.0937870Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x155fc3470>
2025-01-14T13:16:43.0938040Z simulation_state = <tardis.model.base.SimulationState object at 0x125c8b470>
2025-01-14T13:16:43.0938220Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x125cc6a80>
2025-01-14T13:16:43.0939010Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x125cc5ee0>
2025-01-14T13:16:43.0939140Z plasma = <tardis.plasma.base.BasePlasma object at 0x125c1d3a0>
2025-01-14T13:16:43.0939250Z no_of_packets = 4000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0939250Z 
2025-01-14T13:16:43.0939320Z     def initialize_transport_state(
2025-01-14T13:16:43.0939360Z         self,
2025-01-14T13:16:43.0939420Z         simulation_state,
2025-01-14T13:16:43.0939470Z         opacity_state,
2025-01-14T13:16:43.0940350Z         macro_atom_state,
2025-01-14T13:16:43.0941580Z         plasma,
2025-01-14T13:16:43.0941650Z         no_of_packets,
2025-01-14T13:16:43.0941710Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0941760Z         iteration=0,
2025-01-14T13:16:43.0941810Z     ):
2025-01-14T13:16:43.0942690Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0943610Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0943680Z         else:
2025-01-14T13:16:43.0943740Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0943780Z     
2025-01-14T13:16:43.0943890Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0944100Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0944160Z         )
2025-01-14T13:16:43.0944210Z     
2025-01-14T13:16:43.0944310Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0944410Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0944540Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0944580Z         else:
2025-01-14T13:16:43.0944640Z             continuum_state = None
2025-01-14T13:16:43.0945080Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0945360Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0945560Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0945960Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0946070Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0946140Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0946220Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0946260Z         ).to_numba(
2025-01-14T13:16:43.0946320Z             macro_atom_state,
2025-01-14T13:16:43.0946390Z             self.line_interaction_type,
2025-01-14T13:16:43.0946520Z         )
2025-01-14T13:16:43.0946600Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0948030Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0948240Z         ]
2025-01-14T13:16:43.0949340Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0949380Z 
2025-01-14T13:16:43.0949530Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0950220Z ______________________ test_montecarlo_main_loop_weighted ______________________
2025-01-14T13:16:43.0950390Z 
2025-01-14T13:16:43.0950960Z montecarlo_main_loop_config = {'tardis_config_version': 'v1.0', 'supernova': {'luminosity_requested': <Quantity 1.07688e+36 W>, 'time_explosion': <Q...able_biasing': False}, 'method': 'virtual', 'integrated': {'points': 1000, 'interpolate_shells': 0, 'compute': 'CPU'}}}
2025-01-14T13:16:43.0951180Z regression_data = <tardis.tests.fixtures.regression_data.RegressionData object at 0x3110a9f70>
2025-01-14T13:16:43.0951830Z atomic_dataset = <Atomic Data UUID=6f7b09e887a311e7a06b246e96350010 MD5=864f1753714343c41f99cb065710cace Lines=29224 Levels=24806>
2025-01-14T13:16:43.0952150Z simple_weighted_packet_source = <tardis.transport.montecarlo.weighted_packet_source.BlackBodyWeightedSource object at 0x17504b410>
2025-01-14T13:16:43.0952160Z 
2025-01-14T13:16:43.0952230Z     def test_montecarlo_main_loop_weighted(
2025-01-14T13:16:43.0952510Z         montecarlo_main_loop_config,
2025-01-14T13:16:43.0952570Z         regression_data,
2025-01-14T13:16:43.0952620Z         atomic_dataset,
2025-01-14T13:16:43.0952690Z         simple_weighted_packet_source,
2025-01-14T13:16:43.0952750Z     ):
2025-01-14T13:16:43.0952830Z         atomic_dataset = deepcopy(atomic_dataset)
2025-01-14T13:16:43.0952990Z         montecarlo_main_loop_simulation_weighted = Simulation.from_config(
2025-01-14T13:16:43.0953060Z             montecarlo_main_loop_config,
2025-01-14T13:16:43.0953130Z             atom_data=atomic_dataset,
2025-01-14T13:16:43.0953270Z             virtual_packet_logging=False,
2025-01-14T13:16:43.0953340Z             legacy_mode_enabled=True,
2025-01-14T13:16:43.0953390Z         )
2025-01-14T13:16:43.0953500Z         montecarlo_main_loop_simulation_weighted.packet_source = (
2025-01-14T13:16:43.0953570Z             simple_weighted_packet_source
2025-01-14T13:16:43.0953610Z         )
2025-01-14T13:16:43.0953740Z         montecarlo_main_loop_simulation_weighted.run_convergence()
2025-01-14T13:16:43.0953840Z >       montecarlo_main_loop_simulation_weighted.run_final()
2025-01-14T13:16:43.0953850Z 
2025-01-14T13:16:43.0954050Z tardis/transport/montecarlo/tests/test_weighted_packet_source_integration.py:26: 
2025-01-14T13:16:43.0954590Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0954940Z tardis/simulation/base.py:558: in run_final
2025-01-14T13:16:43.0955500Z     emitted_luminosity, v_packets_energy_hist = self.iterate(
2025-01-14T13:16:43.0955730Z tardis/simulation/base.py:462: in iterate
2025-01-14T13:16:43.0956080Z     transport_state = self.transport.initialize_transport_state(
2025-01-14T13:16:43.0956320Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-01-14T13:16:43.0956330Z 
2025-01-14T13:16:43.0956900Z self = <tardis.transport.montecarlo.base.MonteCarloTransportSolver object at 0x310ffac30>
2025-01-14T13:16:43.0957350Z simulation_state = <tardis.model.base.SimulationState object at 0x309d6aa20>
2025-01-14T13:16:43.0957970Z opacity_state = <tardis.opacities.opacity_state.OpacityState object at 0x17640c470>
2025-01-14T13:16:43.0959530Z macro_atom_state = <tardis.opacities.macro_atom.macroatom_state.MacroAtomState object at 0x17640d6a0>
2025-01-14T13:16:43.0959720Z plasma = <tardis.plasma.base.BasePlasma object at 0x318313b30>
2025-01-14T13:16:43.0959840Z no_of_packets = 100000, no_of_virtual_packets = 0, iteration = 0
2025-01-14T13:16:43.0960270Z 
2025-01-14T13:16:43.0960350Z     def initialize_transport_state(
2025-01-14T13:16:43.0960400Z         self,
2025-01-14T13:16:43.0960460Z         simulation_state,
2025-01-14T13:16:43.0960510Z         opacity_state,
2025-01-14T13:16:43.0960560Z         macro_atom_state,
2025-01-14T13:16:43.0960750Z         plasma,
2025-01-14T13:16:43.0960870Z         no_of_packets,
2025-01-14T13:16:43.0960930Z         no_of_virtual_packets=0,
2025-01-14T13:16:43.0960980Z         iteration=0,
2025-01-14T13:16:43.0961020Z     ):
2025-01-14T13:16:43.0961130Z         if not plasma.continuum_interaction_species.empty:
2025-01-14T13:16:43.0961210Z             gamma_shape = plasma.gamma.shape
2025-01-14T13:16:43.0961260Z         else:
2025-01-14T13:16:43.0961320Z             gamma_shape = (0, 0)
2025-01-14T13:16:43.0961360Z     
2025-01-14T13:16:43.0961470Z         packet_collection = self.packet_source.create_packets(
2025-01-14T13:16:43.0961540Z             no_of_packets, seed_offset=iteration
2025-01-14T13:16:43.0961880Z         )
2025-01-14T13:16:43.0961920Z     
2025-01-14T13:16:43.0962050Z         geometry_state = simulation_state.geometry.to_numba()
2025-01-14T13:16:43.0962140Z         if hasattr(plasma, "photo_ion_cross_sections"):
2025-01-14T13:16:43.0962580Z             continuum_state = ContinuumState.from_legacy_plasma(plasma)
2025-01-14T13:16:43.0962650Z         else:
2025-01-14T13:16:43.0962720Z             continuum_state = None
2025-01-14T13:16:43.0962800Z         self.opacity_state_numba = OpacityState(
2025-01-14T13:16:43.0962880Z             electron_density=plasma.electron_densities,
2025-01-14T13:16:43.0963290Z             t_electrons=plasma.t_electrons,
2025-01-14T13:16:43.0963380Z             line_list_nu=plasma.atomic_data.lines.nu,
2025-01-14T13:16:43.0963460Z             tau_sobolev=opacity_state.tau_sobolev,
2025-01-14T13:16:43.0963530Z             beta_sobolev=plasma.beta_sobolev,
2025-01-14T13:16:43.0963600Z             continuum_state=continuum_state,
2025-01-14T13:16:43.0963650Z         ).to_numba(
2025-01-14T13:16:43.0963710Z             macro_atom_state,
2025-01-14T13:16:43.0963770Z             self.line_interaction_type,
2025-01-14T13:16:43.0963860Z         )
2025-01-14T13:16:43.0964420Z >       opacity_state_numba = opacity_state_numba[
2025-01-14T13:16:43.0964750Z             simulation_state.geometry.v_inner_boundary_index : simulation_state.geometry.v_outer_boundary_index
2025-01-14T13:16:43.0964830Z         ]
2025-01-14T13:16:43.0965080Z E       UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.0965090Z 
2025-01-14T13:16:43.0965200Z tardis/transport/montecarlo/base.py:133: UnboundLocalError
2025-01-14T13:16:43.0965330Z ----------------------------- Captured stdout call -----------------------------
2025-01-14T13:16:43.0967390Z [[1mtardis.io.model.parse_density_configuration[0m][[1;33mWARNING[0m]  
2025-01-14T13:16:43.0967740Z 	Number of density points larger than number of shells. Assuming inner point irrelevant ([1mparse_density_configuration.py[0m:114)
2025-01-14T13:16:43.0967890Z [[1mtardis.model.matter.decay[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:43.0968180Z 	Decaying abundances for 1123200.0 seconds ([1mdecay.py[0m:101)
2025-01-14T13:16:43.0969250Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:43.0969370Z 	
2025-01-14T13:16:43.0969450Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:43.0969510Z 	Simulation took 0.00 s
2025-01-14T13:16:43.0969620Z  ([1mbase.py[0m:542)
2025-01-14T13:16:43.0969760Z [[1mtardis.simulation.base[0m][[1;37mINFO[0m   ]  
2025-01-14T13:16:43.0969810Z 	
2025-01-14T13:16:43.0970340Z 	Starting iteration 1 of 1 ([1mbase.py[0m:444)
2025-01-14T13:16:43.0970510Z ------------------------------ Captured log call -------------------------------
2025-01-14T13:16:43.0970940Z WARNING  tardis.io.model.parse_density_configuration:parse_density_configuration.py:114 Number of density points larger than number of shells. Assuming inner point irrelevant
2025-01-14T13:16:43.0971210Z INFO     tardis.model.matter.decay:decay.py:101 Decaying abundances for 1123200.0 seconds
2025-01-14T13:16:43.0971470Z INFO     tardis.simulation.base:base.py:542 
2025-01-14T13:16:43.0971770Z 	Simulation finished in 0 iterations 
2025-01-14T13:16:43.0972130Z 	Simulation took 0.00 s
2025-01-14T13:16:43.0972150Z 
2025-01-14T13:16:43.0972250Z INFO     tardis.simulation.base:base.py:444 
2025-01-14T13:16:43.0972310Z 	Starting iteration 1 of 1
2025-01-14T13:16:43.0972410Z =============================== warnings summary ===============================
2025-01-14T13:16:43.0972500Z tardis/io/configuration/config_validator.py:6
2025-01-14T13:16:43.0972590Z tardis/io/configuration/config_validator.py:6
2025-01-14T13:16:43.0972840Z   /Users/runner/work/tardis/tardis/tardis/io/configuration/config_validator.py:6: DeprecationWarning:
2025-01-14T13:16:43.0972890Z   
2025-01-14T13:16:43.0974820Z   jsonschema.RefResolver is deprecated as of v4.18.0, in favor of the https://github.com/python-jsonschema/referencing library, which provides more compliant referencing behavior as well as more flexible APIs for customization. A future release will remove RefResolver. Please file a feature request (on referencing) if you are missing an API for the kind of customization you need.
2025-01-14T13:16:43.0974840Z 
2025-01-14T13:16:43.0975050Z ../../../micromamba/envs/tardis/lib/python3.12/site-packages/jupyter_client/connect.py:22
2025-01-14T13:16:43.0975360Z   /Users/runner/micromamba/envs/tardis/lib/python3.12/site-packages/jupyter_client/connect.py:22: DeprecationWarning:
2025-01-14T13:16:43.0975530Z   
2025-01-14T13:16:43.0975660Z   Jupyter is migrating its paths to use standard platformdirs
2025-01-14T13:16:43.0975780Z   given by the platformdirs library.  To remove this warning and
2025-01-14T13:16:43.0975920Z   see the appropriate new directories, set the environment variable
2025-01-14T13:16:43.0976040Z   `JUPYTER_PLATFORM_DIRS=1` and then run `jupyter --paths`.
2025-01-14T13:16:43.0976170Z   The use of platformdirs will be the default in `jupyter_core` v6
2025-01-14T13:16:43.0976170Z 
2025-01-14T13:16:43.0994130Z tardis/io/tests/test_HDFWriter.py::test_multi_index_write
2025-01-14T13:16:43.0994330Z   /Users/runner/work/tardis/tardis/tardis/io/util.py:276: PerformanceWarning:
2025-01-14T13:16:43.0994400Z   
2025-01-14T13:16:43.0994460Z   
2025-01-14T13:16:43.0994630Z   your performance may suffer as PyTables will pickle object types that it cannot
2025-01-14T13:16:43.0995300Z   map directly to c-types [inferred_type->mixed,key->block0_values] [items->Index([0], dtype='int64')]
2025-01-14T13:16:43.0995330Z 
2025-01-14T13:16:43.1021970Z tardis/io/tests/test_model_reader.py::test_read_cmfgen_isotope_abundances
2025-01-14T13:16:43.1022830Z tardis/plasma/tests/test_tardis_model_density_config.py::test_electron_densities
2025-01-14T13:16:43.1023070Z tardis/plasma/tests/test_tardis_model_density_config.py::test_isotope_number_densities
2025-01-14T13:16:43.1023290Z tardis/plasma/tests/test_tardis_model_density_config.py::test_t_rad
2025-01-14T13:16:43.1024390Z   /Users/runner/work/tardis/tardis/tardis/io/model/readers/cmfgen_deprecated.py:82: DeprecationWarning:
2025-01-14T13:16:43.1025230Z   
2025-01-14T13:16:43.1025430Z   The current CMFGEN model parser is deprecated
2025-01-14T13:16:43.1025430Z 
2025-01-14T13:16:43.1025520Z tardis/io/tests/test_model_reader.py: 1 warning
2025-01-14T13:16:43.1025810Z tardis/plasma/tests/test_tardis_model_density_config.py: 9 warnings
2025-01-14T13:16:43.1026370Z   /Users/runner/work/tardis/tardis/tardis/io/model/readers/cmfgen_deprecated.py:40: DeprecationWarning:
2025-01-14T13:16:43.1026430Z   
2025-01-14T13:16:43.1026560Z   The current CMFGEN model parser is deprecated
2025-01-14T13:16:43.1026570Z 
2025-01-14T13:16:43.1026880Z tardis/model/tests/test_csvy_model.py::test_compare_models[model_full]
2025-01-14T13:16:43.1027610Z tardis/model/tests/test_csvy_model.py::test_compare_models[radiative]
2025-01-14T13:16:43.1028170Z tardis/plasma/tests/test_tardis_model_density_config.py::test_electron_densities
2025-01-14T13:16:43.1030390Z tardis/plasma/tests/test_tardis_model_density_config.py::test_isotope_number_densities
2025-01-14T13:16:43.1030590Z tardis/plasma/tests/test_tardis_model_density_config.py::test_t_rad
2025-01-14T13:16:43.1030860Z   /Users/runner/work/tardis/tardis/tardis/model/geometry/radial1d.py:50: DeprecationWarning:
2025-01-14T13:16:43.1030910Z   
2025-01-14T13:16:43.1030990Z   v_inner_boundary < 0, assuming default value
2025-01-14T13:16:43.1031000Z 
2025-01-14T13:16:43.1031140Z tardis/model/tests/test_csvy_model.py::test_compare_models[model_full]
2025-01-14T13:16:43.1031980Z tardis/model/tests/test_csvy_model.py::test_compare_models[radiative]
2025-01-14T13:16:43.1032730Z tardis/plasma/tests/test_tardis_model_density_config.py::test_electron_densities
2025-01-14T13:16:43.1033260Z tardis/plasma/tests/test_tardis_model_density_config.py::test_isotope_number_densities
2025-01-14T13:16:43.1033520Z tardis/plasma/tests/test_tardis_model_density_config.py::test_t_rad
2025-01-14T13:16:43.1033960Z   /Users/runner/work/tardis/tardis/tardis/model/geometry/radial1d.py:61: DeprecationWarning:
2025-01-14T13:16:43.1034010Z   
2025-01-14T13:16:43.1034170Z   v_outer_boundary < 0, assuming default value
2025-01-14T13:16:43.1034500Z 
2025-01-14T13:16:43.1036040Z tardis/plasma/equilibrium/tests/test_level_populations.py::TestLevelPopulationSolver::test_solve[collisional_rate_solver0-radiative_transitions0]
2025-01-14T13:16:43.1039090Z   /Users/runner/work/tardis/tardis/tardis/plasma/equilibrium/level_populations.py:65: FutureWarning:
2025-01-14T13:16:43.1039830Z   
2025-01-14T13:16:43.1040230Z   A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
2025-01-14T13:16:43.1040630Z   The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.
2025-01-14T13:16:43.1040690Z   
2025-01-14T13:16:43.1042400Z   For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.
2025-01-14T13:16:43.1042540Z 
2025-01-14T13:16:43.1042780Z tardis/plasma/tests/test_complete_plasmas.py: 20 warnings
2025-01-14T13:16:43.1043030Z   /Users/runner/work/tardis/tardis/tardis/plasma/tests/test_complete_plasmas.py:197: UserWarning:
2025-01-14T13:16:43.1043080Z   
2025-01-14T13:16:43.1043150Z   Property "atomic_mass" not found
2025-01-14T13:16:43.1043150Z 
2025-01-14T13:16:43.1043510Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-w_epsilon:1e-10-j_blues_norm_factor]
2025-01-14T13:16:43.1043920Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-j_blues_norm_factor]
2025-01-14T13:16:43.1044250Z   /Users/runner/work/tardis/tardis/tardis/plasma/tests/test_complete_plasmas.py:197: UserWarning:
2025-01-14T13:16:43.1044300Z   
2025-01-14T13:16:43.1044540Z   Property "j_blues_norm_factor" not found
2025-01-14T13:16:43.1044550Z 
2025-01-14T13:16:43.1045160Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-w_epsilon:1e-10-j_blue_estimator]
2025-01-14T13:16:43.1045940Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-j_blue_estimator]
2025-01-14T13:16:43.1046340Z   /Users/runner/work/tardis/tardis/tardis/plasma/tests/test_complete_plasmas.py:197: UserWarning:
2025-01-14T13:16:43.1046400Z   
2025-01-14T13:16:43.1046630Z   Property "j_blue_estimator" not found
2025-01-14T13:16:43.1046640Z 
2025-01-14T13:16:43.1047370Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-w_epsilon:1e-10-volume]
2025-01-14T13:16:43.1047940Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-volume]
2025-01-14T13:16:43.1048660Z   /Users/runner/work/tardis/tardis/tardis/plasma/tests/test_complete_plasmas.py:197: UserWarning:
2025-01-14T13:16:43.1049270Z   
2025-01-14T13:16:43.1051080Z   Property "volume" not found
2025-01-14T13:16:43.1051160Z 
2025-01-14T13:16:43.1052430Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-w_epsilon:1e-10-r_inner]
2025-01-14T13:16:43.1053210Z tardis/plasma/tests/test_complete_plasmas.py::TestPlasma::test_plasma_properties[radiative_rates_type:detailed-r_inner]
2025-01-14T13:16:43.1053870Z   /Users/runner/work/tardis/tardis/tardis/plasma/tests/test_complete_plasmas.py:197: UserWarning:
2025-01-14T13:16:43.1054020Z   
2025-01-14T13:16:43.1054200Z   Property "r_inner" not found
2025-01-14T13:16:43.1054210Z 
2025-01-14T13:16:43.1054670Z tardis/plasma/tests/test_plasma_vboundary.py::test_plasma_vboundary[2900-3750]
2025-01-14T13:16:43.1055120Z tardis/plasma/tests/test_plasma_vboundary.py::test_plasma_vboundary[2900-3850]
2025-01-14T13:16:43.1055580Z tardis/plasma/tests/test_plasma_vboundary.py::test_plasma_vboundary[2900-3900]
2025-01-14T13:16:43.1056100Z   /Users/runner/work/tardis/tardis/tardis/model/geometry/radial1d.py:71: UserWarning:
2025-01-14T13:16:43.1056250Z   
2025-01-14T13:16:43.1056660Z   Requesting inner boundary below inner shell. Extrapolating the inner cell
2025-01-14T13:16:43.1056680Z 
2025-01-14T13:16:43.1057450Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1058870Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1059630Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1060440Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1061210Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1062490Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1063430Z   /Users/runner/micromamba/envs/tardis/lib/python3.12/site-packages/traitlets/traitlets.py:1385: DeprecationWarning:
2025-01-14T13:16:43.1063580Z   
2025-01-14T13:16:43.1064440Z   Passing unrecognized arguments to super(Checkbox).__init__(icon='lock').
2025-01-14T13:16:43.1064880Z   object.__init__() takes exactly one argument (the instance to initialize)
2025-01-14T13:16:43.1065420Z   This is deprecated in traitlets 4.2.This error will be raised in a future release of traitlets.
2025-01-14T13:16:43.1065800Z 
2025-01-14T13:16:43.1066630Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1067270Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1067860Z   /Users/runner/micromamba/envs/tardis/lib/python3.12/site-packages/traitlets/traitlets.py:1385: DeprecationWarning:
2025-01-14T13:16:43.1068110Z   
2025-01-14T13:16:43.1068760Z   Passing unrecognized arguments to super(FloatText).__init__(min=0).
2025-01-14T13:16:43.1069150Z   object.__init__() takes exactly one argument (the instance to initialize)
2025-01-14T13:16:43.1069370Z   This is deprecated in traitlets 4.2.This error will be raised in a future release of traitlets.
2025-01-14T13:16:43.1069380Z 
2025-01-14T13:16:43.1069770Z tardis/visualization/widgets/tests/test_custom_abundance.py::TestCustomAbundanceWidget::test_update_input_item_value
2025-01-14T13:16:43.1070090Z   /Users/runner/micromamba/envs/tardis/lib/python3.12/site-packages/traitlets/traitlets.py:1385: DeprecationWarning:
2025-01-14T13:16:43.1070140Z   
2025-01-14T13:16:43.1070290Z   Passing unrecognized arguments to super(HTML).__init__(indent=True).
2025-01-14T13:16:43.1070720Z   object.__init__() takes exactly one argument (the instance to initialize)
2025-01-14T13:16:43.1070990Z   This is deprecated in traitlets 4.2.This error will be raised in a future release of traitlets.
2025-01-14T13:16:43.1070990Z 
2025-01-14T13:16:43.1071180Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-01-14T13:16:43.1071180Z 
2025-01-14T13:16:43.1071410Z ---------- coverage: platform darwin, python 3.12.4-final-0 ----------
2025-01-14T13:16:43.1071550Z Coverage HTML written to dir coverage_html_report
2025-01-14T13:16:43.1071630Z Coverage XML written to file coverage.xml
2025-01-14T13:16:43.1071630Z 
2025-01-14T13:16:43.1071730Z =========================== short test summary info ============================
2025-01-14T13:16:43.1072250Z FAILED tardis/tests/test_tardis_full.py::test_run_tardis_from_config_obj - Failed: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1073710Z FAILED tardis/transport/montecarlo/tests/test_montecarlo_main_loop.py::test_montecarlo_main_loop - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1075250Z FAILED tardis/transport/montecarlo/tests/test_montecarlo_main_loop.py::test_montecarlo_main_loop_vpacket_log - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1076150Z FAILED tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py::test_last_interaction_properties[interaction_type_in_use-interaction_type_to_check] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1077310Z FAILED tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py::test_last_interaction_properties[shell_id_in_use-shell_id_to_check] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1078060Z FAILED tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py::test_last_interaction_properties[r_in_use-r_to_check] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1078900Z FAILED tardis/transport/montecarlo/tests/test_rpacket_last_interaction_tracker.py::test_last_interaction_properties[nu_packet_collection-nu_to_check] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1079760Z FAILED tardis/transport/montecarlo/tests/test_rpacket_tracker.py::test_rpacket_tracker_properties[interaction_type_last_interaction_class-last_interaction_type_rpacket_tracker] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1080860Z FAILED tardis/transport/montecarlo/tests/test_rpacket_tracker.py::test_rpacket_tracker_properties[shell_id_last_interaction_class-shell_id_rpacket_tracker] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1081870Z FAILED tardis/transport/montecarlo/tests/test_rpacket_tracker.py::test_rpacket_tracker_properties[nu_from_packet_collection-nu_rpacket_tracker] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1082580Z FAILED tardis/transport/montecarlo/tests/test_weighted_packet_source_integration.py::test_montecarlo_main_loop_weighted - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1083130Z ERROR tardis/model/tests/test_base.py::TestModelFromPaper1Config::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1084000Z ERROR tardis/model/tests/test_base.py::TestModelFromPaper1Config::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1084500Z ERROR tardis/model/tests/test_base.py::TestModelFromPaper1Config::test_densities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1085060Z ERROR tardis/model/tests/test_base.py::TestModelFromPaper1Config::test_time_explosion - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1085590Z ERROR tardis/model/tests/test_base.py::TestModelFromASCIIDensity::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1086140Z ERROR tardis/model/tests/test_base.py::TestModelFromASCIIDensity::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1086710Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensity::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1087210Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensity::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1087840Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundances::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1088660Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundances::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1089230Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundancesVSlice::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1090360Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundancesVSlice::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1090970Z ERROR tardis/model/tests/test_base.py::TestModelFromUniformDensity::test_density - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1091630Z ERROR tardis/model/tests/test_base.py::TestModelFromInitialTinner::test_initial_temperature - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1092370Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundancesAllAscii::test_velocities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1092970Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundancesAllAscii::test_abundances - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1093620Z ERROR tardis/model/tests/test_base.py::TestModelFromArtisDensityAbundancesAllAscii::test_densities - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1094100Z ERROR tardis/model/tests/test_base.py::test_ascii_reader_power_law - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1094740Z ERROR tardis/model/tests/test_base.py::test_ascii_reader_exponential_law - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1096700Z ERROR tardis/model/tests/test_base.py::test_radial_1D_geometry_volume[0-1.00977478e+45] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1097550Z ERROR tardis/model/tests/test_base.py::test_radial_1D_geometry_volume[10-1.98154804e+45] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1099390Z ERROR tardis/model/tests/test_base.py::test_radial_1D_geometry_volume[19-3.13361319e+45] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1100960Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index0-539428198] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1102870Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index1-409675383] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1103470Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index2-314387928] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1104100Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index3-56066111] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1104750Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index4-42580098] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1105390Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index5-32676283] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1105910Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index6-841032262] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1106540Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index7-638732300] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1107810Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index8-490167906] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1108420Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index9-269136275] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1108930Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index10-204398856] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1109440Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index11-156857199] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1109930Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index12-45482957] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1110430Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index13-34542591] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1110940Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index14-26508241] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1111510Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index15-34001569] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1111990Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index16-25822910] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1112500Z ERROR tardis/model/tests/test_base.py::test_composition_elemental_number_density[index17-19816693] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1112970Z ERROR tardis/model/tests/test_base.py::test_simulation_state_mass[index0-1.4471412e+31] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1113410Z ERROR tardis/model/tests/test_base.py::test_simulation_state_mass[index1-2.6820129e+30] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1113890Z ERROR tardis/model/tests/test_base.py::test_simulation_state_mass[index2-1.3464444e+29] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1114500Z ERROR tardis/model/tests/test_base.py::test_radial_1d_model_atomic_mass[index0-1.67378172e-24] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1114960Z ERROR tardis/model/tests/test_base.py::test_radial_1d_model_atomic_mass[index1-9.51707707e-23] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1115440Z ERROR tardis/model/tests/test_base.py::test_radial_1d_model_atomic_mass[index2-9.54725917e-23] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1116010Z ERROR tardis/model/tests/test_base.py::TestModelStateFromNonUniformAbundances::test_atomic_mass - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1116560Z ERROR tardis/model/tests/test_base.py::TestModelStateFromNonUniformAbundances::test_elemental_number_density - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1117030Z ERROR tardis/model/tests/test_base.py::test_hdf_simulation_state_scalars[t_inner] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1117710Z ERROR tardis/model/tests/test_base.py::test_hdf_simulation_state_nparray[dilution_factor] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1118150Z ERROR tardis/model/tests/test_base.py::test_hdf_simulation_state_nparray[v_inner] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1118600Z ERROR tardis/model/tests/test_base.py::test_hdf_simulation_state_nparray[v_outer] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1119010Z ERROR tardis/model/tests/test_density.py::test_hdf_density_0 - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1119390Z ERROR tardis/model/tests/test_density.py::test_hdf_time_0 - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1119960Z ERROR tardis/opacities/tests/test_opacity_solver.py::test_opacity_solver[scatter-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1120420Z ERROR tardis/opacities/tests/test_opacity_solver.py::test_opacity_solver[macroatom-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1120880Z ERROR tardis/opacities/tests/test_opacity_solver.py::test_opacity_solver[macroatom-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1121340Z ERROR tardis/opacities/tests/test_opacity_solver.py::test_opacity_solver[downbranch-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1121970Z ERROR tardis/opacities/tests/test_opacity_solver.py::test_opacity_solver[downbranch-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1122480Z ERROR tardis/opacities/tests/test_opacity_state_numba.py::test_opacity_state_to_numba[scatter-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1123000Z ERROR tardis/opacities/tests/test_opacity_state_numba.py::test_opacity_state_to_numba[macroatom-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1123800Z ERROR tardis/opacities/tests/test_opacity_state_numba.py::test_opacity_state_to_numba[macroatom-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1124310Z ERROR tardis/opacities/tests/test_opacity_state_numba.py::test_opacity_state_to_numba[downbranch-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1124830Z ERROR tardis/opacities/tests/test_opacity_state_numba.py::test_opacity_state_to_numba[downbranch-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1125360Z ERROR tardis/opacities/tests/test_tau_sobolev.py::test_calculate_sobolev_line_opacity - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1125850Z ERROR tardis/opacities/tests/test_tau_sobolev.py::test_calculate_beta_sobolevs - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1126630Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[number_density] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1127480Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[beta_rad] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1128700Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[general_level_boltzmann_factor] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1129930Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[level_boltzmann_factor] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1130410Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[stimulated_emission_factor] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1131820Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[t_electrons] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1133660Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[wavelength_cm] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1134950Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[lines_lower_level_index] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1136240Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[ionization_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1137510Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[density] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1139140Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[atomic_mass] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1140580Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[level_number_density] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1141940Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[lines_upper_level_index] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1142740Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1144070Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[beta_sobolev] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1144600Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[transition_probabilities] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1145370Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[phi] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1145830Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[electron_densities] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1146240Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[t_rad] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1146810Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[selected_atoms] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1147270Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[ion_number_density] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1147730Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[partition_function] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1148170Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[abundance] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1148610Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[g_electron] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1149010Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[g] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1149680Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[lines] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1150090Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[f_lu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1150530Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[tau_sobolevs] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1150960Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[j_blues] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1151390Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[metastability] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1151780Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[w] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1152230Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_plasma[excitation_energy] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1152750Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_levels - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1153180Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_scalars[time_explosion] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1153640Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_scalars[link_t_rad_t_electron] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1154140Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_hdf_helium_treatment - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1155380Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_atomic_data_uuid - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1155840Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_collection[t_rad] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1156440Z ERROR tardis/plasma/tests/test_hdf_plasma.py::test_collection[w] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1156930Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_state_iterations[iterations_w] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1157420Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_state_iterations[iterations_t_rad] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1157940Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_state_iterations[iterations_electron_densities] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1158420Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_state_iterations[iterations_t_inner] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1158890Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[nu_bar_estimator] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1159410Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[j_estimator] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1159880Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[t_radiative] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1160350Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[dilution_factor] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1160800Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[output_nus] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1161280Z ERROR tardis/simulation/tests/test_simulation.py::test_plasma_estimates[output_energies] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1161770Z ERROR tardis/spectrum/tests/test_spectrum_solver.py::TestSpectrumSolver::test_initialization - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1162280Z ERROR tardis/spectrum/tests/test_spectrum_solver.py::TestSpectrumSolver::test_spectrum_real_packets - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1162990Z ERROR tardis/spectrum/tests/test_spectrum_solver.py::TestSpectrumSolver::test_spectrum_real_packets_reabsorbed - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1163450Z ERROR tardis/spectrum/tests/test_spectrum_solver.py::TestSpectrumSolver::test_solve - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1164000Z ERROR tardis/tests/test_tardis_full.py::TestTransportSimple::test_j_blue_estimators - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1164440Z ERROR tardis/tests/test_tardis_full.py::TestTransportSimple::test_spectrum - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1164880Z ERROR tardis/tests/test_tardis_full.py::TestTransportSimple::test_virtual_spectrum - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1165540Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_simulation[-1-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1166130Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_j_blue_estimators[-1-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1166710Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum[-1-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1167670Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum_integrated[-1-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1168280Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_simulation[-1-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1169050Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_j_blue_estimators[-1-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1169600Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum[-1-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1170190Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum_integrated[-1-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1170760Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_simulation[30-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1171320Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_j_blue_estimators[30-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1171890Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum[30-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1173060Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum_integrated[30-macroatom] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1173660Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_simulation[30-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1174310Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_j_blue_estimators[30-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1174860Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum[30-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1175720Z ERROR tardis/tests/test_tardis_full_formal_integral.py::TestTransportSimpleFormalIntegral::test_spectrum_integrated[30-downbranch] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1176190Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[output_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1176660Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[output_energy] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1177140Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[nu_bar_estimator] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1177620Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[j_estimator] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1178140Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[emitted_packet_mask] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1178720Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_interaction_type] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1179210Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_interaction_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1179700Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_interaction_in_r] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1180230Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_line_interaction_out_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1180740Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_line_interaction_in_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1181260Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[last_line_interaction_shell_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1181830Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_nus] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1182320Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_energies] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1182950Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_initial_rs] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1186220Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_initial_mus] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1186820Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_interaction_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1187550Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_interaction_in_r] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1188090Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_interaction_type] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1188630Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_line_interaction_in_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1189190Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_line_interaction_out_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1189740Z ERROR tardis/transport/montecarlo/tests/test_base.py::test_hdf_transport_state[virt_packet_last_line_interaction_shell_id] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1190440Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_thomson_scatter - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1190910Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_scatter[0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1191360Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_scatter[1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1191810Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_scatter[2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1192480Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_emission[test_packet0-expected0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1193010Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_emission[test_packet1-expected1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1193520Z ERROR tardis/transport/montecarlo/tests/test_interaction.py::test_line_emission[test_packet2-expected2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1194140Z ERROR tardis/transport/montecarlo/tests/test_macro_atom.py::test_macro_atom[1963-10015] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1194610Z ERROR tardis/transport/montecarlo/tests/test_macro_atom.py::test_macro_atom[1-9993] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1195200Z ERROR tardis/transport/montecarlo/tests/test_macro_atom.py::test_macro_atom[2111963-17296] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1195700Z ERROR tardis/transport/montecarlo/tests/test_macro_atom.py::test_macro_atom[10000-9993] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1196260Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_opacity_state_initialize[scatter-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1196890Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_opacity_state_initialize[macroatom-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1197430Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_opacity_state_initialize[macroatom-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1197970Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_opacity_state_initialize[downbranch-False] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1198800Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_opacity_state_initialize[downbranch-True] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1199360Z ERROR tardis/transport/montecarlo/tests/test_numba_interface.py::test_VPacketCollection_add_packet - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1200010Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_emitted[132-11-132] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1200550Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_emitted[132-1-133] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1201240Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_emitted[132-2-133] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1201810Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_reabsorbed[132--133-132] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1202390Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_reabsorbed[132--133-133] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1203030Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_reabsorbed[132--1000000000.0-133] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1203840Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_increment[132--1-199] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1204470Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_increment[132-0-132] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1205100Z ERROR tardis/transport/montecarlo/tests/test_packet.py::test_move_packet_across_shell_boundary_increment[132-20-154] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1205760Z ERROR tardis/transport/montecarlo/tests/test_rpacket_tracker.py::test_boundary_interactions - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1206360Z ERROR tardis/transport/montecarlo/tests/test_rpacket_tracker.py::test_rpacket_trackers_to_dataframe - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1207040Z ERROR tardis/transport/montecarlo/tests/test_vpacket.py::test_trace_vpacket_within_shell - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1207580Z ERROR tardis/transport/montecarlo/tests/test_vpacket.py::test_trace_vpacket - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1208110Z ERROR tardis/transport/montecarlo/tests/test_vpacket.py::test_trace_bad_vpacket - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1209030Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_parse_species_list[_species_list] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1209640Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_parse_species_list[_keep_colour] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1210260Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_parse_species_list[_species_mapped] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1211060Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data0-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1211690Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data0-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1212360Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data0-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1213050Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data1-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1213730Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data1-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1214400Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data1-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1215370Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data2-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1216000Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data2-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1216760Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data2-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1217440Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data3-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1218340Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data3-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1219010Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data3-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1221500Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data4-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1224130Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data4-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1226360Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data4-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1228730Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data5-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1230580Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data5-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1232780Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data5-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1234680Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data6-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1236660Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data6-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1240560Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data6-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1243390Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data7-plot_data] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1245950Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data7-plot_colors] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1247720Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_prepare_plot_data[plotter_prepare_plot_data7-new_bin_edges] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1249570Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1252840Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1254480Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1255750Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1256420Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1256990Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1257930Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1258470Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_mpl[plotter_generate_plot_mpl7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1259010Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1259540Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1260060Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1260590Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1261310Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1261860Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1262530Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1263220Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_mpl_image[plotter_generate_plot_mpl7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1263890Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1264460Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1265020Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1265570Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1266120Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1266720Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1267260Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1267810Z ERROR tardis/visualization/tools/tests/test_liv_plot.py::TestLIVPlotter::test_generate_plot_ply[plotter_generate_plot_ply7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1268350Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_coordinates_with_theta_init - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1268910Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_coordinates_multiple_packets[2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1269470Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_coordinates_multiple_packets[5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1270160Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_coordinates_multiple_packets[10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1270710Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_equal_array_size[2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1271230Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_equal_array_size[5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1271800Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_equal_array_size[10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1273080Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[light-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1275480Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[light-5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1276980Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[light-10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1278420Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[dark-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1280460Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[dark-5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1281950Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_frames[dark-10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1283900Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_slider_steps[10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1285870Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_slider_steps[30] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1287790Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_get_slider_steps[50] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1289730Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[light-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1291230Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[light-5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1292680Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[light-10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1294130Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[dark-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1297710Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[dark-5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1299810Z ERROR tardis/visualization/tools/tests/test_rpacket_plot.py::TestRPacketPlotter::test_generate_plot[dark-10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1300690Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_parse_species_list[_full_species_list] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1301230Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_parse_species_list[_species_list] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1301760Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_parse_species_list[_keep_colour] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1302750Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1303490Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1304080Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1304690Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1305410Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1306010Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1306600Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1307200Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1307790Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data8] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1308380Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data9] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1310560Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1311630Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data11] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1312550Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data12] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1313140Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data13] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1313840Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data14] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1314430Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_calculate_plotting_data[plotter_calculate_plotting_data15] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1315340Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1315920Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1316470Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1319880Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1320600Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1321210Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1322590Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1323170Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1323720Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply8] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1324550Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply9] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1325100Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1325760Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply11] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1326320Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply12] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1327180Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply13] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1328750Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply14] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1329730Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_generate_plot_mpl[plotter_generate_plot_ply15] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1330300Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1330930Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1333000Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1333570Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl3] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1334110Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl4] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1334660Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl5] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1335210Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl6] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1336050Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl7] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1336600Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl8] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1339200Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl9] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1341910Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl10] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1342630Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl11] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1343450Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl12] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1344230Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl13] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1344810Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl14] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1345340Z ERROR tardis/visualization/tools/tests/test_sdec_plot.py::TestSDECPlotter::test_mpl_image[plotter_generate_plot_mpl15] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1346620Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_species_interactions[wavelength_range0-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1347270Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_species_interactions[wavelength_range1-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1348120Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_species_interactions[wavelength_range2-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1348720Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_species_interactions[None-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1349460Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[exc-wavelength_range0-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1350070Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[exc-wavelength_range1-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1350690Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[exc-wavelength_range2-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1351280Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[exc-None-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1352940Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[de-exc-wavelength_range0-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1355670Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[de-exc-wavelength_range1-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1356480Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[de-exc-wavelength_range2-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1358340Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[de-exc-None-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1359340Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[both-wavelength_range0-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1360500Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[both-wavelength_range1-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1361320Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[both-wavelength_range2-packet_out_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1362130Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetData::test_get_last_line_counts[both-None-packet_in_nu] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1362830Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_plot[liw_with_selection0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1364300Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[liw_with_selection0-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1365630Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[liw_with_selection0-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1367620Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_species_intrctn_table[liw_with_selection0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1368870Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection0-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1369580Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection0-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1370440Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection0-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1371110Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_plot[liw_with_selection1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1372030Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[liw_with_selection1-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1373390Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[liw_with_selection1-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1374460Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_species_intrctn_table[liw_with_selection1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1376320Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection1-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1377660Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection1-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1378960Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[liw_with_selection1-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1379540Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_plot[None] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1380420Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[None-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1380970Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_filter_mode_toggle[None-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1381550Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_selection_on_species_intrctn_table[None] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1382100Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[None-0] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1382640Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[None-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1383320Z ERROR tardis/visualization/widgets/tests/test_line_info.py::TestLineInfoWidgetEvents::test_group_mode_change[None-2] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1383950Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_shells_data - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1384690Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_element_count_data[1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1385430Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_element_count_data[20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1386590Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_ion_count_data[12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1387130Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_ion_count_data[20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1388190Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_level_count_data[2-12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1388720Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestBaseShellInfo::test_level_count_data[3-20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1389800Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_shells_data - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1390350Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_element_count_data[1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1392620Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_element_count_data[20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1393320Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_ion_count_data[12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1393860Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_ion_count_data[20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1394400Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_level_count_data[2-12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1395020Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestSimulationShellInfo::test_level_count_data[3-20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1395530Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_shells_data - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1396030Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_element_count_data[1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1396960Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_element_count_data[20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1397650Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_ion_count_data[12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1398190Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_ion_count_data[20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1405000Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_level_count_data[2-12-1] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1405580Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestHDFShellInfo::test_level_count_data[3-20-20] - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1406140Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestShellInfoWidget::test_selection_on_shells_table - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1406900Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestShellInfoWidget::test_selection_on_element_count_table - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1408890Z ERROR tardis/visualization/widgets/tests/test_shell_info.py::TestShellInfoWidget::test_selection_on_ion_count_table - UnboundLocalError: cannot access local variable 'opacity_state_numba' where it is not associated with a value
2025-01-14T13:16:43.1409610Z = 11 failed, 1052 passed, 329 skipped, 2 deselected, 23 xfailed, 4 xpassed, 69 warnings, 375 errors in 431.08s (0:07:11) =
2025-01-14T13:16:44.6632340Z ##[error]Process completed with exit code 1.
